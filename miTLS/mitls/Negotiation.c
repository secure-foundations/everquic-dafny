/* 
  This file was generated by KreMLin <https://github.com/FStarLang/kremlin>
  KreMLin invocation: D:\everest\kremlin\_build\src\Kremlin.native -minimal -add-include "kremlib.h" -fnoanonymous-unions -warn-error -9-7-6@4-14-15 -fsopts --debug,yes -verbose -library EverCrypt,EverCrypt.*,Hacl.*,Interop_assumptions,Check_sha_stdcall,Sha_update_bytes_stdcall,Check_aesni_stdcall -drop MonotoneMap -drop MonotoneMapNonDep -drop FStar.Tactics.\* -drop FStar.Tactics -drop Crypto.AEAD.\* -drop Crypto.HKDF -drop Crypto.HMAC -add-include "hacks.h" -add-include "kremlin/internal/compat.h" -bundle LowParse.\*,LowParseWrappers[rename=LowParse] -bundle Format.\* -bundle EverCrypt=EverCrypt,EverCrypt.\* -bundle FStar.\*,LowStar.\*,C,C.\*[rename=Mitls_Kremlib] -bundle Parsers.\* -bundle Spec.\* -bundle Meta.\* -bundle Lib.*[rename=Hacl_Lib] -bundle Hacl.\* -bundle KDF.\*,KDF,Idx,IV,Pkg,Pkg.\*[rename=Pkg] -bundle TLSConstants=TLSConstants,QD.TLS_protocolVersion,List.Helpers -bundle Hashing=Hashing.Spec,Hashing,Hashing.CRF,HMAC,HKDF,HMAC.UFCMA -bundle Old.Handshake=Old.HMAC.UFCMA,Old.Epochs,Old.KeySchedule,Old.Handshake -bundle StatefulLHAE=AEAD_GCM,LHAEPlain,StatefulPlain,StatefulLHAE -bundle StreamAE=StreamPlain,StreamAE -bundle CommonDH=TLS.Curve25519,DHGroup,ECGroup,CommonDH -bundle Content=Content,DataStream -bundle Record=Record,StAE,Transport,StreamDeltas -bundle PMS=PMS,RSAKey,TLSPRF -bundle Crypto.Plain=Buffer.Utils,Crypto.Indexing,Crypto.Plain,Crypto.Symmetric.Bytes -bundle Flags=DebugFlags,Flags,Flag,TLSInfoFlags -bundle Vale.Stdcalls.*,Vale.Interop,Vale.Interop.*,Vale.Wrapper.X64.*[rename=Vale] -bundle Vale.Inline.X64.*[rename=Vale_Inline] -bundle Vale.*[rename=Unused2] -ldopts -L,D:/everest/MLCrypto/openssl,-lcrypto,-lssl extract/Kremlin/FStar_Pervasives_Native.krml extract/Kremlin/FStar_Pervasives.krml extract/Kremlin/FStar_Squash.krml extract/Kremlin/FStar_Classical.krml extract/Kremlin/FStar_Preorder.krml extract/Kremlin/FStar_Calc.krml extract/Kremlin/FStar_Mul.krml extract/Kremlin/FStar_Math_Lib.krml extract/Kremlin/FStar_Math_Lemmas.krml extract/Kremlin/FStar_StrongExcludedMiddle.krml extract/Kremlin/FStar_FunctionalExtensionality.krml extract/Kremlin/FStar_List_Tot_Base.krml extract/Kremlin/FStar_List_Tot_Properties.krml extract/Kremlin/FStar_List_Tot.krml extract/Kremlin/FStar_Seq_Base.krml extract/Kremlin/FStar_Seq_Properties.krml extract/Kremlin/FStar_Seq.krml extract/Kremlin/FStar_BitVector.krml extract/Kremlin/FStar_UInt.krml extract/Kremlin/FStar_UInt32.krml extract/Kremlin/FStar_UInt8.krml extract/Kremlin/FStar_Exn.krml extract/Kremlin/FStar_Set.krml extract/Kremlin/FStar_Monotonic_Witnessed.krml extract/Kremlin/FStar_Ghost.krml extract/Kremlin/FStar_ErasedLogic.krml extract/Kremlin/FStar_PropositionalExtensionality.krml extract/Kremlin/FStar_PredicateExtensionality.krml extract/Kremlin/FStar_TSet.krml extract/Kremlin/FStar_Monotonic_Heap.krml extract/Kremlin/FStar_Heap.krml extract/Kremlin/FStar_ST.krml extract/Kremlin/FStar_All.krml extract/Kremlin/Lib_LoopCombinators.krml extract/Kremlin/FStar_Int.krml extract/Kremlin/FStar_Int64.krml extract/Kremlin/FStar_Int63.krml extract/Kremlin/FStar_Int32.krml extract/Kremlin/FStar_Int16.krml extract/Kremlin/FStar_Int8.krml extract/Kremlin/FStar_UInt64.krml extract/Kremlin/FStar_UInt63.krml extract/Kremlin/FStar_UInt16.krml extract/Kremlin/FStar_Int_Cast.krml extract/Kremlin/FStar_UInt128.krml extract/Kremlin/FStar_Int_Cast_Full.krml extract/Kremlin/FStar_Int128.krml extract/Kremlin/Lib_IntTypes.krml extract/Kremlin/Lib_RawIntTypes.krml extract/Kremlin/Lib_Sequence.krml extract/Kremlin/Lib_ByteSequence.krml extract/Kremlin/Spec_Chacha20.krml extract/Kremlin/Meta_Attribute.krml extract/Kremlin/FStar_Map.krml extract/Kremlin/FStar_Monotonic_HyperHeap.krml extract/Kremlin/FStar_Monotonic_HyperStack.krml extract/Kremlin/FStar_HyperStack.krml extract/Kremlin/FStar_HyperStack_ST.krml extract/Kremlin/FStar_Universe.krml extract/Kremlin/FStar_GSet.krml extract/Kremlin/FStar_ModifiesGen.krml extract/Kremlin/FStar_Range.krml extract/Kremlin/FStar_Reflection_Types.krml extract/Kremlin/FStar_Tactics_Types.krml extract/Kremlin/FStar_Tactics_Result.krml extract/Kremlin/FStar_Tactics_Effect.krml extract/Kremlin/FStar_Reflection_Data.krml extract/Kremlin/FStar_Tactics_Builtins.krml extract/Kremlin/FStar_Reflection_Const.krml extract/Kremlin/FStar_Char.krml extract/Kremlin/FStar_List.krml extract/Kremlin/FStar_String.krml extract/Kremlin/FStar_Order.krml extract/Kremlin/FStar_Reflection_Basic.krml extract/Kremlin/FStar_Reflection_Derived.krml extract/Kremlin/FStar_Reflection_Derived_Lemmas.krml extract/Kremlin/FStar_Reflection.krml extract/Kremlin/FStar_Tactics_SyntaxHelpers.krml extract/Kremlin/FStar_Tactics_Util.krml extract/Kremlin/FStar_Reflection_Formula.krml extract/Kremlin/FStar_Tactics_Derived.krml extract/Kremlin/FStar_Tactics_Logic.krml extract/Kremlin/FStar_Tactics.krml extract/Kremlin/FStar_BigOps.krml extract/Kremlin/LowStar_Monotonic_Buffer.krml extract/Kremlin/LowStar_Buffer.krml extract/Kremlin/LowStar_BufferOps.krml extract/Kremlin/Spec_Loops.krml extract/Kremlin/C_Loops.krml extract/Kremlin/Lib_Loops.krml extract/Kremlin/FStar_Endianness.krml extract/Kremlin/LowStar_Endianness.krml extract/Kremlin/LowStar_ImmutableBuffer.krml extract/Kremlin/Lib_Buffer.krml extract/Kremlin/Lib_ByteBuffer.krml extract/Kremlin/FStar_HyperStack_All.krml extract/Kremlin/Lib_IntVector_Intrinsics.krml extract/Kremlin/Spec_GaloisField.krml extract/Kremlin/Spec_AES.krml extract/Kremlin/Lib_IntVector.krml extract/Kremlin/Hacl_Spec_Chacha20_Vec.krml extract/Kremlin/Hacl_Spec_Chacha20_Lemmas.krml extract/Kremlin/Lib_Sequence_Lemmas.krml extract/Kremlin/Hacl_Spec_Chacha20_Equiv.krml extract/Kremlin/Hacl_Impl_Chacha20_Core32xN.krml extract/Kremlin/Hacl_Impl_Chacha20_Vec.krml extract/Kremlin/Vale_Lib_Seqs_s.krml extract/Kremlin/Vale_Def_Words_s.krml extract/Kremlin/Vale_Def_Words_Four_s.krml extract/Kremlin/Vale_Def_Words_Two_s.krml extract/Kremlin/Vale_Def_Words_Seq_s.krml extract/Kremlin/Vale_Def_Opaque_s.krml extract/Kremlin/Vale_Def_Types_s.krml extract/Kremlin/Vale_X64_Machine_s.krml extract/Kremlin/Vale_Lib_Map16.krml extract/Kremlin/Vale_Def_Prop_s.krml extract/Kremlin/Vale_X64_Flags.krml extract/Kremlin/Vale_X64_CPU_Features_s.krml extract/Kremlin/Vale_Curve25519_Fast_lemmas_internal.krml extract/Kremlin/Vale_Lib_Meta.krml extract/Kremlin/Vale_Def_Words_Two.krml extract/Kremlin/Vale_Lib_Seqs.krml extract/Kremlin/Vale_Def_TypesNative_s.krml extract/Kremlin/Vale_Arch_TypesNative.krml extract/Kremlin/Vale_Def_Words_Seq.krml extract/Kremlin/Vale_Arch_Types.krml extract/Kremlin/Vale_Curve25519_Fast_defs.krml extract/Kremlin/FStar_Algebra_CommMonoid.krml extract/Kremlin/FStar_Tactics_CanonCommSemiring.krml extract/Kremlin/Vale_Curve25519_FastUtil_helpers.krml extract/Kremlin/Vale_Curve25519_FastHybrid_helpers.krml extract/Kremlin/Vale_Curve25519_Fast_lemmas_external.krml extract/Kremlin/Vale_X64_Regs.krml extract/Kremlin/FStar_Float.krml extract/Kremlin/FStar_IO.krml extract/Kremlin/Vale_Def_PossiblyMonad.krml extract/Kremlin/LowStar_BufferView_Down.krml extract/Kremlin/LowStar_BufferView_Up.krml extract/Kremlin/Vale_Interop_Views.krml extract/Kremlin/FStar_Option.krml extract/Kremlin/Vale_Lib_Set.krml extract/Kremlin/Vale_X64_Instruction_s.krml extract/Kremlin/Vale_X64_Bytes_Code_s.krml extract/Kremlin/Vale_AES_AES_s.krml extract/Kremlin/Vale_Math_Poly2_Defs_s.krml extract/Kremlin/Vale_Math_Poly2_s.krml extract/Kremlin/Vale_Math_Poly2_Bits_s.krml extract/Kremlin/Spec_Hash_Definitions.krml extract/Kremlin/Spec_Hash_Lemmas0.krml extract/Kremlin/Spec_Hash_PadFinish.krml extract/Kremlin/Spec_SHA2_Constants.krml extract/Kremlin/Spec_SHA2.krml extract/Kremlin/Vale_X64_CryptoInstructions_s.krml extract/Kremlin/Vale_X64_Instructions_s.krml extract/Kremlin/Vale_Arch_HeapTypes_s.krml extract/Kremlin/Vale_Interop_Types.krml extract/Kremlin/Vale_Arch_MachineHeap_s.krml extract/Kremlin/Vale_Interop_Heap_s.krml extract/Kremlin/LowStar_Modifies.krml extract/Kremlin/LowStar_ModifiesPat.krml extract/Kremlin/LowStar_BufferView.krml extract/Kremlin/Vale_Lib_BufferViewHelpers.krml extract/Kremlin/Vale_Interop.krml extract/Kremlin/Vale_Arch_HeapImpl.krml extract/Kremlin/Vale_Arch_Heap.krml extract/Kremlin/Vale_X64_Machine_Semantics_s.krml extract/Kremlin/Vale_Interop_Base.krml extract/Kremlin/Vale_X64_Memory.krml extract/Kremlin/Vale_Arch_MachineHeap.krml extract/Kremlin/Vale_X64_Stack_i.krml extract/Kremlin/Vale_X64_Stack_Sems.krml extract/Kremlin/Vale_X64_BufferViewStore.krml extract/Kremlin/Vale_X64_Memory_Sems.krml extract/Kremlin/Vale_X64_State.krml extract/Kremlin/Vale_X64_StateLemmas.krml extract/Kremlin/Vale_X64_Lemmas.krml extract/Kremlin/Vale_X64_Print_s.krml extract/Kremlin/Vale_X64_Decls.krml extract/Kremlin/Vale_X64_QuickCode.krml extract/Kremlin/Vale_X64_QuickCodes.krml extract/Kremlin/Vale_X64_Taint_Semantics.krml extract/Kremlin/Vale_X64_InsLemmas.krml extract/Kremlin/Vale_X64_InsBasic.krml extract/Kremlin/Vale_X64_InsMem.krml extract/Kremlin/Vale_X64_InsVector.krml extract/Kremlin/Vale_X64_InsStack.krml extract/Kremlin/Vale_Curve25519_X64_FastHybrid.krml extract/Kremlin/Vale_Bignum_Defs.krml extract/Kremlin/Vale_Bignum_X64.krml extract/Kremlin/Vale_Curve25519_FastSqr_helpers.krml extract/Kremlin/Vale_Curve25519_X64_FastSqr.krml extract/Kremlin/Vale_Curve25519_FastMul_helpers.krml extract/Kremlin/Vale_Curve25519_X64_FastMul.krml extract/Kremlin/Vale_Curve25519_X64_FastWide.krml extract/Kremlin/Vale_Curve25519_X64_FastUtil.krml extract/Kremlin/Vale_X64_MemoryAdapters.krml extract/Kremlin/Vale_Interop_Assumptions.krml extract/Kremlin/Vale_Interop_X64.krml extract/Kremlin/Vale_AsLowStar_ValeSig.krml extract/Kremlin/Vale_AsLowStar_LowStarSig.krml extract/Kremlin/Vale_AsLowStar_MemoryHelpers.krml extract/Kremlin/Vale_AsLowStar_Wrapper.krml extract/Kremlin/Vale_Stdcalls_X64_Fadd.krml extract/Kremlin/Vale_Wrapper_X64_Fadd.krml extract/Kremlin/Spec_SHA1.krml extract/Kremlin/Spec_MD5.krml extract/Kremlin/Spec_Agile_Hash.krml extract/Kremlin/Spec_Hash_Incremental.krml extract/Kremlin/Spec_Hash_Lemmas.krml extract/Kremlin/FStar_Kremlin_Endianness.krml extract/Kremlin/Hacl_Hash_Lemmas.krml extract/Kremlin/Hacl_Hash_Definitions.krml extract/Kremlin/Hacl_Hash_PadFinish.krml extract/Kremlin/Hacl_Hash_MD.krml extract/Kremlin/Spec_SHA2_Lemmas.krml extract/Kremlin/Vale_X64_Stack.krml extract/Kremlin/Vale_SHA_SHA_helpers.krml extract/Kremlin/Vale_X64_InsSha.krml extract/Kremlin/Vale_SHA_X64.krml extract/Kremlin/Vale_Stdcalls_X64_Sha.krml extract/Kremlin/FStar_BV.krml extract/Kremlin/FStar_Reflection_Arith.krml extract/Kremlin/FStar_Tactics_BV.krml extract/Kremlin/Vale_Lib_Bv_s.krml extract/Kremlin/Vale_Math_Bits.krml extract/Kremlin/Vale_Lib_Tactics.krml extract/Kremlin/Vale_Poly1305_Bitvectors.krml extract/Kremlin/Vale_Math_Lemmas_Int.krml extract/Kremlin/FStar_Tactics_Canon.krml extract/Kremlin/Vale_Poly1305_Spec_s.krml extract/Kremlin/Vale_Poly1305_Math.krml extract/Kremlin/Vale_Poly1305_Util.krml extract/Kremlin/Vale_Poly1305_X64.krml extract/Kremlin/Vale_Stdcalls_X64_Poly.krml extract/Kremlin/Vale_Wrapper_X64_Poly.krml extract/Kremlin/Vale_Arch_BufferFriend.krml extract/Kremlin/Vale_SHA_Simplify_Sha.krml extract/Kremlin/Vale_Wrapper_X64_Sha.krml extract/Kremlin/Hacl_Hash_Core_SHA2_Constants.krml extract/Kremlin/Hacl_Hash_Core_SHA2.krml extract/Kremlin/Hacl_Hash_SHA2.krml extract/Kremlin/Hacl_Hash_Core_SHA1.krml extract/Kremlin/Hacl_Hash_SHA1.krml extract/Kremlin/Hacl_Hash_Core_MD5.krml extract/Kremlin/Hacl_Hash_MD5.krml extract/Kremlin/C.krml extract/Kremlin/C_String.krml extract/Kremlin/C_Failure.krml extract/Kremlin/FStar_Int31.krml extract/Kremlin/FStar_UInt31.krml extract/Kremlin/FStar_Integers.krml extract/Kremlin/EverCrypt_StaticConfig.krml extract/Kremlin/EverCrypt_TargetConfig.krml extract/Kremlin/Vale_Lib_Basic.krml extract/Kremlin/Vale_Lib_X64_Cpuid.krml extract/Kremlin/Vale_Lib_X64_Cpuidstdcall.krml extract/Kremlin/Vale_Stdcalls_X64_Cpuid.krml extract/Kremlin/Vale_Wrapper_X64_Cpuid.krml extract/Kremlin/EverCrypt_AutoConfig2.krml extract/Kremlin/EverCrypt_Helpers.krml extract/Kremlin/EverCrypt_Hash.krml extract/Kremlin/Spec_Agile_HMAC.krml extract/Kremlin/Hacl_HMAC.krml extract/Kremlin/EverCrypt_HMAC.krml extract/Kremlin/Declassify.krml extract/Kremlin/FStar_Bytes.krml extract/Kremlin/Hashing_Spec.krml extract/Kremlin/LowParse_Bytes32.krml extract/Kremlin/LowParse_Bytes.krml extract/Kremlin/LowParse_Spec_Base.krml extract/Kremlin/LowParse_SLow_Base.krml extract/Kremlin/LowParse_Spec_Option.krml extract/Kremlin/LowParse_SLow_Option.krml extract/Kremlin/LowParse_Spec_Combinators.krml extract/Kremlin/LowParse_Spec_IfThenElse.krml extract/Kremlin/LowParse_SLow_Combinators.krml extract/Kremlin/LowParse_Spec_List.krml extract/Kremlin/LowParse_SLow_List.krml extract/Kremlin/Spec_Curve25519_Lemmas.krml extract/Kremlin/Spec_Curve25519.krml extract/Kremlin/Hacl_Spec_Curve25519_AddAndDouble.krml extract/Kremlin/Hacl_Impl_Curve25519_Lemmas.krml extract/Kremlin/Hacl_Spec_Curve25519_Field64_Definition.krml extract/Kremlin/Hacl_Spec_Curve25519_Field64_Lemmas.krml extract/Kremlin/Hacl_Spec_Curve25519_Field64_Core.krml extract/Kremlin/Hacl_Spec_Curve25519_Field64.krml extract/Kremlin/Hacl_Spec_Curve25519_Field51_Definition.krml extract/Kremlin/Hacl_Spec_Curve25519_Field51_Lemmas.krml extract/Kremlin/Hacl_Spec_Curve25519_Field51.krml extract/Kremlin/Hacl_Impl_Curve25519_Fields_Core.krml extract/Kremlin/Hacl_Impl_Curve25519_Field64.krml extract/Kremlin/Hacl_Impl_Curve25519_Field51.krml extract/Kremlin/Hacl_Impl_Curve25519_Fields.krml extract/Kremlin/Hacl_Impl_Curve25519_AddAndDouble.krml extract/Kremlin/Spec_Poly1305.krml extract/Kremlin/Hacl_Spec_Poly1305_Vec.krml extract/Kremlin/Hacl_Spec_Poly1305_Field32xN.krml extract/Kremlin/Hacl_Poly1305_Field32xN_Lemmas.krml extract/Kremlin/Hacl_Impl_Poly1305_Lemmas.krml extract/Kremlin/Hacl_Spec_Poly1305_Field32xN_Lemmas.krml extract/Kremlin/Hacl_Impl_Poly1305_Field32xN.krml extract/Kremlin/Hacl_Spec_Poly1305_Lemmas.krml extract/Kremlin/Hacl_Spec_Poly1305_Equiv.krml extract/Kremlin/Hacl_Impl_Poly1305_Field32xN_256.krml extract/Kremlin/Hacl_Impl_Poly1305_Field32xN_128.krml extract/Kremlin/Hacl_Impl_Poly1305_Field32xN_32.krml extract/Kremlin/Hacl_Impl_Poly1305_Fields.krml extract/Kremlin/Hacl_Impl_Poly1305.krml extract/Kremlin/Spec_Chacha20Poly1305.krml extract/Kremlin/Hacl_Impl_Chacha20Poly1305_PolyCore.krml extract/Kremlin/Hacl_Impl_Chacha20Poly1305.krml extract/Kremlin/FStar_List_Pure_Base.krml extract/Kremlin/FStar_List_Pure_Properties.krml extract/Kremlin/FStar_List_Pure.krml extract/Kremlin/Meta_Interface.krml extract/Kremlin/Hacl_Meta_Chacha20Poly1305.krml extract/Kremlin/Hacl_Impl_Chacha20_Core32.krml extract/Kremlin/Hacl_Impl_Chacha20.krml extract/Kremlin/Hacl_Chacha20.krml extract/Kremlin/Hacl_Meta_Poly1305.krml extract/Kremlin/Hacl_Poly1305_32.krml extract/Kremlin/Hacl_Chacha20Poly1305_32.krml extract/Kremlin/FStar_Dyn.krml extract/Kremlin/LowStar_Failure.krml extract/Kremlin/EverCrypt_Vale.krml extract/Kremlin/EverCrypt_Specs.krml extract/Kremlin/EverCrypt_OpenSSL.krml extract/Kremlin/EverCrypt_Hacl.krml extract/Kremlin/EverCrypt_BCrypt.krml extract/Kremlin/EverCrypt_Cipher.krml extract/Kremlin/Hacl_Spec_Curve25519_Finv.krml extract/Kremlin/Hacl_Impl_Curve25519_Finv.krml extract/Kremlin/Hacl_Impl_Curve25519_Generic.krml extract/Kremlin/Hacl_Meta_Curve25519.krml extract/Kremlin/Hacl_Curve25519_51.krml extract/Kremlin/Vale_Stdcalls_X64_Fswap.krml extract/Kremlin/Vale_Wrapper_X64_Fswap.krml extract/Kremlin/Vale_X64_Print_Inline_s.krml extract/Kremlin/Vale_Inline_X64_Fswap_inline.krml extract/Kremlin/Vale_Stdcalls_X64_Fsqr.krml extract/Kremlin/Vale_Wrapper_X64_Fsqr.krml extract/Kremlin/Vale_Inline_X64_Fsqr_inline.krml extract/Kremlin/Vale_Stdcalls_X64_Fmul.krml extract/Kremlin/Vale_Wrapper_X64_Fmul.krml extract/Kremlin/Vale_Inline_X64_Fmul_inline.krml extract/Kremlin/Vale_Stdcalls_X64_Fsub.krml extract/Kremlin/Vale_Wrapper_X64_Fsub.krml extract/Kremlin/Vale_Inline_X64_Fadd_inline.krml extract/Kremlin/Hacl_Impl_Curve25519_Field64_Vale.krml extract/Kremlin/Hacl_Curve25519_64.krml extract/Kremlin/EverCrypt_Curve25519.krml extract/Kremlin/Hacl_Poly1305_128.krml extract/Kremlin/Hacl_Poly1305_256.krml extract/Kremlin/Vale_Poly1305_Equiv.krml extract/Kremlin/Vale_Poly1305_CallingFromLowStar.krml extract/Kremlin/EverCrypt_Poly1305.krml extract/Kremlin/Lib_Memzero.krml extract/Kremlin/Spec_HMAC_DRBG.krml extract/Kremlin/Hacl_HMAC_DRBG.krml extract/Kremlin/Lib_RandomBuffer_System.krml extract/Kremlin/EverCrypt_DRBG.krml extract/Kremlin/Spec_Agile_HKDF.krml extract/Kremlin/Hacl_HKDF.krml extract/Kremlin/EverCrypt_HKDF.krml extract/Kremlin/EverCrypt.krml extract/Kremlin/FStar_Printf.krml extract/Kremlin/FStar_Error.krml extract/Kremlin/FStar_Tcp.krml extract/Kremlin/LowParse_Spec_FLData.krml extract/Kremlin/LowParse_Math.krml extract/Kremlin/LowParse_Slice.krml extract/Kremlin/LowParse_Low_Base.krml extract/Kremlin/LowParse_Low_Combinators.krml extract/Kremlin/LowParse_Low_FLData.krml extract/Kremlin/LowParse_Spec_Seq.krml extract/Kremlin/LowParse_Spec_Int.krml extract/Kremlin/LowParse_Spec_BoundedInt.krml extract/Kremlin/LowParse_Low_Endianness.krml extract/Kremlin/LowParse_BitFields.krml extract/Kremlin/LowParse_Endianness.krml extract/Kremlin/LowParse_Endianness_BitFields.krml extract/Kremlin/LowParse_Low_BoundedInt.krml extract/Kremlin/LowParse_Spec_SeqBytes_Base.krml extract/Kremlin/LowParse_Spec_DER.krml extract/Kremlin/LowParse_Spec_BCVLI.krml extract/Kremlin/LowParse_Spec_AllIntegers.krml extract/Kremlin/LowParse_Spec_VLData.krml extract/Kremlin/LowParse_Low_VLData.krml extract/Kremlin/LowParse_Spec_VLGen.krml extract/Kremlin/LowParse_Low_VLGen.krml extract/Kremlin/LowParse_Low_Int.krml extract/Kremlin/LowParse_Low_DER.krml extract/Kremlin/LowParse_Low_BCVLI.krml extract/Kremlin/LowParse_Low_List.krml extract/Kremlin/LowParse_Spec_Array.krml extract/Kremlin/LowParse_Spec_VCList.krml extract/Kremlin/LowParse_Low_VCList.krml extract/Kremlin/LowParse_Low_IfThenElse.krml extract/Kremlin/LowParse_TacLib.krml extract/Kremlin/LowParse_Spec_Enum.krml extract/Kremlin/LowParse_Spec_Sum.krml extract/Kremlin/LowParse_Low_Enum.krml extract/Kremlin/LowParse_Low_Sum.krml extract/Kremlin/LowParse_Low_Tac_Sum.krml extract/Kremlin/LowParse_Low_Option.krml extract/Kremlin/LowParse_Spec_Bytes.krml extract/Kremlin/LowParse_Low_Bytes.krml extract/Kremlin/LowParse_Low_Array.krml extract/Kremlin/LowParse_Low.krml extract/Kremlin/LowParse_SLow_FLData.krml extract/Kremlin/LowParse_SLow_VLGen.krml extract/Kremlin/LowParse_Spec_Endianness.krml extract/Kremlin/LowParse_Spec_Endianness_Instances.krml extract/Kremlin/LowParse_SLow_Endianness.krml extract/Kremlin/LowParse_SLow_BoundedInt.krml extract/Kremlin/LowParse_SLow_Int.krml extract/Kremlin/LowParse_SLow_DER.krml extract/Kremlin/LowParse_SLow_BCVLI.krml extract/Kremlin/LowParse_SLow_VCList.krml extract/Kremlin/LowParse_SLow_IfThenElse.krml extract/Kremlin/LowParse_SLow_Enum.krml extract/Kremlin/LowParse_SLow_Sum.krml extract/Kremlin/LowParse_SLow_Tac_Enum.krml extract/Kremlin/LowParse_SLow_Tac_Sum.krml extract/Kremlin/LowParse_SLow_VLData.krml extract/Kremlin/LowParse_SLow_Bytes.krml extract/Kremlin/LowParse_SLow_Array.krml extract/Kremlin/LowParse_Spec_Tac_Combinators.krml extract/Kremlin/LowParse_SLow.krml extract/Kremlin/Parsers_AlertDescription.krml extract/Kremlin/Parsers_AlertLevel.krml extract/Kremlin/Parsers_Alert.krml extract/Kremlin/TLSError.krml extract/Kremlin/Parsers_NamedGroup.krml extract/Kremlin/Format_Constants.krml extract/Kremlin/Format_UncompressedPointRepresentation.krml extract/Kremlin/Format_KeyShareEntry.krml extract/Kremlin/Flags.krml extract/Kremlin/Parsers_ECCurveType.krml extract/Kremlin/DebugFlags.krml extract/Kremlin/FStar_DependentMap.krml extract/Kremlin/FStar_Monotonic_DependentMap.krml extract/Kremlin/Mem.krml extract/Kremlin/Random.krml extract/Kremlin/TLS_Curve25519.krml extract/Kremlin/Parse.krml extract/Kremlin/ECGroup.krml extract/Kremlin/DHGroup.krml extract/Kremlin/Parsers_NamedGroupList.krml extract/Kremlin/CommonDH.krml extract/Kremlin/FFICallbacks.krml extract/Kremlin/Parsers_CompressionMethod.krml extract/Kremlin/Parsers_SignatureScheme.krml extract/Kremlin/Parsers_SignatureSchemeList.krml extract/Kremlin/LowParseWrappers.krml extract/Kremlin/Parsers_CipherSuite.krml extract/Kremlin/CipherSuite.krml extract/Kremlin/Parsers_ProtocolVersion.krml extract/Kremlin/TLSConstants.krml extract/Kremlin/HMAC.krml extract/Kremlin/RSAKey.krml extract/Kremlin/PMS.krml extract/Kremlin/List_Helpers.krml extract/Kremlin/PSK.krml extract/Kremlin/Extensions.krml extract/Kremlin/Cert.krml extract/Kremlin/TLSInfoFlags.krml extract/Kremlin/FStar_Date.krml extract/Kremlin/Nonce.krml extract/Kremlin/TLSInfo.krml extract/Kremlin/Crypto_Indexing.krml extract/Kremlin/Flag.krml extract/Kremlin/FStar_Old_Endianness.krml extract/Kremlin/FStar_Buffer.krml extract/Kremlin/C_Compat_Loops.krml extract/Kremlin/Buffer_Utils.krml extract/Kremlin/Crypto_Symmetric_Bytes.krml extract/Kremlin/Crypto_Plain.krml extract/Kremlin/AEADProvider.krml extract/Kremlin/Range.krml extract/Kremlin/DataStream.krml extract/Kremlin/Alert.krml extract/Kremlin/Content.krml extract/Kremlin/StreamPlain.krml extract/Kremlin/Hashing.krml extract/Kremlin/TLSPRF.krml extract/Kremlin/Hashing_CRF.krml extract/Kremlin/HandshakeMessages.krml extract/Kremlin/HandshakeLog.krml extract/Kremlin/Parsers_Boolean.krml extract/Kremlin/Parsers_TicketContents13_custom_data.krml extract/Kremlin/Parsers_TicketContents13_nonce.krml extract/Kremlin/Parsers_TicketContents13_rms.krml extract/Kremlin/Parsers_TicketContents13.krml extract/Kremlin/Parsers_TicketContents12_master_secret.krml extract/Kremlin/Parsers_TicketContents12.krml extract/Kremlin/Parsers_TicketVersion.krml extract/Kremlin/Parsers_TicketContents.krml extract/Kremlin/Parsers_TicketContents12_master_secret_Low.krml extract/Kremlin/Parsers_Ticket_Low.krml extract/Kremlin/Ticket.krml extract/Kremlin/Negotiation.krml extract/Kremlin/FStar_Monotonic_Seq.krml extract/Kremlin/StreamAE.krml extract/Kremlin/StatefulPlain.krml extract/Kremlin/LHAEPlain.krml extract/Kremlin/AEAD_GCM.krml extract/Kremlin/StatefulLHAE.krml extract/Kremlin/StAE.krml extract/Kremlin/Old_HMAC_UFCMA.krml extract/Kremlin/Parsers_HKDF_HkdfLabel_context.krml extract/Kremlin/Parsers_HKDF_HkdfLabel_label.krml extract/Kremlin/Parsers_HKDF_HkdfLabel.krml extract/Kremlin/HKDF.krml extract/Kremlin/Old_KeySchedule.krml extract/Kremlin/Old_Epochs.krml extract/Kremlin/FStar_HyperStack_IO.krml extract/Kremlin/StreamDeltas.krml extract/Kremlin/Old_Handshake.krml extract/Kremlin/Transport.krml extract/Kremlin/BufferBytes.krml extract/Kremlin/Record.krml extract/Kremlin/Connection.krml extract/Kremlin/TLS.krml extract/Kremlin/FFI.krml extract/Kremlin/Pkg.krml extract/Kremlin/Idx.krml extract/Kremlin/Model.krml extract/Kremlin/FStar_Test.krml extract/Kremlin/Pkg_Tree.krml extract/Kremlin/KDF.krml extract/Kremlin/QUIC.krml extract/Kremlin/IV.krml extract/Kremlin/KDF_Rekey.krml -tmpdir extract/Kremlin-Library -skip-compilation
  F* version: 1f9505d5
  KreMLin version: 44acff92
 */

#include "Negotiation.h"

void Negotiation_discard(bool uu____31)
{
  
}

void Negotiation_print(Prims_string s)
{
  Negotiation_discard(FStar_IO_debug_print_string(Prims_strcat("NGO| ", Prims_strcat(s, "\n"))));
}

void (*Negotiation_trace)(Prims_string x0) = Negotiation_print;

Prims_string Extensions_string_of_extensions____(Prims_list__Extensions_extension_ *l)
{
  if (l->tag == Prims_Cons)
  {
    Prims_list__Extensions_extension_ *es = l->tl;
    Extensions_extension_ e0 = l->hd;
    return
      Prims_strcat(Extensions_string_of_extension____(e0),
        Prims_strcat(" ", Extensions_string_of_extensions____(es)));
  }
  else if (l->tag == Prims_Nil)
    return "";
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

Prims_string
Negotiation_string_of_option_extensions(
  FStar_Pervasives_Native_option__Prims_list__Extensions_extension_ o
)
{
  if (o.tag == FStar_Pervasives_Native_None)
    return "None";
  else if (o.tag == FStar_Pervasives_Native_Some)
  {
    Prims_list__Extensions_extension_ *es = o.v;
    return Prims_strcat("[ ", Prims_strcat(Extensions_string_of_extensions____(es), "]"));
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

Prims_string Negotiation_string_of_ciphersuite(CipherSuite_cipherSuite_ cs)
{
  FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite
  scrut;
  if (cs.tag == CipherSuite_NullCipherSuite)
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_NULL_WITH_NULL_NULL } }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite13
    &&
      cs.val.case_CipherSuite13._0
      == EverCrypt_AES128_GCM
      && cs.val.case_CipherSuite13._1 == Spec_Hash_Definitions_SHA2_256
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_AES_128_GCM_SHA256 } }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite13
    &&
      cs.val.case_CipherSuite13._0
      == EverCrypt_AES256_GCM
      && cs.val.case_CipherSuite13._1 == Spec_Hash_Definitions_SHA2_384
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_AES_256_GCM_SHA384 } }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite13
    &&
      cs.val.case_CipherSuite13._0
      == EverCrypt_CHACHA20_POLY1305
      && cs.val.case_CipherSuite13._1 == Spec_Hash_Definitions_SHA2_256
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_CHACHA20_POLY1305_SHA256 } }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite13
    &&
      cs.val.case_CipherSuite13._0
      == EverCrypt_AES128_CCM
      && cs.val.case_CipherSuite13._1 == Spec_Hash_Definitions_SHA2_256
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_AES_128_CCM_SHA256 } }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite13
    &&
      cs.val.case_CipherSuite13._0
      == EverCrypt_AES128_CCM8
      && cs.val.case_CipherSuite13._1 == Spec_Hash_Definitions_SHA2_256
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_AES_128_CCM_8_SHA256 } }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_RSA
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_None
        &&
          cs.val.case_CipherSuite._2.tag
          == CipherSuite_MACOnly
          && cs.val.case_CipherSuite._2.val.case_MACOnly == Spec_Hash_Definitions_MD5
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_NULL_MD5 } }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_RSA
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_None
        &&
          cs.val.case_CipherSuite._2.tag
          == CipherSuite_MACOnly
          && cs.val.case_CipherSuite._2.val.case_MACOnly == Spec_Hash_Definitions_SHA1
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_NULL_SHA } }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_RSA
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_None
        &&
          cs.val.case_CipherSuite._2.tag
          == CipherSuite_MACOnly
          && cs.val.case_CipherSuite._2.val.case_MACOnly == Spec_Hash_Definitions_SHA2_256
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_NULL_SHA256 } }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_RSA
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_None
        &&
          cs.val.case_CipherSuite._2.tag
          == CipherSuite_MtE
          &&
            cs.val.case_CipherSuite._2.val.case_MtE._0.tag
            == CipherSuite_Stream
            &&
              cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Stream
              == EverCrypt_RC4_128
              && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_MD5
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_RC4_128_MD5 } }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_RSA
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_None
        &&
          cs.val.case_CipherSuite._2.tag
          == CipherSuite_MtE
          &&
            cs.val.case_CipherSuite._2.val.case_MtE._0.tag
            == CipherSuite_Stream
            &&
              cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Stream
              == EverCrypt_RC4_128
              && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_RC4_128_SHA } }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_RSA
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_None
        &&
          cs.val.case_CipherSuite._2.tag
          == CipherSuite_MtE
          &&
            cs.val.case_CipherSuite._2.val.case_MtE._0.tag
            == CipherSuite_Block
            &&
              cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
              == EverCrypt_TDES_EDE_CBC
              && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_3DES_EDE_CBC_SHA } }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_RSA
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_None
        &&
          cs.val.case_CipherSuite._2.tag
          == CipherSuite_MtE
          &&
            cs.val.case_CipherSuite._2.val.case_MtE._0.tag
            == CipherSuite_Block
            &&
              cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
              == EverCrypt_AES128_CBC
              && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_AES_128_CBC_SHA } }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_RSA
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_None
        &&
          cs.val.case_CipherSuite._2.tag
          == CipherSuite_MtE
          &&
            cs.val.case_CipherSuite._2.val.case_MtE._0.tag
            == CipherSuite_Block
            &&
              cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
              == EverCrypt_AES256_CBC
              && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_AES_256_CBC_SHA } }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_RSA
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_None
        &&
          cs.val.case_CipherSuite._2.tag
          == CipherSuite_MtE
          &&
            cs.val.case_CipherSuite._2.val.case_MtE._0.tag
            == CipherSuite_Block
            &&
              cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
              == EverCrypt_AES128_CBC
              && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA2_256
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_AES_128_CBC_SHA256 } }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_RSA
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_None
        &&
          cs.val.case_CipherSuite._2.tag
          == CipherSuite_MtE
          &&
            cs.val.case_CipherSuite._2.val.case_MtE._0.tag
            == CipherSuite_Block
            &&
              cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
              == EverCrypt_AES256_CBC
              && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA2_256
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_AES_256_CBC_SHA256 } }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_DHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_Some
        &&
          cs.val.case_CipherSuite._1.v
          == CipherSuite_DSA
          &&
            cs.val.case_CipherSuite._2.tag
            == CipherSuite_MtE
            &&
              cs.val.case_CipherSuite._2.val.case_MtE._0.tag
              == CipherSuite_Block
              &&
                cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                == EverCrypt_TDES_EDE_CBC
                && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = {
            .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_DSS_WITH_3DES_EDE_CBC_SHA }
          }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_DHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_Some
        &&
          cs.val.case_CipherSuite._1.v
          == CipherSuite_RSASIG
          &&
            cs.val.case_CipherSuite._2.tag
            == CipherSuite_MtE
            &&
              cs.val.case_CipherSuite._2.val.case_MtE._0.tag
              == CipherSuite_Block
              &&
                cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                == EverCrypt_TDES_EDE_CBC
                && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = {
            .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_RSA_WITH_3DES_EDE_CBC_SHA }
          }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_DHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_Some
        &&
          cs.val.case_CipherSuite._1.v
          == CipherSuite_DSA
          &&
            cs.val.case_CipherSuite._2.tag
            == CipherSuite_MtE
            &&
              cs.val.case_CipherSuite._2.val.case_MtE._0.tag
              == CipherSuite_Block
              &&
                cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                == EverCrypt_AES128_CBC
                && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_128_CBC_SHA } }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_DHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_Some
        &&
          cs.val.case_CipherSuite._1.v
          == CipherSuite_RSASIG
          &&
            cs.val.case_CipherSuite._2.tag
            == CipherSuite_MtE
            &&
              cs.val.case_CipherSuite._2.val.case_MtE._0.tag
              == CipherSuite_Block
              &&
                cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                == EverCrypt_AES128_CBC
                && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_128_CBC_SHA } }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_DHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_Some
        &&
          cs.val.case_CipherSuite._1.v
          == CipherSuite_DSA
          &&
            cs.val.case_CipherSuite._2.tag
            == CipherSuite_MtE
            &&
              cs.val.case_CipherSuite._2.val.case_MtE._0.tag
              == CipherSuite_Block
              &&
                cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                == EverCrypt_AES256_CBC
                && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_256_CBC_SHA } }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_DHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_Some
        &&
          cs.val.case_CipherSuite._1.v
          == CipherSuite_RSASIG
          &&
            cs.val.case_CipherSuite._2.tag
            == CipherSuite_MtE
            &&
              cs.val.case_CipherSuite._2.val.case_MtE._0.tag
              == CipherSuite_Block
              &&
                cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                == EverCrypt_AES256_CBC
                && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_256_CBC_SHA } }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_DHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_Some
        &&
          cs.val.case_CipherSuite._1.v
          == CipherSuite_DSA
          &&
            cs.val.case_CipherSuite._2.tag
            == CipherSuite_MtE
            &&
              cs.val.case_CipherSuite._2.val.case_MtE._0.tag
              == CipherSuite_Block
              &&
                cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                == EverCrypt_AES128_CBC
                && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA2_256
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = {
            .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_128_CBC_SHA256 }
          }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_DHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_Some
        &&
          cs.val.case_CipherSuite._1.v
          == CipherSuite_RSASIG
          &&
            cs.val.case_CipherSuite._2.tag
            == CipherSuite_MtE
            &&
              cs.val.case_CipherSuite._2.val.case_MtE._0.tag
              == CipherSuite_Block
              &&
                cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                == EverCrypt_AES128_CBC
                && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA2_256
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = {
            .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_128_CBC_SHA256 }
          }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_DHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_Some
        &&
          cs.val.case_CipherSuite._1.v
          == CipherSuite_DSA
          &&
            cs.val.case_CipherSuite._2.tag
            == CipherSuite_MtE
            &&
              cs.val.case_CipherSuite._2.val.case_MtE._0.tag
              == CipherSuite_Block
              &&
                cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                == EverCrypt_AES256_CBC
                && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA2_256
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = {
            .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_256_CBC_SHA256 }
          }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_DHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_Some
        &&
          cs.val.case_CipherSuite._1.v
          == CipherSuite_RSASIG
          &&
            cs.val.case_CipherSuite._2.tag
            == CipherSuite_MtE
            &&
              cs.val.case_CipherSuite._2.val.case_MtE._0.tag
              == CipherSuite_Block
              &&
                cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                == EverCrypt_AES256_CBC
                && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA2_256
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = {
            .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_256_CBC_SHA256 }
          }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_ECDHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_Some
        &&
          cs.val.case_CipherSuite._1.v
          == CipherSuite_RSASIG
          &&
            cs.val.case_CipherSuite._2.tag
            == CipherSuite_MtE
            &&
              cs.val.case_CipherSuite._2.val.case_MtE._0.tag
              == CipherSuite_Stream
              &&
                cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Stream
                == EverCrypt_RC4_128
                && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_RC4_128_SHA } }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_ECDHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_Some
        &&
          cs.val.case_CipherSuite._1.v
          == CipherSuite_RSASIG
          &&
            cs.val.case_CipherSuite._2.tag
            == CipherSuite_MtE
            &&
              cs.val.case_CipherSuite._2.val.case_MtE._0.tag
              == CipherSuite_Block
              &&
                cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                == EverCrypt_TDES_EDE_CBC
                && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = {
            .case_Correct = { .tag = Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA }
          }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_ECDHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_Some
        &&
          cs.val.case_CipherSuite._1.v
          == CipherSuite_RSASIG
          &&
            cs.val.case_CipherSuite._2.tag
            == CipherSuite_MtE
            &&
              cs.val.case_CipherSuite._2.val.case_MtE._0.tag
              == CipherSuite_Block
              &&
                cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                == EverCrypt_AES128_CBC
                && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = {
            .case_Correct = { .tag = Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA }
          }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_ECDHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_Some
        &&
          cs.val.case_CipherSuite._1.v
          == CipherSuite_RSASIG
          &&
            cs.val.case_CipherSuite._2.tag
            == CipherSuite_MtE
            &&
              cs.val.case_CipherSuite._2.val.case_MtE._0.tag
              == CipherSuite_Block
              &&
                cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                == EverCrypt_AES128_CBC
                && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA2_256
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = {
            .case_Correct = { .tag = Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256 }
          }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_ECDHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_Some
        &&
          cs.val.case_CipherSuite._1.v
          == CipherSuite_RSASIG
          &&
            cs.val.case_CipherSuite._2.tag
            == CipherSuite_MtE
            &&
              cs.val.case_CipherSuite._2.val.case_MtE._0.tag
              == CipherSuite_Block
              &&
                cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                == EverCrypt_AES256_CBC
                && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = {
            .case_Correct = { .tag = Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA }
          }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_ECDHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_Some
        &&
          cs.val.case_CipherSuite._1.v
          == CipherSuite_RSASIG
          &&
            cs.val.case_CipherSuite._2.tag
            == CipherSuite_MtE
            &&
              cs.val.case_CipherSuite._2.val.case_MtE._0.tag
              == CipherSuite_Block
              &&
                cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                == EverCrypt_AES256_CBC
                && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA2_384
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = {
            .case_Correct = { .tag = Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384 }
          }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_ECDHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_Some
        &&
          cs.val.case_CipherSuite._1.v
          == CipherSuite_RSASIG
          &&
            cs.val.case_CipherSuite._2.tag
            == CipherSuite_AEAD
            &&
              cs.val.case_CipherSuite._2.val.case_AEAD._0
              == EverCrypt_AES128_GCM
              && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = {
            .case_Correct = { .tag = Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 }
          }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_ECDHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_Some
        &&
          cs.val.case_CipherSuite._1.v
          == CipherSuite_ECDSA
          &&
            cs.val.case_CipherSuite._2.tag
            == CipherSuite_AEAD
            &&
              cs.val.case_CipherSuite._2.val.case_AEAD._0
              == EverCrypt_AES128_GCM
              && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = {
            .case_Correct = { .tag = Parsers_CipherSuite_TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 }
          }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_ECDHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_Some
        &&
          cs.val.case_CipherSuite._1.v
          == CipherSuite_RSASIG
          &&
            cs.val.case_CipherSuite._2.tag
            == CipherSuite_AEAD
            &&
              cs.val.case_CipherSuite._2.val.case_AEAD._0
              == EverCrypt_AES256_GCM
              && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_384
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = {
            .case_Correct = { .tag = Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 }
          }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_ECDHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_Some
        &&
          cs.val.case_CipherSuite._1.v
          == CipherSuite_ECDSA
          &&
            cs.val.case_CipherSuite._2.tag
            == CipherSuite_AEAD
            &&
              cs.val.case_CipherSuite._2.val.case_AEAD._0
              == EverCrypt_AES256_GCM
              && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_384
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = {
            .case_Correct = { .tag = Parsers_CipherSuite_TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 }
          }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_DHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_None
        &&
          cs.val.case_CipherSuite._2.tag
          == CipherSuite_MtE
          &&
            cs.val.case_CipherSuite._2.val.case_MtE._0.tag
            == CipherSuite_Stream
            &&
              cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Stream
              == EverCrypt_RC4_128
              && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_MD5
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_anon_WITH_RC4_128_MD5 } }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_DHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_None
        &&
          cs.val.case_CipherSuite._2.tag
          == CipherSuite_MtE
          &&
            cs.val.case_CipherSuite._2.val.case_MtE._0.tag
            == CipherSuite_Block
            &&
              cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
              == EverCrypt_TDES_EDE_CBC
              && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = {
            .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_anon_WITH_3DES_EDE_CBC_SHA }
          }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_DHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_None
        &&
          cs.val.case_CipherSuite._2.tag
          == CipherSuite_MtE
          &&
            cs.val.case_CipherSuite._2.val.case_MtE._0.tag
            == CipherSuite_Block
            &&
              cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
              == EverCrypt_AES128_CBC
              && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_anon_WITH_AES_128_CBC_SHA } }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_DHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_None
        &&
          cs.val.case_CipherSuite._2.tag
          == CipherSuite_MtE
          &&
            cs.val.case_CipherSuite._2.val.case_MtE._0.tag
            == CipherSuite_Block
            &&
              cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
              == EverCrypt_AES256_CBC
              && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_anon_WITH_AES_256_CBC_SHA } }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_DHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_None
        &&
          cs.val.case_CipherSuite._2.tag
          == CipherSuite_MtE
          &&
            cs.val.case_CipherSuite._2.val.case_MtE._0.tag
            == CipherSuite_Block
            &&
              cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
              == EverCrypt_AES128_CBC
              && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA2_256
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = {
            .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_anon_WITH_AES_128_CBC_SHA256 }
          }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_DHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_None
        &&
          cs.val.case_CipherSuite._2.tag
          == CipherSuite_MtE
          &&
            cs.val.case_CipherSuite._2.val.case_MtE._0.tag
            == CipherSuite_Block
            &&
              cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
              == EverCrypt_AES256_CBC
              && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA2_256
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = {
            .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_anon_WITH_AES_256_CBC_SHA256 }
          }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_RSA
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_None
        &&
          cs.val.case_CipherSuite._2.tag
          == CipherSuite_AEAD
          &&
            cs.val.case_CipherSuite._2.val.case_AEAD._0
            == EverCrypt_AES128_GCM
            && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_AES_128_GCM_SHA256 } }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_RSA
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_None
        &&
          cs.val.case_CipherSuite._2.tag
          == CipherSuite_AEAD
          &&
            cs.val.case_CipherSuite._2.val.case_AEAD._0
            == EverCrypt_AES256_GCM
            && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_384
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_AES_256_GCM_SHA384 } }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_DHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_Some
        &&
          cs.val.case_CipherSuite._1.v
          == CipherSuite_RSASIG
          &&
            cs.val.case_CipherSuite._2.tag
            == CipherSuite_AEAD
            &&
              cs.val.case_CipherSuite._2.val.case_AEAD._0
              == EverCrypt_AES128_GCM
              && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = {
            .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_128_GCM_SHA256 }
          }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_DHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_Some
        &&
          cs.val.case_CipherSuite._1.v
          == CipherSuite_RSASIG
          &&
            cs.val.case_CipherSuite._2.tag
            == CipherSuite_AEAD
            &&
              cs.val.case_CipherSuite._2.val.case_AEAD._0
              == EverCrypt_AES256_GCM
              && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_384
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = {
            .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_256_GCM_SHA384 }
          }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_DH
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_Some
        &&
          cs.val.case_CipherSuite._1.v
          == CipherSuite_RSASIG
          &&
            cs.val.case_CipherSuite._2.tag
            == CipherSuite_AEAD
            &&
              cs.val.case_CipherSuite._2.val.case_AEAD._0
              == EverCrypt_AES128_GCM
              && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = {
            .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_RSA_WITH_AES_128_GCM_SHA256 }
          }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_DH
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_Some
        &&
          cs.val.case_CipherSuite._1.v
          == CipherSuite_RSASIG
          &&
            cs.val.case_CipherSuite._2.tag
            == CipherSuite_AEAD
            &&
              cs.val.case_CipherSuite._2.val.case_AEAD._0
              == EverCrypt_AES256_GCM
              && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_384
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = {
            .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_RSA_WITH_AES_256_GCM_SHA384 }
          }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_DHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_Some
        &&
          cs.val.case_CipherSuite._1.v
          == CipherSuite_DSA
          &&
            cs.val.case_CipherSuite._2.tag
            == CipherSuite_AEAD
            &&
              cs.val.case_CipherSuite._2.val.case_AEAD._0
              == EverCrypt_AES128_GCM
              && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = {
            .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_128_GCM_SHA256 }
          }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_DHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_Some
        &&
          cs.val.case_CipherSuite._1.v
          == CipherSuite_DSA
          &&
            cs.val.case_CipherSuite._2.tag
            == CipherSuite_AEAD
            &&
              cs.val.case_CipherSuite._2.val.case_AEAD._0
              == EverCrypt_AES256_GCM
              && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_384
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = {
            .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_256_GCM_SHA384 }
          }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_DH
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_Some
        &&
          cs.val.case_CipherSuite._1.v
          == CipherSuite_DSA
          &&
            cs.val.case_CipherSuite._2.tag
            == CipherSuite_AEAD
            &&
              cs.val.case_CipherSuite._2.val.case_AEAD._0
              == EverCrypt_AES128_GCM
              && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = {
            .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_DSS_WITH_AES_128_GCM_SHA256 }
          }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_DH
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_Some
        &&
          cs.val.case_CipherSuite._1.v
          == CipherSuite_DSA
          &&
            cs.val.case_CipherSuite._2.tag
            == CipherSuite_AEAD
            &&
              cs.val.case_CipherSuite._2.val.case_AEAD._0
              == EverCrypt_AES256_GCM
              && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_384
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = {
            .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_DSS_WITH_AES_256_GCM_SHA384 }
          }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_DHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_None
        &&
          cs.val.case_CipherSuite._2.tag
          == CipherSuite_AEAD
          &&
            cs.val.case_CipherSuite._2.val.case_AEAD._0
            == EverCrypt_AES128_GCM
            && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = {
            .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_anon_WITH_AES_128_GCM_SHA256 }
          }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_DHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_None
        &&
          cs.val.case_CipherSuite._2.tag
          == CipherSuite_AEAD
          &&
            cs.val.case_CipherSuite._2.val.case_AEAD._0
            == EverCrypt_AES256_GCM
            && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_384
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = {
            .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_anon_WITH_AES_256_GCM_SHA384 }
          }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_ECDHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_Some
        &&
          cs.val.case_CipherSuite._1.v
          == CipherSuite_RSASIG
          &&
            cs.val.case_CipherSuite._2.tag
            == CipherSuite_AEAD
            &&
              cs.val.case_CipherSuite._2.val.case_AEAD._0
              == EverCrypt_CHACHA20_POLY1305
              && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = {
            .case_Correct = {
              .tag = Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256
            }
          }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_ECDHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_Some
        &&
          cs.val.case_CipherSuite._1.v
          == CipherSuite_ECDSA
          &&
            cs.val.case_CipherSuite._2.tag
            == CipherSuite_AEAD
            &&
              cs.val.case_CipherSuite._2.val.case_AEAD._0
              == EverCrypt_CHACHA20_POLY1305
              && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = {
            .case_Correct = {
              .tag = Parsers_CipherSuite_TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256
            }
          }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_DHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_Some
        &&
          cs.val.case_CipherSuite._1.v
          == CipherSuite_RSASIG
          &&
            cs.val.case_CipherSuite._2.tag
            == CipherSuite_AEAD
            &&
              cs.val.case_CipherSuite._2.val.case_AEAD._0
              == EverCrypt_CHACHA20_POLY1305
              && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = {
            .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_RSA_WITH_CHACHA20_POLY1305_SHA256 }
          }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_PSK
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_None
        &&
          cs.val.case_CipherSuite._2.tag
          == CipherSuite_AEAD
          &&
            cs.val.case_CipherSuite._2.val.case_AEAD._0
            == EverCrypt_CHACHA20_POLY1305
            && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = {
            .case_Correct = { .tag = Parsers_CipherSuite_TLS_PSK_WITH_CHACHA20_POLY1305_SHA256 }
          }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_PSK_ECDHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_None
        &&
          cs.val.case_CipherSuite._2.tag
          == CipherSuite_AEAD
          &&
            cs.val.case_CipherSuite._2.val.case_AEAD._0
            == EverCrypt_CHACHA20_POLY1305
            && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = {
            .case_Correct = {
              .tag = Parsers_CipherSuite_TLS_ECDHE_PSK_WITH_CHACHA20_POLY1305_SHA256
            }
          }
        }
      );
  else if
  (
    cs.tag
    == CipherSuite_CipherSuite
    &&
      cs.val.case_CipherSuite._0
      == CipherSuite_Kex_PSK_DHE
      &&
        cs.val.case_CipherSuite._1.tag
        == FStar_Pervasives_Native_None
        &&
          cs.val.case_CipherSuite._2.tag
          == CipherSuite_AEAD
          &&
            cs.val.case_CipherSuite._2.val.case_AEAD._0
            == EverCrypt_CHACHA20_POLY1305
            && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
  )
    scrut =
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
          .tag = FStar_Error_Correct,
          .val = {
            .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_PSK_WITH_CHACHA20_POLY1305_SHA256 }
          }
        }
      );
  else
    scrut =
      TLSError_fatal__Parsers_CipherSuite_cipherSuite(Parsers_AlertDescription_Illegal_parameter,
        FStar_Error_perror("CipherSuite.fsti",
          (krml_checked_int_t)290,
          "Invoked on a unknown ciphersuite"));
  Parsers_CipherSuite_cipherSuite ite;
  if (scrut.tag == FStar_Error_Correct)
    ite = scrut.val.case_Correct;
  else
    ite =
      KRML_EABORT(Parsers_CipherSuite_cipherSuite,
        "unreachable (pattern matches are exhaustive in F*)");
  return Parsers_CipherSuite_string_of_cipherSuite(ite);
}

static Prims_string
Negotiation_accum_string_of_signatureSchemes(
  Prims_string s,
  Parsers_SignatureScheme_signatureScheme sa
)
{
  return
    Prims_strcat(s,
      Prims_strcat(Parsers_SignatureScheme_string_of_signatureScheme(sa), " "));
}

static Prims_string
FStar_List_Tot_Base_fold_left__Prims_string_Parsers_SignatureScheme_signatureScheme(
  Prims_string (*f)(Prims_string x0, Parsers_SignatureScheme_signatureScheme x1),
  Prims_string x,
  Prims_list__Parsers_SignatureScheme_signatureScheme *l
)
{
  if (l->tag == Prims_Nil)
    return x;
  else if (l->tag == Prims_Cons)
  {
    Prims_list__Parsers_SignatureScheme_signatureScheme *tl1 = l->tl;
    Parsers_SignatureScheme_signatureScheme hd1 = l->hd;
    return
      FStar_List_Tot_Base_fold_left__Prims_string_Parsers_SignatureScheme_signatureScheme(f,
        f(x, hd1),
        tl1);
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

Prims_string
Negotiation_string_of_signatureSchemes(
  Prims_list__Parsers_SignatureScheme_signatureScheme *sal
)
{
  return
    FStar_List_Tot_Base_fold_left__Prims_string_Parsers_SignatureScheme_signatureScheme(Negotiation_accum_string_of_signatureSchemes,
      "",
      sal);
}

static Prims_string
Negotiation_accum_string_of_ciphersuite(Prims_string s, CipherSuite_cipherSuite_ cs)
{
  return Prims_strcat(s, Prims_strcat("; ", Negotiation_string_of_ciphersuite(cs)));
}

static Prims_string
FStar_List_Tot_Base_fold_left__Prims_string_CipherSuite_cipherSuite_(
  Prims_string (*f)(Prims_string x0, CipherSuite_cipherSuite_ x1),
  Prims_string x,
  Prims_list__CipherSuite_cipherSuite_ *l
)
{
  if (l->tag == Prims_Nil)
    return x;
  else if (l->tag == Prims_Cons)
  {
    Prims_list__CipherSuite_cipherSuite_ *tl1 = l->tl;
    CipherSuite_cipherSuite_ hd1 = l->hd;
    return FStar_List_Tot_Base_fold_left__Prims_string_CipherSuite_cipherSuite_(f, f(x, hd1), tl1);
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

Prims_string Negotiation_string_of_ciphersuites(Prims_list__CipherSuite_cipherSuite_ *csl)
{
  return
    FStar_List_Tot_Base_fold_left__Prims_string_CipherSuite_cipherSuite_(Negotiation_accum_string_of_ciphersuite,
      "",
      csl);
}

static Prims_string
Negotiation_accum_string_of_namedGroups(Prims_string s, Parsers_NamedGroup_namedGroup ng)
{
  return Prims_strcat(s, Prims_strcat("; ", Parsers_NamedGroup_string_of_namedGroup(ng)));
}

static Prims_string
FStar_List_Tot_Base_fold_left__Prims_string_Parsers_NamedGroup_namedGroup(
  Prims_string (*f)(Prims_string x0, Parsers_NamedGroup_namedGroup x1),
  Prims_string x,
  Prims_list__Parsers_NamedGroup_namedGroup *l
)
{
  if (l->tag == Prims_Nil)
    return x;
  else if (l->tag == Prims_Cons)
  {
    Prims_list__Parsers_NamedGroup_namedGroup *tl1 = l->tl;
    Parsers_NamedGroup_namedGroup hd1 = l->hd;
    return
      FStar_List_Tot_Base_fold_left__Prims_string_Parsers_NamedGroup_namedGroup(f,
        f(x, hd1),
        tl1);
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

Prims_string Negotiation_string_of_namedGroups(Prims_list__Parsers_NamedGroup_namedGroup *ngl)
{
  return
    FStar_List_Tot_Base_fold_left__Prims_string_Parsers_NamedGroup_namedGroup(Negotiation_accum_string_of_namedGroups,
      "",
      ngl);
}

static Prims_string
Negotiation_accum_string_of_ciphersuitename(Prims_string s, Parsers_CipherSuite_cipherSuite cs)
{
  return Prims_strcat(s, Prims_strcat("; ", Parsers_CipherSuite_string_of_cipherSuite(cs)));
}

static Prims_string
FStar_List_Tot_Base_fold_left__Prims_string_Parsers_CipherSuite_cipherSuite(
  Prims_string (*f)(Prims_string x0, Parsers_CipherSuite_cipherSuite x1),
  Prims_string x,
  Prims_list__Parsers_CipherSuite_cipherSuite *l
)
{
  if (l->tag == Prims_Nil)
    return x;
  else if (l->tag == Prims_Cons)
  {
    Prims_list__Parsers_CipherSuite_cipherSuite *tl1 = l->tl;
    Parsers_CipherSuite_cipherSuite hd1 = l->hd;
    return
      FStar_List_Tot_Base_fold_left__Prims_string_Parsers_CipherSuite_cipherSuite(f,
        f(x, hd1),
        tl1);
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

Prims_string
Negotiation_string_of_ciphersuitenames(Prims_list__Parsers_CipherSuite_cipherSuite *csl)
{
  return
    FStar_List_Tot_Base_fold_left__Prims_string_Parsers_CipherSuite_cipherSuite(Negotiation_accum_string_of_ciphersuitename,
      "",
      csl);
}

bool Negotiation_uu___is_OfferNothing(Negotiation_resumption_offer_12 projectee)
{
  if (projectee.tag == Negotiation_OfferNothing)
    return true;
  else
    return false;
}

bool Negotiation_uu___is_OfferTicket(Negotiation_resumption_offer_12 projectee)
{
  if (projectee.tag == Negotiation_OfferTicket)
    return true;
  else
    return false;
}

FStar_Bytes_bytes
Negotiation___proj__OfferTicket__item___0(Negotiation_resumption_offer_12 projectee)
{
  if (projectee.tag == Negotiation_OfferTicket)
    return projectee.val.case_OfferTicket;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

bool Negotiation_uu___is_OfferSid(Negotiation_resumption_offer_12 projectee)
{
  if (projectee.tag == Negotiation_OfferSid)
    return true;
  else
    return false;
}

FStar_Bytes_bytes
Negotiation___proj__OfferSid__item___0(Negotiation_resumption_offer_12 projectee)
{
  if (projectee.tag == Negotiation_OfferSid)
    return projectee.val.case_OfferSid;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

FStar_Pervasives_Native_option__Extensions_extension_
Negotiation_find_client_extension(
  bool (*filter1)(Extensions_extension_ x0),
  HandshakeMessages_ch o
)
{
  if (o.ch_extensions.tag == FStar_Pervasives_Native_None)
    return
      (
        (FStar_Pervasives_Native_option__Extensions_extension_){
          .tag = FStar_Pervasives_Native_None
        }
      );
  else if (o.ch_extensions.tag == FStar_Pervasives_Native_Some)
  {
    Prims_list__Extensions_extension_ *es = o.ch_extensions.v;
    return FStar_List_Tot_Base_find__Extensions_extension_(filter1, es);
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

bool Extensions_uu___is_E_supported_versions____(Extensions_extension_ projectee)
{
  if (projectee.tag == Extensions_E_supported_versions)
    return true;
  else
    return false;
}

FStar_Pervasives_Native_option__Extensions_protocol_versions
Negotiation_find_supported_versions(HandshakeMessages_ch o)
{
  FStar_Pervasives_Native_option__Extensions_extension_
  scrut = Negotiation_find_client_extension(Extensions_uu___is_E_supported_versions____, o);
  if (scrut.tag == FStar_Pervasives_Native_None)
    return
      (
        (FStar_Pervasives_Native_option__Extensions_protocol_versions){
          .tag = FStar_Pervasives_Native_None
        }
      );
  else if
  (scrut.tag == FStar_Pervasives_Native_Some && scrut.v.tag == Extensions_E_supported_versions)
  {
    Extensions_protocol_versions vs = scrut.v.val.case_E_supported_versions;
    return
      (
        (FStar_Pervasives_Native_option__Extensions_protocol_versions){
          .tag = FStar_Pervasives_Native_Some,
          .v = vs
        }
      );
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

bool Extensions_uu___is_E_signature_algorithms____(Extensions_extension_ projectee)
{
  if (projectee.tag == Extensions_E_signature_algorithms)
    return true;
  else
    return false;
}

FStar_Pervasives_Native_option__Prims_list__Parsers_SignatureScheme_signatureScheme
Negotiation_find_signature_algorithms(HandshakeMessages_ch o)
{
  FStar_Pervasives_Native_option__Extensions_extension_
  scrut = Negotiation_find_client_extension(Extensions_uu___is_E_signature_algorithms____, o);
  if (scrut.tag == FStar_Pervasives_Native_None)
    return
      (
        (FStar_Pervasives_Native_option__Prims_list__Parsers_SignatureScheme_signatureScheme){
          .tag = FStar_Pervasives_Native_None
        }
      );
  else if
  (scrut.tag == FStar_Pervasives_Native_Some && scrut.v.tag == Extensions_E_signature_algorithms)
  {
    Prims_list__Parsers_SignatureScheme_signatureScheme
    *algs = scrut.v.val.case_E_signature_algorithms;
    return
      (
        (FStar_Pervasives_Native_option__Prims_list__Parsers_SignatureScheme_signatureScheme){
          .tag = FStar_Pervasives_Native_Some,
          .v = algs
        }
      );
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

bool Extensions_uu___is_E_signature_algorithms_cert____(Extensions_extension_ projectee)
{
  if (projectee.tag == Extensions_E_signature_algorithms_cert)
    return true;
  else
    return false;
}

FStar_Pervasives_Native_option__Prims_list__Parsers_SignatureScheme_signatureScheme
Negotiation_find_signature_algorithms_cert(HandshakeMessages_ch o)
{
  FStar_Pervasives_Native_option__Extensions_extension_
  scrut =
    Negotiation_find_client_extension(Extensions_uu___is_E_signature_algorithms_cert____,
      o);
  if (scrut.tag == FStar_Pervasives_Native_None)
    return
      (
        (FStar_Pervasives_Native_option__Prims_list__Parsers_SignatureScheme_signatureScheme){
          .tag = FStar_Pervasives_Native_None
        }
      );
  else if
  (
    scrut.tag
    == FStar_Pervasives_Native_Some
    && scrut.v.tag == Extensions_E_signature_algorithms_cert
  )
  {
    Prims_list__Parsers_SignatureScheme_signatureScheme
    *algs = scrut.v.val.case_E_signature_algorithms_cert;
    return
      (
        (FStar_Pervasives_Native_option__Prims_list__Parsers_SignatureScheme_signatureScheme){
          .tag = FStar_Pervasives_Native_Some,
          .v = algs
        }
      );
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

bool Extensions_uu___is_E_cookie____(Extensions_extension_ projectee)
{
  if (projectee.tag == Extensions_E_cookie)
    return true;
  else
    return false;
}

FStar_Pervasives_Native_option__FStar_Bytes_bytes
Negotiation_find_cookie(HandshakeMessages_ch o)
{
  FStar_Pervasives_Native_option__Extensions_extension_
  scrut = Negotiation_find_client_extension(Extensions_uu___is_E_cookie____, o);
  if (scrut.tag == FStar_Pervasives_Native_None)
    return
      ((FStar_Pervasives_Native_option__FStar_Bytes_bytes){ .tag = FStar_Pervasives_Native_None });
  else if (scrut.tag == FStar_Pervasives_Native_Some && scrut.v.tag == Extensions_E_cookie)
  {
    FStar_Bytes_bytes c = scrut.v.val.case_E_cookie;
    return
      (
        (FStar_Pervasives_Native_option__FStar_Bytes_bytes){
          .tag = FStar_Pervasives_Native_Some,
          .v = c
        }
      );
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

FStar_Pervasives_Native_option__Prims_list__K___FStar_Bytes_bytes_uint32_t
Negotiation_find_pske(HandshakeMessages_ch o)
{
  FStar_Pervasives_Native_option__Extensions_extension_
  scrut = Negotiation_find_client_extension(Extensions_uu___is_E_pre_shared_key____, o);
  if
  (
    scrut.tag
    == FStar_Pervasives_Native_Some
    &&
      scrut.v.tag
      == Extensions_E_pre_shared_key
      && scrut.v.val.case_E_pre_shared_key.tag == Extensions_ClientPSK
  )
  {
    Prims_list__K___FStar_Bytes_bytes_uint32_t
    *psks = scrut.v.val.case_E_pre_shared_key.val.case_ClientPSK.identities;
    return
      (
        (FStar_Pervasives_Native_option__Prims_list__K___FStar_Bytes_bytes_uint32_t){
          .tag = FStar_Pervasives_Native_Some,
          .v = psks
        }
      );
  }
  else
    return
      (
        (FStar_Pervasives_Native_option__Prims_list__K___FStar_Bytes_bytes_uint32_t){
          .tag = FStar_Pervasives_Native_None
        }
      );
}

bool Extensions_uu___is_E_psk_key_exchange_modes____(Extensions_extension_ projectee)
{
  if (projectee.tag == Extensions_E_psk_key_exchange_modes)
    return true;
  else
    return false;
}

Prims_list__Extensions_psk_kex *Negotiation_find_psk_key_exchange_modes(HandshakeMessages_ch o)
{
  FStar_Pervasives_Native_option__Extensions_extension_
  scrut = Negotiation_find_client_extension(Extensions_uu___is_E_psk_key_exchange_modes____, o);
  if
  (
    scrut.tag
    == FStar_Pervasives_Native_Some
    && scrut.v.tag == Extensions_E_psk_key_exchange_modes
  )
    return scrut.v.val.case_E_psk_key_exchange_modes;
  else
  {
    KRML_CHECK_SIZE(sizeof (Prims_list__Extensions_psk_kex), (uint32_t)1U);
    Prims_list__Extensions_psk_kex
    *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Extensions_psk_kex));
    buf[0U] = ((Prims_list__Extensions_psk_kex){ .tag = Prims_Nil });
    return buf;
  }
}

bool Extensions_uu___is_E_session_ticket____(Extensions_extension_ projectee)
{
  if (projectee.tag == Extensions_E_session_ticket)
    return true;
  else
    return false;
}

FStar_Pervasives_Native_option__FStar_Bytes_bytes
Negotiation_find_sessionTicket(HandshakeMessages_ch o)
{
  FStar_Pervasives_Native_option__Extensions_extension_
  scrut = Negotiation_find_client_extension(Extensions_uu___is_E_session_ticket____, o);
  if (scrut.tag == FStar_Pervasives_Native_None)
    return
      ((FStar_Pervasives_Native_option__FStar_Bytes_bytes){ .tag = FStar_Pervasives_Native_None });
  else if
  (scrut.tag == FStar_Pervasives_Native_Some && scrut.v.tag == Extensions_E_session_ticket)
  {
    FStar_Bytes_bytes b = scrut.v.val.case_E_session_ticket;
    return
      (
        (FStar_Pervasives_Native_option__FStar_Bytes_bytes){
          .tag = FStar_Pervasives_Native_Some,
          .v = b
        }
      );
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

FStar_Pervasives_Native_option__K___Prims_list__K___FStar_Bytes_bytes_uint32_t_Prims_int
Negotiation_find_clientPske(HandshakeMessages_ch o)
{
  FStar_Pervasives_Native_option__Extensions_extension_
  scrut = Negotiation_find_client_extension(Extensions_uu___is_E_pre_shared_key____, o);
  if (scrut.tag == FStar_Pervasives_Native_Some && scrut.v.tag == Extensions_E_pre_shared_key)
  {
    Extensions_psk psk = scrut.v.val.case_E_pre_shared_key;
    if (psk.tag == Extensions_ServerPSK)
      return
        (
          (FStar_Pervasives_Native_option__K___Prims_list__K___FStar_Bytes_bytes_uint32_t_Prims_int){
            .tag = FStar_Pervasives_Native_None
          }
        );
    else if (psk.tag == Extensions_ClientPSK)
    {
      Prims_int tlen = psk.val.case_ClientPSK.binders_len;
      Prims_list__K___FStar_Bytes_bytes_uint32_t *ids = psk.val.case_ClientPSK.identities;
      return
        (
          (FStar_Pervasives_Native_option__K___Prims_list__K___FStar_Bytes_bytes_uint32_t_Prims_int){
            .tag = FStar_Pervasives_Native_Some,
            .v = { .fst = ids, .snd = tlen }
          }
        );
    }
    else
    {
      KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
        __FILE__,
        __LINE__,
        "unreachable (pattern matches are exhaustive in F*)");
      KRML_HOST_EXIT(255U);
    }
  }
  else
    return
      (
        (FStar_Pervasives_Native_option__K___Prims_list__K___FStar_Bytes_bytes_uint32_t_Prims_int){
          .tag = FStar_Pervasives_Native_None
        }
      );
}

FStar_Pervasives_Native_option__Prims_int Negotiation_find_serverPske(HandshakeMessages_sh sh)
{
  if (sh.sh_extensions.tag == FStar_Pervasives_Native_None)
    return ((FStar_Pervasives_Native_option__Prims_int){ .tag = FStar_Pervasives_Native_None });
  else if (sh.sh_extensions.tag == FStar_Pervasives_Native_Some)
  {
    Prims_list__Extensions_extension_ *exts = sh.sh_extensions.v;
    FStar_Pervasives_Native_option__Extensions_extension_
    scrut =
      FStar_List_Tot_Base_find__Extensions_extension_(Extensions_uu___is_E_pre_shared_key____,
        exts);
    if
    (
      scrut.tag
      == FStar_Pervasives_Native_Some
      &&
        scrut.v.tag
        == Extensions_E_pre_shared_key
        && scrut.v.val.case_E_pre_shared_key.tag == Extensions_ServerPSK
    )
    {
      uint16_t idx1 = scrut.v.val.case_E_pre_shared_key.val.case_ServerPSK;
      return
        (
          (FStar_Pervasives_Native_option__Prims_int){
            .tag = FStar_Pervasives_Native_Some,
            .v = FStar_UInt16_v(idx1)
          }
        );
    }
    else
      return ((FStar_Pervasives_Native_option__Prims_int){ .tag = FStar_Pervasives_Native_None });
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

bool Extensions_uu___is_E_key_share____(Extensions_extension_ projectee)
{
  if (projectee.tag == Extensions_E_key_share)
    return true;
  else
    return false;
}

FStar_Pervasives_Native_option__CommonDH_keyShareEntry
Negotiation_find_serverKeyShare(HandshakeMessages_sh sh)
{
  if (sh.sh_extensions.tag == FStar_Pervasives_Native_None)
    return
      (
        (FStar_Pervasives_Native_option__CommonDH_keyShareEntry){
          .tag = FStar_Pervasives_Native_None
        }
      );
  else if (sh.sh_extensions.tag == FStar_Pervasives_Native_Some)
  {
    Prims_list__Extensions_extension_ *exts = sh.sh_extensions.v;
    FStar_Pervasives_Native_option__Extensions_extension_
    scrut =
      FStar_List_Tot_Base_find__Extensions_extension_(Extensions_uu___is_E_key_share____,
        exts);
    if
    (
      scrut.tag
      == FStar_Pervasives_Native_Some
      &&
        scrut.v.tag
        == Extensions_E_key_share
        && scrut.v.val.case_E_key_share.tag == CommonDH_ServerKeyShare
    )
    {
      CommonDH_keyShareEntry ks = scrut.v.val.case_E_key_share.val.case_ServerKeyShare;
      return
        (
          (FStar_Pervasives_Native_option__CommonDH_keyShareEntry){
            .tag = FStar_Pervasives_Native_Some,
            .v = ks
          }
        );
    }
    else
      return
        (
          (FStar_Pervasives_Native_option__CommonDH_keyShareEntry){
            .tag = FStar_Pervasives_Native_None
          }
        );
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

bool Extensions_uu___is_E_supported_groups____(Extensions_extension_ projectee)
{
  if (projectee.tag == Extensions_E_supported_groups)
    return true;
  else
    return false;
}

FStar_Pervasives_Native_option__Prims_list__Parsers_NamedGroup_namedGroup
Negotiation_find_supported_groups(HandshakeMessages_ch o)
{
  FStar_Pervasives_Native_option__Extensions_extension_
  scrut = Negotiation_find_client_extension(Extensions_uu___is_E_supported_groups____, o);
  if (scrut.tag == FStar_Pervasives_Native_None)
    return
      (
        (FStar_Pervasives_Native_option__Prims_list__Parsers_NamedGroup_namedGroup){
          .tag = FStar_Pervasives_Native_None
        }
      );
  else if
  (scrut.tag == FStar_Pervasives_Native_Some && scrut.v.tag == Extensions_E_supported_groups)
  {
    Prims_list__Parsers_NamedGroup_namedGroup *gns = scrut.v.val.case_E_supported_groups;
    return
      (
        (FStar_Pervasives_Native_option__Prims_list__Parsers_NamedGroup_namedGroup){
          .tag = FStar_Pervasives_Native_Some,
          .v = gns
        }
      );
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

FStar_Pervasives_Native_option__Prims_list__CommonDH_keyShareEntry
Negotiation_find_key_shares(HandshakeMessages_ch o)
{
  FStar_Pervasives_Native_option__Extensions_extension_
  scrut = Negotiation_find_client_extension(Extensions_uu___is_E_key_share____, o);
  if
  (
    scrut.tag
    == FStar_Pervasives_Native_Some
    &&
      scrut.v.tag
      == Extensions_E_key_share
      && scrut.v.val.case_E_key_share.tag == CommonDH_ClientKeyShare
  )
  {
    Prims_list__CommonDH_keyShareEntry *ks = scrut.v.val.case_E_key_share.val.case_ClientKeyShare;
    return
      (
        (FStar_Pervasives_Native_option__Prims_list__CommonDH_keyShareEntry){
          .tag = FStar_Pervasives_Native_Some,
          .v = ks
        }
      );
  }
  else
    return
      (
        (FStar_Pervasives_Native_option__Prims_list__CommonDH_keyShareEntry){
          .tag = FStar_Pervasives_Native_None
        }
      );
}

static Prims_list__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_
*Negotiation_list_of_ClientKeyShare(Prims_list__CommonDH_keyShareEntry *ks)
{
  if (ks->tag == Prims_Nil)
  {
    KRML_CHECK_SIZE(sizeof (Prims_list__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_),
      (uint32_t)1U);
    Prims_list__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_
    *buf =
      KRML_HOST_MALLOC(sizeof (Prims_list__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_));
    buf[0U]
    = ((Prims_list__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_){ .tag = Prims_Nil });
    return buf;
  }
  else if (ks->tag == Prims_Cons && ks->hd.tag == CommonDH_UnknownShare)
  {
    Prims_list__CommonDH_keyShareEntry *tl1 = ks->tl;
    return Negotiation_list_of_ClientKeyShare(tl1);
  }
  else if (ks->tag == Prims_Cons && ks->hd.tag == CommonDH_Share)
  {
    Prims_list__CommonDH_keyShareEntry *tl1 = ks->tl;
    CommonDH_pre_share_ s = ks->hd.val.case_Share._1;
    CommonDH_group_ g1 = ks->hd.val.case_Share.g;
    KRML_CHECK_SIZE(sizeof (Prims_list__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_),
      (uint32_t)1U);
    Prims_list__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_
    *buf =
      KRML_HOST_MALLOC(sizeof (Prims_list__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_));
    buf[0U]
    =
      (
        (Prims_list__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_){
          .tag = Prims_Cons,
          .hd = { .fst = g1, .snd = s },
          .tl = Negotiation_list_of_ClientKeyShare(tl1)
        }
      );
    return buf;
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

Prims_list__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_
*Negotiation_gs_of(HandshakeMessages_ch o)
{
  FStar_Pervasives_Native_option__Prims_list__CommonDH_keyShareEntry
  scrut = Negotiation_find_key_shares(o);
  if (scrut.tag == FStar_Pervasives_Native_Some)
  {
    Prims_list__CommonDH_keyShareEntry *ksl = scrut.v;
    return Negotiation_list_of_ClientKeyShare(ksl);
  }
  else
  {
    KRML_CHECK_SIZE(sizeof (Prims_list__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_),
      (uint32_t)1U);
    Prims_list__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_
    *buf =
      KRML_HOST_MALLOC(sizeof (Prims_list__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_));
    buf[0U]
    = ((Prims_list__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_){ .tag = Prims_Nil });
    return buf;
  }
}

bool Extensions_uu___is_E_early_data____(Extensions_extension_ projectee)
{
  if (projectee.tag == Extensions_E_early_data)
    return true;
  else
    return false;
}

FStar_Pervasives_Native_option__FStar_Pervasives_Native_option__uint32_t
Negotiation_find_early_data(HandshakeMessages_ch o)
{
  FStar_Pervasives_Native_option__Extensions_extension_
  scrut = Negotiation_find_client_extension(Extensions_uu___is_E_early_data____, o);
  if (scrut.tag == FStar_Pervasives_Native_None)
    return
      (
        (FStar_Pervasives_Native_option__FStar_Pervasives_Native_option__uint32_t){
          .tag = FStar_Pervasives_Native_None
        }
      );
  else if (scrut.tag == FStar_Pervasives_Native_Some && scrut.v.tag == Extensions_E_early_data)
  {
    FStar_Pervasives_Native_option__uint32_t maxl = scrut.v.val.case_E_early_data;
    return
      (
        (FStar_Pervasives_Native_option__FStar_Pervasives_Native_option__uint32_t){
          .tag = FStar_Pervasives_Native_Some,
          .v = maxl
        }
      );
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

bool Negotiation_uu___is_Mode(Negotiation_mode projectee)
{
  return true;
}

HandshakeMessages_ch Negotiation___proj__Mode__item__n_offer(Negotiation_mode projectee)
{
  return projectee.n_offer;
}

FStar_Pervasives_Native_option__K___HandshakeMessages_hrr_Prims_list__Prims_dtuple2__CommonDH_group__CommonDH_pre_share__Prims_list__K___FStar_Bytes_bytes_uint32_t
Negotiation___proj__Mode__item__n_hrr(Negotiation_mode projectee)
{
  return projectee.n_hrr;
}

Parsers_ProtocolVersion_protocolVersion
Negotiation___proj__Mode__item__n_protocol_version(Negotiation_mode projectee)
{
  return projectee.n_protocol_version;
}

FStar_Bytes_bytes Negotiation___proj__Mode__item__n_server_random(Negotiation_mode projectee)
{
  return projectee.n_server_random;
}

FStar_Bytes_bytes Negotiation___proj__Mode__item__n_sessionID(Negotiation_mode projectee)
{
  return projectee.n_sessionID;
}

CipherSuite_cipherSuite_
Negotiation___proj__Mode__item__n_cipher_suite(Negotiation_mode projectee)
{
  return projectee.n_cipher_suite;
}

FStar_Pervasives_Native_option__Prims_int
Negotiation___proj__Mode__item__n_pski(Negotiation_mode projectee)
{
  return projectee.n_pski;
}

FStar_Pervasives_Native_option__Prims_list__Extensions_extension_
Negotiation___proj__Mode__item__n_server_extensions(Negotiation_mode projectee)
{
  return projectee.n_server_extensions;
}

FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_
Negotiation___proj__Mode__item__n_server_share(Negotiation_mode projectee)
{
  return projectee.n_server_share;
}

FStar_Pervasives_Native_option__HandshakeMessages_cr
Negotiation___proj__Mode__item__n_client_cert_request(Negotiation_mode projectee)
{
  return projectee.n_client_cert_request;
}

FStar_Pervasives_Native_option__K___Prims_list__K___FStar_Bytes_bytes_Prims_list__Extensions_extension__Parsers_SignatureScheme_signatureScheme
Negotiation___proj__Mode__item__n_server_cert(Negotiation_mode projectee)
{
  return projectee.n_server_cert;
}

FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_
Negotiation___proj__Mode__item__n_client_share(Negotiation_mode projectee)
{
  return projectee.n_client_share;
}

FStar_Pervasives_Native_option__Extensions_extension_
Negotiation_find_server_extension(
  bool (*filter1)(Extensions_extension_ x0),
  Negotiation_mode m
)
{
  if (m.n_server_extensions.tag == FStar_Pervasives_Native_None)
    return
      (
        (FStar_Pervasives_Native_option__Extensions_extension_){
          .tag = FStar_Pervasives_Native_None
        }
      );
  else if (m.n_server_extensions.tag == FStar_Pervasives_Native_Some)
  {
    Prims_list__Extensions_extension_ *es = m.n_server_extensions.v;
    return FStar_List_Tot_Base_find__Extensions_extension_(filter1, es);
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

bool Negotiation_is_resumption12(Negotiation_mode m)
{
  return
    !TLSConstants_is_pv_13(m.n_protocol_version)
    && __eq__FStar_Bytes_bytes(m.n_sessionID, m.n_offer.ch_sessionID);
}

bool Negotiation_is_cacheable12(Negotiation_mode m)
{
  if (!TLSConstants_is_pv_13(m.n_protocol_version))
  {
    FStar_Bytes_bytes sid = m.n_sessionID;
    return
      __neq__FStar_Bytes_bytes(sid,
        m.n_offer.ch_sessionID)
      && __neq__FStar_Bytes_bytes(sid, FStar_Bytes_empty_bytes);
  }
  else
    return false;
}

bool
Negotiation_uu___is_C_Init(
  TLSConstants_role r,
  TLSConstants_config cfg,
  Negotiation_negotiationState projectee
)
{
  if (projectee.tag == Negotiation_C_Init)
    return true;
  else
    return false;
}

FStar_Bytes_bytes
Negotiation___proj__C_Init__item__n_client_random(
  TLSConstants_role r,
  TLSConstants_config cfg,
  Negotiation_negotiationState projectee
)
{
  if (projectee.tag == Negotiation_C_Init)
    return projectee.val.case_C_Init;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

bool
Negotiation_uu___is_C_Offer(
  TLSConstants_role r,
  TLSConstants_config cfg,
  Negotiation_negotiationState projectee
)
{
  if (projectee.tag == Negotiation_C_Offer)
    return true;
  else
    return false;
}

HandshakeMessages_ch
Negotiation___proj__C_Offer__item__n_offer(
  TLSConstants_role r,
  TLSConstants_config cfg,
  Negotiation_negotiationState projectee
)
{
  if (projectee.tag == Negotiation_C_Offer)
    return projectee.val.case_C_Offer;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

bool
Negotiation_uu___is_C_HRR(
  TLSConstants_role r,
  TLSConstants_config cfg,
  Negotiation_negotiationState projectee
)
{
  if (projectee.tag == Negotiation_C_HRR)
    return true;
  else
    return false;
}

HandshakeMessages_ch
Negotiation___proj__C_HRR__item__n_offer(
  TLSConstants_role r,
  TLSConstants_config cfg,
  Negotiation_negotiationState projectee
)
{
  if (projectee.tag == Negotiation_C_HRR)
    return projectee.val.case_C_HRR.n_offer;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

K___HandshakeMessages_hrr_Prims_list__Prims_dtuple2__CommonDH_group__CommonDH_pre_share__Prims_list__K___FStar_Bytes_bytes_uint32_t
Negotiation___proj__C_HRR__item__n_hrr(
  TLSConstants_role r,
  TLSConstants_config cfg,
  Negotiation_negotiationState projectee
)
{
  if (projectee.tag == Negotiation_C_HRR)
    return projectee.val.case_C_HRR.n_hrr;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

bool
Negotiation_uu___is_C_WaitFinished1(
  TLSConstants_role r,
  TLSConstants_config cfg,
  Negotiation_negotiationState projectee
)
{
  if (projectee.tag == Negotiation_C_WaitFinished1)
    return true;
  else
    return false;
}

Negotiation_mode
Negotiation___proj__C_WaitFinished1__item__n_partialmode(
  TLSConstants_role r,
  TLSConstants_config cfg,
  Negotiation_negotiationState projectee
)
{
  if (projectee.tag == Negotiation_C_WaitFinished1)
    return projectee.val.case_C_WaitFinished1;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

bool
Negotiation_uu___is_C_Mode(
  TLSConstants_role r,
  TLSConstants_config cfg,
  Negotiation_negotiationState projectee
)
{
  if (projectee.tag == Negotiation_C_Mode)
    return true;
  else
    return false;
}

Negotiation_mode
Negotiation___proj__C_Mode__item__n_mode(
  TLSConstants_role r,
  TLSConstants_config cfg,
  Negotiation_negotiationState projectee
)
{
  if (projectee.tag == Negotiation_C_Mode)
    return projectee.val.case_C_Mode;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

bool
Negotiation_uu___is_C_WaitFinished2(
  TLSConstants_role r,
  TLSConstants_config cfg,
  Negotiation_negotiationState projectee
)
{
  if (projectee.tag == Negotiation_C_WaitFinished2)
    return true;
  else
    return false;
}

Negotiation_mode
Negotiation___proj__C_WaitFinished2__item__n_mode(
  TLSConstants_role r,
  TLSConstants_config cfg,
  Negotiation_negotiationState projectee
)
{
  if (projectee.tag == Negotiation_C_WaitFinished2)
    return projectee.val.case_C_WaitFinished2.n_mode;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

FStar_Pervasives_Native_option__Prims_list__K___FStar_Bytes_bytes_Prims_list__Extensions_extension_
Negotiation___proj__C_WaitFinished2__item__n_client_certificate(
  TLSConstants_role r,
  TLSConstants_config cfg,
  Negotiation_negotiationState projectee
)
{
  if (projectee.tag == Negotiation_C_WaitFinished2)
    return projectee.val.case_C_WaitFinished2.n_client_certificate;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

bool
Negotiation_uu___is_C_Complete(
  TLSConstants_role r,
  TLSConstants_config cfg,
  Negotiation_negotiationState projectee
)
{
  if (projectee.tag == Negotiation_C_Complete)
    return true;
  else
    return false;
}

Negotiation_mode
Negotiation___proj__C_Complete__item__n_mode(
  TLSConstants_role r,
  TLSConstants_config cfg,
  Negotiation_negotiationState projectee
)
{
  if (projectee.tag == Negotiation_C_Complete)
    return projectee.val.case_C_Complete.n_mode;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

FStar_Pervasives_Native_option__Prims_list__K___FStar_Bytes_bytes_Prims_list__Extensions_extension_
Negotiation___proj__C_Complete__item__n_client_certificate(
  TLSConstants_role r,
  TLSConstants_config cfg,
  Negotiation_negotiationState projectee
)
{
  if (projectee.tag == Negotiation_C_Complete)
    return projectee.val.case_C_Complete.n_client_certificate;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

bool
Negotiation_uu___is_S_Init(
  TLSConstants_role r,
  TLSConstants_config cfg,
  Negotiation_negotiationState projectee
)
{
  if (projectee.tag == Negotiation_S_Init)
    return true;
  else
    return false;
}

FStar_Bytes_bytes
Negotiation___proj__S_Init__item__n_server_random(
  TLSConstants_role r,
  TLSConstants_config cfg,
  Negotiation_negotiationState projectee
)
{
  if (projectee.tag == Negotiation_S_Init)
    return projectee.val.case_S_Init;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

bool
Negotiation_uu___is_S_HRR(
  TLSConstants_role r,
  TLSConstants_config cfg,
  Negotiation_negotiationState projectee
)
{
  if (projectee.tag == Negotiation_S_HRR)
    return true;
  else
    return false;
}

HandshakeMessages_ch
Negotiation___proj__S_HRR__item__n_offer(
  TLSConstants_role r,
  TLSConstants_config cfg,
  Negotiation_negotiationState projectee
)
{
  if (projectee.tag == Negotiation_S_HRR)
    return projectee.val.case_S_HRR.n_offer;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

HandshakeMessages_hrr
Negotiation___proj__S_HRR__item__n_hrr(
  TLSConstants_role r,
  TLSConstants_config cfg,
  Negotiation_negotiationState projectee
)
{
  if (projectee.tag == Negotiation_S_HRR)
    return projectee.val.case_S_HRR.n_hrr;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

bool
Negotiation_uu___is_S_ClientHello(
  TLSConstants_role r,
  TLSConstants_config cfg,
  Negotiation_negotiationState projectee
)
{
  if (projectee.tag == Negotiation_S_ClientHello)
    return true;
  else
    return false;
}

Negotiation_mode
Negotiation___proj__S_ClientHello__item__n_mode(
  TLSConstants_role r,
  TLSConstants_config cfg,
  Negotiation_negotiationState projectee
)
{
  if (projectee.tag == Negotiation_S_ClientHello)
    return projectee.val.case_S_ClientHello.n_mode;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

FStar_Pervasives_Native_option__K___uint64_t_Parsers_SignatureScheme_signatureScheme
Negotiation___proj__S_ClientHello__item__n_selected_cert(
  TLSConstants_role r,
  TLSConstants_config cfg,
  Negotiation_negotiationState projectee
)
{
  if (projectee.tag == Negotiation_S_ClientHello)
    return projectee.val.case_S_ClientHello.n_selected_cert;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

bool
Negotiation_uu___is_S_Mode(
  TLSConstants_role r,
  TLSConstants_config cfg,
  Negotiation_negotiationState projectee
)
{
  if (projectee.tag == Negotiation_S_Mode)
    return true;
  else
    return false;
}

Negotiation_mode
Negotiation___proj__S_Mode__item__n_mode(
  TLSConstants_role r,
  TLSConstants_config cfg,
  Negotiation_negotiationState projectee
)
{
  if (projectee.tag == Negotiation_S_Mode)
    return projectee.val.case_S_Mode.n_mode;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

FStar_Pervasives_Native_option__K___uint64_t_Parsers_SignatureScheme_signatureScheme
Negotiation___proj__S_Mode__item__n_selected_cert(
  TLSConstants_role r,
  TLSConstants_config cfg,
  Negotiation_negotiationState projectee
)
{
  if (projectee.tag == Negotiation_S_Mode)
    return projectee.val.case_S_Mode.n_selected_cert;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

bool
Negotiation_uu___is_S_Complete(
  TLSConstants_role r,
  TLSConstants_config cfg,
  Negotiation_negotiationState projectee
)
{
  if (projectee.tag == Negotiation_S_Complete)
    return true;
  else
    return false;
}

Negotiation_mode
Negotiation___proj__S_Complete__item__n_mode(
  TLSConstants_role r,
  TLSConstants_config cfg,
  Negotiation_negotiationState projectee
)
{
  if (projectee.tag == Negotiation_S_Complete)
    return projectee.val.case_S_Complete.n_mode;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

FStar_Pervasives_Native_option__Prims_list__K___FStar_Bytes_bytes_Prims_list__Extensions_extension_
Negotiation___proj__S_Complete__item__n_client_certificate(
  TLSConstants_role r,
  TLSConstants_config cfg,
  Negotiation_negotiationState projectee
)
{
  if (projectee.tag == Negotiation_S_Complete)
    return projectee.val.case_S_Complete.n_client_certificate;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

bool Negotiation_uu___is_NS(TLSConstants_role role, Negotiation_t projectee)
{
  return true;
}

TLSConstants_config
Negotiation___proj__NS__item__cfg(TLSConstants_role role, Negotiation_t projectee)
{
  return projectee.cfg;
}

K___FStar_Pervasives_Native_option__K___FStar_Bytes_bytes_Ticket_ticket_Prims_list__K___FStar_Bytes_bytes_Ticket_ticket
Negotiation___proj__NS__item__resume(TLSConstants_role role, Negotiation_t projectee)
{
  return projectee.resume;
}

FStar_Bytes_bytes
Negotiation___proj__NS__item__nonce(TLSConstants_role role, Negotiation_t projectee)
{
  return projectee.nonce;
}

Negotiation_negotiationState
*Negotiation___proj__NS__item__state(TLSConstants_role role, Negotiation_t projectee)
{
  return projectee.state;
}

FStar_Pervasives_Native_option__K___FStar_Bytes_bytes_Ticket_ticket
FStar_Pervasives_Native_fst__FStar_Pervasives_Native_option_FStar_Bytes_bytes___Ticket_ticket_Prims_list_FStar_Bytes_bytes___Ticket_ticket(
  K___FStar_Pervasives_Native_option__K___FStar_Bytes_bytes_Ticket_ticket_Prims_list__K___FStar_Bytes_bytes_Ticket_ticket
  x
)
{
  return x.fst;
}

static Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo
*FStar_List_Tot_Base_rev_acc__FStar_Bytes_bytes___TLSConstants_pskInfo(
  Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo *l,
  Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo *acc
)
{
  if (l->tag == Prims_Nil)
    return acc;
  else if (l->tag == Prims_Cons)
  {
    Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo *tl1 = l->tl;
    K___FStar_Bytes_bytes_TLSConstants_pskInfo hd1 = l->hd;
    KRML_CHECK_SIZE(sizeof (Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo), (uint32_t)1U);
    Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo
    *buf = KRML_HOST_MALLOC(sizeof (Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo));
    buf[0U]
    =
      (
        (Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo){
          .tag = Prims_Cons,
          .hd = hd1,
          .tl = acc
        }
      );
    return FStar_List_Tot_Base_rev_acc__FStar_Bytes_bytes___TLSConstants_pskInfo(tl1, buf);
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

static Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo
*FStar_List_Tot_Base_rev__FStar_Bytes_bytes___TLSConstants_pskInfo(
  Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo *l
)
{
  KRML_CHECK_SIZE(sizeof (Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo), (uint32_t)1U);
  Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo
  *buf = KRML_HOST_MALLOC(sizeof (Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo));
  buf[0U] = ((Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo){ .tag = Prims_Nil });
  return FStar_List_Tot_Base_rev_acc__FStar_Bytes_bytes___TLSConstants_pskInfo(l, buf);
}

static Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo
*Negotiation_ticket13_pskinfo__FStar_Bytes_bytes(
  Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo *acc,
  Prims_list__K___FStar_Bytes_bytes_Ticket_ticket *uu___2_4457
)
{
  if (uu___2_4457->tag == Prims_Nil)
    return FStar_List_Tot_Base_rev__FStar_Bytes_bytes___TLSConstants_pskInfo(acc);
  else if (uu___2_4457->tag == Prims_Cons)
  {
    Prims_list__K___FStar_Bytes_bytes_Ticket_ticket *r = uu___2_4457->tl;
    Ticket_ticket t = uu___2_4457->hd.snd;
    FStar_Bytes_bytes tid = uu___2_4457->hd.fst;
    FStar_Pervasives_Native_option__TLSConstants_pskInfo x0 = Ticket_ticket_pskinfo(t);
    TLSConstants_pskInfo ite;
    if (x0.tag == FStar_Pervasives_Native_Some)
      ite = x0.v;
    else
      ite = KRML_EABORT(TLSConstants_pskInfo, "unreachable (pattern matches are exhaustive in F*)");
    KRML_CHECK_SIZE(sizeof (Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo), (uint32_t)1U);
    Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo
    *buf = KRML_HOST_MALLOC(sizeof (Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo));
    buf[0U]
    =
      (
        (Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo){
          .tag = Prims_Cons,
          .hd = { .fst = tid, .snd = ite },
          .tl = acc
        }
      );
    return Negotiation_ticket13_pskinfo__FStar_Bytes_bytes(buf, r);
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

static Prims_list__K___FStar_Bytes_bytes_Ticket_ticket
*FStar_Pervasives_Native_snd__FStar_Pervasives_Native_option_FStar_Bytes_bytes___Ticket_ticket_Prims_list_FStar_Bytes_bytes___Ticket_ticket(
  K___FStar_Pervasives_Native_option__K___FStar_Bytes_bytes_Ticket_ticket_Prims_list__K___FStar_Bytes_bytes_Ticket_ticket
  x
)
{
  return x.snd;
}

typedef struct K___FStar_Pervasives_Native_option__FStar_Bytes_bytes_FStar_Bytes_bytes_s
{
  FStar_Pervasives_Native_option__FStar_Bytes_bytes fst;
  FStar_Bytes_bytes snd;
}
K___FStar_Pervasives_Native_option__FStar_Bytes_bytes_FStar_Bytes_bytes;

typedef struct
K___FStar_Pervasives_Native_option__K___FStar_Bytes_bytes_Ticket_ticket_bool_Parsers_ProtocolVersion_protocolVersion_s
{
  FStar_Pervasives_Native_option__K___FStar_Bytes_bytes_Ticket_ticket fst;
  bool snd;
  Parsers_ProtocolVersion_protocolVersion thd;
}
K___FStar_Pervasives_Native_option__K___FStar_Bytes_bytes_Ticket_ticket_bool_Parsers_ProtocolVersion_protocolVersion;

HandshakeMessages_ch
Negotiation_computeOffer(
  TLSConstants_role r,
  TLSConstants_config cfg,
  FStar_Bytes_bytes nonce,
  FStar_Pervasives_Native_option__CommonDH_keyShare ks,
  K___FStar_Pervasives_Native_option__K___FStar_Bytes_bytes_Ticket_ticket_Prims_list__K___FStar_Bytes_bytes_Ticket_ticket
  resume,
  uint32_t now1
)
{
  K___FStar_Pervasives_Native_option__K___FStar_Bytes_bytes_Ticket_ticket_bool_Parsers_ProtocolVersion_protocolVersion
  scrut0 =
    {
      .fst = FStar_Pervasives_Native_fst__FStar_Pervasives_Native_option_FStar_Bytes_bytes___Ticket_ticket_Prims_list_FStar_Bytes_bytes___Ticket_ticket(resume),
      .snd = cfg.enable_tickets,
      .thd = cfg.min_version
    };
  K___FStar_Pervasives_Native_option__FStar_Bytes_bytes_FStar_Bytes_bytes scrut;
  if (scrut0.thd.tag == Parsers_ProtocolVersion_TLS_1p3)
    scrut =
      (
        (K___FStar_Pervasives_Native_option__FStar_Bytes_bytes_FStar_Bytes_bytes){
          .fst = { .tag = FStar_Pervasives_Native_None },
          .snd = FStar_Bytes_empty_bytes
        }
      );
  else if (scrut0.fst.tag == FStar_Pervasives_Native_Some && scrut0.snd == true)
  {
    FStar_Bytes_bytes tid = scrut0.fst.v.fst;
    FStar_Bytes_bytes sid;
    if (Prims_op_LessThanOrEqual(FStar_UInt32_v(FStar_Bytes_len(tid)), (krml_checked_int_t)32))
      sid = tid;
    else
      sid =
        FStar_Pervasives_Native_fst__FStar_Bytes_bytes_FStar_Bytes_bytes(FStar_Bytes_split(tid,
            (uint32_t)32U));
    scrut =
      (
        (K___FStar_Pervasives_Native_option__FStar_Bytes_bytes_FStar_Bytes_bytes){
          .fst = { .tag = FStar_Pervasives_Native_Some, .v = tid },
          .snd = sid
        }
      );
  }
  else if (scrut0.fst.tag == FStar_Pervasives_Native_None && scrut0.snd == true)
    scrut =
      (
        (K___FStar_Pervasives_Native_option__FStar_Bytes_bytes_FStar_Bytes_bytes){
          .fst = { .tag = FStar_Pervasives_Native_Some, .v = FStar_Bytes_empty_bytes },
          .snd = FStar_Bytes_empty_bytes
        }
      );
  else
    scrut =
      (
        (K___FStar_Pervasives_Native_option__FStar_Bytes_bytes_FStar_Bytes_bytes){
          .fst = { .tag = FStar_Pervasives_Native_None },
          .snd = FStar_Bytes_empty_bytes
        }
      );
  FStar_Pervasives_Native_option__FStar_Bytes_bytes ticket12 = scrut.fst;
  FStar_Bytes_bytes sid = scrut.snd;
  KRML_CHECK_SIZE(sizeof (Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo), (uint32_t)1U);
  Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo
  *buf0 = KRML_HOST_MALLOC(sizeof (Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo));
  buf0[0U] = ((Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo){ .tag = Prims_Nil });
  Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo
  *pskinfo =
    Negotiation_ticket13_pskinfo__FStar_Bytes_bytes(buf0,
      FStar_Pervasives_Native_snd__FStar_Pervasives_Native_option_FStar_Bytes_bytes___Ticket_ticket_Prims_list_FStar_Bytes_bytes___Ticket_ticket(resume));
  bool compatible_psk;
  if (pskinfo->tag == Prims_Cons)
  {
    TLSConstants_pskInfo i1 = pskinfo->hd.snd;
    compatible_psk = i1.allow_early_data;
  }
  else
    compatible_psk = false;
  Prims_list__Extensions_extension_
  *extensions =
    Extensions_prepareExtensions(cfg.min_version,
      cfg.max_version,
      cfg.cipher_suites,
      cfg.peer_name,
      cfg.alpn,
      cfg.custom_extensions,
      cfg.extended_master_secret,
      cfg.safe_renegotiation,
      compatible_psk && FStar_Pervasives_Native_uu___is_Some__uint32_t(cfg.max_early_data),
      ticket12,
      cfg.signature_algorithms,
      cfg.named_groups,
      (
        (FStar_Pervasives_Native_option__K___FStar_Bytes_bytes_FStar_Bytes_bytes){
          .tag = FStar_Pervasives_Native_None
        }
      ),
      ks,
      pskinfo,
      now1);
  KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_CompressionMethod_compressionMethod),
    (uint32_t)1U);
  Prims_list__Parsers_CompressionMethod_compressionMethod
  *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_CompressionMethod_compressionMethod));
  buf[0U] = ((Prims_list__Parsers_CompressionMethod_compressionMethod){ .tag = Prims_Nil });
  KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_CompressionMethod_compressionMethod),
    (uint32_t)1U);
  Prims_list__Parsers_CompressionMethod_compressionMethod
  *buf1 = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_CompressionMethod_compressionMethod));
  buf1[0U]
  =
    (
      (Prims_list__Parsers_CompressionMethod_compressionMethod){
        .tag = Prims_Cons,
        .hd = { .tag = Parsers_CompressionMethod_NullCompression },
        .tl = buf
      }
    );
  return
    (
      (HandshakeMessages_ch){
        .ch_protocol_version = TLSConstants_minPV((
            (Parsers_ProtocolVersion_protocolVersion){ .tag = Parsers_ProtocolVersion_TLS_1p2 }
          ),
          cfg.max_version),
        .ch_client_random = nonce,
        .ch_sessionID = sid,
        .ch_cipher_suites = CipherSuite_nameList_of_cipherSuites(cfg.cipher_suites),
        .ch_compressions = buf1,
        .ch_extensions = { .tag = FStar_Pervasives_Native_Some, .v = extensions }
      }
    );
}

static Prims_list__K___FStar_Bytes_bytes_Ticket_ticket
*FStar_List_Tot_Base_rev_acc__FStar_Bytes_bytes___Ticket_ticket(
  Prims_list__K___FStar_Bytes_bytes_Ticket_ticket *l,
  Prims_list__K___FStar_Bytes_bytes_Ticket_ticket *acc
)
{
  if (l->tag == Prims_Nil)
    return acc;
  else if (l->tag == Prims_Cons)
  {
    Prims_list__K___FStar_Bytes_bytes_Ticket_ticket *tl1 = l->tl;
    K___FStar_Bytes_bytes_Ticket_ticket hd1 = l->hd;
    KRML_CHECK_SIZE(sizeof (Prims_list__K___FStar_Bytes_bytes_Ticket_ticket), (uint32_t)1U);
    Prims_list__K___FStar_Bytes_bytes_Ticket_ticket
    *buf = KRML_HOST_MALLOC(sizeof (Prims_list__K___FStar_Bytes_bytes_Ticket_ticket));
    buf[0U]
    =
      ((Prims_list__K___FStar_Bytes_bytes_Ticket_ticket){ .tag = Prims_Cons, .hd = hd1, .tl = acc });
    return FStar_List_Tot_Base_rev_acc__FStar_Bytes_bytes___Ticket_ticket(tl1, buf);
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

static Prims_list__K___FStar_Bytes_bytes_Ticket_ticket
*FStar_List_Tot_Base_rev__FStar_Bytes_bytes___Ticket_ticket(
  Prims_list__K___FStar_Bytes_bytes_Ticket_ticket *l
)
{
  KRML_CHECK_SIZE(sizeof (Prims_list__K___FStar_Bytes_bytes_Ticket_ticket), (uint32_t)1U);
  Prims_list__K___FStar_Bytes_bytes_Ticket_ticket
  *buf = KRML_HOST_MALLOC(sizeof (Prims_list__K___FStar_Bytes_bytes_Ticket_ticket));
  buf[0U] = ((Prims_list__K___FStar_Bytes_bytes_Ticket_ticket){ .tag = Prims_Nil });
  return FStar_List_Tot_Base_rev_acc__FStar_Bytes_bytes___Ticket_ticket(l, buf);
}

Prims_list__K___FStar_Bytes_bytes_Ticket_ticket
*Negotiation_unseal_tickets(
  Prims_list__K___FStar_Bytes_bytes_Ticket_ticket *acc,
  Prims_list__K___FStar_Bytes_bytes_FStar_Bytes_bytes *l
)
{
  if (l->tag == Prims_Nil)
    return FStar_List_Tot_Base_rev__FStar_Bytes_bytes___Ticket_ticket(acc);
  else if (l->tag == Prims_Cons)
  {
    Prims_list__K___FStar_Bytes_bytes_FStar_Bytes_bytes *r = l->tl;
    FStar_Bytes_bytes seal = l->hd.snd;
    FStar_Bytes_bytes tid = l->hd.fst;
    FStar_Pervasives_Native_option__Ticket_ticket scrut = Ticket_check_ticket(true, seal);
    Prims_list__K___FStar_Bytes_bytes_Ticket_ticket *acc1;
    if (scrut.tag == FStar_Pervasives_Native_Some)
    {
      Ticket_ticket t = scrut.v;
      KRML_CHECK_SIZE(sizeof (Prims_list__K___FStar_Bytes_bytes_Ticket_ticket), (uint32_t)1U);
      Prims_list__K___FStar_Bytes_bytes_Ticket_ticket
      *buf = KRML_HOST_MALLOC(sizeof (Prims_list__K___FStar_Bytes_bytes_Ticket_ticket));
      buf[0U]
      =
        (
          (Prims_list__K___FStar_Bytes_bytes_Ticket_ticket){
            .tag = Prims_Cons,
            .hd = { .fst = tid, .snd = t },
            .tl = acc
          }
        );
      acc1 = buf;
    }
    else if (scrut.tag == FStar_Pervasives_Native_None)
    {
      Negotiation_print(Prims_strcat("WARNING: failed to unseal the session data for ticket ",
          Prims_strcat(FStar_Bytes_print_bytes(tid), " (check sealing key)")));
      acc1 = acc;
    }
    else
      acc1 =
        KRML_EABORT(Prims_list__K___FStar_Bytes_bytes_Ticket_ticket *,
          "unreachable (pattern matches are exhaustive in F*)");
    return Negotiation_unseal_tickets(acc1, r);
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

static FStar_Pervasives_Native_option__K___FStar_Bytes_bytes_Ticket_ticket
Negotiation_find_ticket12__FStar_Bytes_bytes(
  FStar_Pervasives_Native_option__K___FStar_Bytes_bytes_Ticket_ticket acc,
  Prims_list__K___FStar_Bytes_bytes_Ticket_ticket *uu___0_4296
)
{
  if (uu___0_4296->tag == Prims_Nil)
    return acc;
  else if (uu___0_4296->tag == Prims_Cons)
  {
    Prims_list__K___FStar_Bytes_bytes_Ticket_ticket *r = uu___0_4296->tl;
    Ticket_ticket t = uu___0_4296->hd.snd;
    FStar_Bytes_bytes tid = uu___0_4296->hd.fst;
    FStar_Pervasives_Native_option__K___FStar_Bytes_bytes_Ticket_ticket ite;
    if (Ticket_uu___is_Ticket12(t))
      ite =
        (
          (FStar_Pervasives_Native_option__K___FStar_Bytes_bytes_Ticket_ticket){
            .tag = FStar_Pervasives_Native_Some,
            .v = { .fst = tid, .snd = t }
          }
        );
    else
      ite = acc;
    return Negotiation_find_ticket12__FStar_Bytes_bytes(ite, r);
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

static Prims_list__K___FStar_Bytes_bytes_Ticket_ticket
*Negotiation_filter_ticket13__FStar_Bytes_bytes(
  Prims_list__K___FStar_Bytes_bytes_Ticket_ticket *acc,
  Prims_list__K___FStar_Bytes_bytes_Ticket_ticket *uu___1_4375
)
{
  if (uu___1_4375->tag == Prims_Nil)
    return FStar_List_Tot_Base_rev__FStar_Bytes_bytes___Ticket_ticket(acc);
  else if (uu___1_4375->tag == Prims_Cons)
  {
    Prims_list__K___FStar_Bytes_bytes_Ticket_ticket *r = uu___1_4375->tl;
    Ticket_ticket t = uu___1_4375->hd.snd;
    FStar_Bytes_bytes tid = uu___1_4375->hd.fst;
    Prims_list__K___FStar_Bytes_bytes_Ticket_ticket *ite;
    if (Ticket_uu___is_Ticket13(t))
    {
      KRML_CHECK_SIZE(sizeof (Prims_list__K___FStar_Bytes_bytes_Ticket_ticket), (uint32_t)1U);
      Prims_list__K___FStar_Bytes_bytes_Ticket_ticket
      *buf = KRML_HOST_MALLOC(sizeof (Prims_list__K___FStar_Bytes_bytes_Ticket_ticket));
      buf[0U]
      =
        (
          (Prims_list__K___FStar_Bytes_bytes_Ticket_ticket){
            .tag = Prims_Cons,
            .hd = { .fst = tid, .snd = t },
            .tl = acc
          }
        );
      ite = buf;
    }
    else
      ite = acc;
    return Negotiation_filter_ticket13__FStar_Bytes_bytes(ite, r);
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

Negotiation_t
Negotiation_create(TLSConstants_role r, TLSConstants_config cfg, FStar_Bytes_bytes nonce)
{
  KRML_CHECK_SIZE(sizeof (Prims_list__K___FStar_Bytes_bytes_Ticket_ticket), (uint32_t)1U);
  Prims_list__K___FStar_Bytes_bytes_Ticket_ticket
  *buf0 = KRML_HOST_MALLOC(sizeof (Prims_list__K___FStar_Bytes_bytes_Ticket_ticket));
  buf0[0U] = ((Prims_list__K___FStar_Bytes_bytes_Ticket_ticket){ .tag = Prims_Nil });
  Prims_list__K___FStar_Bytes_bytes_Ticket_ticket
  *resume = Negotiation_unseal_tickets(buf0, cfg.use_tickets);
  KRML_CHECK_SIZE(sizeof (Prims_list__K___FStar_Bytes_bytes_Ticket_ticket), (uint32_t)1U);
  Prims_list__K___FStar_Bytes_bytes_Ticket_ticket
  *buf = KRML_HOST_MALLOC(sizeof (Prims_list__K___FStar_Bytes_bytes_Ticket_ticket));
  buf[0U] = ((Prims_list__K___FStar_Bytes_bytes_Ticket_ticket){ .tag = Prims_Nil });
  K___FStar_Pervasives_Native_option__K___FStar_Bytes_bytes_Ticket_ticket_Prims_list__K___FStar_Bytes_bytes_Ticket_ticket
  resume1 =
    {
      .fst = Negotiation_find_ticket12__FStar_Bytes_bytes((
          (FStar_Pervasives_Native_option__K___FStar_Bytes_bytes_Ticket_ticket){
            .tag = FStar_Pervasives_Native_None
          }
        ),
        resume),
      .snd = Negotiation_filter_ticket13__FStar_Bytes_bytes(buf, resume)
    };
  switch (r)
  {
    case TLSConstants_Client:
      {
        KRML_CHECK_SIZE(sizeof (Negotiation_negotiationState), (uint32_t)1U);
        Negotiation_negotiationState
        *state = KRML_HOST_MALLOC(sizeof (Negotiation_negotiationState));
        state[0U]
        =
          (
            (Negotiation_negotiationState){
              .tag = Negotiation_C_Init,
              .val = { .case_C_Init = nonce }
            }
          );
        return ((Negotiation_t){ .cfg = cfg, .resume = resume1, .nonce = nonce, .state = state });
      }
    case TLSConstants_Server:
      {
        KRML_CHECK_SIZE(sizeof (Negotiation_negotiationState), (uint32_t)1U);
        Negotiation_negotiationState
        *state = KRML_HOST_MALLOC(sizeof (Negotiation_negotiationState));
        state[0U]
        =
          (
            (Negotiation_negotiationState){
              .tag = Negotiation_S_Init,
              .val = { .case_S_Init = nonce }
            }
          );
        return ((Negotiation_t){ .cfg = cfg, .resume = resume1, .nonce = nonce, .state = state });
      }
    default:
      {
        KRML_HOST_EPRINTF("KreMLin incomplete match at %s:%d\n", __FILE__, __LINE__);
        KRML_HOST_EXIT(253U);
      }
  }
}

bool Negotiation_is_server_hrr(TLSConstants_role role, Negotiation_t ns)
{
  Negotiation_negotiationState scrut = ns.state[0U];
  if (scrut.tag == Negotiation_S_HRR)
    return true;
  else
    return false;
}

Spec_Hash_Definitions_hash_alg Negotiation_hashAlg(Negotiation_mode m)
{
  return TLSConstants_verifyDataHashAlg_of_ciphersuite(m.n_cipher_suite);
}

static bool
FStar_Pervasives_Native_uu___is_Some__Prims_dtuple2_CommonDH_group__CommonDH_pre_share_(
  FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_ projectee
)
{
  if (projectee.tag == FStar_Pervasives_Native_Some)
    return true;
  else
    return false;
}

CipherSuite_kexAlg Negotiation_kexAlg(Negotiation_mode m)
{
  if (TLSConstants_is_pv_13(m.n_protocol_version))
    if (m.n_pski.tag == FStar_Pervasives_Native_None)
      return CipherSuite_Kex_ECDHE;
    else if (m.n_pski.tag == FStar_Pervasives_Native_Some)
      if
      (
        FStar_Pervasives_Native_uu___is_Some__Prims_dtuple2_CommonDH_group__CommonDH_pre_share_(m.n_server_share)
      )
        return CipherSuite_Kex_PSK_ECDHE;
      else
        return CipherSuite_Kex_PSK;
    else
    {
      KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
        __FILE__,
        __LINE__,
        "unreachable (pattern matches are exhaustive in F*)");
      KRML_HOST_EXIT(255U);
    }
  else if (m.n_cipher_suite.tag == CipherSuite_CipherSuite)
    return m.n_cipher_suite.val.case_CipherSuite._0;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

CipherSuite_aeAlg Negotiation_aeAlg(Negotiation_mode m)
{
  return TLSConstants_get_aeAlg(m.n_cipher_suite);
}

bool
__eq__K___Prims_int_FStar_Bytes_bytes(
  K___Prims_int_FStar_Bytes_bytes y,
  K___Prims_int_FStar_Bytes_bytes x
)
{
  return true && x.fst == y.fst && __eq__FStar_Bytes_bytes(x.snd, y.snd);
}

bool __eq__TLSConstants_serverName(TLSConstants_serverName y, TLSConstants_serverName x)
{
  if (x.tag == TLSConstants_SNI_DNS)
  {
    FStar_Bytes_bytes x__0 = x.val.case_SNI_DNS;
    if (y.tag == TLSConstants_SNI_DNS)
    {
      FStar_Bytes_bytes y__0 = y.val.case_SNI_DNS;
      return true && __eq__FStar_Bytes_bytes(y__0, x__0);
    }
    else
      return false;
  }
  else if (x.tag == TLSConstants_SNI_UNKNOWN)
  {
    K___Prims_int_FStar_Bytes_bytes x__0 = x.val.case_SNI_UNKNOWN;
    if (y.tag == TLSConstants_SNI_UNKNOWN)
    {
      K___Prims_int_FStar_Bytes_bytes y__0 = y.val.case_SNI_UNKNOWN;
      return true && __eq__K___Prims_int_FStar_Bytes_bytes(y__0, x__0);
    }
    else
      return false;
  }
  else
    return false;
}

bool
__eq__Prims_list__TLSConstants_serverName(
  Prims_list__TLSConstants_serverName *y,
  Prims_list__TLSConstants_serverName *x
)
{
  if (x->tag == Prims_Nil)
    if (y->tag == Prims_Nil)
      return true;
    else
      return false;
  else if (x->tag == Prims_Cons)
  {
    Prims_list__TLSConstants_serverName *x_tl = x->tl;
    TLSConstants_serverName x_hd = x->hd;
    if (y->tag == Prims_Cons)
    {
      Prims_list__TLSConstants_serverName *y_tl = y->tl;
      TLSConstants_serverName y_hd = y->hd;
      return
        true
        && __eq__TLSConstants_serverName(y_hd, x_hd)
        && __eq__Prims_list__TLSConstants_serverName(y_tl, x_tl);
    }
    else
      return false;
  }
  else
    return false;
}

bool
__eq__Prims_list__Parsers_NamedGroup_namedGroup(
  Prims_list__Parsers_NamedGroup_namedGroup *y,
  Prims_list__Parsers_NamedGroup_namedGroup *x
)
{
  if (x->tag == Prims_Nil)
    if (y->tag == Prims_Nil)
      return true;
    else
      return false;
  else if (x->tag == Prims_Cons)
  {
    Prims_list__Parsers_NamedGroup_namedGroup *x_tl = x->tl;
    Parsers_NamedGroup_namedGroup x_hd = x->hd;
    if (y->tag == Prims_Cons)
    {
      Prims_list__Parsers_NamedGroup_namedGroup *y_tl = y->tl;
      Parsers_NamedGroup_namedGroup y_hd = y->hd;
      return
        true
        && __eq__Parsers_NamedGroup_namedGroup(y_hd, x_hd)
        && __eq__Prims_list__Parsers_NamedGroup_namedGroup(y_tl, x_tl);
    }
    else
      return false;
  }
  else
    return false;
}

bool
__eq__Prims_list__Parsers_SignatureScheme_signatureScheme(
  Prims_list__Parsers_SignatureScheme_signatureScheme *y,
  Prims_list__Parsers_SignatureScheme_signatureScheme *x
)
{
  if (x->tag == Prims_Nil)
    if (y->tag == Prims_Nil)
      return true;
    else
      return false;
  else if (x->tag == Prims_Cons)
  {
    Prims_list__Parsers_SignatureScheme_signatureScheme *x_tl = x->tl;
    Parsers_SignatureScheme_signatureScheme x_hd = x->hd;
    if (y->tag == Prims_Cons)
    {
      Prims_list__Parsers_SignatureScheme_signatureScheme *y_tl = y->tl;
      Parsers_SignatureScheme_signatureScheme y_hd = y->hd;
      return
        true
        && __eq__Parsers_SignatureScheme_signatureScheme(y_hd, x_hd)
        && __eq__Prims_list__Parsers_SignatureScheme_signatureScheme(y_tl, x_tl);
    }
    else
      return false;
  }
  else
    return false;
}

bool __eq__DHGroup_ffdhe(DHGroup_ffdhe y, DHGroup_ffdhe x)
{
  switch (x)
  {
    case DHGroup_FFDHE2048:
      {
        switch (y)
        {
          case DHGroup_FFDHE2048:
            {
              return true;
            }
          default:
            {
              return false;
            }
        }
        break;
      }
    case DHGroup_FFDHE3072:
      {
        switch (y)
        {
          case DHGroup_FFDHE3072:
            {
              return true;
            }
          default:
            {
              return false;
            }
        }
        break;
      }
    case DHGroup_FFDHE4096:
      {
        switch (y)
        {
          case DHGroup_FFDHE4096:
            {
              return true;
            }
          default:
            {
              return false;
            }
        }
        break;
      }
    case DHGroup_FFDHE6144:
      {
        switch (y)
        {
          case DHGroup_FFDHE6144:
            {
              return true;
            }
          default:
            {
              return false;
            }
        }
        break;
      }
    case DHGroup_FFDHE8192:
      {
        switch (y)
        {
          case DHGroup_FFDHE8192:
            {
              return true;
            }
          default:
            {
              return false;
            }
        }
        break;
      }
    default:
      {
        return false;
      }
  }
}

bool __eq__DHGroup_params(DHGroup_params y, DHGroup_params x)
{
  return
    true
    && __eq__FStar_Bytes_bytes(x.dh_p, y.dh_p)
    && __eq__FStar_Bytes_bytes(x.dh_g, y.dh_g)
    && __eq__FStar_Pervasives_Native_option__FStar_Bytes_bytes(x.dh_q, y.dh_q)
    && x.safe_prime == y.safe_prime;
}

bool __eq__DHGroup_group(DHGroup_group y, DHGroup_group x)
{
  if (x.tag == DHGroup_Named)
  {
    DHGroup_ffdhe x__0 = x.val.case_Named;
    if (y.tag == DHGroup_Named)
    {
      DHGroup_ffdhe y__0 = y.val.case_Named;
      return true && __eq__DHGroup_ffdhe(y__0, x__0);
    }
    else
      return false;
  }
  else if (x.tag == DHGroup_Explicit)
  {
    DHGroup_params x__0 = x.val.case_Explicit;
    if (y.tag == DHGroup_Explicit)
    {
      DHGroup_params y__0 = y.val.case_Explicit;
      return true && __eq__DHGroup_params(y__0, x__0);
    }
    else
      return false;
  }
  else
    return false;
}

bool __eq__EverCrypt_ec_curve(EverCrypt_ec_curve y, EverCrypt_ec_curve x)
{
  switch (x)
  {
    case EverCrypt_ECC_P256:
      {
        switch (y)
        {
          case EverCrypt_ECC_P256:
            {
              return true;
            }
          default:
            {
              return false;
            }
        }
        break;
      }
    case EverCrypt_ECC_P384:
      {
        switch (y)
        {
          case EverCrypt_ECC_P384:
            {
              return true;
            }
          default:
            {
              return false;
            }
        }
        break;
      }
    case EverCrypt_ECC_P521:
      {
        switch (y)
        {
          case EverCrypt_ECC_P521:
            {
              return true;
            }
          default:
            {
              return false;
            }
        }
        break;
      }
    case EverCrypt_ECC_X25519:
      {
        switch (y)
        {
          case EverCrypt_ECC_X25519:
            {
              return true;
            }
          default:
            {
              return false;
            }
        }
        break;
      }
    case EverCrypt_ECC_X448:
      {
        switch (y)
        {
          case EverCrypt_ECC_X448:
            {
              return true;
            }
          default:
            {
              return false;
            }
        }
        break;
      }
    default:
      {
        return false;
      }
  }
}

bool __eq__CommonDH_group_(CommonDH_group_ y, CommonDH_group_ x)
{
  if (x.tag == CommonDH_FFDH)
  {
    DHGroup_group x__0 = x.val.case_FFDH;
    if (y.tag == CommonDH_FFDH)
    {
      DHGroup_group y__0 = y.val.case_FFDH;
      return true && __eq__DHGroup_group(y__0, x__0);
    }
    else
      return false;
  }
  else if (x.tag == CommonDH_ECDH)
  {
    EverCrypt_ec_curve x__0 = x.val.case_ECDH;
    if (y.tag == CommonDH_ECDH)
    {
      EverCrypt_ec_curve y__0 = y.val.case_ECDH;
      return true && __eq__EverCrypt_ec_curve(y__0, x__0);
    }
    else
      return false;
  }
  else
    return false;
}

bool __eq__ECGroup_point(ECGroup_point y, ECGroup_point x)
{
  return true && __eq__FStar_Bytes_bytes(x.ecx, y.ecx) && __eq__FStar_Bytes_bytes(x.ecy, y.ecy);
}

bool __eq__ECGroup_pre_share(ECGroup_pre_share y, ECGroup_pre_share x)
{
  if (x.tag == ECGroup_S_CC)
  {
    ECGroup_point x__0 = x.val.case_S_CC;
    if (y.tag == ECGroup_S_CC)
    {
      ECGroup_point y__0 = y.val.case_S_CC;
      return true && __eq__ECGroup_point(y__0, x__0);
    }
    else
      return false;
  }
  else if (x.tag == ECGroup_S_X25519)
  {
    FStar_Bytes_bytes x__0 = x.val.case_S_X25519;
    if (y.tag == ECGroup_S_X25519)
    {
      FStar_Bytes_bytes y__0 = y.val.case_S_X25519;
      return true && __eq__FStar_Bytes_bytes(y__0, x__0);
    }
    else
      return false;
  }
  else if (x.tag == ECGroup_S_X448)
  {
    FStar_Bytes_bytes x__0 = x.val.case_S_X448;
    if (y.tag == ECGroup_S_X448)
    {
      FStar_Bytes_bytes y__0 = y.val.case_S_X448;
      return true && __eq__FStar_Bytes_bytes(y__0, x__0);
    }
    else
      return false;
  }
  else
    return false;
}

bool __eq__CommonDH_pre_share_(CommonDH_pre_share_ y, CommonDH_pre_share_ x)
{
  if (x.tag == CommonDH_S_FF)
  {
    FStar_Bytes_bytes x__1 = x.val.case_S_FF._1;
    DHGroup_group x_g = x.val.case_S_FF.g;
    if (y.tag == CommonDH_S_FF)
    {
      FStar_Bytes_bytes y__1 = y.val.case_S_FF._1;
      DHGroup_group y_g = y.val.case_S_FF.g;
      return true && __eq__DHGroup_group(y_g, x_g) && __eq__FStar_Bytes_bytes(y__1, x__1);
    }
    else
      return false;
  }
  else if (x.tag == CommonDH_S_EC)
  {
    ECGroup_pre_share x__1 = x.val.case_S_EC._1;
    EverCrypt_ec_curve x_g = x.val.case_S_EC.g;
    if (y.tag == CommonDH_S_EC)
    {
      ECGroup_pre_share y__1 = y.val.case_S_EC._1;
      EverCrypt_ec_curve y_g = y.val.case_S_EC.g;
      return true && __eq__EverCrypt_ec_curve(y_g, x_g) && __eq__ECGroup_pre_share(y__1, x__1);
    }
    else
      return false;
  }
  else
    return false;
}

bool __eq__CommonDH_keyShareEntry(CommonDH_keyShareEntry y, CommonDH_keyShareEntry x)
{
  if (x.tag == CommonDH_Share)
  {
    CommonDH_pre_share_ x__1 = x.val.case_Share._1;
    CommonDH_group_ x_g = x.val.case_Share.g;
    if (y.tag == CommonDH_Share)
    {
      CommonDH_pre_share_ y__1 = y.val.case_Share._1;
      CommonDH_group_ y_g = y.val.case_Share.g;
      return true && __eq__CommonDH_group_(y_g, x_g) && __eq__CommonDH_pre_share_(y__1, x__1);
    }
    else
      return false;
  }
  else if (x.tag == CommonDH_UnknownShare)
  {
    FStar_Bytes_bytes x_b = x.val.case_UnknownShare.b;
    Parsers_NamedGroup_namedGroup x_ng = x.val.case_UnknownShare.ng;
    if (y.tag == CommonDH_UnknownShare)
    {
      FStar_Bytes_bytes y_b = y.val.case_UnknownShare.b;
      Parsers_NamedGroup_namedGroup y_ng = y.val.case_UnknownShare.ng;
      return
        true
        && __eq__Parsers_NamedGroup_namedGroup(y_ng, x_ng)
        && __eq__FStar_Bytes_bytes(y_b, x_b);
    }
    else
      return false;
  }
  else
    return false;
}

bool
__eq__Prims_list__CommonDH_keyShareEntry(
  Prims_list__CommonDH_keyShareEntry *y,
  Prims_list__CommonDH_keyShareEntry *x
)
{
  if (x->tag == Prims_Nil)
    if (y->tag == Prims_Nil)
      return true;
    else
      return false;
  else if (x->tag == Prims_Cons)
  {
    Prims_list__CommonDH_keyShareEntry *x_tl = x->tl;
    CommonDH_keyShareEntry x_hd = x->hd;
    if (y->tag == Prims_Cons)
    {
      Prims_list__CommonDH_keyShareEntry *y_tl = y->tl;
      CommonDH_keyShareEntry y_hd = y->hd;
      return
        true
        && __eq__CommonDH_keyShareEntry(y_hd, x_hd)
        && __eq__Prims_list__CommonDH_keyShareEntry(y_tl, x_tl);
    }
    else
      return false;
  }
  else
    return false;
}

bool __eq__CommonDH_keyShare(CommonDH_keyShare y, CommonDH_keyShare x)
{
  if (x.tag == CommonDH_ClientKeyShare)
  {
    Prims_list__CommonDH_keyShareEntry *x__0 = x.val.case_ClientKeyShare;
    if (y.tag == CommonDH_ClientKeyShare)
    {
      Prims_list__CommonDH_keyShareEntry *y__0 = y.val.case_ClientKeyShare;
      return true && __eq__Prims_list__CommonDH_keyShareEntry(y__0, x__0);
    }
    else
      return false;
  }
  else if (x.tag == CommonDH_ServerKeyShare)
  {
    CommonDH_keyShareEntry x__0 = x.val.case_ServerKeyShare;
    if (y.tag == CommonDH_ServerKeyShare)
    {
      CommonDH_keyShareEntry y__0 = y.val.case_ServerKeyShare;
      return true && __eq__CommonDH_keyShareEntry(y__0, x__0);
    }
    else
      return false;
  }
  else if (x.tag == CommonDH_HRRKeyShare)
  {
    Parsers_NamedGroup_namedGroup x__0 = x.val.case_HRRKeyShare;
    if (y.tag == CommonDH_HRRKeyShare)
    {
      Parsers_NamedGroup_namedGroup y__0 = y.val.case_HRRKeyShare;
      return true && __eq__Parsers_NamedGroup_namedGroup(y__0, x__0);
    }
    else
      return false;
  }
  else
    return false;
}

bool
__eq__K___FStar_Bytes_bytes_uint32_t(
  K___FStar_Bytes_bytes_uint32_t y,
  K___FStar_Bytes_bytes_uint32_t x
)
{
  return true && __eq__FStar_Bytes_bytes(x.fst, y.fst) && x.snd == y.snd;
}

bool
__eq__Prims_list__K___FStar_Bytes_bytes_uint32_t(
  Prims_list__K___FStar_Bytes_bytes_uint32_t *y,
  Prims_list__K___FStar_Bytes_bytes_uint32_t *x
)
{
  if (x->tag == Prims_Nil)
    if (y->tag == Prims_Nil)
      return true;
    else
      return false;
  else if (x->tag == Prims_Cons)
  {
    Prims_list__K___FStar_Bytes_bytes_uint32_t *x_tl = x->tl;
    K___FStar_Bytes_bytes_uint32_t x_hd = x->hd;
    if (y->tag == Prims_Cons)
    {
      Prims_list__K___FStar_Bytes_bytes_uint32_t *y_tl = y->tl;
      K___FStar_Bytes_bytes_uint32_t y_hd = y->hd;
      return
        true
        && __eq__K___FStar_Bytes_bytes_uint32_t(y_hd, x_hd)
        && __eq__Prims_list__K___FStar_Bytes_bytes_uint32_t(y_tl, x_tl);
    }
    else
      return false;
  }
  else
    return false;
}

bool __eq__Extensions_psk(Extensions_psk y, Extensions_psk x)
{
  if (x.tag == Extensions_ClientPSK)
  {
    Prims_int x_binders_len = x.val.case_ClientPSK.binders_len;
    Prims_list__K___FStar_Bytes_bytes_uint32_t *x_identities = x.val.case_ClientPSK.identities;
    if (y.tag == Extensions_ClientPSK)
    {
      Prims_int y_binders_len = y.val.case_ClientPSK.binders_len;
      Prims_list__K___FStar_Bytes_bytes_uint32_t *y_identities = y.val.case_ClientPSK.identities;
      return
        true
        && __eq__Prims_list__K___FStar_Bytes_bytes_uint32_t(y_identities, x_identities)
        && y_binders_len == x_binders_len;
    }
    else
      return false;
  }
  else if (x.tag == Extensions_ServerPSK)
  {
    uint16_t x__0 = x.val.case_ServerPSK;
    if (y.tag == Extensions_ServerPSK)
    {
      uint16_t y__0 = y.val.case_ServerPSK;
      return true && y__0 == x__0;
    }
    else
      return false;
  }
  else
    return false;
}

bool
__eq__FStar_Pervasives_Native_option__uint32_t(
  FStar_Pervasives_Native_option__uint32_t y,
  FStar_Pervasives_Native_option__uint32_t x
)
{
  if (x.tag == FStar_Pervasives_Native_None)
    if (y.tag == FStar_Pervasives_Native_None)
      return true;
    else
      return false;
  else if (x.tag == FStar_Pervasives_Native_Some)
  {
    uint32_t x_v = x.v;
    if (y.tag == FStar_Pervasives_Native_Some)
    {
      uint32_t y_v = y.v;
      return true && y_v == x_v;
    }
    else
      return false;
  }
  else
    return false;
}

bool
__eq__Prims_list__Parsers_ProtocolVersion_protocolVersion(
  Prims_list__Parsers_ProtocolVersion_protocolVersion *y,
  Prims_list__Parsers_ProtocolVersion_protocolVersion *x
)
{
  if (x->tag == Prims_Nil)
    if (y->tag == Prims_Nil)
      return true;
    else
      return false;
  else if (x->tag == Prims_Cons)
  {
    Prims_list__Parsers_ProtocolVersion_protocolVersion *x_tl = x->tl;
    Parsers_ProtocolVersion_protocolVersion x_hd = x->hd;
    if (y->tag == Prims_Cons)
    {
      Prims_list__Parsers_ProtocolVersion_protocolVersion *y_tl = y->tl;
      Parsers_ProtocolVersion_protocolVersion y_hd = y->hd;
      return
        true
        && __eq__Parsers_ProtocolVersion_protocolVersion(y_hd, x_hd)
        && __eq__Prims_list__Parsers_ProtocolVersion_protocolVersion(y_tl, x_tl);
    }
    else
      return false;
  }
  else
    return false;
}

bool
__eq__Extensions_protocol_versions(
  Extensions_protocol_versions y,
  Extensions_protocol_versions x
)
{
  if (x.tag == Extensions_ServerPV)
  {
    Parsers_ProtocolVersion_protocolVersion x__0 = x.val.case_ServerPV;
    if (y.tag == Extensions_ServerPV)
    {
      Parsers_ProtocolVersion_protocolVersion y__0 = y.val.case_ServerPV;
      return true && __eq__Parsers_ProtocolVersion_protocolVersion(y__0, x__0);
    }
    else
      return false;
  }
  else if (x.tag == Extensions_ClientPV)
  {
    Prims_list__Parsers_ProtocolVersion_protocolVersion *x__0 = x.val.case_ClientPV;
    if (y.tag == Extensions_ClientPV)
    {
      Prims_list__Parsers_ProtocolVersion_protocolVersion *y__0 = y.val.case_ClientPV;
      return true && __eq__Prims_list__Parsers_ProtocolVersion_protocolVersion(y__0, x__0);
    }
    else
      return false;
  }
  else
    return false;
}

bool __eq__Extensions_psk_kex(Extensions_psk_kex y, Extensions_psk_kex x)
{
  switch (x)
  {
    case Extensions_PSK_KE:
      {
        switch (y)
        {
          case Extensions_PSK_KE:
            {
              return true;
            }
          default:
            {
              return false;
            }
        }
        break;
      }
    case Extensions_PSK_DHE_KE:
      {
        switch (y)
        {
          case Extensions_PSK_DHE_KE:
            {
              return true;
            }
          default:
            {
              return false;
            }
        }
        break;
      }
    default:
      {
        return false;
      }
  }
}

bool
__eq__Prims_list__Extensions_psk_kex(
  Prims_list__Extensions_psk_kex *y,
  Prims_list__Extensions_psk_kex *x
)
{
  if (x->tag == Prims_Nil)
    if (y->tag == Prims_Nil)
      return true;
    else
      return false;
  else if (x->tag == Prims_Cons)
  {
    Prims_list__Extensions_psk_kex *x_tl = x->tl;
    Extensions_psk_kex x_hd = x->hd;
    if (y->tag == Prims_Cons)
    {
      Prims_list__Extensions_psk_kex *y_tl = y->tl;
      Extensions_psk_kex y_hd = y->hd;
      return
        true
        && __eq__Extensions_psk_kex(y_hd, x_hd)
        && __eq__Prims_list__Extensions_psk_kex(y_tl, x_tl);
    }
    else
      return false;
  }
  else
    return false;
}

bool
__eq__Prims_list__Extensions_point_format(
  Prims_list__Extensions_point_format *y,
  Prims_list__Extensions_point_format *x
)
{
  if (x->tag == Prims_Nil)
    if (y->tag == Prims_Nil)
      return true;
    else
      return false;
  else if (x->tag == Prims_Cons)
  {
    Prims_list__Extensions_point_format *x_tl = x->tl;
    Extensions_point_format x_hd = x->hd;
    if (y->tag == Prims_Cons)
    {
      Prims_list__Extensions_point_format *y_tl = y->tl;
      Extensions_point_format y_hd = y->hd;
      return
        true
        && __eq__Extensions_point_format(y_hd, x_hd)
        && __eq__Prims_list__Extensions_point_format(y_tl, x_tl);
    }
    else
      return false;
  }
  else
    return false;
}

bool __eq__Extensions_extension_(Extensions_extension_ y, Extensions_extension_ x)
{
  if (x.tag == Extensions_E_server_name)
  {
    Prims_list__TLSConstants_serverName *x__0 = x.val.case_E_server_name;
    if (y.tag == Extensions_E_server_name)
    {
      Prims_list__TLSConstants_serverName *y__0 = y.val.case_E_server_name;
      return true && __eq__Prims_list__TLSConstants_serverName(y__0, x__0);
    }
    else
      return false;
  }
  else if (x.tag == Extensions_E_supported_groups)
  {
    Prims_list__Parsers_NamedGroup_namedGroup *x__0 = x.val.case_E_supported_groups;
    if (y.tag == Extensions_E_supported_groups)
    {
      Prims_list__Parsers_NamedGroup_namedGroup *y__0 = y.val.case_E_supported_groups;
      return true && __eq__Prims_list__Parsers_NamedGroup_namedGroup(y__0, x__0);
    }
    else
      return false;
  }
  else if (x.tag == Extensions_E_signature_algorithms)
  {
    Prims_list__Parsers_SignatureScheme_signatureScheme *x__0 = x.val.case_E_signature_algorithms;
    if (y.tag == Extensions_E_signature_algorithms)
    {
      Prims_list__Parsers_SignatureScheme_signatureScheme *y__0 = y.val.case_E_signature_algorithms;
      return true && __eq__Prims_list__Parsers_SignatureScheme_signatureScheme(y__0, x__0);
    }
    else
      return false;
  }
  else if (x.tag == Extensions_E_signature_algorithms_cert)
  {
    Prims_list__Parsers_SignatureScheme_signatureScheme
    *x__0 = x.val.case_E_signature_algorithms_cert;
    if (y.tag == Extensions_E_signature_algorithms_cert)
    {
      Prims_list__Parsers_SignatureScheme_signatureScheme
      *y__0 = y.val.case_E_signature_algorithms_cert;
      return true && __eq__Prims_list__Parsers_SignatureScheme_signatureScheme(y__0, x__0);
    }
    else
      return false;
  }
  else if (x.tag == Extensions_E_key_share)
  {
    CommonDH_keyShare x__0 = x.val.case_E_key_share;
    if (y.tag == Extensions_E_key_share)
    {
      CommonDH_keyShare y__0 = y.val.case_E_key_share;
      return true && __eq__CommonDH_keyShare(y__0, x__0);
    }
    else
      return false;
  }
  else if (x.tag == Extensions_E_pre_shared_key)
  {
    Extensions_psk x__0 = x.val.case_E_pre_shared_key;
    if (y.tag == Extensions_E_pre_shared_key)
    {
      Extensions_psk y__0 = y.val.case_E_pre_shared_key;
      return true && __eq__Extensions_psk(y__0, x__0);
    }
    else
      return false;
  }
  else if (x.tag == Extensions_E_session_ticket)
  {
    FStar_Bytes_bytes x__0 = x.val.case_E_session_ticket;
    if (y.tag == Extensions_E_session_ticket)
    {
      FStar_Bytes_bytes y__0 = y.val.case_E_session_ticket;
      return true && __eq__FStar_Bytes_bytes(y__0, x__0);
    }
    else
      return false;
  }
  else if (x.tag == Extensions_E_early_data)
  {
    FStar_Pervasives_Native_option__uint32_t x__0 = x.val.case_E_early_data;
    if (y.tag == Extensions_E_early_data)
    {
      FStar_Pervasives_Native_option__uint32_t y__0 = y.val.case_E_early_data;
      return true && __eq__FStar_Pervasives_Native_option__uint32_t(y__0, x__0);
    }
    else
      return false;
  }
  else if (x.tag == Extensions_E_supported_versions)
  {
    Extensions_protocol_versions x__0 = x.val.case_E_supported_versions;
    if (y.tag == Extensions_E_supported_versions)
    {
      Extensions_protocol_versions y__0 = y.val.case_E_supported_versions;
      return true && __eq__Extensions_protocol_versions(y__0, x__0);
    }
    else
      return false;
  }
  else if (x.tag == Extensions_E_cookie)
  {
    FStar_Bytes_bytes x__0 = x.val.case_E_cookie;
    if (y.tag == Extensions_E_cookie)
    {
      FStar_Bytes_bytes y__0 = y.val.case_E_cookie;
      return true && __eq__FStar_Bytes_bytes(y__0, x__0);
    }
    else
      return false;
  }
  else if (x.tag == Extensions_E_psk_key_exchange_modes)
  {
    Prims_list__Extensions_psk_kex *x__0 = x.val.case_E_psk_key_exchange_modes;
    if (y.tag == Extensions_E_psk_key_exchange_modes)
    {
      Prims_list__Extensions_psk_kex *y__0 = y.val.case_E_psk_key_exchange_modes;
      return true && __eq__Prims_list__Extensions_psk_kex(y__0, x__0);
    }
    else
      return false;
  }
  else if (x.tag == Extensions_E_extended_ms)
    if (y.tag == Extensions_E_extended_ms)
      return true;
    else
      return false;
  else if (x.tag == Extensions_E_ec_point_format)
  {
    Prims_list__Extensions_point_format *x__0 = x.val.case_E_ec_point_format;
    if (y.tag == Extensions_E_ec_point_format)
    {
      Prims_list__Extensions_point_format *y__0 = y.val.case_E_ec_point_format;
      return true && __eq__Prims_list__Extensions_point_format(y__0, x__0);
    }
    else
      return false;
  }
  else if (x.tag == Extensions_E_alpn)
  {
    Prims_list__FStar_Bytes_bytes *x__0 = x.val.case_E_alpn;
    if (y.tag == Extensions_E_alpn)
    {
      Prims_list__FStar_Bytes_bytes *y__0 = y.val.case_E_alpn;
      return true && __eq__Prims_list__FStar_Bytes_bytes(y__0, x__0);
    }
    else
      return false;
  }
  else if (x.tag == Extensions_E_unknown_extension)
  {
    FStar_Bytes_bytes x__1 = x.val.case_E_unknown_extension._1;
    FStar_Bytes_bytes x_x = x.val.case_E_unknown_extension.x;
    if (y.tag == Extensions_E_unknown_extension)
    {
      FStar_Bytes_bytes y__1 = y.val.case_E_unknown_extension._1;
      FStar_Bytes_bytes y_x = y.val.case_E_unknown_extension.x;
      return true && __eq__FStar_Bytes_bytes(y_x, x_x) && __eq__FStar_Bytes_bytes(y__1, x__1);
    }
    else
      return false;
  }
  else
    return false;
}

static bool
FStar_List_Tot_Base_mem__Extensions_extension_(
  Extensions_extension_ x,
  Prims_list__Extensions_extension_ *uu___7_953
)
{
  if (uu___7_953->tag == Prims_Nil)
    return false;
  else if (uu___7_953->tag == Prims_Cons)
  {
    Prims_list__Extensions_extension_ *tl1 = uu___7_953->tl;
    Extensions_extension_ hd1 = uu___7_953->hd;
    if (__eq__Extensions_extension_(hd1, x))
      return true;
    else
      return FStar_List_Tot_Base_mem__Extensions_extension_(x, tl1);
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

bool Negotiation_emsFlag(Negotiation_mode mode)
{
  if (TLSConstants_is_pv_13(mode.n_protocol_version))
    return true;
  else if (mode.n_offer.ch_extensions.tag == FStar_Pervasives_Native_None)
    return false;
  else if (mode.n_offer.ch_extensions.tag == FStar_Pervasives_Native_Some)
  {
    Prims_list__Extensions_extension_ *cexts = mode.n_offer.ch_extensions.v;
    if
    (
      FStar_List_Tot_Base_mem__Extensions_extension_((
          (Extensions_extension_){ .tag = Extensions_E_extended_ms }
        ),
        cexts)
    )
      if (mode.n_server_extensions.tag == FStar_Pervasives_Native_None)
        return true;
      else if (mode.n_server_extensions.tag == FStar_Pervasives_Native_Some)
      {
        Prims_list__Extensions_extension_ *sexts = mode.n_server_extensions.v;
        return
          FStar_List_Tot_Base_mem__Extensions_extension_((
              (Extensions_extension_){ .tag = Extensions_E_extended_ms }
            ),
            sexts);
      }
      else
      {
        KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
          __FILE__,
          __LINE__,
          "unreachable (pattern matches are exhaustive in F*)");
        KRML_HOST_EXIT(255U);
      }
    else
      return false;
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

FStar_Pervasives_Native_option__CommonDH_group_ Negotiation_chosenGroup(Negotiation_mode mode)
{
  switch (Negotiation_kexAlg(mode))
  {
    case CipherSuite_Kex_PSK_DHE:
      {
        return
          CommonDH_group_of_namedGroup((
              (Parsers_NamedGroup_namedGroup){ .tag = Parsers_NamedGroup_Ffdhe2048 }
            ));
      }
    case CipherSuite_Kex_DHE:
      {
        return
          CommonDH_group_of_namedGroup((
              (Parsers_NamedGroup_namedGroup){ .tag = Parsers_NamedGroup_Ffdhe2048 }
            ));
      }
    case CipherSuite_Kex_PSK_ECDHE:
      {
        return
          CommonDH_group_of_namedGroup((
              (Parsers_NamedGroup_namedGroup){ .tag = Parsers_NamedGroup_Secp256r1 }
            ));
      }
    case CipherSuite_Kex_ECDHE:
      {
        return
          CommonDH_group_of_namedGroup((
              (Parsers_NamedGroup_namedGroup){ .tag = Parsers_NamedGroup_Secp256r1 }
            ));
      }
    default:
      {
        KRML_HOST_EPRINTF("KreMLin incomplete match at %s:%d\n", __FILE__, __LINE__);
        KRML_HOST_EXIT(253U);
      }
  }
}

bool
FStar_Pervasives_Native_uu___is_Some__FStar_Pervasives_Native_option_uint32_t(
  FStar_Pervasives_Native_option__FStar_Pervasives_Native_option__uint32_t projectee
)
{
  if (projectee.tag == FStar_Pervasives_Native_Some)
    return true;
  else
    return false;
}

bool Negotiation_zeroRTToffer(HandshakeMessages_ch o)
{
  return
    FStar_Pervasives_Native_uu___is_Some__FStar_Pervasives_Native_option_uint32_t(Negotiation_find_early_data(o));
}

static bool
FStar_Pervasives_Native_uu___is_Some__Prims_int(
  FStar_Pervasives_Native_option__Prims_int projectee
)
{
  if (projectee.tag == FStar_Pervasives_Native_Some)
    return true;
  else
    return false;
}

static bool
FStar_Pervasives_Native_uu___is_Some__Prims_list_Extensions_extension_(
  FStar_Pervasives_Native_option__Prims_list__Extensions_extension_ projectee
)
{
  if (projectee.tag == FStar_Pervasives_Native_Some)
    return true;
  else
    return false;
}

static bool
FStar_List_Tot_Base_existsb__Extensions_extension_(
  bool (*f)(Extensions_extension_ x0),
  Prims_list__Extensions_extension_ *l
)
{
  if (l->tag == Prims_Nil)
    return false;
  else if (l->tag == Prims_Cons)
  {
    Prims_list__Extensions_extension_ *tl1 = l->tl;
    Extensions_extension_ hd1 = l->hd;
    if (f(hd1))
      return true;
    else
      return FStar_List_Tot_Base_existsb__Extensions_extension_(f, tl1);
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

bool Negotiation_zeroRTT(Negotiation_mode mode)
{
  if
  (
    Negotiation_zeroRTToffer(mode.n_offer)
    && FStar_Pervasives_Native_uu___is_Some__Prims_int(mode.n_pski)
    &&
      FStar_Pervasives_Native_uu___is_Some__Prims_list_Extensions_extension_(mode.n_server_extensions)
  )
  {
    FStar_Pervasives_Native_option__Prims_list__Extensions_extension_
    x0 = mode.n_server_extensions;
    Prims_list__Extensions_extension_ *ite;
    if (x0.tag == FStar_Pervasives_Native_Some)
      ite = x0.v;
    else
      ite =
        KRML_EABORT(Prims_list__Extensions_extension_ *,
          "unreachable (pattern matches are exhaustive in F*)");
    return
      FStar_List_Tot_Base_existsb__Extensions_extension_(Extensions_uu___is_E_early_data____,
        ite);
  }
  else
    return false;
}

bool Negotiation_sendticket_12(Negotiation_mode mode)
{
  if
  (
    FStar_Pervasives_Native_uu___is_Some__Prims_list_Extensions_extension_(mode.n_server_extensions)
  )
  {
    FStar_Pervasives_Native_option__Prims_list__Extensions_extension_
    x0 = mode.n_server_extensions;
    Prims_list__Extensions_extension_ *ite;
    if (x0.tag == FStar_Pervasives_Native_Some)
      ite = x0.v;
    else
      ite =
        KRML_EABORT(Prims_list__Extensions_extension_ *,
          "unreachable (pattern matches are exhaustive in F*)");
    return
      FStar_List_Tot_Base_existsb__Extensions_extension_(Extensions_uu___is_E_session_ticket____,
        ite);
  }
  else
    return false;
}

bool
FStar_Pervasives_Native_uu___is_Some__FStar_Bytes_bytes(
  FStar_Pervasives_Native_option__FStar_Bytes_bytes projectee
)
{
  if (projectee.tag == FStar_Pervasives_Native_Some)
    return true;
  else
    return false;
}

bool Negotiation_resume_12(Negotiation_mode mode)
{
  return
    !TLSConstants_is_pv_13(mode.n_protocol_version)
    &&
      FStar_Pervasives_Native_uu___is_Some__FStar_Bytes_bytes(Negotiation_find_sessionTicket(mode.n_offer))
    &&
      Prims_op_GreaterThan(FStar_UInt32_v(FStar_Bytes_len(mode.n_offer.ch_sessionID)),
        (krml_checked_int_t)0)
    && __eq__FStar_Bytes_bytes(mode.n_sessionID, mode.n_offer.ch_sessionID);
}

TLSConstants_config Negotiation_local_config(TLSConstants_role role, Negotiation_t ns)
{
  return ns.cfg;
}

FStar_Bytes_bytes Negotiation_nonce(TLSConstants_role role, Negotiation_t ns)
{
  return ns.nonce;
}

K___FStar_Pervasives_Native_option__K___FStar_Bytes_bytes_Ticket_ticket_Prims_list__K___FStar_Bytes_bytes_Ticket_ticket
Negotiation_resume(TLSConstants_role role, Negotiation_t ns)
{
  return ns.resume;
}

Negotiation_mode Negotiation_getMode(TLSConstants_role role, Negotiation_t ns)
{
  Negotiation_negotiationState scrut = ns.state[0U];
  if (scrut.tag == Negotiation_C_Mode)
    return scrut.val.case_C_Mode;
  else if (scrut.tag == Negotiation_C_WaitFinished2)
    return scrut.val.case_C_WaitFinished2.n_mode;
  else if (scrut.tag == Negotiation_C_Complete)
    return scrut.val.case_C_Complete.n_mode;
  else if (scrut.tag == Negotiation_S_ClientHello)
    return scrut.val.case_S_ClientHello.n_mode;
  else if (scrut.tag == Negotiation_S_Mode)
    return scrut.val.case_S_Mode.n_mode;
  else if (scrut.tag == Negotiation_S_Complete)
    return scrut.val.case_S_Complete.n_mode;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

Parsers_ProtocolVersion_protocolVersion
Negotiation_version(TLSConstants_role role, Negotiation_t ns)
{
  Negotiation_negotiationState scrut = ns.state[0U];
  if (scrut.tag == Negotiation_C_Init)
    return ns.cfg.max_version;
  else if (scrut.tag == Negotiation_C_Offer)
    return ns.cfg.max_version;
  else if (scrut.tag == Negotiation_C_HRR)
    return ns.cfg.max_version;
  else if (scrut.tag == Negotiation_C_WaitFinished1)
    return ns.cfg.max_version;
  else if (scrut.tag == Negotiation_C_Mode)
  {
    Negotiation_mode mode = scrut.val.case_C_Mode;
    return mode.n_protocol_version;
  }
  else if (scrut.tag == Negotiation_C_WaitFinished2)
  {
    Negotiation_mode mode = scrut.val.case_C_WaitFinished2.n_mode;
    return mode.n_protocol_version;
  }
  else if (scrut.tag == Negotiation_C_Complete)
  {
    Negotiation_mode mode = scrut.val.case_C_Complete.n_mode;
    return mode.n_protocol_version;
  }
  else if (scrut.tag == Negotiation_S_Init)
    return ns.cfg.max_version;
  else if (scrut.tag == Negotiation_S_HRR)
    return ns.cfg.max_version;
  else if (scrut.tag == Negotiation_S_ClientHello)
  {
    Negotiation_mode mode = scrut.val.case_S_ClientHello.n_mode;
    return mode.n_protocol_version;
  }
  else if (scrut.tag == Negotiation_S_Mode)
  {
    Negotiation_mode mode = scrut.val.case_S_Mode.n_mode;
    return mode.n_protocol_version;
  }
  else if (scrut.tag == Negotiation_S_Complete)
  {
    Negotiation_mode mode = scrut.val.case_S_Complete.n_mode;
    return mode.n_protocol_version;
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

bool Negotiation_is_hrr(TLSConstants_role role, Negotiation_t ns)
{
  Negotiation_negotiationState uu____0 = ns.state[0U];
  return Negotiation_uu___is_C_HRR(role, ns.cfg, uu____0);
}

FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_HandshakeMessages_signature
Negotiation_sign(TLSConstants_role role, Negotiation_t ns, FStar_Bytes_bytes tbs)
{
  Negotiation_negotiationState scrut0 = ns.state[0U];
  if
  (
    scrut0.tag
    == Negotiation_S_Mode
    && scrut0.val.case_S_Mode.n_selected_cert.tag == FStar_Pervasives_Native_Some
  )
  {
    Parsers_SignatureScheme_signatureScheme sa = scrut0.val.case_S_Mode.n_selected_cert.v.snd;
    uint64_t cert = scrut0.val.case_S_Mode.n_selected_cert.v.fst;
    Negotiation_mode mode = scrut0.val.case_S_Mode.n_mode;
    FStar_Pervasives_Native_option__FStar_Bytes_bytes
    scrut = TLSConstants_cert_sign_cb(ns.cfg, cert, sa, tbs);
    if (scrut.tag == FStar_Pervasives_Native_None)
      return
        TLSError_fatal__HandshakeMessages_signature(Parsers_AlertDescription_Bad_certificate,
          FStar_Error_perror("Negotiation.fst",
            (krml_checked_int_t)589,
            "Failed to sign with selected certificate."));
    else if (scrut.tag == FStar_Pervasives_Native_Some)
    {
      FStar_Bytes_bytes sigv = scrut.v;
      FStar_Pervasives_Native_option__Parsers_SignatureScheme_signatureScheme alg1;
      if
      (
        TLSConstants_geqPV(mode.n_protocol_version,
          ((Parsers_ProtocolVersion_protocolVersion){ .tag = Parsers_ProtocolVersion_TLS_1p2 }))
      )
        alg1 =
          (
            (FStar_Pervasives_Native_option__Parsers_SignatureScheme_signatureScheme){
              .tag = FStar_Pervasives_Native_Some,
              .v = sa
            }
          );
      else
        alg1 =
          (
            (FStar_Pervasives_Native_option__Parsers_SignatureScheme_signatureScheme){
              .tag = FStar_Pervasives_Native_None
            }
          );
      return
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_HandshakeMessages_signature){
            .tag = FStar_Error_Correct,
            .val = { .case_Correct = { .sig_algorithm = alg1, .sig_signature = sigv } }
          }
        );
    }
    else
    {
      KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
        __FILE__,
        __LINE__,
        "unreachable (pattern matches are exhaustive in F*)");
      KRML_HOST_EXIT(255U);
    }
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

K___FStar_Bytes_bytes_TLSConstants_pskInfo Negotiation_i_psk_info(FStar_Bytes_bytes i1)
{
  return ((K___FStar_Bytes_bytes_TLSConstants_pskInfo){ .fst = i1, .snd = PSK_psk_info(i1) });
}

HandshakeMessages_ch
Negotiation_client_ClientHello(
  Negotiation_t ns,
  FStar_Pervasives_Native_option__Prims_list__CommonDH_keyShareEntry oks
)
{
  FStar_Pervasives_Native_option__CommonDH_keyShare oks_;
  if (oks.tag == FStar_Pervasives_Native_Some)
  {
    Prims_list__CommonDH_keyShareEntry *ks = oks.v;
    oks_ =
      (
        (FStar_Pervasives_Native_option__CommonDH_keyShare){
          .tag = FStar_Pervasives_Native_Some,
          .v = { .tag = CommonDH_ClientKeyShare, .val = { .case_ClientKeyShare = ks } }
        }
      );
  }
  else if (oks.tag == FStar_Pervasives_Native_None)
    oks_ =
      ((FStar_Pervasives_Native_option__CommonDH_keyShare){ .tag = FStar_Pervasives_Native_None });
  else
    oks_ =
      KRML_EABORT(FStar_Pervasives_Native_option__CommonDH_keyShare,
        "unreachable (pattern matches are exhaustive in F*)");
  Negotiation_negotiationState scrut = ns.state[0U];
  if (scrut.tag == Negotiation_C_Init)
  {
    KRML_CHECK_SIZE(sizeof (Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo), (uint32_t)1U);
    Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo
    *buf = KRML_HOST_MALLOC(sizeof (Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo));
    buf[0U] = ((Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo){ .tag = Prims_Nil });
    Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo
    *scrut =
      Negotiation_ticket13_pskinfo__FStar_Bytes_bytes(buf,
        FStar_Pervasives_Native_snd__FStar_Pervasives_Native_option_FStar_Bytes_bytes___Ticket_ticket_Prims_list_FStar_Bytes_bytes___Ticket_ticket(ns.resume));
    bool ite0;
    if (scrut->tag == Prims_Cons)
    {
      TLSConstants_pskInfo i1 = scrut->hd.snd;
      ite0 =
        i1.allow_early_data
        && FStar_Pervasives_Native_uu___is_Some__uint32_t(ns.cfg.max_early_data);
    }
    else
      ite0 = false;
    Prims_string ite;
    if (ite0)
      ite = "Offering a PSK compatible with 0-RTT";
    else
      ite = "No PSK or 0-RTT disabled";
    Negotiation_print(ite);
    uint32_t now1 = FStar_UInt32_uint_to_t(FStar_Date_secondsFromDawn());
    HandshakeMessages_ch
    offer = Negotiation_computeOffer(TLSConstants_Client, ns.cfg, ns.nonce, oks_, ns.resume, now1);
    Negotiation_print(Prims_strcat("offering client extensions ",
        Negotiation_string_of_option_extensions(offer.ch_extensions)));
    Negotiation_print(Prims_strcat("offering cipher suites ",
        Negotiation_string_of_ciphersuitenames(offer.ch_cipher_suites)));
    ns.state[0U] =
      (
        (Negotiation_negotiationState){
          .tag = Negotiation_C_Offer,
          .val = { .case_C_Offer = offer }
        }
      );
    return offer;
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

FStar_Pervasives_Native_option__CommonDH_group_
Negotiation_group_of_hrr(HandshakeMessages_hrr hrr)
{
  FStar_Pervasives_Native_option__Extensions_extension_
  scrut =
    FStar_List_Tot_Base_find__Extensions_extension_(Extensions_uu___is_E_key_share____,
      hrr.hrr_extensions);
  if
  (
    scrut.tag
    == FStar_Pervasives_Native_Some
    &&
      scrut.v.tag
      == Extensions_E_key_share
      && scrut.v.val.case_E_key_share.tag == CommonDH_HRRKeyShare
  )
  {
    Parsers_NamedGroup_namedGroup ng = scrut.v.val.case_E_key_share.val.case_HRRKeyShare;
    return CommonDH_group_of_namedGroup(ng);
  }
  else
    return
      ((FStar_Pervasives_Native_option__CommonDH_group_){ .tag = FStar_Pervasives_Native_None });
}

static FStar_Pervasives_Native_option__Extensions_extension_
Negotiation_choose_extension(
  FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_ s,
  Extensions_extension_ e
)
{
  if (e.tag == Extensions_E_key_share && e.val.case_E_key_share.tag == CommonDH_ClientKeyShare)
    if (s.tag == FStar_Pervasives_Native_Some)
    {
      CommonDH_pre_share_ gx = s.v.snd;
      CommonDH_group_ g1 = s.v.fst;
      KRML_CHECK_SIZE(sizeof (Prims_list__CommonDH_keyShareEntry), (uint32_t)1U);
      Prims_list__CommonDH_keyShareEntry
      *buf = KRML_HOST_MALLOC(sizeof (Prims_list__CommonDH_keyShareEntry));
      buf[0U] = ((Prims_list__CommonDH_keyShareEntry){ .tag = Prims_Nil });
      KRML_CHECK_SIZE(sizeof (Prims_list__CommonDH_keyShareEntry), (uint32_t)1U);
      Prims_list__CommonDH_keyShareEntry
      *buf0 = KRML_HOST_MALLOC(sizeof (Prims_list__CommonDH_keyShareEntry));
      buf0[0U]
      =
        (
          (Prims_list__CommonDH_keyShareEntry){
            .tag = Prims_Cons,
            .hd = { .tag = CommonDH_Share, .val = { .case_Share = { .g = g1, ._1 = gx } } },
            .tl = buf
          }
        );
      return
        (
          (FStar_Pervasives_Native_option__Extensions_extension_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = Extensions_E_key_share,
              .val = {
                .case_E_key_share = {
                  .tag = CommonDH_ClientKeyShare,
                  .val = { .case_ClientKeyShare = buf0 }
                }
              }
            }
          }
        );
    }
    else
      return
        (
          (FStar_Pervasives_Native_option__Extensions_extension_){
            .tag = FStar_Pervasives_Native_Some,
            .v = e
          }
        );
  else if (e.tag == Extensions_E_early_data)
    return
      (
        (FStar_Pervasives_Native_option__Extensions_extension_){
          .tag = FStar_Pervasives_Native_None
        }
      );
  else
  {
    Extensions_extension_ e1 = e;
    return
      (
        (FStar_Pervasives_Native_option__Extensions_extension_){
          .tag = FStar_Pervasives_Native_Some,
          .v = e1
        }
      );
  }
}

static Prims_list__Extensions_extension_
*List_Helpers_choose_aux__Extensions_extension__Extensions_extension__FStar_Pervasives_Native_option_Prims_dtuple2_CommonDH_group__CommonDH_pre_share_(
  FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_ env,
  FStar_Pervasives_Native_option__Extensions_extension_
  (*f)(
    FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_ x0,
    Extensions_extension_ x1
  ),
  Prims_list__Extensions_extension_ *l
)
{
  if (l->tag == Prims_Nil)
  {
    KRML_CHECK_SIZE(sizeof (Prims_list__Extensions_extension_), (uint32_t)1U);
    Prims_list__Extensions_extension_
    *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Extensions_extension_));
    buf[0U] = ((Prims_list__Extensions_extension_){ .tag = Prims_Nil });
    return buf;
  }
  else if (l->tag == Prims_Cons)
  {
    Prims_list__Extensions_extension_ *tl1 = l->tl;
    Extensions_extension_ hd1 = l->hd;
    FStar_Pervasives_Native_option__Extensions_extension_ scrut = f(env, hd1);
    if (scrut.tag == FStar_Pervasives_Native_Some)
    {
      Extensions_extension_ i = scrut.v;
      KRML_CHECK_SIZE(sizeof (Prims_list__Extensions_extension_), (uint32_t)1U);
      Prims_list__Extensions_extension_
      *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Extensions_extension_));
      buf[0U]
      =
        (
          (Prims_list__Extensions_extension_){
            .tag = Prims_Cons,
            .hd = i,
            .tl = List_Helpers_choose_aux__Extensions_extension__Extensions_extension__FStar_Pervasives_Native_option_Prims_dtuple2_CommonDH_group__CommonDH_pre_share_(env,
              f,
              tl1)
          }
        );
      return buf;
    }
    else if (scrut.tag == FStar_Pervasives_Native_None)
      return
        List_Helpers_choose_aux__Extensions_extension__Extensions_extension__FStar_Pervasives_Native_option_Prims_dtuple2_CommonDH_group__CommonDH_pre_share_(env,
          f,
          tl1);
    else
    {
      KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
        __FILE__,
        __LINE__,
        "unreachable (pattern matches are exhaustive in F*)");
      KRML_HOST_EXIT(255U);
    }
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_HandshakeMessages_ch
TLSError_fatal__HandshakeMessages_ch(
  Parsers_AlertDescription_alertDescription a,
  Prims_string s
)
{
  return
    (
      (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_HandshakeMessages_ch){
        .tag = FStar_Error_Error,
        .val = { .case_Error = { .fst = TLSError_fatalAlert(a), .snd = s } }
      }
    );
}

static bool
FStar_Pervasives_Native_uu___is_None__CommonDH_group_(
  FStar_Pervasives_Native_option__CommonDH_group_ projectee
)
{
  if (projectee.tag == FStar_Pervasives_Native_None)
    return true;
  else
    return false;
}

typedef struct K___Prims_list__Extensions_extension__bool_s
{
  Prims_list__Extensions_extension_ *fst;
  bool snd;
}
K___Prims_list__Extensions_extension__bool;

FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_HandshakeMessages_ch
Negotiation_client_HelloRetryRequest(
  Negotiation_t ns,
  HandshakeMessages_hrr hrr,
  FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_ s
)
{
  FStar_Bytes_bytes sid = hrr.hrr_sessionID;
  Prims_list__Extensions_extension_ *el = hrr.hrr_extensions;
  Negotiation_print(Prims_strcat("Got HRR, extensions: [",
      Prims_strcat(Extensions_string_of_extensions____(el), "]")));
  Negotiation_negotiationState scrut0 = ns.state[0U];
  if (scrut0.tag == Negotiation_C_Offer)
  {
    HandshakeMessages_ch offer = scrut0.val.case_C_Offer;
    Prims_list__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_
    *old_shares = Negotiation_gs_of(offer);
    FStar_Pervasives_Native_option__Prims_list__K___FStar_Bytes_bytes_uint32_t
    scrut0 = Negotiation_find_pske(offer);
    Prims_list__K___FStar_Bytes_bytes_uint32_t *old_psk;
    if (scrut0.tag == FStar_Pervasives_Native_None)
    {
      KRML_CHECK_SIZE(sizeof (Prims_list__K___FStar_Bytes_bytes_uint32_t), (uint32_t)1U);
      Prims_list__K___FStar_Bytes_bytes_uint32_t
      *buf = KRML_HOST_MALLOC(sizeof (Prims_list__K___FStar_Bytes_bytes_uint32_t));
      buf[0U] = ((Prims_list__K___FStar_Bytes_bytes_uint32_t){ .tag = Prims_Nil });
      old_psk = buf;
    }
    else if (scrut0.tag == FStar_Pervasives_Native_Some)
      old_psk = scrut0.v;
    else
      old_psk =
        KRML_EABORT(Prims_list__K___FStar_Bytes_bytes_uint32_t *,
          "unreachable (pattern matches are exhaustive in F*)");
    Prims_list__Extensions_extension_ *ite;
    if (offer.ch_extensions.tag == FStar_Pervasives_Native_Some)
      ite = offer.ch_extensions.v;
    else
      ite =
        KRML_EABORT(Prims_list__Extensions_extension_ *,
          "unreachable (pattern matches are exhaustive in F*)");
    Prims_list__Extensions_extension_
    *ext_ =
      List_Helpers_choose_aux__Extensions_extension__Extensions_extension__FStar_Pervasives_Native_option_Prims_dtuple2_CommonDH_group__CommonDH_pre_share_(s,
        Negotiation_choose_extension,
        ite);
    FStar_Pervasives_Native_option__Extensions_extension_
    scrut1 = FStar_List_Tot_Base_find__Extensions_extension_(Extensions_uu___is_E_cookie____, el);
    K___Prims_list__Extensions_extension__bool scrut;
    if (scrut1.tag == FStar_Pervasives_Native_Some)
    {
      Extensions_extension_ cookie = scrut1.v;
      KRML_CHECK_SIZE(sizeof (Prims_list__Extensions_extension_), (uint32_t)1U);
      Prims_list__Extensions_extension_
      *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Extensions_extension_));
      buf[0U]
      = ((Prims_list__Extensions_extension_){ .tag = Prims_Cons, .hd = cookie, .tl = ext_ });
      scrut = ((K___Prims_list__Extensions_extension__bool){ .fst = buf, .snd = false });
    }
    else if (scrut1.tag == FStar_Pervasives_Native_None)
      scrut = ((K___Prims_list__Extensions_extension__bool){ .fst = ext_, .snd = true });
    else
      scrut =
        KRML_EABORT(K___Prims_list__Extensions_extension__bool,
          "unreachable (pattern matches are exhaustive in F*)");
    Prims_list__Extensions_extension_ *ext_1 = scrut.fst;
    bool no_cookie = scrut.snd;
    if (__neq__FStar_Bytes_bytes(sid, offer.ch_sessionID))
      return
        TLSError_fatal__HandshakeMessages_ch(Parsers_AlertDescription_Illegal_parameter,
          "mismatched session ID in HelloRetryRequest");
    else if
    (
      FStar_Pervasives_Native_uu___is_None__CommonDH_group_(Negotiation_group_of_hrr(hrr))
      && no_cookie
    )
      return
        TLSError_fatal__HandshakeMessages_ch(Parsers_AlertDescription_Illegal_parameter,
          "received a HRR that would yield the same ClientHello");
    else
    {
      HandshakeMessages_ch uu____0 = offer;
      HandshakeMessages_ch
      offer_ =
        {
          .ch_protocol_version = uu____0.ch_protocol_version,
          .ch_client_random = uu____0.ch_client_random, .ch_sessionID = uu____0.ch_sessionID,
          .ch_cipher_suites = uu____0.ch_cipher_suites, .ch_compressions = uu____0.ch_compressions,
          .ch_extensions = { .tag = FStar_Pervasives_Native_Some, .v = ext_1 }
        };
      K___HandshakeMessages_hrr_Prims_list__Prims_dtuple2__CommonDH_group__CommonDH_pre_share__Prims_list__K___FStar_Bytes_bytes_uint32_t
      ri = { .fst = hrr, .snd = old_shares, .thd = old_psk };
      ns.state[0U] =
        (
          (Negotiation_negotiationState){
            .tag = Negotiation_C_HRR,
            .val = { .case_C_HRR = { .n_offer = offer_, .n_hrr = ri } }
          }
        );
      return
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_HandshakeMessages_ch){
            .tag = FStar_Error_Correct,
            .val = { .case_Correct = offer_ }
          }
        );
    }
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

static bool Negotiation_not_unknown_version(Parsers_ProtocolVersion_protocolVersion x)
{
  return !Parsers_ProtocolVersion_uu___is_Unknown_protocolVersion(x);
}

static Prims_list__Parsers_ProtocolVersion_protocolVersion
*FStar_List_Tot_Base_filter__Parsers_ProtocolVersion_protocolVersion(
  bool (*f)(Parsers_ProtocolVersion_protocolVersion x0),
  Prims_list__Parsers_ProtocolVersion_protocolVersion *uu___8_1135
)
{
  if (uu___8_1135->tag == Prims_Nil)
  {
    KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_ProtocolVersion_protocolVersion), (uint32_t)1U);
    Prims_list__Parsers_ProtocolVersion_protocolVersion
    *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_ProtocolVersion_protocolVersion));
    buf[0U] = ((Prims_list__Parsers_ProtocolVersion_protocolVersion){ .tag = Prims_Nil });
    return buf;
  }
  else if (uu___8_1135->tag == Prims_Cons)
  {
    Prims_list__Parsers_ProtocolVersion_protocolVersion *tl1 = uu___8_1135->tl;
    Parsers_ProtocolVersion_protocolVersion hd1 = uu___8_1135->hd;
    if (f(hd1))
    {
      KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_ProtocolVersion_protocolVersion), (uint32_t)1U);
      Prims_list__Parsers_ProtocolVersion_protocolVersion
      *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_ProtocolVersion_protocolVersion));
      buf[0U]
      =
        (
          (Prims_list__Parsers_ProtocolVersion_protocolVersion){
            .tag = Prims_Cons,
            .hd = hd1,
            .tl = FStar_List_Tot_Base_filter__Parsers_ProtocolVersion_protocolVersion(f, tl1)
          }
        );
      return buf;
    }
    else
      return FStar_List_Tot_Base_filter__Parsers_ProtocolVersion_protocolVersion(f, tl1);
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Prims_list__Parsers_ProtocolVersion_protocolVersion
Negotiation_offered_versions(
  Parsers_ProtocolVersion_protocolVersion min_pv,
  HandshakeMessages_ch o
)
{
  FStar_Pervasives_Native_option__Extensions_protocol_versions
  scrut = Negotiation_find_supported_versions(o);
  if (scrut.tag == FStar_Pervasives_Native_Some && scrut.v.tag == Extensions_ServerPV)
    return
      TLSError_fatal__Prims_list_Parsers_ProtocolVersion_protocolVersion(Parsers_AlertDescription_Protocol_version,
        "protocol version negotiation: empty proposal");
  else if
  (
    scrut.tag
    == FStar_Pervasives_Native_Some
    && scrut.v.tag == Extensions_ClientPV && scrut.v.val.case_ClientPV->tag == Prims_Nil
  )
    return
      TLSError_fatal__Prims_list_Parsers_ProtocolVersion_protocolVersion(Parsers_AlertDescription_Protocol_version,
        "protocol version negotiation: empty proposal");
  else if (scrut.tag == FStar_Pervasives_Native_Some && scrut.v.tag == Extensions_ClientPV)
  {
    Prims_list__Parsers_ProtocolVersion_protocolVersion *vs = scrut.v.val.case_ClientPV;
    return
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Prims_list__Parsers_ProtocolVersion_protocolVersion){
          .tag = FStar_Error_Correct,
          .val = {
            .case_Correct = FStar_List_Tot_Base_filter__Parsers_ProtocolVersion_protocolVersion(Negotiation_not_unknown_version,
              vs)
          }
        }
      );
  }
  else if (scrut.tag == FStar_Pervasives_Native_None)
  {
    K___Parsers_ProtocolVersion_protocolVersion_Parsers_ProtocolVersion_protocolVersion
    scrut = { .fst = o.ch_protocol_version, .snd = min_pv };
    if
    (
      scrut.fst.tag
      == Parsers_ProtocolVersion_TLS_1p0
      && scrut.snd.tag == Parsers_ProtocolVersion_TLS_1p0
    )
    {
      KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_ProtocolVersion_protocolVersion), (uint32_t)1U);
      Prims_list__Parsers_ProtocolVersion_protocolVersion
      *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_ProtocolVersion_protocolVersion));
      buf[0U] = ((Prims_list__Parsers_ProtocolVersion_protocolVersion){ .tag = Prims_Nil });
      KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_ProtocolVersion_protocolVersion), (uint32_t)1U);
      Prims_list__Parsers_ProtocolVersion_protocolVersion
      *buf0 = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_ProtocolVersion_protocolVersion));
      buf0[0U]
      =
        (
          (Prims_list__Parsers_ProtocolVersion_protocolVersion){
            .tag = Prims_Cons,
            .hd = { .tag = Parsers_ProtocolVersion_TLS_1p0 },
            .tl = buf
          }
        );
      return
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Prims_list__Parsers_ProtocolVersion_protocolVersion){
            .tag = FStar_Error_Correct,
            .val = { .case_Correct = buf0 }
          }
        );
    }
    else if
    (
      scrut.fst.tag
      == Parsers_ProtocolVersion_TLS_1p1
      && scrut.snd.tag == Parsers_ProtocolVersion_TLS_1p0
    )
    {
      KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_ProtocolVersion_protocolVersion), (uint32_t)1U);
      Prims_list__Parsers_ProtocolVersion_protocolVersion
      *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_ProtocolVersion_protocolVersion));
      buf[0U] = ((Prims_list__Parsers_ProtocolVersion_protocolVersion){ .tag = Prims_Nil });
      KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_ProtocolVersion_protocolVersion), (uint32_t)1U);
      Prims_list__Parsers_ProtocolVersion_protocolVersion
      *buf0 = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_ProtocolVersion_protocolVersion));
      buf0[0U]
      =
        (
          (Prims_list__Parsers_ProtocolVersion_protocolVersion){
            .tag = Prims_Cons,
            .hd = { .tag = Parsers_ProtocolVersion_TLS_1p1 },
            .tl = buf
          }
        );
      KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_ProtocolVersion_protocolVersion), (uint32_t)1U);
      Prims_list__Parsers_ProtocolVersion_protocolVersion
      *buf1 = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_ProtocolVersion_protocolVersion));
      buf1[0U]
      =
        (
          (Prims_list__Parsers_ProtocolVersion_protocolVersion){
            .tag = Prims_Cons,
            .hd = { .tag = Parsers_ProtocolVersion_TLS_1p2 },
            .tl = buf0
          }
        );
      return
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Prims_list__Parsers_ProtocolVersion_protocolVersion){
            .tag = FStar_Error_Correct,
            .val = { .case_Correct = buf1 }
          }
        );
    }
    else if
    (
      scrut.fst.tag
      == Parsers_ProtocolVersion_TLS_1p1
      && scrut.snd.tag == Parsers_ProtocolVersion_TLS_1p1
    )
    {
      KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_ProtocolVersion_protocolVersion), (uint32_t)1U);
      Prims_list__Parsers_ProtocolVersion_protocolVersion
      *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_ProtocolVersion_protocolVersion));
      buf[0U] = ((Prims_list__Parsers_ProtocolVersion_protocolVersion){ .tag = Prims_Nil });
      KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_ProtocolVersion_protocolVersion), (uint32_t)1U);
      Prims_list__Parsers_ProtocolVersion_protocolVersion
      *buf0 = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_ProtocolVersion_protocolVersion));
      buf0[0U]
      =
        (
          (Prims_list__Parsers_ProtocolVersion_protocolVersion){
            .tag = Prims_Cons,
            .hd = { .tag = Parsers_ProtocolVersion_TLS_1p1 },
            .tl = buf
          }
        );
      return
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Prims_list__Parsers_ProtocolVersion_protocolVersion){
            .tag = FStar_Error_Correct,
            .val = { .case_Correct = buf0 }
          }
        );
    }
    else if
    (
      scrut.fst.tag
      == Parsers_ProtocolVersion_TLS_1p2
      && scrut.snd.tag == Parsers_ProtocolVersion_TLS_1p0
    )
    {
      KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_ProtocolVersion_protocolVersion), (uint32_t)1U);
      Prims_list__Parsers_ProtocolVersion_protocolVersion
      *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_ProtocolVersion_protocolVersion));
      buf[0U] = ((Prims_list__Parsers_ProtocolVersion_protocolVersion){ .tag = Prims_Nil });
      KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_ProtocolVersion_protocolVersion), (uint32_t)1U);
      Prims_list__Parsers_ProtocolVersion_protocolVersion
      *buf0 = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_ProtocolVersion_protocolVersion));
      buf0[0U]
      =
        (
          (Prims_list__Parsers_ProtocolVersion_protocolVersion){
            .tag = Prims_Cons,
            .hd = { .tag = Parsers_ProtocolVersion_TLS_1p0 },
            .tl = buf
          }
        );
      KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_ProtocolVersion_protocolVersion), (uint32_t)1U);
      Prims_list__Parsers_ProtocolVersion_protocolVersion
      *buf1 = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_ProtocolVersion_protocolVersion));
      buf1[0U]
      =
        (
          (Prims_list__Parsers_ProtocolVersion_protocolVersion){
            .tag = Prims_Cons,
            .hd = { .tag = Parsers_ProtocolVersion_TLS_1p1 },
            .tl = buf0
          }
        );
      KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_ProtocolVersion_protocolVersion), (uint32_t)1U);
      Prims_list__Parsers_ProtocolVersion_protocolVersion
      *buf2 = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_ProtocolVersion_protocolVersion));
      buf2[0U]
      =
        (
          (Prims_list__Parsers_ProtocolVersion_protocolVersion){
            .tag = Prims_Cons,
            .hd = { .tag = Parsers_ProtocolVersion_TLS_1p2 },
            .tl = buf1
          }
        );
      return
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Prims_list__Parsers_ProtocolVersion_protocolVersion){
            .tag = FStar_Error_Correct,
            .val = { .case_Correct = buf2 }
          }
        );
    }
    else if
    (
      scrut.fst.tag
      == Parsers_ProtocolVersion_TLS_1p2
      && scrut.snd.tag == Parsers_ProtocolVersion_TLS_1p1
    )
    {
      KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_ProtocolVersion_protocolVersion), (uint32_t)1U);
      Prims_list__Parsers_ProtocolVersion_protocolVersion
      *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_ProtocolVersion_protocolVersion));
      buf[0U] = ((Prims_list__Parsers_ProtocolVersion_protocolVersion){ .tag = Prims_Nil });
      KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_ProtocolVersion_protocolVersion), (uint32_t)1U);
      Prims_list__Parsers_ProtocolVersion_protocolVersion
      *buf0 = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_ProtocolVersion_protocolVersion));
      buf0[0U]
      =
        (
          (Prims_list__Parsers_ProtocolVersion_protocolVersion){
            .tag = Prims_Cons,
            .hd = { .tag = Parsers_ProtocolVersion_TLS_1p1 },
            .tl = buf
          }
        );
      KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_ProtocolVersion_protocolVersion), (uint32_t)1U);
      Prims_list__Parsers_ProtocolVersion_protocolVersion
      *buf1 = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_ProtocolVersion_protocolVersion));
      buf1[0U]
      =
        (
          (Prims_list__Parsers_ProtocolVersion_protocolVersion){
            .tag = Prims_Cons,
            .hd = { .tag = Parsers_ProtocolVersion_TLS_1p2 },
            .tl = buf0
          }
        );
      return
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Prims_list__Parsers_ProtocolVersion_protocolVersion){
            .tag = FStar_Error_Correct,
            .val = { .case_Correct = buf1 }
          }
        );
    }
    else if
    (
      scrut.fst.tag
      == Parsers_ProtocolVersion_TLS_1p2
      && scrut.snd.tag == Parsers_ProtocolVersion_TLS_1p2
    )
    {
      KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_ProtocolVersion_protocolVersion), (uint32_t)1U);
      Prims_list__Parsers_ProtocolVersion_protocolVersion
      *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_ProtocolVersion_protocolVersion));
      buf[0U] = ((Prims_list__Parsers_ProtocolVersion_protocolVersion){ .tag = Prims_Nil });
      KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_ProtocolVersion_protocolVersion), (uint32_t)1U);
      Prims_list__Parsers_ProtocolVersion_protocolVersion
      *buf0 = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_ProtocolVersion_protocolVersion));
      buf0[0U]
      =
        (
          (Prims_list__Parsers_ProtocolVersion_protocolVersion){
            .tag = Prims_Cons,
            .hd = { .tag = Parsers_ProtocolVersion_TLS_1p2 },
            .tl = buf
          }
        );
      return
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Prims_list__Parsers_ProtocolVersion_protocolVersion){
            .tag = FStar_Error_Correct,
            .val = { .case_Correct = buf0 }
          }
        );
    }
    else
      return
        TLSError_fatal__Prims_list_Parsers_ProtocolVersion_protocolVersion(Parsers_AlertDescription_Protocol_version,
          "protocol version negotation: bad legacy proposal");
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

static bool
FStar_List_Tot_Base_existsb__Parsers_ProtocolVersion_protocolVersion(
  bool (*f)(Parsers_ProtocolVersion_protocolVersion x0),
  Prims_list__Parsers_ProtocolVersion_protocolVersion *l
)
{
  if (l->tag == Prims_Nil)
    return false;
  else if (l->tag == Prims_Cons)
  {
    Prims_list__Parsers_ProtocolVersion_protocolVersion *tl1 = l->tl;
    Parsers_ProtocolVersion_protocolVersion hd1 = l->hd;
    if (f(hd1))
      return true;
    else
      return FStar_List_Tot_Base_existsb__Parsers_ProtocolVersion_protocolVersion(f, tl1);
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

bool Negotiation_is_client13(HandshakeMessages_ch o)
{
  FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Prims_list__Parsers_ProtocolVersion_protocolVersion
  scrut =
    Negotiation_offered_versions((
        (Parsers_ProtocolVersion_protocolVersion){ .tag = Parsers_ProtocolVersion_TLS_1p3 }
      ),
      o);
  if (scrut.tag == FStar_Error_Correct)
  {
    Prims_list__Parsers_ProtocolVersion_protocolVersion *vs = scrut.val.case_Correct;
    return
      FStar_List_Tot_Base_existsb__Parsers_ProtocolVersion_protocolVersion(TLSConstants_is_pv_13,
        vs);
  }
  else if (scrut.tag == FStar_Error_Error)
    return false;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

static bool
Negotiation_version_within(TLSConstants_config cfg, Parsers_ProtocolVersion_protocolVersion v1)
{
  return TLSConstants_geqPV(cfg.max_version, v1) && TLSConstants_geqPV(v1, cfg.min_version);
}

static FStar_Pervasives_Native_option__Parsers_ProtocolVersion_protocolVersion
List_Helpers_find_aux__Parsers_ProtocolVersion_protocolVersion_TLSConstants_config(
  TLSConstants_config env,
  bool (*f)(TLSConstants_config x0, Parsers_ProtocolVersion_protocolVersion x1),
  Prims_list__Parsers_ProtocolVersion_protocolVersion *l
)
{
  if (l->tag == Prims_Nil)
    return
      (
        (FStar_Pervasives_Native_option__Parsers_ProtocolVersion_protocolVersion){
          .tag = FStar_Pervasives_Native_None
        }
      );
  else if (l->tag == Prims_Cons)
  {
    Prims_list__Parsers_ProtocolVersion_protocolVersion *tl1 = l->tl;
    Parsers_ProtocolVersion_protocolVersion hd1 = l->hd;
    if (f(env, hd1))
      return
        (
          (FStar_Pervasives_Native_option__Parsers_ProtocolVersion_protocolVersion){
            .tag = FStar_Pervasives_Native_Some,
            .v = hd1
          }
        );
    else
      return
        List_Helpers_find_aux__Parsers_ProtocolVersion_protocolVersion_TLSConstants_config(env,
          f,
          tl1);
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_ProtocolVersion_protocolVersion
Negotiation_negotiate_version(TLSConstants_config cfg, HandshakeMessages_ch offer)
{
  FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Prims_list__Parsers_ProtocolVersion_protocolVersion
  scrut =
    Negotiation_offered_versions((
        (Parsers_ProtocolVersion_protocolVersion){ .tag = Parsers_ProtocolVersion_TLS_1p0 }
      ),
      offer);
  if (scrut.tag == FStar_Error_Error)
  {
    K___Parsers_Alert_alert_Prims_string z = scrut.val.case_Error;
    return
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_ProtocolVersion_protocolVersion){
          .tag = FStar_Error_Error,
          .val = { .case_Error = z }
        }
      );
  }
  else if (scrut.tag == FStar_Error_Correct)
  {
    Prims_list__Parsers_ProtocolVersion_protocolVersion *vs = scrut.val.case_Correct;
    FStar_Pervasives_Native_option__Parsers_ProtocolVersion_protocolVersion
    scrut =
      List_Helpers_find_aux__Parsers_ProtocolVersion_protocolVersion_TLSConstants_config(cfg,
        Negotiation_version_within,
        vs);
    if (scrut.tag == FStar_Pervasives_Native_Some)
    {
      Parsers_ProtocolVersion_protocolVersion v1 = scrut.v;
      return
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_ProtocolVersion_protocolVersion){
            .tag = FStar_Error_Correct,
            .val = { .case_Correct = v1 }
          }
        );
    }
    else if (scrut.tag == FStar_Pervasives_Native_None)
      return
        TLSError_fatal__Parsers_ProtocolVersion_protocolVersion(Parsers_AlertDescription_Protocol_version,
          "protocol version negotiation: mismatch");
    else
    {
      KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
        __FILE__,
        __LINE__,
        "unreachable (pattern matches are exhaustive in F*)");
      KRML_HOST_EXIT(255U);
    }
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

static bool
FStar_List_Tot_Base_mem__Parsers_CipherSuite_cipherSuite(
  Parsers_CipherSuite_cipherSuite x,
  Prims_list__Parsers_CipherSuite_cipherSuite *uu___7_953
)
{
  if (uu___7_953->tag == Prims_Nil)
    return false;
  else if (uu___7_953->tag == Prims_Cons)
  {
    Prims_list__Parsers_CipherSuite_cipherSuite *tl1 = uu___7_953->tl;
    Parsers_CipherSuite_cipherSuite hd1 = uu___7_953->hd;
    if (__eq__Parsers_CipherSuite_cipherSuite(hd1, x))
      return true;
    else
      return FStar_List_Tot_Base_mem__Parsers_CipherSuite_cipherSuite(x, tl1);
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

typedef struct K___Prims_list__Parsers_CipherSuite_cipherSuite_CipherSuite_sigAlg_s
{
  Prims_list__Parsers_CipherSuite_cipherSuite *fst;
  CipherSuite_sigAlg snd;
}
K___Prims_list__Parsers_CipherSuite_cipherSuite_CipherSuite_sigAlg;

static bool __eq__CipherSuite_sigAlg(CipherSuite_sigAlg y, CipherSuite_sigAlg x)
{
  switch (x)
  {
    case CipherSuite_RSASIG:
      {
        switch (y)
        {
          case CipherSuite_RSASIG:
            {
              return true;
            }
          default:
            {
              return false;
            }
        }
        break;
      }
    case CipherSuite_DSA:
      {
        switch (y)
        {
          case CipherSuite_DSA:
            {
              return true;
            }
          default:
            {
              return false;
            }
        }
        break;
      }
    case CipherSuite_ECDSA:
      {
        switch (y)
        {
          case CipherSuite_ECDSA:
            {
              return true;
            }
          default:
            {
              return false;
            }
        }
        break;
      }
    case CipherSuite_RSAPSS:
      {
        switch (y)
        {
          case CipherSuite_RSAPSS:
            {
              return true;
            }
          default:
            {
              return false;
            }
        }
        break;
      }
    default:
      {
        return false;
      }
  }
}

static bool
__eq__FStar_Pervasives_Native_option__CipherSuite_sigAlg(
  FStar_Pervasives_Native_option__CipherSuite_sigAlg y,
  FStar_Pervasives_Native_option__CipherSuite_sigAlg x
)
{
  if (x.tag == FStar_Pervasives_Native_None)
    if (y.tag == FStar_Pervasives_Native_None)
      return true;
    else
      return false;
  else if (x.tag == FStar_Pervasives_Native_Some)
  {
    CipherSuite_sigAlg x_v = x.v;
    if (y.tag == FStar_Pervasives_Native_Some)
    {
      CipherSuite_sigAlg y_v = y.v;
      return true && __eq__CipherSuite_sigAlg(y_v, x_v);
    }
    else
      return false;
  }
  else
    return false;
}

/*

  For use in negotiating the ciphersuite, takes two lists and
  outputs the first ciphersuite in list2 that also is in list
  one and is a valid ciphersuite, or [None]

*/
static bool
Negotiation_is_cs_in_l(
  K___Prims_list__Parsers_CipherSuite_cipherSuite_CipherSuite_sigAlg uu____6791,
  CipherSuite_cipherSuite_ s
)
{
  Prims_list__Parsers_CipherSuite_cipherSuite *l1 = uu____6791.fst;
  CipherSuite_sigAlg sa = uu____6791.snd;
  if (CipherSuite_uu___is_CipherSuite(s))
  {
    FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite
    scrut;
    if (s.tag == CipherSuite_NullCipherSuite)
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_NULL_WITH_NULL_NULL } }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite13
      &&
        s.val.case_CipherSuite13._0
        == EverCrypt_AES128_GCM
        && s.val.case_CipherSuite13._1 == Spec_Hash_Definitions_SHA2_256
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_AES_128_GCM_SHA256 } }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite13
      &&
        s.val.case_CipherSuite13._0
        == EverCrypt_AES256_GCM
        && s.val.case_CipherSuite13._1 == Spec_Hash_Definitions_SHA2_384
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_AES_256_GCM_SHA384 } }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite13
      &&
        s.val.case_CipherSuite13._0
        == EverCrypt_CHACHA20_POLY1305
        && s.val.case_CipherSuite13._1 == Spec_Hash_Definitions_SHA2_256
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_CHACHA20_POLY1305_SHA256 } }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite13
      &&
        s.val.case_CipherSuite13._0
        == EverCrypt_AES128_CCM
        && s.val.case_CipherSuite13._1 == Spec_Hash_Definitions_SHA2_256
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_AES_128_CCM_SHA256 } }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite13
      &&
        s.val.case_CipherSuite13._0
        == EverCrypt_AES128_CCM8
        && s.val.case_CipherSuite13._1 == Spec_Hash_Definitions_SHA2_256
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_AES_128_CCM_8_SHA256 } }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_RSA
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_None
          &&
            s.val.case_CipherSuite._2.tag
            == CipherSuite_MACOnly
            && s.val.case_CipherSuite._2.val.case_MACOnly == Spec_Hash_Definitions_MD5
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_NULL_MD5 } }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_RSA
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_None
          &&
            s.val.case_CipherSuite._2.tag
            == CipherSuite_MACOnly
            && s.val.case_CipherSuite._2.val.case_MACOnly == Spec_Hash_Definitions_SHA1
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_NULL_SHA } }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_RSA
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_None
          &&
            s.val.case_CipherSuite._2.tag
            == CipherSuite_MACOnly
            && s.val.case_CipherSuite._2.val.case_MACOnly == Spec_Hash_Definitions_SHA2_256
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_NULL_SHA256 } }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_RSA
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_None
          &&
            s.val.case_CipherSuite._2.tag
            == CipherSuite_MtE
            &&
              s.val.case_CipherSuite._2.val.case_MtE._0.tag
              == CipherSuite_Stream
              &&
                s.val.case_CipherSuite._2.val.case_MtE._0.val.case_Stream
                == EverCrypt_RC4_128
                && s.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_MD5
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_RC4_128_MD5 } }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_RSA
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_None
          &&
            s.val.case_CipherSuite._2.tag
            == CipherSuite_MtE
            &&
              s.val.case_CipherSuite._2.val.case_MtE._0.tag
              == CipherSuite_Stream
              &&
                s.val.case_CipherSuite._2.val.case_MtE._0.val.case_Stream
                == EverCrypt_RC4_128
                && s.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_RC4_128_SHA } }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_RSA
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_None
          &&
            s.val.case_CipherSuite._2.tag
            == CipherSuite_MtE
            &&
              s.val.case_CipherSuite._2.val.case_MtE._0.tag
              == CipherSuite_Block
              &&
                s.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                == EverCrypt_TDES_EDE_CBC
                && s.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_3DES_EDE_CBC_SHA } }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_RSA
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_None
          &&
            s.val.case_CipherSuite._2.tag
            == CipherSuite_MtE
            &&
              s.val.case_CipherSuite._2.val.case_MtE._0.tag
              == CipherSuite_Block
              &&
                s.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                == EverCrypt_AES128_CBC
                && s.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_AES_128_CBC_SHA } }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_RSA
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_None
          &&
            s.val.case_CipherSuite._2.tag
            == CipherSuite_MtE
            &&
              s.val.case_CipherSuite._2.val.case_MtE._0.tag
              == CipherSuite_Block
              &&
                s.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                == EverCrypt_AES256_CBC
                && s.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_AES_256_CBC_SHA } }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_RSA
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_None
          &&
            s.val.case_CipherSuite._2.tag
            == CipherSuite_MtE
            &&
              s.val.case_CipherSuite._2.val.case_MtE._0.tag
              == CipherSuite_Block
              &&
                s.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                == EverCrypt_AES128_CBC
                && s.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA2_256
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_AES_128_CBC_SHA256 }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_RSA
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_None
          &&
            s.val.case_CipherSuite._2.tag
            == CipherSuite_MtE
            &&
              s.val.case_CipherSuite._2.val.case_MtE._0.tag
              == CipherSuite_Block
              &&
                s.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                == EverCrypt_AES256_CBC
                && s.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA2_256
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_AES_256_CBC_SHA256 }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_DHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_Some
          &&
            s.val.case_CipherSuite._1.v
            == CipherSuite_DSA
            &&
              s.val.case_CipherSuite._2.tag
              == CipherSuite_MtE
              &&
                s.val.case_CipherSuite._2.val.case_MtE._0.tag
                == CipherSuite_Block
                &&
                  s.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                  == EverCrypt_TDES_EDE_CBC
                  && s.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_DSS_WITH_3DES_EDE_CBC_SHA }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_DHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_Some
          &&
            s.val.case_CipherSuite._1.v
            == CipherSuite_RSASIG
            &&
              s.val.case_CipherSuite._2.tag
              == CipherSuite_MtE
              &&
                s.val.case_CipherSuite._2.val.case_MtE._0.tag
                == CipherSuite_Block
                &&
                  s.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                  == EverCrypt_TDES_EDE_CBC
                  && s.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_RSA_WITH_3DES_EDE_CBC_SHA }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_DHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_Some
          &&
            s.val.case_CipherSuite._1.v
            == CipherSuite_DSA
            &&
              s.val.case_CipherSuite._2.tag
              == CipherSuite_MtE
              &&
                s.val.case_CipherSuite._2.val.case_MtE._0.tag
                == CipherSuite_Block
                &&
                  s.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                  == EverCrypt_AES128_CBC
                  && s.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_128_CBC_SHA }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_DHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_Some
          &&
            s.val.case_CipherSuite._1.v
            == CipherSuite_RSASIG
            &&
              s.val.case_CipherSuite._2.tag
              == CipherSuite_MtE
              &&
                s.val.case_CipherSuite._2.val.case_MtE._0.tag
                == CipherSuite_Block
                &&
                  s.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                  == EverCrypt_AES128_CBC
                  && s.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_128_CBC_SHA }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_DHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_Some
          &&
            s.val.case_CipherSuite._1.v
            == CipherSuite_DSA
            &&
              s.val.case_CipherSuite._2.tag
              == CipherSuite_MtE
              &&
                s.val.case_CipherSuite._2.val.case_MtE._0.tag
                == CipherSuite_Block
                &&
                  s.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                  == EverCrypt_AES256_CBC
                  && s.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_256_CBC_SHA }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_DHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_Some
          &&
            s.val.case_CipherSuite._1.v
            == CipherSuite_RSASIG
            &&
              s.val.case_CipherSuite._2.tag
              == CipherSuite_MtE
              &&
                s.val.case_CipherSuite._2.val.case_MtE._0.tag
                == CipherSuite_Block
                &&
                  s.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                  == EverCrypt_AES256_CBC
                  && s.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_256_CBC_SHA }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_DHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_Some
          &&
            s.val.case_CipherSuite._1.v
            == CipherSuite_DSA
            &&
              s.val.case_CipherSuite._2.tag
              == CipherSuite_MtE
              &&
                s.val.case_CipherSuite._2.val.case_MtE._0.tag
                == CipherSuite_Block
                &&
                  s.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                  == EverCrypt_AES128_CBC
                  && s.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA2_256
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_128_CBC_SHA256 }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_DHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_Some
          &&
            s.val.case_CipherSuite._1.v
            == CipherSuite_RSASIG
            &&
              s.val.case_CipherSuite._2.tag
              == CipherSuite_MtE
              &&
                s.val.case_CipherSuite._2.val.case_MtE._0.tag
                == CipherSuite_Block
                &&
                  s.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                  == EverCrypt_AES128_CBC
                  && s.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA2_256
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_128_CBC_SHA256 }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_DHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_Some
          &&
            s.val.case_CipherSuite._1.v
            == CipherSuite_DSA
            &&
              s.val.case_CipherSuite._2.tag
              == CipherSuite_MtE
              &&
                s.val.case_CipherSuite._2.val.case_MtE._0.tag
                == CipherSuite_Block
                &&
                  s.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                  == EverCrypt_AES256_CBC
                  && s.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA2_256
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_256_CBC_SHA256 }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_DHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_Some
          &&
            s.val.case_CipherSuite._1.v
            == CipherSuite_RSASIG
            &&
              s.val.case_CipherSuite._2.tag
              == CipherSuite_MtE
              &&
                s.val.case_CipherSuite._2.val.case_MtE._0.tag
                == CipherSuite_Block
                &&
                  s.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                  == EverCrypt_AES256_CBC
                  && s.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA2_256
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_256_CBC_SHA256 }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_ECDHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_Some
          &&
            s.val.case_CipherSuite._1.v
            == CipherSuite_RSASIG
            &&
              s.val.case_CipherSuite._2.tag
              == CipherSuite_MtE
              &&
                s.val.case_CipherSuite._2.val.case_MtE._0.tag
                == CipherSuite_Stream
                &&
                  s.val.case_CipherSuite._2.val.case_MtE._0.val.case_Stream
                  == EverCrypt_RC4_128
                  && s.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_RC4_128_SHA } }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_ECDHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_Some
          &&
            s.val.case_CipherSuite._1.v
            == CipherSuite_RSASIG
            &&
              s.val.case_CipherSuite._2.tag
              == CipherSuite_MtE
              &&
                s.val.case_CipherSuite._2.val.case_MtE._0.tag
                == CipherSuite_Block
                &&
                  s.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                  == EverCrypt_TDES_EDE_CBC
                  && s.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_ECDHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_Some
          &&
            s.val.case_CipherSuite._1.v
            == CipherSuite_RSASIG
            &&
              s.val.case_CipherSuite._2.tag
              == CipherSuite_MtE
              &&
                s.val.case_CipherSuite._2.val.case_MtE._0.tag
                == CipherSuite_Block
                &&
                  s.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                  == EverCrypt_AES128_CBC
                  && s.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_ECDHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_Some
          &&
            s.val.case_CipherSuite._1.v
            == CipherSuite_RSASIG
            &&
              s.val.case_CipherSuite._2.tag
              == CipherSuite_MtE
              &&
                s.val.case_CipherSuite._2.val.case_MtE._0.tag
                == CipherSuite_Block
                &&
                  s.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                  == EverCrypt_AES128_CBC
                  && s.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA2_256
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256 }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_ECDHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_Some
          &&
            s.val.case_CipherSuite._1.v
            == CipherSuite_RSASIG
            &&
              s.val.case_CipherSuite._2.tag
              == CipherSuite_MtE
              &&
                s.val.case_CipherSuite._2.val.case_MtE._0.tag
                == CipherSuite_Block
                &&
                  s.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                  == EverCrypt_AES256_CBC
                  && s.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_ECDHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_Some
          &&
            s.val.case_CipherSuite._1.v
            == CipherSuite_RSASIG
            &&
              s.val.case_CipherSuite._2.tag
              == CipherSuite_MtE
              &&
                s.val.case_CipherSuite._2.val.case_MtE._0.tag
                == CipherSuite_Block
                &&
                  s.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                  == EverCrypt_AES256_CBC
                  && s.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA2_384
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384 }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_ECDHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_Some
          &&
            s.val.case_CipherSuite._1.v
            == CipherSuite_RSASIG
            &&
              s.val.case_CipherSuite._2.tag
              == CipherSuite_AEAD
              &&
                s.val.case_CipherSuite._2.val.case_AEAD._0
                == EverCrypt_AES128_GCM
                && s.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_ECDHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_Some
          &&
            s.val.case_CipherSuite._1.v
            == CipherSuite_ECDSA
            &&
              s.val.case_CipherSuite._2.tag
              == CipherSuite_AEAD
              &&
                s.val.case_CipherSuite._2.val.case_AEAD._0
                == EverCrypt_AES128_GCM
                && s.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_ECDHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_Some
          &&
            s.val.case_CipherSuite._1.v
            == CipherSuite_RSASIG
            &&
              s.val.case_CipherSuite._2.tag
              == CipherSuite_AEAD
              &&
                s.val.case_CipherSuite._2.val.case_AEAD._0
                == EverCrypt_AES256_GCM
                && s.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_384
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_ECDHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_Some
          &&
            s.val.case_CipherSuite._1.v
            == CipherSuite_ECDSA
            &&
              s.val.case_CipherSuite._2.tag
              == CipherSuite_AEAD
              &&
                s.val.case_CipherSuite._2.val.case_AEAD._0
                == EverCrypt_AES256_GCM
                && s.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_384
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_DHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_None
          &&
            s.val.case_CipherSuite._2.tag
            == CipherSuite_MtE
            &&
              s.val.case_CipherSuite._2.val.case_MtE._0.tag
              == CipherSuite_Stream
              &&
                s.val.case_CipherSuite._2.val.case_MtE._0.val.case_Stream
                == EverCrypt_RC4_128
                && s.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_MD5
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_anon_WITH_RC4_128_MD5 } }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_DHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_None
          &&
            s.val.case_CipherSuite._2.tag
            == CipherSuite_MtE
            &&
              s.val.case_CipherSuite._2.val.case_MtE._0.tag
              == CipherSuite_Block
              &&
                s.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                == EverCrypt_TDES_EDE_CBC
                && s.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_anon_WITH_3DES_EDE_CBC_SHA }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_DHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_None
          &&
            s.val.case_CipherSuite._2.tag
            == CipherSuite_MtE
            &&
              s.val.case_CipherSuite._2.val.case_MtE._0.tag
              == CipherSuite_Block
              &&
                s.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                == EverCrypt_AES128_CBC
                && s.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_anon_WITH_AES_128_CBC_SHA }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_DHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_None
          &&
            s.val.case_CipherSuite._2.tag
            == CipherSuite_MtE
            &&
              s.val.case_CipherSuite._2.val.case_MtE._0.tag
              == CipherSuite_Block
              &&
                s.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                == EverCrypt_AES256_CBC
                && s.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_anon_WITH_AES_256_CBC_SHA }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_DHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_None
          &&
            s.val.case_CipherSuite._2.tag
            == CipherSuite_MtE
            &&
              s.val.case_CipherSuite._2.val.case_MtE._0.tag
              == CipherSuite_Block
              &&
                s.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                == EverCrypt_AES128_CBC
                && s.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA2_256
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_anon_WITH_AES_128_CBC_SHA256 }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_DHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_None
          &&
            s.val.case_CipherSuite._2.tag
            == CipherSuite_MtE
            &&
              s.val.case_CipherSuite._2.val.case_MtE._0.tag
              == CipherSuite_Block
              &&
                s.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                == EverCrypt_AES256_CBC
                && s.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA2_256
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_anon_WITH_AES_256_CBC_SHA256 }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_RSA
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_None
          &&
            s.val.case_CipherSuite._2.tag
            == CipherSuite_AEAD
            &&
              s.val.case_CipherSuite._2.val.case_AEAD._0
              == EverCrypt_AES128_GCM
              && s.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_AES_128_GCM_SHA256 }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_RSA
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_None
          &&
            s.val.case_CipherSuite._2.tag
            == CipherSuite_AEAD
            &&
              s.val.case_CipherSuite._2.val.case_AEAD._0
              == EverCrypt_AES256_GCM
              && s.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_384
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_AES_256_GCM_SHA384 }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_DHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_Some
          &&
            s.val.case_CipherSuite._1.v
            == CipherSuite_RSASIG
            &&
              s.val.case_CipherSuite._2.tag
              == CipherSuite_AEAD
              &&
                s.val.case_CipherSuite._2.val.case_AEAD._0
                == EverCrypt_AES128_GCM
                && s.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_128_GCM_SHA256 }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_DHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_Some
          &&
            s.val.case_CipherSuite._1.v
            == CipherSuite_RSASIG
            &&
              s.val.case_CipherSuite._2.tag
              == CipherSuite_AEAD
              &&
                s.val.case_CipherSuite._2.val.case_AEAD._0
                == EverCrypt_AES256_GCM
                && s.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_384
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_256_GCM_SHA384 }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_DH
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_Some
          &&
            s.val.case_CipherSuite._1.v
            == CipherSuite_RSASIG
            &&
              s.val.case_CipherSuite._2.tag
              == CipherSuite_AEAD
              &&
                s.val.case_CipherSuite._2.val.case_AEAD._0
                == EverCrypt_AES128_GCM
                && s.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_RSA_WITH_AES_128_GCM_SHA256 }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_DH
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_Some
          &&
            s.val.case_CipherSuite._1.v
            == CipherSuite_RSASIG
            &&
              s.val.case_CipherSuite._2.tag
              == CipherSuite_AEAD
              &&
                s.val.case_CipherSuite._2.val.case_AEAD._0
                == EverCrypt_AES256_GCM
                && s.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_384
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_RSA_WITH_AES_256_GCM_SHA384 }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_DHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_Some
          &&
            s.val.case_CipherSuite._1.v
            == CipherSuite_DSA
            &&
              s.val.case_CipherSuite._2.tag
              == CipherSuite_AEAD
              &&
                s.val.case_CipherSuite._2.val.case_AEAD._0
                == EverCrypt_AES128_GCM
                && s.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_128_GCM_SHA256 }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_DHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_Some
          &&
            s.val.case_CipherSuite._1.v
            == CipherSuite_DSA
            &&
              s.val.case_CipherSuite._2.tag
              == CipherSuite_AEAD
              &&
                s.val.case_CipherSuite._2.val.case_AEAD._0
                == EverCrypt_AES256_GCM
                && s.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_384
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_256_GCM_SHA384 }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_DH
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_Some
          &&
            s.val.case_CipherSuite._1.v
            == CipherSuite_DSA
            &&
              s.val.case_CipherSuite._2.tag
              == CipherSuite_AEAD
              &&
                s.val.case_CipherSuite._2.val.case_AEAD._0
                == EverCrypt_AES128_GCM
                && s.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_DSS_WITH_AES_128_GCM_SHA256 }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_DH
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_Some
          &&
            s.val.case_CipherSuite._1.v
            == CipherSuite_DSA
            &&
              s.val.case_CipherSuite._2.tag
              == CipherSuite_AEAD
              &&
                s.val.case_CipherSuite._2.val.case_AEAD._0
                == EverCrypt_AES256_GCM
                && s.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_384
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_DSS_WITH_AES_256_GCM_SHA384 }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_DHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_None
          &&
            s.val.case_CipherSuite._2.tag
            == CipherSuite_AEAD
            &&
              s.val.case_CipherSuite._2.val.case_AEAD._0
              == EverCrypt_AES128_GCM
              && s.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_anon_WITH_AES_128_GCM_SHA256 }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_DHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_None
          &&
            s.val.case_CipherSuite._2.tag
            == CipherSuite_AEAD
            &&
              s.val.case_CipherSuite._2.val.case_AEAD._0
              == EverCrypt_AES256_GCM
              && s.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_384
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_anon_WITH_AES_256_GCM_SHA384 }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_ECDHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_Some
          &&
            s.val.case_CipherSuite._1.v
            == CipherSuite_RSASIG
            &&
              s.val.case_CipherSuite._2.tag
              == CipherSuite_AEAD
              &&
                s.val.case_CipherSuite._2.val.case_AEAD._0
                == EverCrypt_CHACHA20_POLY1305
                && s.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = {
                .tag = Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256
              }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_ECDHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_Some
          &&
            s.val.case_CipherSuite._1.v
            == CipherSuite_ECDSA
            &&
              s.val.case_CipherSuite._2.tag
              == CipherSuite_AEAD
              &&
                s.val.case_CipherSuite._2.val.case_AEAD._0
                == EverCrypt_CHACHA20_POLY1305
                && s.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = {
                .tag = Parsers_CipherSuite_TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256
              }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_DHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_Some
          &&
            s.val.case_CipherSuite._1.v
            == CipherSuite_RSASIG
            &&
              s.val.case_CipherSuite._2.tag
              == CipherSuite_AEAD
              &&
                s.val.case_CipherSuite._2.val.case_AEAD._0
                == EverCrypt_CHACHA20_POLY1305
                && s.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = {
                .tag = Parsers_CipherSuite_TLS_DHE_RSA_WITH_CHACHA20_POLY1305_SHA256
              }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_PSK
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_None
          &&
            s.val.case_CipherSuite._2.tag
            == CipherSuite_AEAD
            &&
              s.val.case_CipherSuite._2.val.case_AEAD._0
              == EverCrypt_CHACHA20_POLY1305
              && s.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = { .tag = Parsers_CipherSuite_TLS_PSK_WITH_CHACHA20_POLY1305_SHA256 }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_PSK_ECDHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_None
          &&
            s.val.case_CipherSuite._2.tag
            == CipherSuite_AEAD
            &&
              s.val.case_CipherSuite._2.val.case_AEAD._0
              == EverCrypt_CHACHA20_POLY1305
              && s.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = {
                .tag = Parsers_CipherSuite_TLS_ECDHE_PSK_WITH_CHACHA20_POLY1305_SHA256
              }
            }
          }
        );
    else if
    (
      s.tag
      == CipherSuite_CipherSuite
      &&
        s.val.case_CipherSuite._0
        == CipherSuite_Kex_PSK_DHE
        &&
          s.val.case_CipherSuite._1.tag
          == FStar_Pervasives_Native_None
          &&
            s.val.case_CipherSuite._2.tag
            == CipherSuite_AEAD
            &&
              s.val.case_CipherSuite._2.val.case_AEAD._0
              == EverCrypt_CHACHA20_POLY1305
              && s.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
    )
      scrut =
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = {
                .tag = Parsers_CipherSuite_TLS_DHE_PSK_WITH_CHACHA20_POLY1305_SHA256
              }
            }
          }
        );
    else
      scrut =
        TLSError_fatal__Parsers_CipherSuite_cipherSuite(Parsers_AlertDescription_Illegal_parameter,
          FStar_Error_perror("CipherSuite.fsti",
            (krml_checked_int_t)290,
            "Invoked on a unknown ciphersuite"));
    Parsers_CipherSuite_cipherSuite ite;
    if (scrut.tag == FStar_Error_Correct)
      ite = scrut.val.case_Correct;
    else
      ite =
        KRML_EABORT(Parsers_CipherSuite_cipherSuite,
          "unreachable (pattern matches are exhaustive in F*)");
    if (FStar_List_Tot_Base_mem__Parsers_CipherSuite_cipherSuite(ite, l1))
    {
      FStar_Pervasives_Native_option__CipherSuite_sigAlg ite;
      if (s.tag == CipherSuite_CipherSuite)
        ite = s.val.case_CipherSuite._1;
      else
        ite =
          KRML_EABORT(FStar_Pervasives_Native_option__CipherSuite_sigAlg,
            "unreachable (pattern matches are exhaustive in F*)");
      return
        __eq__FStar_Pervasives_Native_option__CipherSuite_sigAlg(ite,
          (
            (FStar_Pervasives_Native_option__CipherSuite_sigAlg){
              .tag = FStar_Pervasives_Native_Some,
              .v = sa
            }
          ));
    }
    else
      return false;
  }
  else
    return false;
}

static FStar_Pervasives_Native_option__CipherSuite_cipherSuite_
List_Helpers_find_aux__CipherSuite_cipherSuite__Prims_list_Parsers_CipherSuite_cipherSuite___CipherSuite_sigAlg(
  K___Prims_list__Parsers_CipherSuite_cipherSuite_CipherSuite_sigAlg env,
  bool
  (*f)(
    K___Prims_list__Parsers_CipherSuite_cipherSuite_CipherSuite_sigAlg x0,
    CipherSuite_cipherSuite_ x1
  ),
  Prims_list__CipherSuite_cipherSuite_ *l
)
{
  if (l->tag == Prims_Nil)
    return
      (
        (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
          .tag = FStar_Pervasives_Native_None
        }
      );
  else if (l->tag == Prims_Cons)
  {
    Prims_list__CipherSuite_cipherSuite_ *tl1 = l->tl;
    CipherSuite_cipherSuite_ hd1 = l->hd;
    if (f(env, hd1))
      return
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = hd1
          }
        );
    else
      return
        List_Helpers_find_aux__CipherSuite_cipherSuite__Prims_list_Parsers_CipherSuite_cipherSuite___CipherSuite_sigAlg(env,
          f,
          tl1);
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

FStar_Pervasives_Native_option__CipherSuite_cipherSuite_
Negotiation_negotiate(
  Prims_list__Parsers_CipherSuite_cipherSuite *l1,
  Prims_list__CipherSuite_cipherSuite_ *l2,
  CipherSuite_sigAlg sa
)
{
  return
    List_Helpers_find_aux__CipherSuite_cipherSuite__Prims_list_Parsers_CipherSuite_cipherSuite___CipherSuite_sigAlg((
        (K___Prims_list__Parsers_CipherSuite_cipherSuite_CipherSuite_sigAlg){ .fst = l1, .snd = sa }
      ),
      Negotiation_is_cs_in_l,
      l2);
}

FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_K___CipherSuite_kexAlg_FStar_Pervasives_Native_option__CipherSuite_sigAlg_CipherSuite_aeAlg_CipherSuite_cipherSuite_
TLSError_fatal__CipherSuite_kexAlg___FStar_Pervasives_Native_option_CipherSuite_sigAlg___CipherSuite_aeAlg___CipherSuite_cipherSuite_(
  Parsers_AlertDescription_alertDescription a,
  Prims_string s
)
{
  return
    (
      (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_K___CipherSuite_kexAlg_FStar_Pervasives_Native_option__CipherSuite_sigAlg_CipherSuite_aeAlg_CipherSuite_cipherSuite_){
        .tag = FStar_Error_Error,
        .val = { .case_Error = { .fst = TLSError_fatalAlert(a), .snd = s } }
      }
    );
}

FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_K___CipherSuite_kexAlg_FStar_Pervasives_Native_option__CipherSuite_sigAlg_CipherSuite_aeAlg_CipherSuite_cipherSuite_
Negotiation_negotiateCipherSuite(
  TLSConstants_config cfg,
  Parsers_ProtocolVersion_protocolVersion pv,
  Prims_list__Parsers_CipherSuite_cipherSuite *ccs,
  CipherSuite_sigAlg sa
)
{
  FStar_Pervasives_Native_option__CipherSuite_cipherSuite_
  scrut = Negotiation_negotiate(ccs, cfg.cipher_suites, sa);
  if (scrut.tag == FStar_Pervasives_Native_Some && scrut.v.tag == CipherSuite_CipherSuite)
  {
    CipherSuite_aeAlg ae = scrut.v.val.case_CipherSuite._2;
    FStar_Pervasives_Native_option__CipherSuite_sigAlg sa1 = scrut.v.val.case_CipherSuite._1;
    CipherSuite_kexAlg kex = scrut.v.val.case_CipherSuite._0;
    return
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_K___CipherSuite_kexAlg_FStar_Pervasives_Native_option__CipherSuite_sigAlg_CipherSuite_aeAlg_CipherSuite_cipherSuite_){
          .tag = FStar_Error_Correct,
          .val = {
            .case_Correct = {
              .fst = kex,
              .snd = sa1,
              .thd = ae,
              .f3 = {
                .tag = CipherSuite_CipherSuite,
                .val = { .case_CipherSuite = { ._0 = kex, ._1 = sa1, ._2 = ae } }
              }
            }
          }
        }
      );
  }
  else if (scrut.tag == FStar_Pervasives_Native_None)
    return
      TLSError_fatal__CipherSuite_kexAlg___FStar_Pervasives_Native_option_CipherSuite_sigAlg___CipherSuite_aeAlg___CipherSuite_cipherSuite_(Parsers_AlertDescription_Internal_error,
        FStar_Error_perror("Negotiation.fst",
          (krml_checked_int_t)747,
          "Cipher suite negotiation failed"));
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

bool
Negotiation_isSentinelRandomValue(
  Parsers_ProtocolVersion_protocolVersion c_pv,
  Parsers_ProtocolVersion_protocolVersion s_pv,
  FStar_Bytes_bytes s_random
)
{
  FStar_Bytes_bytes down = FStar_Bytes_bytes_of_string("DOWNGRD");
  return
    TLSConstants_geqPV(c_pv,
      ((Parsers_ProtocolVersion_protocolVersion){ .tag = Parsers_ProtocolVersion_TLS_1p3 }))
    &&
      TLSConstants_geqPV((
          (Parsers_ProtocolVersion_protocolVersion){ .tag = Parsers_ProtocolVersion_TLS_1p2 }
        ),
        s_pv)
    && __eq__FStar_Bytes_bytes(FStar_Bytes_append(down, FStar_Bytes_abyte((uint8_t)1U)), s_random)
    ||
      TLSConstants_geqPV(c_pv,
        ((Parsers_ProtocolVersion_protocolVersion){ .tag = Parsers_ProtocolVersion_TLS_1p2 }))
      &&
        TLSConstants_geqPV((
            (Parsers_ProtocolVersion_protocolVersion){ .tag = Parsers_ProtocolVersion_TLS_1p1 }
          ),
          s_pv)
      && __eq__FStar_Bytes_bytes(FStar_Bytes_append(down, FStar_Bytes_abyte((uint8_t)0U)), s_random);
}

bool
Negotiation_acceptableVersion(
  TLSConstants_config cfg,
  Parsers_ProtocolVersion_protocolVersion pv,
  FStar_Bytes_bytes sr
)
{
  return
    TLSConstants_geqPV(pv,
      cfg.min_version)
    && TLSConstants_geqPV(cfg.max_version, pv)
    && !Negotiation_isSentinelRandomValue(cfg.max_version, pv, sr);
}

static bool __eq__CipherSuite_kexAlg(CipherSuite_kexAlg y, CipherSuite_kexAlg x)
{
  switch (x)
  {
    case CipherSuite_Kex_RSA:
      {
        switch (y)
        {
          case CipherSuite_Kex_RSA:
            {
              return true;
            }
          default:
            {
              return false;
            }
        }
        break;
      }
    case CipherSuite_Kex_DH:
      {
        switch (y)
        {
          case CipherSuite_Kex_DH:
            {
              return true;
            }
          default:
            {
              return false;
            }
        }
        break;
      }
    case CipherSuite_Kex_PSK:
      {
        switch (y)
        {
          case CipherSuite_Kex_PSK:
            {
              return true;
            }
          default:
            {
              return false;
            }
        }
        break;
      }
    case CipherSuite_Kex_PSK_DHE:
      {
        switch (y)
        {
          case CipherSuite_Kex_PSK_DHE:
            {
              return true;
            }
          default:
            {
              return false;
            }
        }
        break;
      }
    case CipherSuite_Kex_PSK_ECDHE:
      {
        switch (y)
        {
          case CipherSuite_Kex_PSK_ECDHE:
            {
              return true;
            }
          default:
            {
              return false;
            }
        }
        break;
      }
    case CipherSuite_Kex_DHE:
      {
        switch (y)
        {
          case CipherSuite_Kex_DHE:
            {
              return true;
            }
          default:
            {
              return false;
            }
        }
        break;
      }
    case CipherSuite_Kex_ECDHE:
      {
        switch (y)
        {
          case CipherSuite_Kex_ECDHE:
            {
              return true;
            }
          default:
            {
              return false;
            }
        }
        break;
      }
    default:
      {
        return false;
      }
  }
}

static bool
__eq__EverCrypt_block_cipher_alg(EverCrypt_block_cipher_alg y, EverCrypt_block_cipher_alg x)
{
  switch (x)
  {
    case EverCrypt_AES128_CBC:
      {
        switch (y)
        {
          case EverCrypt_AES128_CBC:
            {
              return true;
            }
          default:
            {
              return false;
            }
        }
        break;
      }
    case EverCrypt_AES256_CBC:
      {
        switch (y)
        {
          case EverCrypt_AES256_CBC:
            {
              return true;
            }
          default:
            {
              return false;
            }
        }
        break;
      }
    case EverCrypt_TDES_EDE_CBC:
      {
        switch (y)
        {
          case EverCrypt_TDES_EDE_CBC:
            {
              return true;
            }
          default:
            {
              return false;
            }
        }
        break;
      }
    default:
      {
        return false;
      }
  }
}

static bool
__eq__EverCrypt_stream_cipher_alg(EverCrypt_stream_cipher_alg y, EverCrypt_stream_cipher_alg x)
{
  switch (x)
  {
    case EverCrypt_RC4_128:
      {
        switch (y)
        {
          case EverCrypt_RC4_128:
            {
              return true;
            }
          default:
            {
              return false;
            }
        }
        break;
      }
    default:
      {
        return false;
      }
  }
}

static bool __eq__CipherSuite_encAlg(CipherSuite_encAlg y, CipherSuite_encAlg x)
{
  if (x.tag == CipherSuite_Block)
  {
    EverCrypt_block_cipher_alg x__0 = x.val.case_Block;
    if (y.tag == CipherSuite_Block)
    {
      EverCrypt_block_cipher_alg y__0 = y.val.case_Block;
      return true && __eq__EverCrypt_block_cipher_alg(y__0, x__0);
    }
    else
      return false;
  }
  else if (x.tag == CipherSuite_Stream)
  {
    EverCrypt_stream_cipher_alg x__0 = x.val.case_Stream;
    if (y.tag == CipherSuite_Stream)
    {
      EverCrypt_stream_cipher_alg y__0 = y.val.case_Stream;
      return true && __eq__EverCrypt_stream_cipher_alg(y__0, x__0);
    }
    else
      return false;
  }
  else
    return false;
}

static bool __eq__CipherSuite_aeAlg(CipherSuite_aeAlg y, CipherSuite_aeAlg x)
{
  if (x.tag == CipherSuite_MACOnly)
  {
    Spec_Hash_Definitions_hash_alg x__0 = x.val.case_MACOnly;
    if (y.tag == CipherSuite_MACOnly)
    {
      Spec_Hash_Definitions_hash_alg y__0 = y.val.case_MACOnly;
      return true && __eq__Spec_Hash_Definitions_hash_alg(y__0, x__0);
    }
    else
      return false;
  }
  else if (x.tag == CipherSuite_MtE)
  {
    Spec_Hash_Definitions_hash_alg x__1 = x.val.case_MtE._1;
    CipherSuite_encAlg x__0 = x.val.case_MtE._0;
    if (y.tag == CipherSuite_MtE)
    {
      Spec_Hash_Definitions_hash_alg y__1 = y.val.case_MtE._1;
      CipherSuite_encAlg y__0 = y.val.case_MtE._0;
      return
        true
        && __eq__CipherSuite_encAlg(y__0, x__0)
        && __eq__Spec_Hash_Definitions_hash_alg(y__1, x__1);
    }
    else
      return false;
  }
  else if (x.tag == CipherSuite_AEAD)
  {
    Spec_Hash_Definitions_hash_alg x__1 = x.val.case_AEAD._1;
    EverCrypt_aead_alg x__0 = x.val.case_AEAD._0;
    if (y.tag == CipherSuite_AEAD)
    {
      Spec_Hash_Definitions_hash_alg y__1 = y.val.case_AEAD._1;
      EverCrypt_aead_alg y__0 = y.val.case_AEAD._0;
      return
        true
        && __eq__EverCrypt_aead_alg(y__0, x__0)
        && __eq__Spec_Hash_Definitions_hash_alg(y__1, x__1);
    }
    else
      return false;
  }
  else
    return false;
}

bool __eq__CipherSuite_cipherSuite_(CipherSuite_cipherSuite_ y, CipherSuite_cipherSuite_ x)
{
  if (x.tag == CipherSuite_NullCipherSuite)
    if (y.tag == CipherSuite_NullCipherSuite)
      return true;
    else
      return false;
  else if (x.tag == CipherSuite_CipherSuite)
  {
    CipherSuite_aeAlg x__2 = x.val.case_CipherSuite._2;
    FStar_Pervasives_Native_option__CipherSuite_sigAlg x__1 = x.val.case_CipherSuite._1;
    CipherSuite_kexAlg x__0 = x.val.case_CipherSuite._0;
    if (y.tag == CipherSuite_CipherSuite)
    {
      CipherSuite_aeAlg y__2 = y.val.case_CipherSuite._2;
      FStar_Pervasives_Native_option__CipherSuite_sigAlg y__1 = y.val.case_CipherSuite._1;
      CipherSuite_kexAlg y__0 = y.val.case_CipherSuite._0;
      return
        true
        && __eq__CipherSuite_kexAlg(y__0, x__0)
        && __eq__FStar_Pervasives_Native_option__CipherSuite_sigAlg(y__1, x__1)
        && __eq__CipherSuite_aeAlg(y__2, x__2);
    }
    else
      return false;
  }
  else if (x.tag == CipherSuite_CipherSuite13)
  {
    Spec_Hash_Definitions_hash_alg x__1 = x.val.case_CipherSuite13._1;
    EverCrypt_aead_alg x__0 = x.val.case_CipherSuite13._0;
    if (y.tag == CipherSuite_CipherSuite13)
    {
      Spec_Hash_Definitions_hash_alg y__1 = y.val.case_CipherSuite13._1;
      EverCrypt_aead_alg y__0 = y.val.case_CipherSuite13._0;
      return
        true
        && __eq__EverCrypt_aead_alg(y__0, x__0)
        && __eq__Spec_Hash_Definitions_hash_alg(y__1, x__1);
    }
    else
      return false;
  }
  else if (x.tag == CipherSuite_SCSV)
    if (y.tag == CipherSuite_SCSV)
      return true;
    else
      return false;
  else
    return false;
}

bool Negotiation_is_cs(CipherSuite_cipherSuite_ cs, CipherSuite_cipherSuite_ x)
{
  return __eq__CipherSuite_cipherSuite_(x, cs);
}

static bool
FStar_Pervasives_Native_uu___is_Some__CipherSuite_cipherSuite_(
  FStar_Pervasives_Native_option__CipherSuite_cipherSuite_ projectee
)
{
  if (projectee.tag == FStar_Pervasives_Native_Some)
    return true;
  else
    return false;
}

static FStar_Pervasives_Native_option__CipherSuite_cipherSuite_
List_Helpers_find_aux__CipherSuite_cipherSuite__CipherSuite_cipherSuite_(
  CipherSuite_cipherSuite_ env,
  bool (*f)(CipherSuite_cipherSuite_ x0, CipherSuite_cipherSuite_ x1),
  Prims_list__CipherSuite_cipherSuite_ *l
)
{
  if (l->tag == Prims_Nil)
    return
      (
        (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
          .tag = FStar_Pervasives_Native_None
        }
      );
  else if (l->tag == Prims_Cons)
  {
    Prims_list__CipherSuite_cipherSuite_ *tl1 = l->tl;
    CipherSuite_cipherSuite_ hd1 = l->hd;
    if (f(env, hd1))
      return
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = hd1
          }
        );
    else
      return List_Helpers_find_aux__CipherSuite_cipherSuite__CipherSuite_cipherSuite_(env, f, tl1);
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

static bool
List_Helpers_exists_b_aux__CipherSuite_cipherSuite__CipherSuite_cipherSuite_(
  CipherSuite_cipherSuite_ env,
  bool (*f)(CipherSuite_cipherSuite_ x0, CipherSuite_cipherSuite_ x1),
  Prims_list__CipherSuite_cipherSuite_ *l
)
{
  return
    FStar_Pervasives_Native_uu___is_Some__CipherSuite_cipherSuite_(List_Helpers_find_aux__CipherSuite_cipherSuite__CipherSuite_cipherSuite_(env,
        f,
        l));
}

bool
Negotiation_acceptableCipherSuite(
  TLSConstants_config cfg,
  Parsers_ProtocolVersion_protocolVersion spv,
  CipherSuite_cipherSuite_ cs
)
{
  return
    List_Helpers_exists_b_aux__CipherSuite_cipherSuite__CipherSuite_cipherSuite_(cs,
      Negotiation_is_cs,
      cfg.cipher_suites);
}

bool Negotiation_is_share_eq(CommonDH_group_ g1, CommonDH_keyShareEntry share)
{
  CommonDH_group_ ite;
  if (share.tag == CommonDH_Share)
    ite = share.val.case_Share.g;
  else
    ite = KRML_EABORT(CommonDH_group_, "unreachable (pattern matches are exhaustive in F*)");
  return __eq__CommonDH_group_(ite, g1);
}

static FStar_Pervasives_Native_option__CommonDH_keyShareEntry
List_Helpers_find_aux__CommonDH_keyShareEntry_CommonDH_group_(
  CommonDH_group_ env,
  bool (*f)(CommonDH_group_ x0, CommonDH_keyShareEntry x1),
  Prims_list__CommonDH_keyShareEntry *l
)
{
  if (l->tag == Prims_Nil)
    return
      (
        (FStar_Pervasives_Native_option__CommonDH_keyShareEntry){
          .tag = FStar_Pervasives_Native_None
        }
      );
  else if (l->tag == Prims_Cons)
  {
    Prims_list__CommonDH_keyShareEntry *tl1 = l->tl;
    CommonDH_keyShareEntry hd1 = l->hd;
    if (f(env, hd1))
      return
        (
          (FStar_Pervasives_Native_option__CommonDH_keyShareEntry){
            .tag = FStar_Pervasives_Native_Some,
            .v = hd1
          }
        );
    else
      return List_Helpers_find_aux__CommonDH_keyShareEntry_CommonDH_group_(env, f, tl1);
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_
Negotiation_matching_share(
  FStar_Pervasives_Native_option__Prims_list__Extensions_extension_ cext,
  CommonDH_group_ g1
)
{
  if (cext.tag == FStar_Pervasives_Native_Some)
  {
    Prims_list__Extensions_extension_ *cext1 = cext.v;
    FStar_Pervasives_Native_option__Extensions_extension_
    scrut =
      FStar_List_Tot_Base_find__Extensions_extension_(Extensions_uu___is_E_key_share____,
        cext1);
    if
    (
      scrut.tag
      == FStar_Pervasives_Native_Some
      &&
        scrut.v.tag
        == Extensions_E_key_share
        && scrut.v.val.case_E_key_share.tag == CommonDH_ClientKeyShare
    )
    {
      Prims_list__CommonDH_keyShareEntry
      *shares = scrut.v.val.case_E_key_share.val.case_ClientKeyShare;
      FStar_Pervasives_Native_option__CommonDH_keyShareEntry
      scrut =
        List_Helpers_find_aux__CommonDH_keyShareEntry_CommonDH_group_(g1,
          Negotiation_is_share_eq,
          shares);
      if (scrut.tag == FStar_Pervasives_Native_Some && scrut.v.tag == CommonDH_Share)
      {
        CommonDH_pre_share_ gx = scrut.v.val.case_Share._1;
        CommonDH_group_ g2 = scrut.v.val.case_Share.g;
        return
          (
            (FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_){
              .tag = FStar_Pervasives_Native_Some,
              .v = { .fst = g2, .snd = gx }
            }
          );
      }
      else
        return
          (
            (FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_){
              .tag = FStar_Pervasives_Native_None
            }
          );
    }
    else
      return
        (
          (FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_){
            .tag = FStar_Pervasives_Native_None
          }
        );
  }
  else if (cext.tag == FStar_Pervasives_Native_None)
    return
      (
        (FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_){
          .tag = FStar_Pervasives_Native_None
        }
      );
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_K___CipherSuite_cipherSuite__Parsers_ProtocolVersion_protocolVersion
TLSError_fatal__CipherSuite_cipherSuite____Parsers_ProtocolVersion_protocolVersion(
  Parsers_AlertDescription_alertDescription a,
  Prims_string s
)
{
  return
    (
      (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_K___CipherSuite_cipherSuite__Parsers_ProtocolVersion_protocolVersion){
        .tag = FStar_Error_Error,
        .val = { .case_Error = { .fst = TLSError_fatalAlert(a), .snd = s } }
      }
    );
}

FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_mode
TLSError_fatal__Negotiation_mode(Parsers_AlertDescription_alertDescription a, Prims_string s)
{
  return
    (
      (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_mode){
        .tag = FStar_Error_Error,
        .val = { .case_Error = { .fst = TLSError_fatalAlert(a), .snd = s } }
      }
    );
}

Prims_int
FStar_List_Tot_Base_length__FStar_Bytes_bytes___uint32_t(
  Prims_list__K___FStar_Bytes_bytes_uint32_t *uu___4_154
)
{
  if (uu___4_154->tag == Prims_Nil)
    return (krml_checked_int_t)0;
  else if (uu___4_154->tag == Prims_Cons)
  {
    Prims_list__K___FStar_Bytes_bytes_uint32_t *tl1 = uu___4_154->tl;
    return
      Prims_op_Addition((krml_checked_int_t)1,
        FStar_List_Tot_Base_length__FStar_Bytes_bytes___uint32_t(tl1));
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_FStar_Pervasives_Native_option__Prims_int
TLSError_fatal__FStar_Pervasives_Native_option_Prims_int(
  Parsers_AlertDescription_alertDescription a,
  Prims_string s
)
{
  return
    (
      (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_FStar_Pervasives_Native_option__Prims_int){
        .tag = FStar_Error_Error,
        .val = { .case_Error = { .fst = TLSError_fatalAlert(a), .snd = s } }
      }
    );
}

typedef struct
K___FStar_Pervasives_Native_option__K___Prims_list__K___FStar_Bytes_bytes_uint32_t_Prims_int_FStar_Pervasives_Native_option__Prims_int_s
{
  FStar_Pervasives_Native_option__K___Prims_list__K___FStar_Bytes_bytes_uint32_t_Prims_int fst;
  FStar_Pervasives_Native_option__Prims_int snd;
}
K___FStar_Pervasives_Native_option__K___Prims_list__K___FStar_Bytes_bytes_uint32_t_Prims_int_FStar_Pervasives_Native_option__Prims_int;

typedef struct
K___Parsers_ProtocolVersion_protocolVersion_FStar_Pervasives_Native_option__CommonDH_keyShareEntry_s
{
  Parsers_ProtocolVersion_protocolVersion fst;
  FStar_Pervasives_Native_option__CommonDH_keyShareEntry snd;
}
K___Parsers_ProtocolVersion_protocolVersion_FStar_Pervasives_Native_option__CommonDH_keyShareEntry;

FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_mode
Negotiation_client_ServerHello(Negotiation_t ns, HandshakeMessages_sh sh)
{
  Negotiation_negotiationState scrut0 = ns.state[0U];
  if (scrut0.tag == Negotiation_C_HRR)
  {
    HandshakeMessages_ch offer = scrut0.val.case_C_HRR.n_offer;
    Parsers_ProtocolVersion_protocolVersion spv = sh.sh_protocol_version;
    FStar_Bytes_bytes sr = sh.sh_server_random;
    Parsers_CipherSuite_cipherSuite csn = sh.sh_cipher_suite;
    FStar_Pervasives_Native_option__Prims_list__Extensions_extension_ sext = sh.sh_extensions;
    FStar_Bytes_bytes ssid = sh.sh_sessionID;
    FStar_Pervasives_Native_option__Prims_list__Extensions_extension_ cext = offer.ch_extensions;
    bool
    resume1 =
      __eq__FStar_Bytes_bytes(ssid,
        offer.ch_sessionID)
      &&
        Prims_op_GreaterThan(FStar_UInt32_v(FStar_Bytes_len(offer.ch_sessionID)),
          (krml_checked_int_t)0);
    Negotiation_print(Prims_strcat("processing server extensions ",
        Negotiation_string_of_option_extensions(sext)));
    FStar_Pervasives_Native_option__CipherSuite_cipherSuite_ scrut0;
    if (csn.tag == Parsers_CipherSuite_TLS_NULL_WITH_NULL_NULL)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = { .tag = CipherSuite_NullCipherSuite }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_AES_128_GCM_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite13,
              .val = {
                .case_CipherSuite13 = {
                  ._0 = EverCrypt_AES128_GCM,
                  ._1 = Spec_Hash_Definitions_SHA2_256
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_AES_256_GCM_SHA384)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite13,
              .val = {
                .case_CipherSuite13 = {
                  ._0 = EverCrypt_AES256_GCM,
                  ._1 = Spec_Hash_Definitions_SHA2_384
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_CHACHA20_POLY1305_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite13,
              .val = {
                .case_CipherSuite13 = {
                  ._0 = EverCrypt_CHACHA20_POLY1305,
                  ._1 = Spec_Hash_Definitions_SHA2_256
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_AES_128_CCM_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite13,
              .val = {
                .case_CipherSuite13 = {
                  ._0 = EverCrypt_AES128_CCM,
                  ._1 = Spec_Hash_Definitions_SHA2_256
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_AES_128_CCM_8_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite13,
              .val = {
                .case_CipherSuite13 = {
                  ._0 = EverCrypt_AES128_CCM8,
                  ._1 = Spec_Hash_Definitions_SHA2_256
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_RSA_WITH_NULL_MD5)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_RSA,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MACOnly,
                    .val = { .case_MACOnly = Spec_Hash_Definitions_MD5 }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_RSA_WITH_NULL_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_RSA,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MACOnly,
                    .val = { .case_MACOnly = Spec_Hash_Definitions_SHA1 }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_RSA_WITH_NULL_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_RSA,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MACOnly,
                    .val = { .case_MACOnly = Spec_Hash_Definitions_SHA2_256 }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_RSA_WITH_RC4_128_MD5)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_RSA,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Stream,
                          .val = { .case_Stream = EverCrypt_RC4_128 }
                        },
                        ._1 = Spec_Hash_Definitions_MD5
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_RSA_WITH_RC4_128_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_RSA,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Stream,
                          .val = { .case_Stream = EverCrypt_RC4_128 }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_RSA_WITH_3DES_EDE_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_RSA,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_TDES_EDE_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_RSA_WITH_AES_128_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_RSA,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES128_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_RSA_WITH_AES_256_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_RSA,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES256_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_RSA_WITH_AES_128_CBC_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_RSA,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES128_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_RSA_WITH_AES_256_CBC_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_RSA,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES256_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_DSS_WITH_3DES_EDE_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_DSA },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_TDES_EDE_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_RSA_WITH_3DES_EDE_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_TDES_EDE_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_128_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_DSA },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES128_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_128_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES128_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_256_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_DSA },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES256_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_256_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES256_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_128_CBC_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_DSA },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES128_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_128_CBC_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES128_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_256_CBC_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_DSA },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES256_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_256_CBC_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES256_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_RC4_128_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Stream,
                          .val = { .case_Stream = EverCrypt_RC4_128 }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_TDES_EDE_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES128_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES128_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES256_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES256_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA2_384
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_ECDSA },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES128_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES128_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_ECDSA },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES256_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_384
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES256_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_384
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DH_anon_WITH_RC4_128_MD5)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Stream,
                          .val = { .case_Stream = EverCrypt_RC4_128 }
                        },
                        ._1 = Spec_Hash_Definitions_MD5
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DH_anon_WITH_3DES_EDE_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_TDES_EDE_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DH_anon_WITH_AES_128_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES128_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DH_anon_WITH_AES_256_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES256_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DH_anon_WITH_AES_128_CBC_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES128_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DH_anon_WITH_AES_256_CBC_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES256_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_RSA_WITH_AES_128_GCM_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_RSA,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES128_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_RSA_WITH_AES_256_GCM_SHA384)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_RSA,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES256_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_384
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_128_GCM_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES128_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_256_GCM_SHA384)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES256_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_384
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DH_RSA_WITH_AES_128_GCM_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DH,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES128_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DH_RSA_WITH_AES_256_GCM_SHA384)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DH,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES256_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_384
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_128_GCM_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_DSA },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES128_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_256_GCM_SHA384)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_DSA },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES256_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_384
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DH_DSS_WITH_AES_128_GCM_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DH,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_DSA },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES128_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DH_DSS_WITH_AES_256_GCM_SHA384)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DH,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_DSA },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES256_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_384
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DH_anon_WITH_AES_128_GCM_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES128_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DH_anon_WITH_AES_256_GCM_SHA384)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES256_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_384
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_CHACHA20_POLY1305,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_ECDSA },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_CHACHA20_POLY1305,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_RSA_WITH_CHACHA20_POLY1305_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_CHACHA20_POLY1305,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_PSK_WITH_CHACHA20_POLY1305_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_PSK,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_CHACHA20_POLY1305,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_PSK_WITH_CHACHA20_POLY1305_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_PSK_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_CHACHA20_POLY1305,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_PSK_WITH_CHACHA20_POLY1305_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_PSK_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_CHACHA20_POLY1305,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_None
          }
        );
    FStar_Pervasives_Native_option__CipherSuite_cipherSuite_ scrut1;
    if (scrut0.tag == FStar_Pervasives_Native_Some)
    {
      CipherSuite_cipherSuite_ v1 = scrut0.v;
      scrut1 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = v1
          }
        );
    }
    else if (scrut0.tag == FStar_Pervasives_Native_None)
      scrut1 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_None
          }
        );
    else
      scrut1 =
        KRML_EABORT(FStar_Pervasives_Native_option__CipherSuite_cipherSuite_,
          "unreachable (pattern matches are exhaustive in F*)");
    FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_K___CipherSuite_cipherSuite__Parsers_ProtocolVersion_protocolVersion
    nego;
    if (scrut1.tag == FStar_Pervasives_Native_Some)
    {
      CipherSuite_cipherSuite_ cs = scrut1.v;
      FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_ProtocolVersion_protocolVersion
      scrut =
        Extensions_negotiateClientExtensions(spv,
          ns.cfg,
          cext,
          sext,
          cs,
          (
            (FStar_Pervasives_Native_option__K___FStar_Bytes_bytes_FStar_Bytes_bytes){
              .tag = FStar_Pervasives_Native_None
            }
          ),
          resume1);
      if (scrut.tag == FStar_Error_Error)
      {
        K___Parsers_Alert_alert_Prims_string z = scrut.val.case_Error;
        nego =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_K___CipherSuite_cipherSuite__Parsers_ProtocolVersion_protocolVersion){
              .tag = FStar_Error_Error,
              .val = { .case_Error = z }
            }
          );
      }
      else if (scrut.tag == FStar_Error_Correct)
      {
        Parsers_ProtocolVersion_protocolVersion spv1 = scrut.val.case_Correct;
        nego =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_K___CipherSuite_cipherSuite__Parsers_ProtocolVersion_protocolVersion){
              .tag = FStar_Error_Correct,
              .val = { .case_Correct = { .fst = cs, .snd = spv1 } }
            }
          );
      }
      else
        nego =
          KRML_EABORT(FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_K___CipherSuite_cipherSuite__Parsers_ProtocolVersion_protocolVersion,
            "unreachable (pattern matches are exhaustive in F*)");
    }
    else if (scrut1.tag == FStar_Pervasives_Native_None)
      nego =
        TLSError_fatal__CipherSuite_cipherSuite____Parsers_ProtocolVersion_protocolVersion(Parsers_AlertDescription_Illegal_parameter,
          FStar_Error_perror("Negotiation.fst", (krml_checked_int_t)889, "Server cipherSuite"));
    else
      nego =
        KRML_EABORT(FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_K___CipherSuite_cipherSuite__Parsers_ProtocolVersion_protocolVersion,
          "unreachable (pattern matches are exhaustive in F*)");
    if (nego.tag == FStar_Error_Error)
    {
      K___Parsers_Alert_alert_Prims_string z = nego.val.case_Error;
      return
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_mode){
            .tag = FStar_Error_Error,
            .val = { .case_Error = z }
          }
        );
    }
    else if (nego.tag == FStar_Error_Correct)
    {
      Parsers_ProtocolVersion_protocolVersion spv1 = nego.val.case_Correct.snd;
      CipherSuite_cipherSuite_ cs = nego.val.case_Correct.fst;
      if (!Negotiation_acceptableVersion(ns.cfg, spv1, sr))
        return
          TLSError_fatal__Negotiation_mode(Parsers_AlertDescription_Illegal_parameter,
            FStar_Error_perror("Negotiation.fst",
              (krml_checked_int_t)895,
              "Protocol version negotiation"));
      else if (!Negotiation_acceptableCipherSuite(ns.cfg, spv1, cs))
        return
          TLSError_fatal__Negotiation_mode(Parsers_AlertDescription_Illegal_parameter,
            FStar_Error_perror("Negotiation.fst",
              (krml_checked_int_t)897,
              "Ciphersuite negotiation"));
      else
      {
        Negotiation_print(Prims_strcat("negotiated ",
            Prims_strcat(Parsers_ProtocolVersion_string_of_protocolVersion(spv1),
              Prims_strcat(" ", Negotiation_string_of_ciphersuite(cs)))));
        if (cs.tag == CipherSuite_CipherSuite13)
        {
          K___FStar_Pervasives_Native_option__K___Prims_list__K___FStar_Bytes_bytes_uint32_t_Prims_int_FStar_Pervasives_Native_option__Prims_int
          scrut0 =
            { .fst = Negotiation_find_clientPske(offer), .snd = Negotiation_find_serverPske(sh) };
          FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_FStar_Pervasives_Native_option__Prims_int
          pski;
          if
          (
            scrut0.fst.tag
            == FStar_Pervasives_Native_Some
            && scrut0.snd.tag == FStar_Pervasives_Native_Some
          )
          {
            Prims_int idx1 = scrut0.snd.v;
            Prims_list__K___FStar_Bytes_bytes_uint32_t *ids = scrut0.fst.v.fst;
            if
            (Prims_op_LessThan(idx1, FStar_List_Tot_Base_length__FStar_Bytes_bytes___uint32_t(ids)))
              pski =
                (
                  (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_FStar_Pervasives_Native_option__Prims_int){
                    .tag = FStar_Error_Correct,
                    .val = { .case_Correct = { .tag = FStar_Pervasives_Native_Some, .v = idx1 } }
                  }
                );
            else
              pski =
                TLSError_fatal__FStar_Pervasives_Native_option_Prims_int(Parsers_AlertDescription_Illegal_parameter,
                  FStar_Error_perror("Negotiation.fst",
                    (krml_checked_int_t)909,
                    "PSK out of bounds"));
          }
          else if
          (
            scrut0.fst.tag
            == FStar_Pervasives_Native_None
            && scrut0.snd.tag == FStar_Pervasives_Native_Some
          )
            pski =
              TLSError_fatal__FStar_Pervasives_Native_option_Prims_int(Parsers_AlertDescription_Illegal_parameter,
                FStar_Error_perror("Negotiation.fst", (krml_checked_int_t)911, "PSK not offered"));
          else
            pski =
              (
                (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_FStar_Pervasives_Native_option__Prims_int){
                  .tag = FStar_Error_Correct,
                  .val = { .case_Correct = { .tag = FStar_Pervasives_Native_None } }
                }
              );
          if (pski.tag == FStar_Error_Error)
          {
            K___Parsers_Alert_alert_Prims_string z = pski.val.case_Error;
            return
              (
                (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_mode){
                  .tag = FStar_Error_Error,
                  .val = { .case_Error = z }
                }
              );
          }
          else if (pski.tag == FStar_Error_Correct)
          {
            FStar_Pervasives_Native_option__Prims_int pski1 = pski.val.case_Correct;
            K___Parsers_ProtocolVersion_protocolVersion_FStar_Pervasives_Native_option__CommonDH_keyShareEntry
            scrut = { .fst = spv1, .snd = Negotiation_find_serverKeyShare(sh) };
            if
            (
              scrut.fst.tag
              == Parsers_ProtocolVersion_TLS_1p3
              && scrut.snd.tag == FStar_Pervasives_Native_Some && scrut.snd.v.tag == CommonDH_Share
            )
            {
              CommonDH_pre_share_ gy = scrut.snd.v.val.case_Share._1;
              CommonDH_group_ g1 = scrut.snd.v.val.case_Share.g;
              Prims_dtuple2__CommonDH_group__CommonDH_pre_share_
              server_share = { .fst = g1, .snd = gy };
              FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_
              client_share = Negotiation_matching_share(cext, g1);
              Negotiation_mode
              mode =
                {
                  .n_offer = offer, .n_hrr = { .tag = FStar_Pervasives_Native_None },
                  .n_protocol_version = spv1, .n_server_random = sr, .n_sessionID = ssid,
                  .n_cipher_suite = cs, .n_pski = pski1, .n_server_extensions = sext,
                  .n_server_share = { .tag = FStar_Pervasives_Native_Some, .v = server_share },
                  .n_client_cert_request = { .tag = FStar_Pervasives_Native_None },
                  .n_server_cert = { .tag = FStar_Pervasives_Native_None },
                  .n_client_share = client_share
                };
              ns.state[0U] =
                (
                  (Negotiation_negotiationState){
                    .tag = Negotiation_C_Mode,
                    .val = { .case_C_Mode = mode }
                  }
                );
              return
                (
                  (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_mode){
                    .tag = FStar_Error_Correct,
                    .val = { .case_Correct = mode }
                  }
                );
            }
            else if
            (
              scrut.fst.tag
              == Parsers_ProtocolVersion_TLS_1p3
              && scrut.snd.tag == FStar_Pervasives_Native_None
            )
            {
              Negotiation_mode
              mode =
                {
                  .n_offer = offer, .n_hrr = { .tag = FStar_Pervasives_Native_None },
                  .n_protocol_version = spv1, .n_server_random = sr, .n_sessionID = ssid,
                  .n_cipher_suite = cs, .n_pski = pski1, .n_server_extensions = sext,
                  .n_server_share = { .tag = FStar_Pervasives_Native_None },
                  .n_client_cert_request = { .tag = FStar_Pervasives_Native_None },
                  .n_server_cert = { .tag = FStar_Pervasives_Native_None },
                  .n_client_share = { .tag = FStar_Pervasives_Native_None }
                };
              ns.state[0U] =
                (
                  (Negotiation_negotiationState){
                    .tag = Negotiation_C_Mode,
                    .val = { .case_C_Mode = mode }
                  }
                );
              return
                (
                  (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_mode){
                    .tag = FStar_Error_Correct,
                    .val = { .case_Correct = mode }
                  }
                );
            }
            else
              return
                TLSError_fatal__Negotiation_mode(Parsers_AlertDescription_Illegal_parameter,
                  FStar_Error_perror("Negotiation.fst",
                    (krml_checked_int_t)944,
                    "Impossible: TLS 1.3 PSK"));
          }
          else
          {
            KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
              __FILE__,
              __LINE__,
              "unreachable (pattern matches are exhaustive in F*)");
            KRML_HOST_EXIT(255U);
          }
        }
        else if (cs.tag == CipherSuite_CipherSuite)
        {
          Negotiation_mode
          mode =
            {
              .n_offer = offer, .n_hrr = { .tag = FStar_Pervasives_Native_None },
              .n_protocol_version = spv1, .n_server_random = sr, .n_sessionID = ssid,
              .n_cipher_suite = cs, .n_pski = { .tag = FStar_Pervasives_Native_None },
              .n_server_extensions = sext, .n_server_share = { .tag = FStar_Pervasives_Native_None },
              .n_client_cert_request = { .tag = FStar_Pervasives_Native_None },
              .n_server_cert = { .tag = FStar_Pervasives_Native_None },
              .n_client_share = { .tag = FStar_Pervasives_Native_None }
            };
          ns.state[0U] =
            (
              (Negotiation_negotiationState){
                .tag = Negotiation_C_Mode,
                .val = { .case_C_Mode = mode }
              }
            );
          return
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_mode){
                .tag = FStar_Error_Correct,
                .val = { .case_Correct = mode }
              }
            );
        }
        else
          return
            TLSError_fatal__Negotiation_mode(Parsers_AlertDescription_Decode_error,
              "ServerHello ciphersuite is not a real ciphersuite");
      }
    }
    else
    {
      KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
        __FILE__,
        __LINE__,
        "unreachable (pattern matches are exhaustive in F*)");
      KRML_HOST_EXIT(255U);
    }
  }
  else if (scrut0.tag == Negotiation_C_Offer)
  {
    HandshakeMessages_ch offer = scrut0.val.case_C_Offer;
    Parsers_ProtocolVersion_protocolVersion spv = sh.sh_protocol_version;
    FStar_Bytes_bytes sr = sh.sh_server_random;
    Parsers_CipherSuite_cipherSuite csn = sh.sh_cipher_suite;
    FStar_Pervasives_Native_option__Prims_list__Extensions_extension_ sext = sh.sh_extensions;
    FStar_Bytes_bytes ssid = sh.sh_sessionID;
    FStar_Pervasives_Native_option__Prims_list__Extensions_extension_ cext = offer.ch_extensions;
    bool
    resume1 =
      __eq__FStar_Bytes_bytes(ssid,
        offer.ch_sessionID)
      &&
        Prims_op_GreaterThan(FStar_UInt32_v(FStar_Bytes_len(offer.ch_sessionID)),
          (krml_checked_int_t)0);
    Negotiation_print(Prims_strcat("processing server extensions ",
        Negotiation_string_of_option_extensions(sext)));
    FStar_Pervasives_Native_option__CipherSuite_cipherSuite_ scrut0;
    if (csn.tag == Parsers_CipherSuite_TLS_NULL_WITH_NULL_NULL)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = { .tag = CipherSuite_NullCipherSuite }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_AES_128_GCM_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite13,
              .val = {
                .case_CipherSuite13 = {
                  ._0 = EverCrypt_AES128_GCM,
                  ._1 = Spec_Hash_Definitions_SHA2_256
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_AES_256_GCM_SHA384)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite13,
              .val = {
                .case_CipherSuite13 = {
                  ._0 = EverCrypt_AES256_GCM,
                  ._1 = Spec_Hash_Definitions_SHA2_384
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_CHACHA20_POLY1305_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite13,
              .val = {
                .case_CipherSuite13 = {
                  ._0 = EverCrypt_CHACHA20_POLY1305,
                  ._1 = Spec_Hash_Definitions_SHA2_256
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_AES_128_CCM_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite13,
              .val = {
                .case_CipherSuite13 = {
                  ._0 = EverCrypt_AES128_CCM,
                  ._1 = Spec_Hash_Definitions_SHA2_256
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_AES_128_CCM_8_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite13,
              .val = {
                .case_CipherSuite13 = {
                  ._0 = EverCrypt_AES128_CCM8,
                  ._1 = Spec_Hash_Definitions_SHA2_256
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_RSA_WITH_NULL_MD5)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_RSA,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MACOnly,
                    .val = { .case_MACOnly = Spec_Hash_Definitions_MD5 }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_RSA_WITH_NULL_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_RSA,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MACOnly,
                    .val = { .case_MACOnly = Spec_Hash_Definitions_SHA1 }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_RSA_WITH_NULL_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_RSA,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MACOnly,
                    .val = { .case_MACOnly = Spec_Hash_Definitions_SHA2_256 }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_RSA_WITH_RC4_128_MD5)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_RSA,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Stream,
                          .val = { .case_Stream = EverCrypt_RC4_128 }
                        },
                        ._1 = Spec_Hash_Definitions_MD5
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_RSA_WITH_RC4_128_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_RSA,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Stream,
                          .val = { .case_Stream = EverCrypt_RC4_128 }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_RSA_WITH_3DES_EDE_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_RSA,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_TDES_EDE_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_RSA_WITH_AES_128_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_RSA,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES128_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_RSA_WITH_AES_256_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_RSA,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES256_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_RSA_WITH_AES_128_CBC_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_RSA,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES128_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_RSA_WITH_AES_256_CBC_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_RSA,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES256_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_DSS_WITH_3DES_EDE_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_DSA },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_TDES_EDE_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_RSA_WITH_3DES_EDE_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_TDES_EDE_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_128_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_DSA },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES128_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_128_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES128_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_256_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_DSA },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES256_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_256_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES256_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_128_CBC_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_DSA },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES128_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_128_CBC_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES128_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_256_CBC_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_DSA },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES256_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_256_CBC_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES256_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_RC4_128_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Stream,
                          .val = { .case_Stream = EverCrypt_RC4_128 }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_TDES_EDE_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES128_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES128_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES256_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES256_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA2_384
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_ECDSA },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES128_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES128_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_ECDSA },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES256_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_384
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES256_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_384
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DH_anon_WITH_RC4_128_MD5)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Stream,
                          .val = { .case_Stream = EverCrypt_RC4_128 }
                        },
                        ._1 = Spec_Hash_Definitions_MD5
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DH_anon_WITH_3DES_EDE_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_TDES_EDE_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DH_anon_WITH_AES_128_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES128_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DH_anon_WITH_AES_256_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES256_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DH_anon_WITH_AES_128_CBC_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES128_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DH_anon_WITH_AES_256_CBC_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES256_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_RSA_WITH_AES_128_GCM_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_RSA,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES128_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_RSA_WITH_AES_256_GCM_SHA384)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_RSA,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES256_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_384
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_128_GCM_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES128_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_256_GCM_SHA384)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES256_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_384
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DH_RSA_WITH_AES_128_GCM_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DH,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES128_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DH_RSA_WITH_AES_256_GCM_SHA384)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DH,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES256_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_384
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_128_GCM_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_DSA },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES128_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_256_GCM_SHA384)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_DSA },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES256_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_384
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DH_DSS_WITH_AES_128_GCM_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DH,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_DSA },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES128_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DH_DSS_WITH_AES_256_GCM_SHA384)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DH,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_DSA },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES256_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_384
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DH_anon_WITH_AES_128_GCM_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES128_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DH_anon_WITH_AES_256_GCM_SHA384)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES256_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_384
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_CHACHA20_POLY1305,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_ECDSA },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_CHACHA20_POLY1305,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_RSA_WITH_CHACHA20_POLY1305_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_CHACHA20_POLY1305,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_PSK_WITH_CHACHA20_POLY1305_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_PSK,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_CHACHA20_POLY1305,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_PSK_WITH_CHACHA20_POLY1305_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_PSK_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_CHACHA20_POLY1305,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_PSK_WITH_CHACHA20_POLY1305_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_PSK_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_CHACHA20_POLY1305,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_None
          }
        );
    FStar_Pervasives_Native_option__CipherSuite_cipherSuite_ scrut1;
    if (scrut0.tag == FStar_Pervasives_Native_Some)
    {
      CipherSuite_cipherSuite_ v1 = scrut0.v;
      scrut1 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = v1
          }
        );
    }
    else if (scrut0.tag == FStar_Pervasives_Native_None)
      scrut1 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_None
          }
        );
    else
      scrut1 =
        KRML_EABORT(FStar_Pervasives_Native_option__CipherSuite_cipherSuite_,
          "unreachable (pattern matches are exhaustive in F*)");
    FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_K___CipherSuite_cipherSuite__Parsers_ProtocolVersion_protocolVersion
    nego;
    if (scrut1.tag == FStar_Pervasives_Native_Some)
    {
      CipherSuite_cipherSuite_ cs = scrut1.v;
      FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_ProtocolVersion_protocolVersion
      scrut =
        Extensions_negotiateClientExtensions(spv,
          ns.cfg,
          cext,
          sext,
          cs,
          (
            (FStar_Pervasives_Native_option__K___FStar_Bytes_bytes_FStar_Bytes_bytes){
              .tag = FStar_Pervasives_Native_None
            }
          ),
          resume1);
      if (scrut.tag == FStar_Error_Error)
      {
        K___Parsers_Alert_alert_Prims_string z = scrut.val.case_Error;
        nego =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_K___CipherSuite_cipherSuite__Parsers_ProtocolVersion_protocolVersion){
              .tag = FStar_Error_Error,
              .val = { .case_Error = z }
            }
          );
      }
      else if (scrut.tag == FStar_Error_Correct)
      {
        Parsers_ProtocolVersion_protocolVersion spv1 = scrut.val.case_Correct;
        nego =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_K___CipherSuite_cipherSuite__Parsers_ProtocolVersion_protocolVersion){
              .tag = FStar_Error_Correct,
              .val = { .case_Correct = { .fst = cs, .snd = spv1 } }
            }
          );
      }
      else
        nego =
          KRML_EABORT(FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_K___CipherSuite_cipherSuite__Parsers_ProtocolVersion_protocolVersion,
            "unreachable (pattern matches are exhaustive in F*)");
    }
    else if (scrut1.tag == FStar_Pervasives_Native_None)
      nego =
        TLSError_fatal__CipherSuite_cipherSuite____Parsers_ProtocolVersion_protocolVersion(Parsers_AlertDescription_Illegal_parameter,
          FStar_Error_perror("Negotiation.fst", (krml_checked_int_t)889, "Server cipherSuite"));
    else
      nego =
        KRML_EABORT(FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_K___CipherSuite_cipherSuite__Parsers_ProtocolVersion_protocolVersion,
          "unreachable (pattern matches are exhaustive in F*)");
    if (nego.tag == FStar_Error_Error)
    {
      K___Parsers_Alert_alert_Prims_string z = nego.val.case_Error;
      return
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_mode){
            .tag = FStar_Error_Error,
            .val = { .case_Error = z }
          }
        );
    }
    else if (nego.tag == FStar_Error_Correct)
    {
      Parsers_ProtocolVersion_protocolVersion spv1 = nego.val.case_Correct.snd;
      CipherSuite_cipherSuite_ cs = nego.val.case_Correct.fst;
      if (!Negotiation_acceptableVersion(ns.cfg, spv1, sr))
        return
          TLSError_fatal__Negotiation_mode(Parsers_AlertDescription_Illegal_parameter,
            FStar_Error_perror("Negotiation.fst",
              (krml_checked_int_t)895,
              "Protocol version negotiation"));
      else if (!Negotiation_acceptableCipherSuite(ns.cfg, spv1, cs))
        return
          TLSError_fatal__Negotiation_mode(Parsers_AlertDescription_Illegal_parameter,
            FStar_Error_perror("Negotiation.fst",
              (krml_checked_int_t)897,
              "Ciphersuite negotiation"));
      else
      {
        Negotiation_print(Prims_strcat("negotiated ",
            Prims_strcat(Parsers_ProtocolVersion_string_of_protocolVersion(spv1),
              Prims_strcat(" ", Negotiation_string_of_ciphersuite(cs)))));
        if (cs.tag == CipherSuite_CipherSuite13)
        {
          K___FStar_Pervasives_Native_option__K___Prims_list__K___FStar_Bytes_bytes_uint32_t_Prims_int_FStar_Pervasives_Native_option__Prims_int
          scrut0 =
            { .fst = Negotiation_find_clientPske(offer), .snd = Negotiation_find_serverPske(sh) };
          FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_FStar_Pervasives_Native_option__Prims_int
          pski;
          if
          (
            scrut0.fst.tag
            == FStar_Pervasives_Native_Some
            && scrut0.snd.tag == FStar_Pervasives_Native_Some
          )
          {
            Prims_int idx1 = scrut0.snd.v;
            Prims_list__K___FStar_Bytes_bytes_uint32_t *ids = scrut0.fst.v.fst;
            if
            (Prims_op_LessThan(idx1, FStar_List_Tot_Base_length__FStar_Bytes_bytes___uint32_t(ids)))
              pski =
                (
                  (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_FStar_Pervasives_Native_option__Prims_int){
                    .tag = FStar_Error_Correct,
                    .val = { .case_Correct = { .tag = FStar_Pervasives_Native_Some, .v = idx1 } }
                  }
                );
            else
              pski =
                TLSError_fatal__FStar_Pervasives_Native_option_Prims_int(Parsers_AlertDescription_Illegal_parameter,
                  FStar_Error_perror("Negotiation.fst",
                    (krml_checked_int_t)909,
                    "PSK out of bounds"));
          }
          else if
          (
            scrut0.fst.tag
            == FStar_Pervasives_Native_None
            && scrut0.snd.tag == FStar_Pervasives_Native_Some
          )
            pski =
              TLSError_fatal__FStar_Pervasives_Native_option_Prims_int(Parsers_AlertDescription_Illegal_parameter,
                FStar_Error_perror("Negotiation.fst", (krml_checked_int_t)911, "PSK not offered"));
          else
            pski =
              (
                (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_FStar_Pervasives_Native_option__Prims_int){
                  .tag = FStar_Error_Correct,
                  .val = { .case_Correct = { .tag = FStar_Pervasives_Native_None } }
                }
              );
          if (pski.tag == FStar_Error_Error)
          {
            K___Parsers_Alert_alert_Prims_string z = pski.val.case_Error;
            return
              (
                (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_mode){
                  .tag = FStar_Error_Error,
                  .val = { .case_Error = z }
                }
              );
          }
          else if (pski.tag == FStar_Error_Correct)
          {
            FStar_Pervasives_Native_option__Prims_int pski1 = pski.val.case_Correct;
            K___Parsers_ProtocolVersion_protocolVersion_FStar_Pervasives_Native_option__CommonDH_keyShareEntry
            scrut = { .fst = spv1, .snd = Negotiation_find_serverKeyShare(sh) };
            if
            (
              scrut.fst.tag
              == Parsers_ProtocolVersion_TLS_1p3
              && scrut.snd.tag == FStar_Pervasives_Native_Some && scrut.snd.v.tag == CommonDH_Share
            )
            {
              CommonDH_pre_share_ gy = scrut.snd.v.val.case_Share._1;
              CommonDH_group_ g1 = scrut.snd.v.val.case_Share.g;
              Prims_dtuple2__CommonDH_group__CommonDH_pre_share_
              server_share = { .fst = g1, .snd = gy };
              FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_
              client_share = Negotiation_matching_share(cext, g1);
              Negotiation_mode
              mode =
                {
                  .n_offer = offer, .n_hrr = { .tag = FStar_Pervasives_Native_None },
                  .n_protocol_version = spv1, .n_server_random = sr, .n_sessionID = ssid,
                  .n_cipher_suite = cs, .n_pski = pski1, .n_server_extensions = sext,
                  .n_server_share = { .tag = FStar_Pervasives_Native_Some, .v = server_share },
                  .n_client_cert_request = { .tag = FStar_Pervasives_Native_None },
                  .n_server_cert = { .tag = FStar_Pervasives_Native_None },
                  .n_client_share = client_share
                };
              ns.state[0U] =
                (
                  (Negotiation_negotiationState){
                    .tag = Negotiation_C_Mode,
                    .val = { .case_C_Mode = mode }
                  }
                );
              return
                (
                  (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_mode){
                    .tag = FStar_Error_Correct,
                    .val = { .case_Correct = mode }
                  }
                );
            }
            else if
            (
              scrut.fst.tag
              == Parsers_ProtocolVersion_TLS_1p3
              && scrut.snd.tag == FStar_Pervasives_Native_None
            )
            {
              Negotiation_mode
              mode =
                {
                  .n_offer = offer, .n_hrr = { .tag = FStar_Pervasives_Native_None },
                  .n_protocol_version = spv1, .n_server_random = sr, .n_sessionID = ssid,
                  .n_cipher_suite = cs, .n_pski = pski1, .n_server_extensions = sext,
                  .n_server_share = { .tag = FStar_Pervasives_Native_None },
                  .n_client_cert_request = { .tag = FStar_Pervasives_Native_None },
                  .n_server_cert = { .tag = FStar_Pervasives_Native_None },
                  .n_client_share = { .tag = FStar_Pervasives_Native_None }
                };
              ns.state[0U] =
                (
                  (Negotiation_negotiationState){
                    .tag = Negotiation_C_Mode,
                    .val = { .case_C_Mode = mode }
                  }
                );
              return
                (
                  (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_mode){
                    .tag = FStar_Error_Correct,
                    .val = { .case_Correct = mode }
                  }
                );
            }
            else
              return
                TLSError_fatal__Negotiation_mode(Parsers_AlertDescription_Illegal_parameter,
                  FStar_Error_perror("Negotiation.fst",
                    (krml_checked_int_t)944,
                    "Impossible: TLS 1.3 PSK"));
          }
          else
          {
            KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
              __FILE__,
              __LINE__,
              "unreachable (pattern matches are exhaustive in F*)");
            KRML_HOST_EXIT(255U);
          }
        }
        else if (cs.tag == CipherSuite_CipherSuite)
        {
          Negotiation_mode
          mode =
            {
              .n_offer = offer, .n_hrr = { .tag = FStar_Pervasives_Native_None },
              .n_protocol_version = spv1, .n_server_random = sr, .n_sessionID = ssid,
              .n_cipher_suite = cs, .n_pski = { .tag = FStar_Pervasives_Native_None },
              .n_server_extensions = sext, .n_server_share = { .tag = FStar_Pervasives_Native_None },
              .n_client_cert_request = { .tag = FStar_Pervasives_Native_None },
              .n_server_cert = { .tag = FStar_Pervasives_Native_None },
              .n_client_share = { .tag = FStar_Pervasives_Native_None }
            };
          ns.state[0U] =
            (
              (Negotiation_negotiationState){
                .tag = Negotiation_C_Mode,
                .val = { .case_C_Mode = mode }
              }
            );
          return
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_mode){
                .tag = FStar_Error_Correct,
                .val = { .case_Correct = mode }
              }
            );
        }
        else
          return
            TLSError_fatal__Negotiation_mode(Parsers_AlertDescription_Decode_error,
              "ServerHello ciphersuite is not a real ciphersuite");
      }
    }
    else
    {
      KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
        __FILE__,
        __LINE__,
        "unreachable (pattern matches are exhaustive in F*)");
      KRML_HOST_EXIT(255U);
    }
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

typedef struct
K___Parsers_ProtocolVersion_protocolVersion_FStar_Pervasives_Native_option__FStar_Bytes_bytes_s
{
  Parsers_ProtocolVersion_protocolVersion fst;
  FStar_Pervasives_Native_option__FStar_Bytes_bytes snd;
}
K___Parsers_ProtocolVersion_protocolVersion_FStar_Pervasives_Native_option__FStar_Bytes_bytes;

FStar_Bytes_bytes
Negotiation_to_be_signed(
  Parsers_ProtocolVersion_protocolVersion pv,
  TLSConstants_role role,
  FStar_Pervasives_Native_option__FStar_Bytes_bytes csr,
  FStar_Bytes_bytes tbs
)
{
  K___Parsers_ProtocolVersion_protocolVersion_FStar_Pervasives_Native_option__FStar_Bytes_bytes
  scrut = { .fst = pv, .snd = csr };
  if
  (
    scrut.fst.tag
    == Parsers_ProtocolVersion_TLS_1p3
    && scrut.snd.tag == FStar_Pervasives_Native_None
  )
  {
    FStar_Bytes_bytes pad1 = FStar_Bytes_create((uint32_t)64U, (uint8_t)32U);
    Prims_string ctx;
    switch (role)
    {
      case TLSConstants_Server:
        {
          ctx = "TLS 1.3, server CertificateVerify";
          break;
        }
      case TLSConstants_Client:
        {
          ctx = "TLS 1.3, client CertificateVerify";
          break;
        }
      default:
        {
          KRML_HOST_EPRINTF("KreMLin incomplete match at %s:%d\n", __FILE__, __LINE__);
          KRML_HOST_EXIT(253U);
        }
    }
    return
      FStar_Bytes_append(pad1,
        FStar_Bytes_append(FStar_Bytes_bytes_of_string(ctx),
          FStar_Bytes_append(FStar_Bytes_abyte((uint8_t)0U), tbs)));
  }
  else if
  (
    scrut.fst.tag
    == Parsers_ProtocolVersion_TLS_1p2
    && scrut.snd.tag == FStar_Pervasives_Native_Some
  )
  {
    FStar_Bytes_bytes csr1 = scrut.snd.v;
    return FStar_Bytes_append(csr1, tbs);
  }
  else if (scrut.snd.tag == FStar_Pervasives_Native_Some)
  {
    FStar_Bytes_bytes csr1 = scrut.snd.v;
    return FStar_Bytes_append(csr1, tbs);
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

static bool
Negotiation_matches_sigHashAlg_of_signatureScheme(
  CipherSuite_sigAlg sa,
  Parsers_SignatureScheme_signatureScheme alg1
)
{
  K___CipherSuite_sigAlg_Hashing_Spec_tls_alg
  scrut = TLSConstants_sigHashAlg_of_signatureScheme(alg1);
  CipherSuite_sigAlg sa_ = scrut.fst;
  return __eq__CipherSuite_sigAlg(sa_, sa);
}

static Prims_list__Parsers_SignatureScheme_signatureScheme
*List_Helpers_filter_aux__Parsers_SignatureScheme_signatureScheme_CipherSuite_sigAlg(
  CipherSuite_sigAlg env,
  bool (*f)(CipherSuite_sigAlg x0, Parsers_SignatureScheme_signatureScheme x1),
  Prims_list__Parsers_SignatureScheme_signatureScheme *l
)
{
  if (l->tag == Prims_Nil)
  {
    KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme), (uint32_t)1U);
    Prims_list__Parsers_SignatureScheme_signatureScheme
    *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme));
    buf[0U] = ((Prims_list__Parsers_SignatureScheme_signatureScheme){ .tag = Prims_Nil });
    return buf;
  }
  else if (l->tag == Prims_Cons)
  {
    Prims_list__Parsers_SignatureScheme_signatureScheme *tl1 = l->tl;
    Parsers_SignatureScheme_signatureScheme hd1 = l->hd;
    if (f(env, hd1))
    {
      KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme), (uint32_t)1U);
      Prims_list__Parsers_SignatureScheme_signatureScheme
      *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme));
      buf[0U]
      =
        (
          (Prims_list__Parsers_SignatureScheme_signatureScheme){
            .tag = Prims_Cons,
            .hd = hd1,
            .tl = List_Helpers_filter_aux__Parsers_SignatureScheme_signatureScheme_CipherSuite_sigAlg(env,
              f,
              tl1)
          }
        );
      return buf;
    }
    else
      return
        List_Helpers_filter_aux__Parsers_SignatureScheme_signatureScheme_CipherSuite_sigAlg(env,
          f,
          tl1);
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

Prims_list__Parsers_SignatureScheme_signatureScheme
*Negotiation_supported_signatureSchemes_12(Negotiation_mode mode)
{
  Hashing_Spec_tls_alg
  ha0 = TLSConstants_sessionHashAlg(mode.n_protocol_version, mode.n_cipher_suite);
  CipherSuite_sigAlg sa = CipherSuite_sigAlg_of_ciphersuite(mode.n_cipher_suite);
  if (mode.n_protocol_version.tag == Parsers_ProtocolVersion_TLS_1p0)
  {
    KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme), (uint32_t)1U);
    Prims_list__Parsers_SignatureScheme_signatureScheme
    *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme));
    buf[0U] = ((Prims_list__Parsers_SignatureScheme_signatureScheme){ .tag = Prims_Nil });
    KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme), (uint32_t)1U);
    Prims_list__Parsers_SignatureScheme_signatureScheme
    *buf0 = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme));
    buf0[0U]
    =
      (
        (Prims_list__Parsers_SignatureScheme_signatureScheme){
          .tag = Prims_Cons,
          .hd = TLSConstants_signatureScheme_of_sigHashAlg(sa, ha0),
          .tl = buf
        }
      );
    return buf0;
  }
  else if (mode.n_protocol_version.tag == Parsers_ProtocolVersion_TLS_1p1)
  {
    KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme), (uint32_t)1U);
    Prims_list__Parsers_SignatureScheme_signatureScheme
    *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme));
    buf[0U] = ((Prims_list__Parsers_SignatureScheme_signatureScheme){ .tag = Prims_Nil });
    KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme), (uint32_t)1U);
    Prims_list__Parsers_SignatureScheme_signatureScheme
    *buf0 = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme));
    buf0[0U]
    =
      (
        (Prims_list__Parsers_SignatureScheme_signatureScheme){
          .tag = Prims_Cons,
          .hd = TLSConstants_signatureScheme_of_sigHashAlg(sa, ha0),
          .tl = buf
        }
      );
    return buf0;
  }
  else if (mode.n_protocol_version.tag == Parsers_ProtocolVersion_SSL_3p0)
  {
    KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme), (uint32_t)1U);
    Prims_list__Parsers_SignatureScheme_signatureScheme
    *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme));
    buf[0U] = ((Prims_list__Parsers_SignatureScheme_signatureScheme){ .tag = Prims_Nil });
    KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme), (uint32_t)1U);
    Prims_list__Parsers_SignatureScheme_signatureScheme
    *buf0 = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme));
    buf0[0U]
    =
      (
        (Prims_list__Parsers_SignatureScheme_signatureScheme){
          .tag = Prims_Cons,
          .hd = TLSConstants_signatureScheme_of_sigHashAlg(sa, ha0),
          .tl = buf
        }
      );
    return buf0;
  }
  else if (mode.n_protocol_version.tag == Parsers_ProtocolVersion_TLS_1p2)
  {
    FStar_Pervasives_Native_option__Prims_list__Parsers_SignatureScheme_signatureScheme
    scrut = Negotiation_find_signature_algorithms(mode.n_offer);
    if (scrut.tag == FStar_Pervasives_Native_None)
    {
      KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme), (uint32_t)1U);
      Prims_list__Parsers_SignatureScheme_signatureScheme
      *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme));
      buf[0U] = ((Prims_list__Parsers_SignatureScheme_signatureScheme){ .tag = Prims_Nil });
      KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme), (uint32_t)1U);
      Prims_list__Parsers_SignatureScheme_signatureScheme
      *buf0 = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme));
      buf0[0U]
      =
        (
          (Prims_list__Parsers_SignatureScheme_signatureScheme){
            .tag = Prims_Cons,
            .hd = TLSConstants_signatureScheme_of_sigHashAlg(sa, ha0),
            .tl = buf
          }
        );
      return buf0;
    }
    else if (scrut.tag == FStar_Pervasives_Native_Some)
    {
      Prims_list__Parsers_SignatureScheme_signatureScheme *algs = scrut.v;
      return
        List_Helpers_filter_aux__Parsers_SignatureScheme_signatureScheme_CipherSuite_sigAlg(sa,
          Negotiation_matches_sigHashAlg_of_signatureScheme,
          algs);
    }
    else
    {
      KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
        __FILE__,
        __LINE__,
        "unreachable (pattern matches are exhaustive in F*)");
      KRML_HOST_EXIT(255U);
    }
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

static Prims_list__Parsers_SignatureScheme_signatureScheme
*List_Helpers_filter_aux__Parsers_SignatureScheme_signatureScheme_Parsers_SignatureScheme_signatureScheme(
  Parsers_SignatureScheme_signatureScheme env,
  bool
  (*f)(Parsers_SignatureScheme_signatureScheme x0, Parsers_SignatureScheme_signatureScheme x1),
  Prims_list__Parsers_SignatureScheme_signatureScheme *l
)
{
  if (l->tag == Prims_Nil)
  {
    KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme), (uint32_t)1U);
    Prims_list__Parsers_SignatureScheme_signatureScheme
    *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme));
    buf[0U] = ((Prims_list__Parsers_SignatureScheme_signatureScheme){ .tag = Prims_Nil });
    return buf;
  }
  else if (l->tag == Prims_Cons)
  {
    Prims_list__Parsers_SignatureScheme_signatureScheme *tl1 = l->tl;
    Parsers_SignatureScheme_signatureScheme hd1 = l->hd;
    if (f(env, hd1))
    {
      KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme), (uint32_t)1U);
      Prims_list__Parsers_SignatureScheme_signatureScheme
      *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme));
      buf[0U]
      =
        (
          (Prims_list__Parsers_SignatureScheme_signatureScheme){
            .tag = Prims_Cons,
            .hd = hd1,
            .tl = List_Helpers_filter_aux__Parsers_SignatureScheme_signatureScheme_Parsers_SignatureScheme_signatureScheme(env,
              f,
              tl1)
          }
        );
      return buf;
    }
    else
      return
        List_Helpers_filter_aux__Parsers_SignatureScheme_signatureScheme_Parsers_SignatureScheme_signatureScheme(env,
          f,
          tl1);
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_mode
Negotiation_client_ServerKeyExchange(
  Negotiation_t ns,
  Prims_list__FStar_Bytes_bytes *crt,
  HandshakeMessages_ske ske,
  FStar_Pervasives_Native_option__HandshakeMessages_cr ocr
)
{
  Negotiation_mode mode = Negotiation_getMode(TLSConstants_Client, ns);
  if (ske.ske_kex_s.tag == HandshakeMessages_KEX_S_RSA)
    return
      TLSError_fatal__Negotiation_mode(Parsers_AlertDescription_Handshake_failure,
        FStar_Error_perror("Negotiation.fst", (krml_checked_int_t)1006, "Illegal message"));
  else if (ske.ske_kex_s.tag == HandshakeMessages_KEX_S_DHE)
  {
    Prims_dtuple2__CommonDH_group__CommonDH_pre_share_ gy = ske.ske_kex_s.val.case_KEX_S_DHE;
    FStar_Bytes_bytes ske_tbs = HandshakeMessages_kex_s_to_bytes(ske.ske_kex_s);
    Prims_list__Parsers_SignatureScheme_signatureScheme
    *salgs = Negotiation_supported_signatureSchemes_12(mode);
    Prims_list__Parsers_SignatureScheme_signatureScheme *salgs1;
    if (ske.ske_signed_params.sig_algorithm.tag == FStar_Pervasives_Native_None)
      salgs1 = salgs;
    else if (ske.ske_signed_params.sig_algorithm.tag == FStar_Pervasives_Native_Some)
    {
      Parsers_SignatureScheme_signatureScheme sa_ = ske.ske_signed_params.sig_algorithm.v;
      salgs1 =
        List_Helpers_filter_aux__Parsers_SignatureScheme_signatureScheme_Parsers_SignatureScheme_signatureScheme(sa_,
          __eq__Parsers_SignatureScheme_signatureScheme,
          salgs);
    }
    else
      salgs1 =
        KRML_EABORT(Prims_list__Parsers_SignatureScheme_signatureScheme *,
          "unreachable (pattern matches are exhaustive in F*)");
    if (salgs1->tag == Prims_Nil)
      return
        TLSError_fatal__Negotiation_mode(Parsers_AlertDescription_Handshake_failure,
          FStar_Error_perror("Negotiation.fst",
            (krml_checked_int_t)1016,
            "Signature algorithm negotiation failed"));
    else if (salgs1->tag == Prims_Cons)
    {
      Parsers_SignatureScheme_signatureScheme sa = salgs1->hd;
      FStar_Bytes_bytes csr = FStar_Bytes_append(ns.nonce, mode.n_server_random);
      FStar_Bytes_bytes
      tbs =
        Negotiation_to_be_signed(mode.n_protocol_version,
          TLSConstants_Server,
          (
            (FStar_Pervasives_Native_option__FStar_Bytes_bytes){
              .tag = FStar_Pervasives_Native_Some,
              .v = csr
            }
          ),
          ske_tbs);
      bool
      valid = TLSConstants_cert_verify_cb(ns.cfg, crt, sa, tbs, ske.ske_signed_params.sig_signature);
      Prims_string ite;
      if (valid)
        ite = "Valid";
      else
        ite = "Invalid";
      Negotiation_print(Prims_strcat("ServerKeyExchange signature: ", ite));
      if (!valid)
        return
          TLSError_fatal__Negotiation_mode(Parsers_AlertDescription_Handshake_failure,
            FStar_Error_perror("Negotiation.fst",
              (krml_checked_int_t)1023,
              "Failed to check SKE signature"));
      else
      {
        FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_
        gx = mode.n_client_share;
        FStar_Pervasives_Native_option__Prims_list__Extensions_extension_
        sext = mode.n_server_extensions;
        FStar_Pervasives_Native_option__Prims_int pski = mode.n_pski;
        CipherSuite_cipherSuite_ cs = mode.n_cipher_suite;
        FStar_Bytes_bytes sid = mode.n_sessionID;
        FStar_Bytes_bytes sr = mode.n_server_random;
        Parsers_ProtocolVersion_protocolVersion pv = mode.n_protocol_version;
        FStar_Pervasives_Native_option__K___HandshakeMessages_hrr_Prims_list__Prims_dtuple2__CommonDH_group__CommonDH_pre_share__Prims_list__K___FStar_Bytes_bytes_uint32_t
        hrr = mode.n_hrr;
        HandshakeMessages_ch offer = mode.n_offer;
        FStar_Pervasives_Native_option__K___Prims_list__K___FStar_Bytes_bytes_Prims_list__Extensions_extension__Parsers_SignatureScheme_signatureScheme
        scert =
          { .tag = FStar_Pervasives_Native_Some, .v = { .fst = Cert_chain_up(crt), .snd = sa } };
        Negotiation_mode
        mode1 =
          {
            .n_offer = offer, .n_hrr = hrr, .n_protocol_version = pv, .n_server_random = sr,
            .n_sessionID = sid, .n_cipher_suite = cs, .n_pski = pski, .n_server_extensions = sext,
            .n_server_share = { .tag = FStar_Pervasives_Native_Some, .v = gy },
            .n_client_cert_request = ocr, .n_server_cert = scert, .n_client_share = gx
          };
        FStar_Pervasives_Native_option__Prims_list__K___FStar_Bytes_bytes_Prims_list__Extensions_extension_
        ccert = { .tag = FStar_Pervasives_Native_None };
        ns.state[0U] =
          (
            (Negotiation_negotiationState){
              .tag = Negotiation_C_WaitFinished2,
              .val = { .case_C_WaitFinished2 = { .n_mode = mode1, .n_client_certificate = ccert } }
            }
          );
        return
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_mode){
              .tag = FStar_Error_Correct,
              .val = { .case_Correct = mode1 }
            }
          );
      }
    }
    else
    {
      KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
        __FILE__,
        __LINE__,
        "unreachable (pattern matches are exhaustive in F*)");
      KRML_HOST_EXIT(255U);
    }
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

static bool
FStar_List_Tot_Base_mem__Parsers_SignatureScheme_signatureScheme(
  Parsers_SignatureScheme_signatureScheme x,
  Prims_list__Parsers_SignatureScheme_signatureScheme *uu___7_953
)
{
  if (uu___7_953->tag == Prims_Nil)
    return false;
  else if (uu___7_953->tag == Prims_Cons)
  {
    Prims_list__Parsers_SignatureScheme_signatureScheme *tl1 = uu___7_953->tl;
    Parsers_SignatureScheme_signatureScheme hd1 = uu___7_953->hd;
    if (__eq__Parsers_SignatureScheme_signatureScheme(hd1, x))
      return true;
    else
      return FStar_List_Tot_Base_mem__Parsers_SignatureScheme_signatureScheme(x, tl1);
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

typedef struct
K___FStar_Pervasives_Native_option__Prims_list__Extensions_extension__Prims_list__Extensions_extension__s
{
  FStar_Pervasives_Native_option__Prims_list__Extensions_extension_ fst;
  Prims_list__Extensions_extension_ *snd;
}
K___FStar_Pervasives_Native_option__Prims_list__Extensions_extension__Prims_list__Extensions_extension_;

typedef struct
K___bool_FStar_Pervasives_Native_option__K___Prims_list__K___FStar_Bytes_bytes_Prims_list__Extensions_extension__Parsers_SignatureScheme_signatureScheme_s
{
  bool fst;
  FStar_Pervasives_Native_option__K___Prims_list__K___FStar_Bytes_bytes_Prims_list__Extensions_extension__Parsers_SignatureScheme_signatureScheme
  snd;
}
K___bool_FStar_Pervasives_Native_option__K___Prims_list__K___FStar_Bytes_bytes_Prims_list__Extensions_extension__Parsers_SignatureScheme_signatureScheme;

typedef struct
K___CipherSuite_kexAlg_FStar_Pervasives_Native_option__Prims_list__K___FStar_Bytes_bytes_Prims_list__Extensions_extension__FStar_Pervasives_Native_option__HandshakeMessages_signature_FStar_Pervasives_Native_option__FStar_Bytes_bytes_s
{
  CipherSuite_kexAlg fst;
  FStar_Pervasives_Native_option__Prims_list__K___FStar_Bytes_bytes_Prims_list__Extensions_extension_
  snd;
  FStar_Pervasives_Native_option__HandshakeMessages_signature thd;
  FStar_Pervasives_Native_option__FStar_Bytes_bytes f3;
}
K___CipherSuite_kexAlg_FStar_Pervasives_Native_option__Prims_list__K___FStar_Bytes_bytes_Prims_list__Extensions_extension__FStar_Pervasives_Native_option__HandshakeMessages_signature_FStar_Pervasives_Native_option__FStar_Bytes_bytes;

FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_mode
Negotiation_clientComplete_13(
  Negotiation_t ns,
  Prims_list__Extensions_extension_ *ee,
  FStar_Pervasives_Native_option__HandshakeMessages_cr optCertRequest,
  FStar_Pervasives_Native_option__Prims_list__K___FStar_Bytes_bytes_Prims_list__Extensions_extension_
  optServerCert,
  FStar_Pervasives_Native_option__HandshakeMessages_signature optCertVerify,
  FStar_Pervasives_Native_option__FStar_Bytes_bytes digest
)
{
  Negotiation_print("Nego.clientComplete_13");
  Negotiation_negotiationState scrut0 = ns.state[0U];
  if (scrut0.tag == Negotiation_C_Mode)
  {
    Negotiation_mode mode = scrut0.val.case_C_Mode;
    FStar_Pervasives_Native_option__Prims_list__K___FStar_Bytes_bytes_Prims_list__Extensions_extension_
    ccert = { .tag = FStar_Pervasives_Native_None };
    Negotiation_print(Prims_strcat("EE: ", Extensions_string_of_extensions____(ee)));
    K___FStar_Pervasives_Native_option__Prims_list__Extensions_extension__Prims_list__Extensions_extension_
    scrut0 = { .fst = mode.n_server_extensions, .snd = ee };
    FStar_Pervasives_Native_option__Prims_list__Extensions_extension_ sexts;
    if (scrut0.fst.tag == FStar_Pervasives_Native_Some)
    {
      Prims_list__Extensions_extension_ *ee1 = scrut0.snd;
      Prims_list__Extensions_extension_ *el = scrut0.fst.v;
      sexts =
        (
          (FStar_Pervasives_Native_option__Prims_list__Extensions_extension_){
            .tag = FStar_Pervasives_Native_Some,
            .v = FStar_List_Tot_Base_append__Extensions_extension_(el, ee1)
          }
        );
    }
    else if (scrut0.fst.tag == FStar_Pervasives_Native_None && scrut0.snd->tag == Prims_Nil)
      sexts =
        (
          (FStar_Pervasives_Native_option__Prims_list__Extensions_extension_){
            .tag = FStar_Pervasives_Native_None
          }
        );
    else if (scrut0.fst.tag == FStar_Pervasives_Native_None)
    {
      Prims_list__Extensions_extension_ *ee1 = scrut0.snd;
      sexts =
        (
          (FStar_Pervasives_Native_option__Prims_list__Extensions_extension_){
            .tag = FStar_Pervasives_Native_Some,
            .v = ee1
          }
        );
    }
    else
      sexts =
        KRML_EABORT(FStar_Pervasives_Native_option__Prims_list__Extensions_extension_,
          "unreachable (pattern matches are exhaustive in F*)");
    TLSConstants_nego_cb nego_cb = ns.cfg.nego_callback;
    FStar_Pervasives_Native_option__Prims_list__Extensions_extension_
    exts = Extensions_app_ext_filter(sexts);
    FStar_Bytes_bytes exts_bytes = HandshakeMessages_optionExtensionsBytes(exts);
    Negotiation_print("Negotiation callback to process application extensions.");
    TLSConstants_nego_action
    scrut1 =
      nego_cb.negotiate(nego_cb.nego_context,
        mode.n_protocol_version,
        exts_bytes,
        ((FStar_Pervasives_Native_option__FStar_Bytes_bytes){ .tag = FStar_Pervasives_Native_None }));
    if (scrut1.tag == TLSConstants_Nego_abort)
      return
        TLSError_fatal__Negotiation_mode(Parsers_AlertDescription_Handshake_failure,
          FStar_Error_perror("Negotiation.fst",
            (krml_checked_int_t)1056,
            "application requested to abort the handshake"));
    else if (scrut1.tag == TLSConstants_Nego_retry)
      return
        TLSError_fatal__Negotiation_mode(Parsers_AlertDescription_Internal_error,
          FStar_Error_perror("Negotiation.fst",
            (krml_checked_int_t)1057,
            "client application requested a server retry"));
    else if (scrut1.tag == TLSConstants_Nego_accept)
    {
      K___CipherSuite_kexAlg_FStar_Pervasives_Native_option__Prims_list__K___FStar_Bytes_bytes_Prims_list__Extensions_extension__FStar_Pervasives_Native_option__HandshakeMessages_signature_FStar_Pervasives_Native_option__FStar_Bytes_bytes
      scrut0 =
        {
          .fst = Negotiation_kexAlg(mode),
          .snd = optServerCert,
          .thd = optCertVerify,
          .f3 = digest
        };
      K___bool_FStar_Pervasives_Native_option__K___Prims_list__K___FStar_Bytes_bytes_Prims_list__Extensions_extension__Parsers_SignatureScheme_signatureScheme
      scrut1;
      if
      (
        scrut0.fst
        == CipherSuite_Kex_DHE
        &&
          scrut0.snd.tag
          == FStar_Pervasives_Native_Some
          &&
            scrut0.thd.tag
            == FStar_Pervasives_Native_Some
            && scrut0.f3.tag == FStar_Pervasives_Native_Some
      )
      {
        FStar_Bytes_bytes digest1 = scrut0.f3.v;
        HandshakeMessages_signature cv = scrut0.thd.v;
        Prims_list__K___FStar_Bytes_bytes_Prims_list__Extensions_extension_ *c = scrut0.snd.v;
        FStar_Pervasives_Native_option__Prims_list__Parsers_SignatureScheme_signatureScheme
        scrut = Negotiation_find_signature_algorithms(mode.n_offer);
        if (scrut.tag == FStar_Pervasives_Native_Some)
        {
          Prims_list__Parsers_SignatureScheme_signatureScheme *sal = scrut.v;
          Parsers_SignatureScheme_signatureScheme sa;
          if (cv.sig_algorithm.tag == FStar_Pervasives_Native_Some)
            sa = cv.sig_algorithm.v;
          else
            sa =
              KRML_EABORT(Parsers_SignatureScheme_signatureScheme,
                "unreachable (pattern matches are exhaustive in F*)");
          FStar_Pervasives_Native_option__K___Prims_list__K___FStar_Bytes_bytes_Prims_list__Extensions_extension__Parsers_SignatureScheme_signatureScheme
          chain = { .tag = FStar_Pervasives_Native_Some, .v = { .fst = c, .snd = sa } };
          if (FStar_List_Tot_Base_mem__Parsers_SignatureScheme_signatureScheme(sa, sal))
          {
            FStar_Bytes_bytes
            tbs =
              Negotiation_to_be_signed(mode.n_protocol_version,
                TLSConstants_Server,
                (
                  (FStar_Pervasives_Native_option__FStar_Bytes_bytes){
                    .tag = FStar_Pervasives_Native_None
                  }
                ),
                digest1);
            scrut1 =
              (
                (K___bool_FStar_Pervasives_Native_option__K___Prims_list__K___FStar_Bytes_bytes_Prims_list__Extensions_extension__Parsers_SignatureScheme_signatureScheme){
                  .fst = TLSConstants_cert_verify_cb(ns.cfg,
                    Cert_chain_down(c),
                    sa,
                    tbs,
                    cv.sig_signature),
                  .snd = chain
                }
              );
          }
          else
            scrut1 =
              (
                (K___bool_FStar_Pervasives_Native_option__K___Prims_list__K___FStar_Bytes_bytes_Prims_list__Extensions_extension__Parsers_SignatureScheme_signatureScheme){
                  .fst = false,
                  .snd = { .tag = FStar_Pervasives_Native_None }
                }
              );
        }
        else
          scrut1 =
            KRML_EABORT(K___bool_FStar_Pervasives_Native_option__K___Prims_list__K___FStar_Bytes_bytes_Prims_list__Extensions_extension__Parsers_SignatureScheme_signatureScheme,
              "unreachable (pattern matches are exhaustive in F*)");
      }
      else if
      (
        scrut0.fst
        == CipherSuite_Kex_ECDHE
        &&
          scrut0.snd.tag
          == FStar_Pervasives_Native_Some
          &&
            scrut0.thd.tag
            == FStar_Pervasives_Native_Some
            && scrut0.f3.tag == FStar_Pervasives_Native_Some
      )
      {
        FStar_Bytes_bytes digest1 = scrut0.f3.v;
        HandshakeMessages_signature cv = scrut0.thd.v;
        Prims_list__K___FStar_Bytes_bytes_Prims_list__Extensions_extension_ *c = scrut0.snd.v;
        FStar_Pervasives_Native_option__Prims_list__Parsers_SignatureScheme_signatureScheme
        scrut = Negotiation_find_signature_algorithms(mode.n_offer);
        if (scrut.tag == FStar_Pervasives_Native_Some)
        {
          Prims_list__Parsers_SignatureScheme_signatureScheme *sal = scrut.v;
          Parsers_SignatureScheme_signatureScheme sa;
          if (cv.sig_algorithm.tag == FStar_Pervasives_Native_Some)
            sa = cv.sig_algorithm.v;
          else
            sa =
              KRML_EABORT(Parsers_SignatureScheme_signatureScheme,
                "unreachable (pattern matches are exhaustive in F*)");
          FStar_Pervasives_Native_option__K___Prims_list__K___FStar_Bytes_bytes_Prims_list__Extensions_extension__Parsers_SignatureScheme_signatureScheme
          chain = { .tag = FStar_Pervasives_Native_Some, .v = { .fst = c, .snd = sa } };
          if (FStar_List_Tot_Base_mem__Parsers_SignatureScheme_signatureScheme(sa, sal))
          {
            FStar_Bytes_bytes
            tbs =
              Negotiation_to_be_signed(mode.n_protocol_version,
                TLSConstants_Server,
                (
                  (FStar_Pervasives_Native_option__FStar_Bytes_bytes){
                    .tag = FStar_Pervasives_Native_None
                  }
                ),
                digest1);
            scrut1 =
              (
                (K___bool_FStar_Pervasives_Native_option__K___Prims_list__K___FStar_Bytes_bytes_Prims_list__Extensions_extension__Parsers_SignatureScheme_signatureScheme){
                  .fst = TLSConstants_cert_verify_cb(ns.cfg,
                    Cert_chain_down(c),
                    sa,
                    tbs,
                    cv.sig_signature),
                  .snd = chain
                }
              );
          }
          else
            scrut1 =
              (
                (K___bool_FStar_Pervasives_Native_option__K___Prims_list__K___FStar_Bytes_bytes_Prims_list__Extensions_extension__Parsers_SignatureScheme_signatureScheme){
                  .fst = false,
                  .snd = { .tag = FStar_Pervasives_Native_None }
                }
              );
        }
        else
          scrut1 =
            KRML_EABORT(K___bool_FStar_Pervasives_Native_option__K___Prims_list__K___FStar_Bytes_bytes_Prims_list__Extensions_extension__Parsers_SignatureScheme_signatureScheme,
              "unreachable (pattern matches are exhaustive in F*)");
      }
      else if
      (
        scrut0.fst
        == CipherSuite_Kex_PSK_ECDHE
        &&
          scrut0.snd.tag
          == FStar_Pervasives_Native_None
          &&
            scrut0.thd.tag
            == FStar_Pervasives_Native_None
            && scrut0.f3.tag == FStar_Pervasives_Native_None
      )
        scrut1 =
          (
            (K___bool_FStar_Pervasives_Native_option__K___Prims_list__K___FStar_Bytes_bytes_Prims_list__Extensions_extension__Parsers_SignatureScheme_signatureScheme){
              .fst = true,
              .snd = { .tag = FStar_Pervasives_Native_None }
            }
          );
      else if
      (
        scrut0.fst
        == CipherSuite_Kex_PSK
        &&
          scrut0.snd.tag
          == FStar_Pervasives_Native_None
          &&
            scrut0.thd.tag
            == FStar_Pervasives_Native_None
            && scrut0.f3.tag == FStar_Pervasives_Native_None
      )
        scrut1 =
          (
            (K___bool_FStar_Pervasives_Native_option__K___Prims_list__K___FStar_Bytes_bytes_Prims_list__Extensions_extension__Parsers_SignatureScheme_signatureScheme){
              .fst = true,
              .snd = { .tag = FStar_Pervasives_Native_None }
            }
          );
      else
        scrut1 =
          (
            (K___bool_FStar_Pervasives_Native_option__K___Prims_list__K___FStar_Bytes_bytes_Prims_list__Extensions_extension__Parsers_SignatureScheme_signatureScheme){
              .fst = false,
              .snd = { .tag = FStar_Pervasives_Native_None }
            }
          );
      bool validSig = scrut1.fst;
      FStar_Pervasives_Native_option__K___Prims_list__K___FStar_Bytes_bytes_Prims_list__Extensions_extension__Parsers_SignatureScheme_signatureScheme
      schain = scrut1.snd;
      Prims_string ite;
      if (validSig)
        ite = "valid";
      else
        ite = "invalid";
      Negotiation_print(Prims_strcat("Certificate & signature 1.3 callback result: ", ite));
      if (validSig)
      {
        Negotiation_mode
        mode1 =
          {
            .n_offer = mode.n_offer, .n_hrr = mode.n_hrr,
            .n_protocol_version = mode.n_protocol_version, .n_server_random = mode.n_server_random,
            .n_sessionID = mode.n_sessionID, .n_cipher_suite = mode.n_cipher_suite,
            .n_pski = mode.n_pski, .n_server_extensions = sexts,
            .n_server_share = mode.n_server_share, .n_client_cert_request = optCertRequest,
            .n_server_cert = schain, .n_client_share = mode.n_client_share
          };
        ns.state[0U] =
          (
            (Negotiation_negotiationState){
              .tag = Negotiation_C_Complete,
              .val = { .case_C_Complete = { .n_mode = mode1, .n_client_certificate = ccert } }
            }
          );
        return
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_mode){
              .tag = FStar_Error_Correct,
              .val = { .case_Correct = mode1 }
            }
          );
      }
      else
        return
          TLSError_fatal__Negotiation_mode(Parsers_AlertDescription_Bad_certificate,
            "Failed to validate signature or certificate");
    }
    else
    {
      KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
        __FILE__,
        __LINE__,
        "unreachable (pattern matches are exhaustive in F*)");
      KRML_HOST_EXIT(255U);
    }
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

bool Negotiation_uu___is_PSK_EDH(HandshakeMessages_ch offer, Negotiation_cs13 projectee)
{
  if (projectee.tag == Negotiation_PSK_EDH)
    return true;
  else
    return false;
}

Prims_int
Negotiation___proj__PSK_EDH__item__j(HandshakeMessages_ch offer, Negotiation_cs13 projectee)
{
  if (projectee.tag == Negotiation_PSK_EDH)
    return projectee.val.case_PSK_EDH.j;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_
Negotiation___proj__PSK_EDH__item__oks(HandshakeMessages_ch offer, Negotiation_cs13 projectee)
{
  if (projectee.tag == Negotiation_PSK_EDH)
    return projectee.val.case_PSK_EDH.oks;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

CipherSuite_cipherSuite_
Negotiation___proj__PSK_EDH__item__cs(HandshakeMessages_ch offer, Negotiation_cs13 projectee)
{
  if (projectee.tag == Negotiation_PSK_EDH)
    return projectee.val.case_PSK_EDH.cs;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

bool Negotiation_uu___is_JUST_EDH(HandshakeMessages_ch offer, Negotiation_cs13 projectee)
{
  if (projectee.tag == Negotiation_JUST_EDH)
    return true;
  else
    return false;
}

Prims_dtuple2__CommonDH_group__CommonDH_pre_share_
Negotiation___proj__JUST_EDH__item__oks(HandshakeMessages_ch offer, Negotiation_cs13 projectee)
{
  if (projectee.tag == Negotiation_JUST_EDH)
    return projectee.val.case_JUST_EDH.oks;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

CipherSuite_cipherSuite_
Negotiation___proj__JUST_EDH__item__cs(HandshakeMessages_ch offer, Negotiation_cs13 projectee)
{
  if (projectee.tag == Negotiation_JUST_EDH)
    return projectee.val.case_JUST_EDH.cs;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

static Prims_list__Negotiation_cs13
*Negotiation_just_edh_x(
  HandshakeMessages_ch o,
  Prims_dtuple2__CommonDH_group__CommonDH_pre_share_ oks,
  Prims_list__CipherSuite_cipherSuite_ *l
)
{
  if (l->tag == Prims_Nil)
  {
    KRML_CHECK_SIZE(sizeof (Prims_list__Negotiation_cs13), (uint32_t)1U);
    Prims_list__Negotiation_cs13 *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Negotiation_cs13));
    buf[0U] = ((Prims_list__Negotiation_cs13){ .tag = Prims_Nil });
    return buf;
  }
  else if (l->tag == Prims_Cons)
  {
    Prims_list__CipherSuite_cipherSuite_ *tl1 = l->tl;
    CipherSuite_cipherSuite_ hd1 = l->hd;
    KRML_CHECK_SIZE(sizeof (Prims_list__Negotiation_cs13), (uint32_t)1U);
    Prims_list__Negotiation_cs13 *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Negotiation_cs13));
    buf[0U]
    =
      (
        (Prims_list__Negotiation_cs13){
          .tag = Prims_Cons,
          .hd = {
            .tag = Negotiation_JUST_EDH,
            .val = { .case_JUST_EDH = { .oks = oks, .cs = hd1 } }
          },
          .tl = Negotiation_just_edh_x(o, oks, tl1)
        }
      );
    return buf;
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

static Prims_int
FStar_List_Tot_Base_length__FStar_Bytes_bytes___TLSConstants_pskInfo(
  Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo *uu___4_154
)
{
  if (uu___4_154->tag == Prims_Nil)
    return (krml_checked_int_t)0;
  else if (uu___4_154->tag == Prims_Cons)
  {
    Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo *tl1 = uu___4_154->tl;
    return
      Prims_op_Addition((krml_checked_int_t)1,
        FStar_List_Tot_Base_length__FStar_Bytes_bytes___TLSConstants_pskInfo(tl1));
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

static K___FStar_Bytes_bytes_TLSConstants_pskInfo
FStar_List_Tot_Base_hd__FStar_Bytes_bytes___TLSConstants_pskInfo(
  Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo *uu___0_39
)
{
  if (uu___0_39->tag == Prims_Cons)
    return uu___0_39->hd;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

static Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo
*FStar_List_Tot_Base_tail__FStar_Bytes_bytes___TLSConstants_pskInfo(
  Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo *uu___1_64
)
{
  if (uu___1_64->tag == Prims_Cons)
    return uu___1_64->tl;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

static Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo
*(*FStar_List_Tot_Base_tl__FStar_Bytes_bytes___TLSConstants_pskInfo)(
  Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo *x0
) = FStar_List_Tot_Base_tail__FStar_Bytes_bytes___TLSConstants_pskInfo;

static K___FStar_Bytes_bytes_TLSConstants_pskInfo
FStar_List_Tot_Base_index__FStar_Bytes_bytes___TLSConstants_pskInfo(
  Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo *l,
  Prims_int i
)
{
  if (i == (krml_checked_int_t)0)
    return FStar_List_Tot_Base_hd__FStar_Bytes_bytes___TLSConstants_pskInfo(l);
  else
    return
      FStar_List_Tot_Base_index__FStar_Bytes_bytes___TLSConstants_pskInfo(FStar_List_Tot_Base_tl__FStar_Bytes_bytes___TLSConstants_pskInfo(l),
        Prims_op_Subtraction(i, (krml_checked_int_t)1));
}

static bool
FStar_List_Tot_Base_mem__CipherSuite_cipherSuite_(
  CipherSuite_cipherSuite_ x,
  Prims_list__CipherSuite_cipherSuite_ *uu___7_953
)
{
  if (uu___7_953->tag == Prims_Nil)
    return false;
  else if (uu___7_953->tag == Prims_Cons)
  {
    Prims_list__CipherSuite_cipherSuite_ *tl1 = uu___7_953->tl;
    CipherSuite_cipherSuite_ hd1 = uu___7_953->hd;
    if (__eq__CipherSuite_cipherSuite_(hd1, x))
      return true;
    else
      return FStar_List_Tot_Base_mem__CipherSuite_cipherSuite_(x, tl1);
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

static bool
FStar_List_Tot_Base_mem__Extensions_psk_kex(
  Extensions_psk_kex x,
  Prims_list__Extensions_psk_kex *uu___7_953
)
{
  if (uu___7_953->tag == Prims_Nil)
    return false;
  else if (uu___7_953->tag == Prims_Cons)
  {
    Prims_list__Extensions_psk_kex *tl1 = uu___7_953->tl;
    Extensions_psk_kex hd1 = uu___7_953->hd;
    if (__eq__Extensions_psk_kex(hd1, x))
      return true;
    else
      return FStar_List_Tot_Base_mem__Extensions_psk_kex(x, tl1);
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

static Prims_list__Negotiation_cs13
*FStar_List_Tot_Base_append__Negotiation_cs13(
  Prims_list__Negotiation_cs13 *x,
  Prims_list__Negotiation_cs13 *y
)
{
  if (x->tag == Prims_Nil)
    return y;
  else if (x->tag == Prims_Cons)
  {
    Prims_list__Negotiation_cs13 *tl1 = x->tl;
    Negotiation_cs13 a = x->hd;
    KRML_CHECK_SIZE(sizeof (Prims_list__Negotiation_cs13), (uint32_t)1U);
    Prims_list__Negotiation_cs13 *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Negotiation_cs13));
    buf[0U]
    =
      (
        (Prims_list__Negotiation_cs13){
          .tag = Prims_Cons,
          .hd = a,
          .tl = FStar_List_Tot_Base_append__Negotiation_cs13(tl1, y)
        }
      );
    return buf;
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

typedef struct
K___FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share__bool_s
{
  FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_ fst;
  bool snd;
}
K___FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share__bool;

static Prims_list__Negotiation_cs13
*Negotiation_compute_cs13_aux(
  Prims_int i1,
  HandshakeMessages_ch o,
  Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo *psks,
  FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_ g_gx,
  Prims_list__CipherSuite_cipherSuite_ *ncs,
  Prims_list__Extensions_psk_kex *psk_kex,
  bool server_cert
)
{
  if (i1 == FStar_List_Tot_Base_length__FStar_Bytes_bytes___TLSConstants_pskInfo(psks))
  {
    K___FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share__bool
    scrut = { .fst = g_gx, .snd = server_cert };
    if (scrut.fst.tag == FStar_Pervasives_Native_Some && scrut.snd == true)
    {
      Prims_dtuple2__CommonDH_group__CommonDH_pre_share_ x = scrut.fst.v;
      return Negotiation_just_edh_x(o, x, ncs);
    }
    else
    {
      KRML_CHECK_SIZE(sizeof (Prims_list__Negotiation_cs13), (uint32_t)1U);
      Prims_list__Negotiation_cs13 *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Negotiation_cs13));
      buf[0U] = ((Prims_list__Negotiation_cs13){ .tag = Prims_Nil });
      return buf;
    }
  }
  else
  {
    K___FStar_Bytes_bytes_TLSConstants_pskInfo
    scrut = FStar_List_Tot_Base_index__FStar_Bytes_bytes___TLSConstants_pskInfo(psks, i1);
    Prims_list__Negotiation_cs13 *choices;
    if (true)
    {
      TLSConstants_pskInfo info = scrut.snd;
      CipherSuite_cipherSuite_
      cs =
        {
          .tag = CipherSuite_CipherSuite13,
          .val = { .case_CipherSuite13 = { ._0 = info.early_ae, ._1 = info.early_hash } }
        };
      if (FStar_List_Tot_Base_mem__CipherSuite_cipherSuite_(cs, ncs))
      {
        Prims_list__Negotiation_cs13 *r;
        if (FStar_List_Tot_Base_mem__Extensions_psk_kex(Extensions_PSK_KE, psk_kex))
        {
          KRML_CHECK_SIZE(sizeof (Prims_list__Negotiation_cs13), (uint32_t)1U);
          Prims_list__Negotiation_cs13
          *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Negotiation_cs13));
          buf[0U] = ((Prims_list__Negotiation_cs13){ .tag = Prims_Nil });
          KRML_CHECK_SIZE(sizeof (Prims_list__Negotiation_cs13), (uint32_t)1U);
          Prims_list__Negotiation_cs13
          *buf0 = KRML_HOST_MALLOC(sizeof (Prims_list__Negotiation_cs13));
          buf0[0U]
          =
            (
              (Prims_list__Negotiation_cs13){
                .tag = Prims_Cons,
                .hd = {
                  .tag = Negotiation_PSK_EDH,
                  .val = {
                    .case_PSK_EDH = {
                      .j = i1,
                      .oks = { .tag = FStar_Pervasives_Native_None },
                      .cs = cs
                    }
                  }
                },
                .tl = buf
              }
            );
          r = buf0;
        }
        else
        {
          KRML_CHECK_SIZE(sizeof (Prims_list__Negotiation_cs13), (uint32_t)1U);
          Prims_list__Negotiation_cs13
          *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Negotiation_cs13));
          buf[0U] = ((Prims_list__Negotiation_cs13){ .tag = Prims_Nil });
          r = buf;
        }
        Prims_list__Negotiation_cs13 *r1;
        if (FStar_List_Tot_Base_mem__Extensions_psk_kex(Extensions_PSK_DHE_KE, psk_kex))
        {
          KRML_CHECK_SIZE(sizeof (Prims_list__Negotiation_cs13), (uint32_t)1U);
          Prims_list__Negotiation_cs13
          *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Negotiation_cs13));
          buf[0U]
          =
            (
              (Prims_list__Negotiation_cs13){
                .tag = Prims_Cons,
                .hd = {
                  .tag = Negotiation_PSK_EDH,
                  .val = { .case_PSK_EDH = { .j = i1, .oks = g_gx, .cs = cs } }
                },
                .tl = r
              }
            );
          r1 = buf;
        }
        else
          r1 = r;
        choices = r1;
      }
      else
      {
        KRML_CHECK_SIZE(sizeof (Prims_list__Negotiation_cs13), (uint32_t)1U);
        Prims_list__Negotiation_cs13 *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Negotiation_cs13));
        buf[0U] = ((Prims_list__Negotiation_cs13){ .tag = Prims_Nil });
        choices = buf;
      }
    }
    else
    {
      KRML_CHECK_SIZE(sizeof (Prims_list__Negotiation_cs13), (uint32_t)1U);
      Prims_list__Negotiation_cs13 *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Negotiation_cs13));
      buf[0U] = ((Prims_list__Negotiation_cs13){ .tag = Prims_Nil });
      choices = buf;
    }
    return
      FStar_List_Tot_Base_append__Negotiation_cs13(choices,
        Negotiation_compute_cs13_aux(Prims_op_Addition(i1, (krml_checked_int_t)1),
          o,
          psks,
          g_gx,
          ncs,
          psk_kex,
          server_cert));
  }
}

static bool Negotiation_is_cs13_in_cfg(TLSConstants_config cfg, CipherSuite_cipherSuite_ cs)
{
  return
    CipherSuite_uu___is_CipherSuite13(cs)
    && FStar_List_Tot_Base_mem__CipherSuite_cipherSuite_(cs, cfg.cipher_suites);
}

static bool
Negotiation_is_in_cfg_named_groups(TLSConstants_config cfg, Parsers_NamedGroup_namedGroup g1)
{
  return FStar_List_Tot_Base_mem__Parsers_NamedGroup_namedGroup(g1, cfg.named_groups);
}

static CommonDH_group_ Negotiation_group_of_named_group(Parsers_NamedGroup_namedGroup x)
{
  FStar_Pervasives_Native_option__CommonDH_group_ x0 = CommonDH_group_of_namedGroup(x);
  if (x0.tag == FStar_Pervasives_Native_Some)
    return x0.v;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

static bool
FStar_List_Tot_Base_mem__CommonDH_group_(
  CommonDH_group_ x,
  Prims_list__CommonDH_group_ *uu___7_953
)
{
  if (uu___7_953->tag == Prims_Nil)
    return false;
  else if (uu___7_953->tag == Prims_Cons)
  {
    Prims_list__CommonDH_group_ *tl1 = uu___7_953->tl;
    CommonDH_group_ hd1 = uu___7_953->hd;
    if (__eq__CommonDH_group_(hd1, x))
      return true;
    else
      return FStar_List_Tot_Base_mem__CommonDH_group_(x, tl1);
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

static bool
Negotiation_share_in_named_group(
  Prims_list__CommonDH_group_ *gl,
  Prims_dtuple2__CommonDH_group__CommonDH_pre_share_ x
)
{
  CommonDH_group_ g1 = x.fst;
  return FStar_List_Tot_Base_mem__CommonDH_group_(g1, gl);
}

Prims_list__CipherSuite_cipherSuite_
*Negotiation_filter_cipherSuites13_aux(
  TLSConstants_config cfg,
  Prims_list__Parsers_CipherSuite_cipherSuite *l,
  Prims_list__CipherSuite_cipherSuite_ *accu
)
{
  if (l->tag == Prims_Nil)
    return FStar_List_Tot_Base_rev__CipherSuite_cipherSuite_(accu);
  else if (l->tag == Prims_Cons)
  {
    Prims_list__Parsers_CipherSuite_cipherSuite *q = l->tl;
    Parsers_CipherSuite_cipherSuite csn = l->hd;
    FStar_Pervasives_Native_option__CipherSuite_cipherSuite_ scrut0;
    if (csn.tag == Parsers_CipherSuite_TLS_NULL_WITH_NULL_NULL)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = { .tag = CipherSuite_NullCipherSuite }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_AES_128_GCM_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite13,
              .val = {
                .case_CipherSuite13 = {
                  ._0 = EverCrypt_AES128_GCM,
                  ._1 = Spec_Hash_Definitions_SHA2_256
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_AES_256_GCM_SHA384)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite13,
              .val = {
                .case_CipherSuite13 = {
                  ._0 = EverCrypt_AES256_GCM,
                  ._1 = Spec_Hash_Definitions_SHA2_384
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_CHACHA20_POLY1305_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite13,
              .val = {
                .case_CipherSuite13 = {
                  ._0 = EverCrypt_CHACHA20_POLY1305,
                  ._1 = Spec_Hash_Definitions_SHA2_256
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_AES_128_CCM_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite13,
              .val = {
                .case_CipherSuite13 = {
                  ._0 = EverCrypt_AES128_CCM,
                  ._1 = Spec_Hash_Definitions_SHA2_256
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_AES_128_CCM_8_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite13,
              .val = {
                .case_CipherSuite13 = {
                  ._0 = EverCrypt_AES128_CCM8,
                  ._1 = Spec_Hash_Definitions_SHA2_256
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_RSA_WITH_NULL_MD5)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_RSA,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MACOnly,
                    .val = { .case_MACOnly = Spec_Hash_Definitions_MD5 }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_RSA_WITH_NULL_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_RSA,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MACOnly,
                    .val = { .case_MACOnly = Spec_Hash_Definitions_SHA1 }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_RSA_WITH_NULL_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_RSA,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MACOnly,
                    .val = { .case_MACOnly = Spec_Hash_Definitions_SHA2_256 }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_RSA_WITH_RC4_128_MD5)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_RSA,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Stream,
                          .val = { .case_Stream = EverCrypt_RC4_128 }
                        },
                        ._1 = Spec_Hash_Definitions_MD5
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_RSA_WITH_RC4_128_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_RSA,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Stream,
                          .val = { .case_Stream = EverCrypt_RC4_128 }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_RSA_WITH_3DES_EDE_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_RSA,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_TDES_EDE_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_RSA_WITH_AES_128_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_RSA,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES128_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_RSA_WITH_AES_256_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_RSA,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES256_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_RSA_WITH_AES_128_CBC_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_RSA,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES128_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_RSA_WITH_AES_256_CBC_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_RSA,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES256_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_DSS_WITH_3DES_EDE_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_DSA },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_TDES_EDE_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_RSA_WITH_3DES_EDE_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_TDES_EDE_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_128_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_DSA },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES128_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_128_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES128_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_256_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_DSA },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES256_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_256_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES256_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_128_CBC_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_DSA },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES128_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_128_CBC_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES128_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_256_CBC_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_DSA },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES256_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_256_CBC_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES256_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_RC4_128_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Stream,
                          .val = { .case_Stream = EverCrypt_RC4_128 }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_TDES_EDE_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES128_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES128_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES256_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES256_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA2_384
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_ECDSA },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES128_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES128_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_ECDSA },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES256_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_384
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES256_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_384
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DH_anon_WITH_RC4_128_MD5)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Stream,
                          .val = { .case_Stream = EverCrypt_RC4_128 }
                        },
                        ._1 = Spec_Hash_Definitions_MD5
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DH_anon_WITH_3DES_EDE_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_TDES_EDE_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DH_anon_WITH_AES_128_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES128_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DH_anon_WITH_AES_256_CBC_SHA)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES256_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA1
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DH_anon_WITH_AES_128_CBC_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES128_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DH_anon_WITH_AES_256_CBC_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_MtE,
                    .val = {
                      .case_MtE = {
                        ._0 = {
                          .tag = CipherSuite_Block,
                          .val = { .case_Block = EverCrypt_AES256_CBC }
                        },
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_RSA_WITH_AES_128_GCM_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_RSA,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES128_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_RSA_WITH_AES_256_GCM_SHA384)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_RSA,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES256_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_384
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_128_GCM_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES128_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_256_GCM_SHA384)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES256_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_384
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DH_RSA_WITH_AES_128_GCM_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DH,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES128_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DH_RSA_WITH_AES_256_GCM_SHA384)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DH,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES256_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_384
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_128_GCM_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_DSA },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES128_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_256_GCM_SHA384)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_DSA },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES256_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_384
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DH_DSS_WITH_AES_128_GCM_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DH,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_DSA },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES128_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DH_DSS_WITH_AES_256_GCM_SHA384)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DH,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_DSA },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES256_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_384
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DH_anon_WITH_AES_128_GCM_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES128_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DH_anon_WITH_AES_256_GCM_SHA384)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_AES256_GCM,
                        ._1 = Spec_Hash_Definitions_SHA2_384
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_CHACHA20_POLY1305,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_ECDSA },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_CHACHA20_POLY1305,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_RSA_WITH_CHACHA20_POLY1305_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_Some, .v = CipherSuite_RSASIG },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_CHACHA20_POLY1305,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_PSK_WITH_CHACHA20_POLY1305_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_PSK,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_CHACHA20_POLY1305,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_ECDHE_PSK_WITH_CHACHA20_POLY1305_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_PSK_ECDHE,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_CHACHA20_POLY1305,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else if (csn.tag == Parsers_CipherSuite_TLS_DHE_PSK_WITH_CHACHA20_POLY1305_SHA256)
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = {
              .tag = CipherSuite_CipherSuite,
              .val = {
                .case_CipherSuite = {
                  ._0 = CipherSuite_Kex_PSK_DHE,
                  ._1 = { .tag = FStar_Pervasives_Native_None },
                  ._2 = {
                    .tag = CipherSuite_AEAD,
                    .val = {
                      .case_AEAD = {
                        ._0 = EverCrypt_CHACHA20_POLY1305,
                        ._1 = Spec_Hash_Definitions_SHA2_256
                      }
                    }
                  }
                }
              }
            }
          }
        );
    else
      scrut0 =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_None
          }
        );
    FStar_Pervasives_Native_option__CipherSuite_cipherSuite_ scrut;
    if (scrut0.tag == FStar_Pervasives_Native_Some)
    {
      CipherSuite_cipherSuite_ v1 = scrut0.v;
      scrut =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_Some,
            .v = v1
          }
        );
    }
    else if (scrut0.tag == FStar_Pervasives_Native_None)
      scrut =
        (
          (FStar_Pervasives_Native_option__CipherSuite_cipherSuite_){
            .tag = FStar_Pervasives_Native_None
          }
        );
    else
      scrut =
        KRML_EABORT(FStar_Pervasives_Native_option__CipherSuite_cipherSuite_,
          "unreachable (pattern matches are exhaustive in F*)");
    Prims_list__CipherSuite_cipherSuite_ *accu_;
    if (scrut.tag == FStar_Pervasives_Native_None)
      accu_ = accu;
    else if (scrut.tag == FStar_Pervasives_Native_Some)
    {
      CipherSuite_cipherSuite_ cs = scrut.v;
      if (Negotiation_is_cs13_in_cfg(cfg, cs))
      {
        KRML_CHECK_SIZE(sizeof (Prims_list__CipherSuite_cipherSuite_), (uint32_t)1U);
        Prims_list__CipherSuite_cipherSuite_
        *buf = KRML_HOST_MALLOC(sizeof (Prims_list__CipherSuite_cipherSuite_));
        buf[0U]
        = ((Prims_list__CipherSuite_cipherSuite_){ .tag = Prims_Cons, .hd = cs, .tl = accu });
        accu_ = buf;
      }
      else
        accu_ = accu;
    }
    else
      accu_ =
        KRML_EABORT(Prims_list__CipherSuite_cipherSuite_ *,
          "unreachable (pattern matches are exhaustive in F*)");
    return Negotiation_filter_cipherSuites13_aux(cfg, q, accu_);
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

Prims_list__CipherSuite_cipherSuite_
*Negotiation_filter_cipherSuites13(
  TLSConstants_config cfg,
  Prims_list__Parsers_CipherSuite_cipherSuite *l
)
{
  KRML_CHECK_SIZE(sizeof (Prims_list__CipherSuite_cipherSuite_), (uint32_t)1U);
  Prims_list__CipherSuite_cipherSuite_
  *buf = KRML_HOST_MALLOC(sizeof (Prims_list__CipherSuite_cipherSuite_));
  buf[0U] = ((Prims_list__CipherSuite_cipherSuite_){ .tag = Prims_Nil });
  return Negotiation_filter_cipherSuites13_aux(cfg, l, buf);
}

static Prims_list__Parsers_NamedGroup_namedGroup
*List_Helpers_filter_aux__Parsers_NamedGroup_namedGroup_TLSConstants_config(
  TLSConstants_config env,
  bool (*f)(TLSConstants_config x0, Parsers_NamedGroup_namedGroup x1),
  Prims_list__Parsers_NamedGroup_namedGroup *l
)
{
  if (l->tag == Prims_Nil)
  {
    KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_NamedGroup_namedGroup), (uint32_t)1U);
    Prims_list__Parsers_NamedGroup_namedGroup
    *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_NamedGroup_namedGroup));
    buf[0U] = ((Prims_list__Parsers_NamedGroup_namedGroup){ .tag = Prims_Nil });
    return buf;
  }
  else if (l->tag == Prims_Cons)
  {
    Prims_list__Parsers_NamedGroup_namedGroup *tl1 = l->tl;
    Parsers_NamedGroup_namedGroup hd1 = l->hd;
    if (f(env, hd1))
    {
      KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_NamedGroup_namedGroup), (uint32_t)1U);
      Prims_list__Parsers_NamedGroup_namedGroup
      *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_NamedGroup_namedGroup));
      buf[0U]
      =
        (
          (Prims_list__Parsers_NamedGroup_namedGroup){
            .tag = Prims_Cons,
            .hd = hd1,
            .tl = List_Helpers_filter_aux__Parsers_NamedGroup_namedGroup_TLSConstants_config(env,
              f,
              tl1)
          }
        );
      return buf;
    }
    else
      return
        List_Helpers_filter_aux__Parsers_NamedGroup_namedGroup_TLSConstants_config(env,
          f,
          tl1);
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

static Parsers_NamedGroup_namedGroup
FStar_List_Tot_Base_hd__Parsers_NamedGroup_namedGroup(
  Prims_list__Parsers_NamedGroup_namedGroup *uu___0_39
)
{
  if (uu___0_39->tag == Prims_Cons)
    return uu___0_39->hd;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

Prims_list__CommonDH_group_
*FStar_List_Tot_Base_map__Parsers_NamedGroup_namedGroup_CommonDH_group_(
  CommonDH_group_ (*f)(Parsers_NamedGroup_namedGroup x0),
  Prims_list__Parsers_NamedGroup_namedGroup *x
)
{
  if (x->tag == Prims_Nil)
  {
    KRML_CHECK_SIZE(sizeof (Prims_list__CommonDH_group_), (uint32_t)1U);
    Prims_list__CommonDH_group_ *buf = KRML_HOST_MALLOC(sizeof (Prims_list__CommonDH_group_));
    buf[0U] = ((Prims_list__CommonDH_group_){ .tag = Prims_Nil });
    return buf;
  }
  else if (x->tag == Prims_Cons)
  {
    Prims_list__Parsers_NamedGroup_namedGroup *tl1 = x->tl;
    Parsers_NamedGroup_namedGroup a = x->hd;
    KRML_CHECK_SIZE(sizeof (Prims_list__CommonDH_group_), (uint32_t)1U);
    Prims_list__CommonDH_group_ *buf = KRML_HOST_MALLOC(sizeof (Prims_list__CommonDH_group_));
    buf[0U]
    =
      (
        (Prims_list__CommonDH_group_){
          .tag = Prims_Cons,
          .hd = f(a),
          .tl = FStar_List_Tot_Base_map__Parsers_NamedGroup_namedGroup_CommonDH_group_(f, tl1)
        }
      );
    return buf;
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

static FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_
List_Helpers_find_aux__Prims_dtuple2_CommonDH_group__CommonDH_pre_share__Prims_list_CommonDH_group_(
  Prims_list__CommonDH_group_ *env,
  bool
  (*f)(Prims_list__CommonDH_group_ *x0, Prims_dtuple2__CommonDH_group__CommonDH_pre_share_ x1),
  Prims_list__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_ *l
)
{
  if (l->tag == Prims_Nil)
    return
      (
        (FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_){
          .tag = FStar_Pervasives_Native_None
        }
      );
  else if (l->tag == Prims_Cons)
  {
    Prims_list__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_ *tl1 = l->tl;
    Prims_dtuple2__CommonDH_group__CommonDH_pre_share_ hd1 = l->hd;
    if (f(env, hd1))
      return
        (
          (FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_){
            .tag = FStar_Pervasives_Native_Some,
            .v = hd1
          }
        );
    else
      return
        List_Helpers_find_aux__Prims_dtuple2_CommonDH_group__CommonDH_pre_share__Prims_list_CommonDH_group_(env,
          f,
          tl1);
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

typedef struct
K___FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share__FStar_Pervasives_Native_option__K___Parsers_NamedGroup_namedGroup_CipherSuite_cipherSuite__s
{
  FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_ fst;
  FStar_Pervasives_Native_option__K___Parsers_NamedGroup_namedGroup_CipherSuite_cipherSuite_ snd;
}
K___FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share__FStar_Pervasives_Native_option__K___Parsers_NamedGroup_namedGroup_CipherSuite_cipherSuite_;

FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_K___Prims_list__Negotiation_cs13_FStar_Pervasives_Native_option__K___Parsers_NamedGroup_namedGroup_CipherSuite_cipherSuite_
Negotiation_compute_cs13(
  TLSConstants_config cfg,
  HandshakeMessages_ch o,
  Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo *psks,
  Prims_list__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_ *shares,
  bool server_cert
)
{
  Prims_list__CipherSuite_cipherSuite_
  *ncs = Negotiation_filter_cipherSuites13(cfg, o.ch_cipher_suites);
  FStar_Pervasives_Native_option__Prims_list__Parsers_NamedGroup_namedGroup
  scrut0 = Negotiation_find_supported_groups(o);
  K___FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share__FStar_Pervasives_Native_option__K___Parsers_NamedGroup_namedGroup_CipherSuite_cipherSuite_
  scrut;
  if (scrut0.tag == FStar_Pervasives_Native_None)
    scrut =
      (
        (K___FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share__FStar_Pervasives_Native_option__K___Parsers_NamedGroup_namedGroup_CipherSuite_cipherSuite_){
          .fst = { .tag = FStar_Pervasives_Native_None },
          .snd = { .tag = FStar_Pervasives_Native_None }
        }
      );
  else if (scrut0.tag == FStar_Pervasives_Native_Some)
  {
    Prims_list__Parsers_NamedGroup_namedGroup *gs = scrut0.v;
    Prims_list__Parsers_NamedGroup_namedGroup
    *scrut0 =
      List_Helpers_filter_aux__Parsers_NamedGroup_namedGroup_TLSConstants_config(cfg,
        Negotiation_is_in_cfg_named_groups,
        gs);
    if (scrut0->tag == Prims_Nil)
      scrut =
        (
          (K___FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share__FStar_Pervasives_Native_option__K___Parsers_NamedGroup_namedGroup_CipherSuite_cipherSuite_){
            .fst = { .tag = FStar_Pervasives_Native_None },
            .snd = { .tag = FStar_Pervasives_Native_None }
          }
        );
    else
    {
      Prims_list__Parsers_NamedGroup_namedGroup *gl = scrut0;
      FStar_Pervasives_Native_option__K___Parsers_NamedGroup_namedGroup_CipherSuite_cipherSuite_
      csg;
      if (ncs->tag == Prims_Nil)
        csg =
          (
            (FStar_Pervasives_Native_option__K___Parsers_NamedGroup_namedGroup_CipherSuite_cipherSuite_){
              .tag = FStar_Pervasives_Native_None
            }
          );
      else if (ncs->tag == Prims_Cons)
      {
        CipherSuite_cipherSuite_ cs = ncs->hd;
        csg =
          (
            (FStar_Pervasives_Native_option__K___Parsers_NamedGroup_namedGroup_CipherSuite_cipherSuite_){
              .tag = FStar_Pervasives_Native_Some,
              .v = { .fst = FStar_List_Tot_Base_hd__Parsers_NamedGroup_namedGroup(gl), .snd = cs }
            }
          );
      }
      else
        csg =
          KRML_EABORT(FStar_Pervasives_Native_option__K___Parsers_NamedGroup_namedGroup_CipherSuite_cipherSuite_,
            "unreachable (pattern matches are exhaustive in F*)");
      Prims_list__CommonDH_group_
      *gl_ =
        FStar_List_Tot_Base_map__Parsers_NamedGroup_namedGroup_CommonDH_group_(Negotiation_group_of_named_group,
          gl);
      FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_
      s =
        List_Helpers_find_aux__Prims_dtuple2_CommonDH_group__CommonDH_pre_share__Prims_list_CommonDH_group_(gl_,
          Negotiation_share_in_named_group,
          shares);
      FStar_Pervasives_Native_option__K___Parsers_NamedGroup_namedGroup_CipherSuite_cipherSuite_
      ite;
      if (server_cert)
        ite = csg;
      else
        ite =
          (
            (FStar_Pervasives_Native_option__K___Parsers_NamedGroup_namedGroup_CipherSuite_cipherSuite_){
              .tag = FStar_Pervasives_Native_None
            }
          );
      scrut =
        (
          (K___FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share__FStar_Pervasives_Native_option__K___Parsers_NamedGroup_namedGroup_CipherSuite_cipherSuite_){
            .fst = s,
            .snd = ite
          }
        );
    }
  }
  else
    scrut =
      KRML_EABORT(K___FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share__FStar_Pervasives_Native_option__K___Parsers_NamedGroup_namedGroup_CipherSuite_cipherSuite_,
        "unreachable (pattern matches are exhaustive in F*)");
  FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_
  g_gx = scrut.fst;
  FStar_Pervasives_Native_option__K___Parsers_NamedGroup_namedGroup_CipherSuite_cipherSuite_
  g_hrr = scrut.snd;
  Prims_list__Extensions_psk_kex *psk_kex = Negotiation_find_psk_key_exchange_modes(o);
  return
    (
      (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_K___Prims_list__Negotiation_cs13_FStar_Pervasives_Native_option__K___Parsers_NamedGroup_namedGroup_CipherSuite_cipherSuite_){
        .tag = FStar_Error_Correct,
        .val = {
          .case_Correct = {
            .fst = Negotiation_compute_cs13_aux((krml_checked_int_t)0,
              o,
              psks,
              g_gx,
              ncs,
              psk_kex,
              server_cert),
            .snd = g_hrr
          }
        }
      }
    );
}

Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo
*Negotiation_filter_psk(uint32_t max_age, Prims_list__K___FStar_Bytes_bytes_uint32_t *l)
{
  if (l->tag == Prims_Nil)
  {
    KRML_CHECK_SIZE(sizeof (Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo), (uint32_t)1U);
    Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo
    *buf = KRML_HOST_MALLOC(sizeof (Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo));
    buf[0U] = ((Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo){ .tag = Prims_Nil });
    return buf;
  }
  else if (l->tag == Prims_Cons)
  {
    Prims_list__K___FStar_Bytes_bytes_uint32_t *t = l->tl;
    uint32_t age = l->hd.snd;
    FStar_Bytes_bytes id1 = l->hd.fst;
    FStar_Pervasives_Native_option__TLSConstants_pskInfo scrut = Ticket_check_ticket13(id1);
    if (scrut.tag == FStar_Pervasives_Native_Some)
    {
      TLSConstants_pskInfo info = scrut.v;
      uint32_t real_age = PSK_decode_age(age, info.ticket_age_add);
      if (real_age <= max_age * (uint32_t)1000U)
      {
        Negotiation_print(Prims_strcat("Loaded PSK from ticket <",
            Prims_strcat(FStar_Bytes_print_bytes(id1), ">")));
        KRML_CHECK_SIZE(sizeof (Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo),
          (uint32_t)1U);
        Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo
        *buf = KRML_HOST_MALLOC(sizeof (Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo));
        buf[0U]
        =
          (
            (Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo){
              .tag = Prims_Cons,
              .hd = { .fst = id1, .snd = info },
              .tl = Negotiation_filter_psk(max_age, t)
            }
          );
        return buf;
      }
      else
      {
        Negotiation_print(Prims_strcat("Ticket <",
            Prims_strcat(FStar_Bytes_print_bytes(id1), "> is too old")));
        return Negotiation_filter_psk(max_age, t);
      }
    }
    else if (scrut.tag == FStar_Pervasives_Native_None)
    {
      FStar_Pervasives_Native_option__TLSConstants_pskInfo scrut = PSK_psk_lookup(id1);
      if (scrut.tag == FStar_Pervasives_Native_Some)
      {
        TLSConstants_pskInfo info = scrut.v;
        Negotiation_print(Prims_strcat("Loaded PSK from table <",
            Prims_strcat(FStar_Bytes_print_bytes(id1), ">")));
        KRML_CHECK_SIZE(sizeof (Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo),
          (uint32_t)1U);
        Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo
        *buf = KRML_HOST_MALLOC(sizeof (Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo));
        buf[0U]
        =
          (
            (Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo){
              .tag = Prims_Cons,
              .hd = { .fst = id1, .snd = info },
              .tl = Negotiation_filter_psk(max_age, t)
            }
          );
        return buf;
      }
      else if (scrut.tag == FStar_Pervasives_Native_None)
      {
        Negotiation_print(Prims_strcat("WARNING: ignored PSK <",
            Prims_strcat(FStar_Bytes_print_bytes(id1), ">")));
        return Negotiation_filter_psk(max_age, t);
      }
      else
      {
        KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
          __FILE__,
          __LINE__,
          "unreachable (pattern matches are exhaustive in F*)");
        KRML_HOST_EXIT(255U);
      }
    }
    else
    {
      KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
        __FILE__,
        __LINE__,
        "unreachable (pattern matches are exhaustive in F*)");
      KRML_HOST_EXIT(255U);
    }
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

Prims_list__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_
*Negotiation_register_shares(Prims_list__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_ *l)
{
  if (l->tag == Prims_Nil)
  {
    KRML_CHECK_SIZE(sizeof (Prims_list__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_),
      (uint32_t)1U);
    Prims_list__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_
    *buf =
      KRML_HOST_MALLOC(sizeof (Prims_list__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_));
    buf[0U]
    = ((Prims_list__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_){ .tag = Prims_Nil });
    return buf;
  }
  else if (l->tag == Prims_Cons)
  {
    Prims_list__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_ *t = l->tl;
    CommonDH_pre_share_ gx = l->hd.snd;
    CommonDH_group_ g1 = l->hd.fst;
    Prims_dtuple2__CommonDH_group__CommonDH_pre_share_
    uu____0 = { .fst = g1, .snd = CommonDH_register_dhi(g1, gx) };
    KRML_CHECK_SIZE(sizeof (Prims_list__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_),
      (uint32_t)1U);
    Prims_list__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_
    *buf =
      KRML_HOST_MALLOC(sizeof (Prims_list__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_));
    buf[0U]
    =
      (
        (Prims_list__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_){
          .tag = Prims_Cons,
          .hd = uu____0,
          .tl = Negotiation_register_shares(t)
        }
      );
    return buf;
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

bool Negotiation_uu___is_ServerHelloRetryRequest(Negotiation_serverMode projectee)
{
  if (projectee.tag == Negotiation_ServerHelloRetryRequest)
    return true;
  else
    return false;
}

HandshakeMessages_hrr
Negotiation___proj__ServerHelloRetryRequest__item__hrr(Negotiation_serverMode projectee)
{
  if (projectee.tag == Negotiation_ServerHelloRetryRequest)
    return projectee.val.case_ServerHelloRetryRequest.hrr;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

CipherSuite_cipherSuite_
Negotiation___proj__ServerHelloRetryRequest__item__cs(Negotiation_serverMode projectee)
{
  if (projectee.tag == Negotiation_ServerHelloRetryRequest)
    return projectee.val.case_ServerHelloRetryRequest.cs;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

bool Negotiation_uu___is_ServerMode(Negotiation_serverMode projectee)
{
  if (projectee.tag == Negotiation_ServerMode)
    return true;
  else
    return false;
}

Negotiation_mode Negotiation___proj__ServerMode__item___0(Negotiation_serverMode projectee)
{
  if (projectee.tag == Negotiation_ServerMode)
    return projectee.val.case_ServerMode._0;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

FStar_Pervasives_Native_option__K___uint64_t_Parsers_SignatureScheme_signatureScheme
Negotiation___proj__ServerMode__item___1(Negotiation_serverMode projectee)
{
  if (projectee.tag == Negotiation_ServerMode)
    return projectee.val.case_ServerMode._1;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

Prims_list__Extensions_extension_
*Negotiation___proj__ServerMode__item___2(Negotiation_serverMode projectee)
{
  if (projectee.tag == Negotiation_ServerMode)
    return projectee.val.case_ServerMode._2;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

bool Extensions_uu___is_E_server_name____(Extensions_extension_ projectee)
{
  if (projectee.tag == Extensions_E_server_name)
    return true;
  else
    return false;
}

FStar_Bytes_bytes Negotiation_get_sni(HandshakeMessages_ch o)
{
  FStar_Pervasives_Native_option__Extensions_extension_
  scrut = Negotiation_find_client_extension(Extensions_uu___is_E_server_name____, o);
  if
  (
    scrut.tag
    == FStar_Pervasives_Native_Some
    &&
      scrut.v.tag
      == Extensions_E_server_name
      &&
        scrut.v.val.case_E_server_name->tag
        == Prims_Cons
        && scrut.v.val.case_E_server_name->hd.tag == TLSConstants_SNI_DNS
  )
    return scrut.v.val.case_E_server_name->hd.val.case_SNI_DNS;
  else
    return FStar_Bytes_empty_bytes;
}

bool Extensions_uu___is_E_alpn____(Extensions_extension_ projectee)
{
  if (projectee.tag == Extensions_E_alpn)
    return true;
  else
    return false;
}

Prims_list__FStar_Bytes_bytes *Negotiation_get_alpn(HandshakeMessages_ch o)
{
  FStar_Pervasives_Native_option__Extensions_extension_
  scrut = Negotiation_find_client_extension(Extensions_uu___is_E_alpn____, o);
  if (scrut.tag == FStar_Pervasives_Native_None)
  {
    KRML_CHECK_SIZE(sizeof (Prims_list__FStar_Bytes_bytes), (uint32_t)1U);
    Prims_list__FStar_Bytes_bytes *buf = KRML_HOST_MALLOC(sizeof (Prims_list__FStar_Bytes_bytes));
    buf[0U] = ((Prims_list__FStar_Bytes_bytes){ .tag = Prims_Nil });
    return buf;
  }
  else if (scrut.tag == FStar_Pervasives_Native_Some && scrut.v.tag == Extensions_E_alpn)
    return scrut.v.val.case_E_alpn;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

FStar_Bytes_bytes Negotiation_nego_alpn(HandshakeMessages_ch o, TLSConstants_config cfg)
{
  if (cfg.alpn.tag == FStar_Pervasives_Native_None)
    return FStar_Bytes_empty_bytes;
  else if (cfg.alpn.tag == FStar_Pervasives_Native_Some)
  {
    Prims_list__FStar_Bytes_bytes *sal = cfg.alpn.v;
    FStar_Pervasives_Native_option__Extensions_extension_
    scrut = Negotiation_find_client_extension(Extensions_uu___is_E_alpn____, o);
    if (scrut.tag == FStar_Pervasives_Native_None)
      return FStar_Bytes_empty_bytes;
    else if (scrut.tag == FStar_Pervasives_Native_Some && scrut.v.tag == Extensions_E_alpn)
    {
      Prims_list__FStar_Bytes_bytes *cal = scrut.v.val.case_E_alpn;
      Prims_list__FStar_Bytes_bytes
      *scrut =
        List_Helpers_filter_aux__FStar_Bytes_bytes_Prims_list_FStar_Bytes_bytes(sal,
          List_Helpers_mem_rev__FStar_Bytes_bytes,
          cal);
      if (scrut->tag == Prims_Cons)
        return scrut->hd;
      else
        return FStar_Bytes_empty_bytes;
    }
    else
    {
      KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
        __FILE__,
        __LINE__,
        "unreachable (pattern matches are exhaustive in F*)");
      KRML_HOST_EXIT(255U);
    }
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

static Prims_list__Parsers_SignatureScheme_signatureScheme
*List_Helpers_filter_aux__Parsers_SignatureScheme_signatureScheme_Prims_list_Parsers_SignatureScheme_signatureScheme(
  Prims_list__Parsers_SignatureScheme_signatureScheme *env,
  bool
  (*f)(
    Prims_list__Parsers_SignatureScheme_signatureScheme *x0,
    Parsers_SignatureScheme_signatureScheme x1
  ),
  Prims_list__Parsers_SignatureScheme_signatureScheme *l
)
{
  if (l->tag == Prims_Nil)
  {
    KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme), (uint32_t)1U);
    Prims_list__Parsers_SignatureScheme_signatureScheme
    *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme));
    buf[0U] = ((Prims_list__Parsers_SignatureScheme_signatureScheme){ .tag = Prims_Nil });
    return buf;
  }
  else if (l->tag == Prims_Cons)
  {
    Prims_list__Parsers_SignatureScheme_signatureScheme *tl1 = l->tl;
    Parsers_SignatureScheme_signatureScheme hd1 = l->hd;
    if (f(env, hd1))
    {
      KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme), (uint32_t)1U);
      Prims_list__Parsers_SignatureScheme_signatureScheme
      *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme));
      buf[0U]
      =
        (
          (Prims_list__Parsers_SignatureScheme_signatureScheme){
            .tag = Prims_Cons,
            .hd = hd1,
            .tl = List_Helpers_filter_aux__Parsers_SignatureScheme_signatureScheme_Prims_list_Parsers_SignatureScheme_signatureScheme(env,
              f,
              tl1)
          }
        );
      return buf;
    }
    else
      return
        List_Helpers_filter_aux__Parsers_SignatureScheme_signatureScheme_Prims_list_Parsers_SignatureScheme_signatureScheme(env,
          f,
          tl1);
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

static bool
List_Helpers_mem_rev__Parsers_SignatureScheme_signatureScheme(
  Prims_list__Parsers_SignatureScheme_signatureScheme *l,
  Parsers_SignatureScheme_signatureScheme x
)
{
  return FStar_List_Tot_Base_mem__Parsers_SignatureScheme_signatureScheme(x, l);
}

static Prims_list__Parsers_SignatureScheme_signatureScheme
*FStar_List_Tot_Base_rev_acc__Parsers_SignatureScheme_signatureScheme(
  Prims_list__Parsers_SignatureScheme_signatureScheme *l,
  Prims_list__Parsers_SignatureScheme_signatureScheme *acc
)
{
  if (l->tag == Prims_Nil)
    return acc;
  else if (l->tag == Prims_Cons)
  {
    Prims_list__Parsers_SignatureScheme_signatureScheme *tl1 = l->tl;
    Parsers_SignatureScheme_signatureScheme hd1 = l->hd;
    KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme), (uint32_t)1U);
    Prims_list__Parsers_SignatureScheme_signatureScheme
    *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme));
    buf[0U]
    =
      (
        (Prims_list__Parsers_SignatureScheme_signatureScheme){
          .tag = Prims_Cons,
          .hd = hd1,
          .tl = acc
        }
      );
    return FStar_List_Tot_Base_rev_acc__Parsers_SignatureScheme_signatureScheme(tl1, buf);
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

static Prims_list__Parsers_SignatureScheme_signatureScheme
*FStar_List_Tot_Base_rev__Parsers_SignatureScheme_signatureScheme(
  Prims_list__Parsers_SignatureScheme_signatureScheme *l
)
{
  KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme), (uint32_t)1U);
  Prims_list__Parsers_SignatureScheme_signatureScheme
  *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme));
  buf[0U] = ((Prims_list__Parsers_SignatureScheme_signatureScheme){ .tag = Prims_Nil });
  return FStar_List_Tot_Base_rev_acc__Parsers_SignatureScheme_signatureScheme(l, buf);
}

static bool
FStar_Pervasives_Native_uu___is_Some__uint64_t___Parsers_SignatureScheme_signatureScheme(
  FStar_Pervasives_Native_option__K___uint64_t_Parsers_SignatureScheme_signatureScheme projectee
)
{
  if (projectee.tag == FStar_Pervasives_Native_Some)
    return true;
  else
    return false;
}

FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_serverMode
TLSError_fatal__Negotiation_serverMode(
  Parsers_AlertDescription_alertDescription a,
  Prims_string s
)
{
  return
    (
      (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_serverMode){
        .tag = FStar_Error_Error,
        .val = { .case_Error = { .fst = TLSError_fatalAlert(a), .snd = s } }
      }
    );
}

static bool
__eq__Parsers_CompressionMethod_compressionMethod(
  Parsers_CompressionMethod_compressionMethod y,
  Parsers_CompressionMethod_compressionMethod x
)
{
  if (x.tag == Parsers_CompressionMethod_NullCompression)
    if (y.tag == Parsers_CompressionMethod_NullCompression)
      return true;
    else
      return false;
  else if (x.tag == Parsers_CompressionMethod_Unknown_compressionMethod)
  {
    uint8_t x__0 = x._0;
    if (y.tag == Parsers_CompressionMethod_Unknown_compressionMethod)
    {
      uint8_t y__0 = y._0;
      return true && y__0 == x__0;
    }
    else
      return false;
  }
  else
    return false;
}

static bool
FStar_List_Tot_Base_mem__Parsers_CompressionMethod_compressionMethod(
  Parsers_CompressionMethod_compressionMethod x,
  Prims_list__Parsers_CompressionMethod_compressionMethod *uu___7_953
)
{
  if (uu___7_953->tag == Prims_Nil)
    return false;
  else if (uu___7_953->tag == Prims_Cons)
  {
    Prims_list__Parsers_CompressionMethod_compressionMethod *tl1 = uu___7_953->tl;
    Parsers_CompressionMethod_compressionMethod hd1 = uu___7_953->hd;
    if (__eq__Parsers_CompressionMethod_compressionMethod(hd1, x))
      return true;
    else
      return FStar_List_Tot_Base_mem__Parsers_CompressionMethod_compressionMethod(x, tl1);
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_serverMode
Negotiation_computeServerMode(
  TLSConstants_config cfg,
  HandshakeMessages_ch co,
  FStar_Bytes_bytes serverRandom
)
{
  FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_ProtocolVersion_protocolVersion
  scrut0 = Negotiation_negotiate_version(cfg, co);
  if (scrut0.tag == FStar_Error_Error)
  {
    K___Parsers_Alert_alert_Prims_string z = scrut0.val.case_Error;
    return
      (
        (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_serverMode){
          .tag = FStar_Error_Error,
          .val = { .case_Error = z }
        }
      );
  }
  else if
  (
    scrut0.tag
    == FStar_Error_Correct
    && scrut0.val.case_Correct.tag == Parsers_ProtocolVersion_TLS_1p3
  )
  {
    FStar_Pervasives_Native_option__K___Prims_list__K___FStar_Bytes_bytes_uint32_t_Prims_int
    scrut0 = Negotiation_find_clientPske(co);
    Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo *pske0;
    if (scrut0.tag == FStar_Pervasives_Native_Some)
    {
      Prims_list__K___FStar_Bytes_bytes_uint32_t *pske = scrut0.v.fst;
      pske0 = Negotiation_filter_psk(cfg.max_ticket_age, pske);
    }
    else if (scrut0.tag == FStar_Pervasives_Native_None)
    {
      KRML_CHECK_SIZE(sizeof (Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo),
        (uint32_t)1U);
      Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo
      *buf = KRML_HOST_MALLOC(sizeof (Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo));
      buf[0U] = ((Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo){ .tag = Prims_Nil });
      pske0 = buf;
    }
    else
      pske0 =
        KRML_EABORT(Prims_list__K___FStar_Bytes_bytes_TLSConstants_pskInfo *,
          "unreachable (pattern matches are exhaustive in F*)");
    Prims_list__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_
    *shares = Negotiation_register_shares(Negotiation_gs_of(co));
    FStar_Pervasives_Native_option__Prims_list__Parsers_SignatureScheme_signatureScheme
    scrut1 = Negotiation_find_signature_algorithms(co);
    FStar_Pervasives_Native_option__K___uint64_t_Parsers_SignatureScheme_signatureScheme scert;
    if (scrut1.tag == FStar_Pervasives_Native_None)
      scert =
        (
          (FStar_Pervasives_Native_option__K___uint64_t_Parsers_SignatureScheme_signatureScheme){
            .tag = FStar_Pervasives_Native_None
          }
        );
    else if (scrut1.tag == FStar_Pervasives_Native_Some)
    {
      Prims_list__Parsers_SignatureScheme_signatureScheme *sigalgs = scrut1.v;
      Prims_list__Parsers_SignatureScheme_signatureScheme
      *sigalgs1 =
        List_Helpers_filter_aux__Parsers_SignatureScheme_signatureScheme_Prims_list_Parsers_SignatureScheme_signatureScheme(cfg.signature_algorithms,
          List_Helpers_mem_rev__Parsers_SignatureScheme_signatureScheme,
          sigalgs);
      KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme), (uint32_t)1U);
      Prims_list__Parsers_SignatureScheme_signatureScheme
      *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme));
      buf[0U] = ((Prims_list__Parsers_SignatureScheme_signatureScheme){ .tag = Prims_Nil });
      if (__eq__Prims_list__Parsers_SignatureScheme_signatureScheme(sigalgs1, buf))
        scert =
          (
            (FStar_Pervasives_Native_option__K___uint64_t_Parsers_SignatureScheme_signatureScheme){
              .tag = FStar_Pervasives_Native_None
            }
          );
      else
        scert =
          TLSConstants_cert_select_cb(cfg,
            ((Parsers_ProtocolVersion_protocolVersion){ .tag = Parsers_ProtocolVersion_TLS_1p3 }),
            Negotiation_get_sni(co),
            Negotiation_nego_alpn(co, cfg),
            FStar_List_Tot_Base_rev__Parsers_SignatureScheme_signatureScheme(sigalgs1));
    }
    else
      scert =
        KRML_EABORT(FStar_Pervasives_Native_option__K___uint64_t_Parsers_SignatureScheme_signatureScheme,
          "unreachable (pattern matches are exhaustive in F*)");
    FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_K___Prims_list__Negotiation_cs13_FStar_Pervasives_Native_option__K___Parsers_NamedGroup_namedGroup_CipherSuite_cipherSuite_
    scrut2 =
      Negotiation_compute_cs13(cfg,
        co,
        pske0,
        shares,
        FStar_Pervasives_Native_uu___is_Some__uint64_t___Parsers_SignatureScheme_signatureScheme(scert));
    if (scrut2.tag == FStar_Error_Error)
    {
      K___Parsers_Alert_alert_Prims_string z = scrut2.val.case_Error;
      return
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_serverMode){
            .tag = FStar_Error_Error,
            .val = { .case_Error = z }
          }
        );
    }
    else if
    (
      scrut2.tag
      == FStar_Error_Correct
      &&
        scrut2.val.case_Correct.fst->tag
        == Prims_Nil
        && scrut2.val.case_Correct.snd.tag == FStar_Pervasives_Native_None
    )
      return
        TLSError_fatal__Negotiation_serverMode(Parsers_AlertDescription_Handshake_failure,
          "ciphersuite negotiation failed");
    else if
    (
      scrut2.tag
      == FStar_Error_Correct
      &&
        scrut2.val.case_Correct.fst->tag
        == Prims_Nil
        && scrut2.val.case_Correct.snd.tag == FStar_Pervasives_Native_Some
    )
    {
      CipherSuite_cipherSuite_ cs = scrut2.val.case_Correct.snd.v.snd;
      Parsers_NamedGroup_namedGroup ng = scrut2.val.case_Correct.snd.v.fst;
      FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite
      scrut;
      if (cs.tag == CipherSuite_NullCipherSuite)
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_NULL_WITH_NULL_NULL } }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite13
        &&
          cs.val.case_CipherSuite13._0
          == EverCrypt_AES128_GCM
          && cs.val.case_CipherSuite13._1 == Spec_Hash_Definitions_SHA2_256
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_AES_128_GCM_SHA256 } }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite13
        &&
          cs.val.case_CipherSuite13._0
          == EverCrypt_AES256_GCM
          && cs.val.case_CipherSuite13._1 == Spec_Hash_Definitions_SHA2_384
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_AES_256_GCM_SHA384 } }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite13
        &&
          cs.val.case_CipherSuite13._0
          == EverCrypt_CHACHA20_POLY1305
          && cs.val.case_CipherSuite13._1 == Spec_Hash_Definitions_SHA2_256
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_CHACHA20_POLY1305_SHA256 } }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite13
        &&
          cs.val.case_CipherSuite13._0
          == EverCrypt_AES128_CCM
          && cs.val.case_CipherSuite13._1 == Spec_Hash_Definitions_SHA2_256
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_AES_128_CCM_SHA256 } }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite13
        &&
          cs.val.case_CipherSuite13._0
          == EverCrypt_AES128_CCM8
          && cs.val.case_CipherSuite13._1 == Spec_Hash_Definitions_SHA2_256
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_AES_128_CCM_8_SHA256 } }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_RSA
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_None
            &&
              cs.val.case_CipherSuite._2.tag
              == CipherSuite_MACOnly
              && cs.val.case_CipherSuite._2.val.case_MACOnly == Spec_Hash_Definitions_MD5
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_NULL_MD5 } }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_RSA
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_None
            &&
              cs.val.case_CipherSuite._2.tag
              == CipherSuite_MACOnly
              && cs.val.case_CipherSuite._2.val.case_MACOnly == Spec_Hash_Definitions_SHA1
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_NULL_SHA } }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_RSA
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_None
            &&
              cs.val.case_CipherSuite._2.tag
              == CipherSuite_MACOnly
              && cs.val.case_CipherSuite._2.val.case_MACOnly == Spec_Hash_Definitions_SHA2_256
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_NULL_SHA256 } }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_RSA
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_None
            &&
              cs.val.case_CipherSuite._2.tag
              == CipherSuite_MtE
              &&
                cs.val.case_CipherSuite._2.val.case_MtE._0.tag
                == CipherSuite_Stream
                &&
                  cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Stream
                  == EverCrypt_RC4_128
                  && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_MD5
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_RC4_128_MD5 } }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_RSA
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_None
            &&
              cs.val.case_CipherSuite._2.tag
              == CipherSuite_MtE
              &&
                cs.val.case_CipherSuite._2.val.case_MtE._0.tag
                == CipherSuite_Stream
                &&
                  cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Stream
                  == EverCrypt_RC4_128
                  && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_RC4_128_SHA } }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_RSA
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_None
            &&
              cs.val.case_CipherSuite._2.tag
              == CipherSuite_MtE
              &&
                cs.val.case_CipherSuite._2.val.case_MtE._0.tag
                == CipherSuite_Block
                &&
                  cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                  == EverCrypt_TDES_EDE_CBC
                  && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_3DES_EDE_CBC_SHA }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_RSA
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_None
            &&
              cs.val.case_CipherSuite._2.tag
              == CipherSuite_MtE
              &&
                cs.val.case_CipherSuite._2.val.case_MtE._0.tag
                == CipherSuite_Block
                &&
                  cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                  == EverCrypt_AES128_CBC
                  && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_AES_128_CBC_SHA } }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_RSA
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_None
            &&
              cs.val.case_CipherSuite._2.tag
              == CipherSuite_MtE
              &&
                cs.val.case_CipherSuite._2.val.case_MtE._0.tag
                == CipherSuite_Block
                &&
                  cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                  == EverCrypt_AES256_CBC
                  && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_AES_256_CBC_SHA } }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_RSA
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_None
            &&
              cs.val.case_CipherSuite._2.tag
              == CipherSuite_MtE
              &&
                cs.val.case_CipherSuite._2.val.case_MtE._0.tag
                == CipherSuite_Block
                &&
                  cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                  == EverCrypt_AES128_CBC
                  && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA2_256
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_AES_128_CBC_SHA256 }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_RSA
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_None
            &&
              cs.val.case_CipherSuite._2.tag
              == CipherSuite_MtE
              &&
                cs.val.case_CipherSuite._2.val.case_MtE._0.tag
                == CipherSuite_Block
                &&
                  cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                  == EverCrypt_AES256_CBC
                  && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA2_256
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_AES_256_CBC_SHA256 }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_DHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_Some
            &&
              cs.val.case_CipherSuite._1.v
              == CipherSuite_DSA
              &&
                cs.val.case_CipherSuite._2.tag
                == CipherSuite_MtE
                &&
                  cs.val.case_CipherSuite._2.val.case_MtE._0.tag
                  == CipherSuite_Block
                  &&
                    cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                    == EverCrypt_TDES_EDE_CBC
                    && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_DSS_WITH_3DES_EDE_CBC_SHA }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_DHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_Some
            &&
              cs.val.case_CipherSuite._1.v
              == CipherSuite_RSASIG
              &&
                cs.val.case_CipherSuite._2.tag
                == CipherSuite_MtE
                &&
                  cs.val.case_CipherSuite._2.val.case_MtE._0.tag
                  == CipherSuite_Block
                  &&
                    cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                    == EverCrypt_TDES_EDE_CBC
                    && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_RSA_WITH_3DES_EDE_CBC_SHA }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_DHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_Some
            &&
              cs.val.case_CipherSuite._1.v
              == CipherSuite_DSA
              &&
                cs.val.case_CipherSuite._2.tag
                == CipherSuite_MtE
                &&
                  cs.val.case_CipherSuite._2.val.case_MtE._0.tag
                  == CipherSuite_Block
                  &&
                    cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                    == EverCrypt_AES128_CBC
                    && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_128_CBC_SHA }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_DHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_Some
            &&
              cs.val.case_CipherSuite._1.v
              == CipherSuite_RSASIG
              &&
                cs.val.case_CipherSuite._2.tag
                == CipherSuite_MtE
                &&
                  cs.val.case_CipherSuite._2.val.case_MtE._0.tag
                  == CipherSuite_Block
                  &&
                    cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                    == EverCrypt_AES128_CBC
                    && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_128_CBC_SHA }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_DHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_Some
            &&
              cs.val.case_CipherSuite._1.v
              == CipherSuite_DSA
              &&
                cs.val.case_CipherSuite._2.tag
                == CipherSuite_MtE
                &&
                  cs.val.case_CipherSuite._2.val.case_MtE._0.tag
                  == CipherSuite_Block
                  &&
                    cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                    == EverCrypt_AES256_CBC
                    && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_256_CBC_SHA }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_DHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_Some
            &&
              cs.val.case_CipherSuite._1.v
              == CipherSuite_RSASIG
              &&
                cs.val.case_CipherSuite._2.tag
                == CipherSuite_MtE
                &&
                  cs.val.case_CipherSuite._2.val.case_MtE._0.tag
                  == CipherSuite_Block
                  &&
                    cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                    == EverCrypt_AES256_CBC
                    && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_256_CBC_SHA }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_DHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_Some
            &&
              cs.val.case_CipherSuite._1.v
              == CipherSuite_DSA
              &&
                cs.val.case_CipherSuite._2.tag
                == CipherSuite_MtE
                &&
                  cs.val.case_CipherSuite._2.val.case_MtE._0.tag
                  == CipherSuite_Block
                  &&
                    cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                    == EverCrypt_AES128_CBC
                    && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA2_256
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_128_CBC_SHA256 }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_DHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_Some
            &&
              cs.val.case_CipherSuite._1.v
              == CipherSuite_RSASIG
              &&
                cs.val.case_CipherSuite._2.tag
                == CipherSuite_MtE
                &&
                  cs.val.case_CipherSuite._2.val.case_MtE._0.tag
                  == CipherSuite_Block
                  &&
                    cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                    == EverCrypt_AES128_CBC
                    && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA2_256
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_128_CBC_SHA256 }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_DHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_Some
            &&
              cs.val.case_CipherSuite._1.v
              == CipherSuite_DSA
              &&
                cs.val.case_CipherSuite._2.tag
                == CipherSuite_MtE
                &&
                  cs.val.case_CipherSuite._2.val.case_MtE._0.tag
                  == CipherSuite_Block
                  &&
                    cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                    == EverCrypt_AES256_CBC
                    && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA2_256
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_256_CBC_SHA256 }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_DHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_Some
            &&
              cs.val.case_CipherSuite._1.v
              == CipherSuite_RSASIG
              &&
                cs.val.case_CipherSuite._2.tag
                == CipherSuite_MtE
                &&
                  cs.val.case_CipherSuite._2.val.case_MtE._0.tag
                  == CipherSuite_Block
                  &&
                    cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                    == EverCrypt_AES256_CBC
                    && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA2_256
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_256_CBC_SHA256 }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_ECDHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_Some
            &&
              cs.val.case_CipherSuite._1.v
              == CipherSuite_RSASIG
              &&
                cs.val.case_CipherSuite._2.tag
                == CipherSuite_MtE
                &&
                  cs.val.case_CipherSuite._2.val.case_MtE._0.tag
                  == CipherSuite_Stream
                  &&
                    cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Stream
                    == EverCrypt_RC4_128
                    && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_RC4_128_SHA }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_ECDHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_Some
            &&
              cs.val.case_CipherSuite._1.v
              == CipherSuite_RSASIG
              &&
                cs.val.case_CipherSuite._2.tag
                == CipherSuite_MtE
                &&
                  cs.val.case_CipherSuite._2.val.case_MtE._0.tag
                  == CipherSuite_Block
                  &&
                    cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                    == EverCrypt_TDES_EDE_CBC
                    && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_ECDHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_Some
            &&
              cs.val.case_CipherSuite._1.v
              == CipherSuite_RSASIG
              &&
                cs.val.case_CipherSuite._2.tag
                == CipherSuite_MtE
                &&
                  cs.val.case_CipherSuite._2.val.case_MtE._0.tag
                  == CipherSuite_Block
                  &&
                    cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                    == EverCrypt_AES128_CBC
                    && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_ECDHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_Some
            &&
              cs.val.case_CipherSuite._1.v
              == CipherSuite_RSASIG
              &&
                cs.val.case_CipherSuite._2.tag
                == CipherSuite_MtE
                &&
                  cs.val.case_CipherSuite._2.val.case_MtE._0.tag
                  == CipherSuite_Block
                  &&
                    cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                    == EverCrypt_AES128_CBC
                    && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA2_256
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256 }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_ECDHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_Some
            &&
              cs.val.case_CipherSuite._1.v
              == CipherSuite_RSASIG
              &&
                cs.val.case_CipherSuite._2.tag
                == CipherSuite_MtE
                &&
                  cs.val.case_CipherSuite._2.val.case_MtE._0.tag
                  == CipherSuite_Block
                  &&
                    cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                    == EverCrypt_AES256_CBC
                    && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_ECDHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_Some
            &&
              cs.val.case_CipherSuite._1.v
              == CipherSuite_RSASIG
              &&
                cs.val.case_CipherSuite._2.tag
                == CipherSuite_MtE
                &&
                  cs.val.case_CipherSuite._2.val.case_MtE._0.tag
                  == CipherSuite_Block
                  &&
                    cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                    == EverCrypt_AES256_CBC
                    && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA2_384
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384 }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_ECDHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_Some
            &&
              cs.val.case_CipherSuite._1.v
              == CipherSuite_RSASIG
              &&
                cs.val.case_CipherSuite._2.tag
                == CipherSuite_AEAD
                &&
                  cs.val.case_CipherSuite._2.val.case_AEAD._0
                  == EverCrypt_AES128_GCM
                  && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_ECDHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_Some
            &&
              cs.val.case_CipherSuite._1.v
              == CipherSuite_ECDSA
              &&
                cs.val.case_CipherSuite._2.tag
                == CipherSuite_AEAD
                &&
                  cs.val.case_CipherSuite._2.val.case_AEAD._0
                  == EverCrypt_AES128_GCM
                  && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = {
                  .tag = Parsers_CipherSuite_TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
                }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_ECDHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_Some
            &&
              cs.val.case_CipherSuite._1.v
              == CipherSuite_RSASIG
              &&
                cs.val.case_CipherSuite._2.tag
                == CipherSuite_AEAD
                &&
                  cs.val.case_CipherSuite._2.val.case_AEAD._0
                  == EverCrypt_AES256_GCM
                  && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_384
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_ECDHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_Some
            &&
              cs.val.case_CipherSuite._1.v
              == CipherSuite_ECDSA
              &&
                cs.val.case_CipherSuite._2.tag
                == CipherSuite_AEAD
                &&
                  cs.val.case_CipherSuite._2.val.case_AEAD._0
                  == EverCrypt_AES256_GCM
                  && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_384
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = {
                  .tag = Parsers_CipherSuite_TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
                }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_DHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_None
            &&
              cs.val.case_CipherSuite._2.tag
              == CipherSuite_MtE
              &&
                cs.val.case_CipherSuite._2.val.case_MtE._0.tag
                == CipherSuite_Stream
                &&
                  cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Stream
                  == EverCrypt_RC4_128
                  && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_MD5
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_anon_WITH_RC4_128_MD5 } }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_DHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_None
            &&
              cs.val.case_CipherSuite._2.tag
              == CipherSuite_MtE
              &&
                cs.val.case_CipherSuite._2.val.case_MtE._0.tag
                == CipherSuite_Block
                &&
                  cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                  == EverCrypt_TDES_EDE_CBC
                  && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_anon_WITH_3DES_EDE_CBC_SHA }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_DHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_None
            &&
              cs.val.case_CipherSuite._2.tag
              == CipherSuite_MtE
              &&
                cs.val.case_CipherSuite._2.val.case_MtE._0.tag
                == CipherSuite_Block
                &&
                  cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                  == EverCrypt_AES128_CBC
                  && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_anon_WITH_AES_128_CBC_SHA }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_DHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_None
            &&
              cs.val.case_CipherSuite._2.tag
              == CipherSuite_MtE
              &&
                cs.val.case_CipherSuite._2.val.case_MtE._0.tag
                == CipherSuite_Block
                &&
                  cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                  == EverCrypt_AES256_CBC
                  && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA1
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_anon_WITH_AES_256_CBC_SHA }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_DHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_None
            &&
              cs.val.case_CipherSuite._2.tag
              == CipherSuite_MtE
              &&
                cs.val.case_CipherSuite._2.val.case_MtE._0.tag
                == CipherSuite_Block
                &&
                  cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                  == EverCrypt_AES128_CBC
                  && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA2_256
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_anon_WITH_AES_128_CBC_SHA256 }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_DHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_None
            &&
              cs.val.case_CipherSuite._2.tag
              == CipherSuite_MtE
              &&
                cs.val.case_CipherSuite._2.val.case_MtE._0.tag
                == CipherSuite_Block
                &&
                  cs.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                  == EverCrypt_AES256_CBC
                  && cs.val.case_CipherSuite._2.val.case_MtE._1 == Spec_Hash_Definitions_SHA2_256
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_anon_WITH_AES_256_CBC_SHA256 }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_RSA
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_None
            &&
              cs.val.case_CipherSuite._2.tag
              == CipherSuite_AEAD
              &&
                cs.val.case_CipherSuite._2.val.case_AEAD._0
                == EverCrypt_AES128_GCM
                && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_AES_128_GCM_SHA256 }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_RSA
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_None
            &&
              cs.val.case_CipherSuite._2.tag
              == CipherSuite_AEAD
              &&
                cs.val.case_CipherSuite._2.val.case_AEAD._0
                == EverCrypt_AES256_GCM
                && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_384
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_AES_256_GCM_SHA384 }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_DHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_Some
            &&
              cs.val.case_CipherSuite._1.v
              == CipherSuite_RSASIG
              &&
                cs.val.case_CipherSuite._2.tag
                == CipherSuite_AEAD
                &&
                  cs.val.case_CipherSuite._2.val.case_AEAD._0
                  == EverCrypt_AES128_GCM
                  && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_128_GCM_SHA256 }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_DHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_Some
            &&
              cs.val.case_CipherSuite._1.v
              == CipherSuite_RSASIG
              &&
                cs.val.case_CipherSuite._2.tag
                == CipherSuite_AEAD
                &&
                  cs.val.case_CipherSuite._2.val.case_AEAD._0
                  == EverCrypt_AES256_GCM
                  && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_384
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_256_GCM_SHA384 }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_DH
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_Some
            &&
              cs.val.case_CipherSuite._1.v
              == CipherSuite_RSASIG
              &&
                cs.val.case_CipherSuite._2.tag
                == CipherSuite_AEAD
                &&
                  cs.val.case_CipherSuite._2.val.case_AEAD._0
                  == EverCrypt_AES128_GCM
                  && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_RSA_WITH_AES_128_GCM_SHA256 }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_DH
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_Some
            &&
              cs.val.case_CipherSuite._1.v
              == CipherSuite_RSASIG
              &&
                cs.val.case_CipherSuite._2.tag
                == CipherSuite_AEAD
                &&
                  cs.val.case_CipherSuite._2.val.case_AEAD._0
                  == EverCrypt_AES256_GCM
                  && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_384
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_RSA_WITH_AES_256_GCM_SHA384 }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_DHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_Some
            &&
              cs.val.case_CipherSuite._1.v
              == CipherSuite_DSA
              &&
                cs.val.case_CipherSuite._2.tag
                == CipherSuite_AEAD
                &&
                  cs.val.case_CipherSuite._2.val.case_AEAD._0
                  == EverCrypt_AES128_GCM
                  && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_128_GCM_SHA256 }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_DHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_Some
            &&
              cs.val.case_CipherSuite._1.v
              == CipherSuite_DSA
              &&
                cs.val.case_CipherSuite._2.tag
                == CipherSuite_AEAD
                &&
                  cs.val.case_CipherSuite._2.val.case_AEAD._0
                  == EverCrypt_AES256_GCM
                  && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_384
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_256_GCM_SHA384 }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_DH
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_Some
            &&
              cs.val.case_CipherSuite._1.v
              == CipherSuite_DSA
              &&
                cs.val.case_CipherSuite._2.tag
                == CipherSuite_AEAD
                &&
                  cs.val.case_CipherSuite._2.val.case_AEAD._0
                  == EverCrypt_AES128_GCM
                  && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_DSS_WITH_AES_128_GCM_SHA256 }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_DH
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_Some
            &&
              cs.val.case_CipherSuite._1.v
              == CipherSuite_DSA
              &&
                cs.val.case_CipherSuite._2.tag
                == CipherSuite_AEAD
                &&
                  cs.val.case_CipherSuite._2.val.case_AEAD._0
                  == EverCrypt_AES256_GCM
                  && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_384
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_DSS_WITH_AES_256_GCM_SHA384 }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_DHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_None
            &&
              cs.val.case_CipherSuite._2.tag
              == CipherSuite_AEAD
              &&
                cs.val.case_CipherSuite._2.val.case_AEAD._0
                == EverCrypt_AES128_GCM
                && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_anon_WITH_AES_128_GCM_SHA256 }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_DHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_None
            &&
              cs.val.case_CipherSuite._2.tag
              == CipherSuite_AEAD
              &&
                cs.val.case_CipherSuite._2.val.case_AEAD._0
                == EverCrypt_AES256_GCM
                && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_384
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_anon_WITH_AES_256_GCM_SHA384 }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_ECDHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_Some
            &&
              cs.val.case_CipherSuite._1.v
              == CipherSuite_RSASIG
              &&
                cs.val.case_CipherSuite._2.tag
                == CipherSuite_AEAD
                &&
                  cs.val.case_CipherSuite._2.val.case_AEAD._0
                  == EverCrypt_CHACHA20_POLY1305
                  && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = {
                  .tag = Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256
                }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_ECDHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_Some
            &&
              cs.val.case_CipherSuite._1.v
              == CipherSuite_ECDSA
              &&
                cs.val.case_CipherSuite._2.tag
                == CipherSuite_AEAD
                &&
                  cs.val.case_CipherSuite._2.val.case_AEAD._0
                  == EverCrypt_CHACHA20_POLY1305
                  && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = {
                  .tag = Parsers_CipherSuite_TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256
                }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_DHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_Some
            &&
              cs.val.case_CipherSuite._1.v
              == CipherSuite_RSASIG
              &&
                cs.val.case_CipherSuite._2.tag
                == CipherSuite_AEAD
                &&
                  cs.val.case_CipherSuite._2.val.case_AEAD._0
                  == EverCrypt_CHACHA20_POLY1305
                  && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = {
                  .tag = Parsers_CipherSuite_TLS_DHE_RSA_WITH_CHACHA20_POLY1305_SHA256
                }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_PSK
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_None
            &&
              cs.val.case_CipherSuite._2.tag
              == CipherSuite_AEAD
              &&
                cs.val.case_CipherSuite._2.val.case_AEAD._0
                == EverCrypt_CHACHA20_POLY1305
                && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = { .tag = Parsers_CipherSuite_TLS_PSK_WITH_CHACHA20_POLY1305_SHA256 }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_PSK_ECDHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_None
            &&
              cs.val.case_CipherSuite._2.tag
              == CipherSuite_AEAD
              &&
                cs.val.case_CipherSuite._2.val.case_AEAD._0
                == EverCrypt_CHACHA20_POLY1305
                && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = {
                  .tag = Parsers_CipherSuite_TLS_ECDHE_PSK_WITH_CHACHA20_POLY1305_SHA256
                }
              }
            }
          );
      else if
      (
        cs.tag
        == CipherSuite_CipherSuite
        &&
          cs.val.case_CipherSuite._0
          == CipherSuite_Kex_PSK_DHE
          &&
            cs.val.case_CipherSuite._1.tag
            == FStar_Pervasives_Native_None
            &&
              cs.val.case_CipherSuite._2.tag
              == CipherSuite_AEAD
              &&
                cs.val.case_CipherSuite._2.val.case_AEAD._0
                == EverCrypt_CHACHA20_POLY1305
                && cs.val.case_CipherSuite._2.val.case_AEAD._1 == Spec_Hash_Definitions_SHA2_256
      )
        scrut =
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = {
                  .tag = Parsers_CipherSuite_TLS_DHE_PSK_WITH_CHACHA20_POLY1305_SHA256
                }
              }
            }
          );
      else
        scrut =
          TLSError_fatal__Parsers_CipherSuite_cipherSuite(Parsers_AlertDescription_Illegal_parameter,
            FStar_Error_perror("CipherSuite.fsti",
              (krml_checked_int_t)290,
              "Invoked on a unknown ciphersuite"));
      Parsers_CipherSuite_cipherSuite ite;
      if (scrut.tag == FStar_Error_Correct)
        ite = scrut.val.case_Correct;
      else
        ite =
          KRML_EABORT(Parsers_CipherSuite_cipherSuite,
            "unreachable (pattern matches are exhaustive in F*)");
      KRML_CHECK_SIZE(sizeof (Prims_list__Extensions_extension_), (uint32_t)1U);
      Prims_list__Extensions_extension_
      *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Extensions_extension_));
      buf[0U] = ((Prims_list__Extensions_extension_){ .tag = Prims_Nil });
      KRML_CHECK_SIZE(sizeof (Prims_list__Extensions_extension_), (uint32_t)1U);
      Prims_list__Extensions_extension_
      *buf0 = KRML_HOST_MALLOC(sizeof (Prims_list__Extensions_extension_));
      buf0[0U]
      =
        (
          (Prims_list__Extensions_extension_){
            .tag = Prims_Cons,
            .hd = {
              .tag = Extensions_E_key_share,
              .val = {
                .case_E_key_share = {
                  .tag = CommonDH_HRRKeyShare,
                  .val = { .case_HRRKeyShare = ng }
                }
              }
            },
            .tl = buf
          }
        );
      KRML_CHECK_SIZE(sizeof (Prims_list__Extensions_extension_), (uint32_t)1U);
      Prims_list__Extensions_extension_
      *buf1 = KRML_HOST_MALLOC(sizeof (Prims_list__Extensions_extension_));
      buf1[0U]
      =
        (
          (Prims_list__Extensions_extension_){
            .tag = Prims_Cons,
            .hd = {
              .tag = Extensions_E_supported_versions,
              .val = {
                .case_E_supported_versions = {
                  .tag = Extensions_ServerPV,
                  .val = { .case_ServerPV = { .tag = Parsers_ProtocolVersion_TLS_1p3 } }
                }
              }
            },
            .tl = buf0
          }
        );
      HandshakeMessages_hrr
      hrr = { .hrr_sessionID = co.ch_sessionID, .hrr_cipher_suite = ite, .hrr_extensions = buf1 };
      return
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_serverMode){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = {
                .tag = Negotiation_ServerHelloRetryRequest,
                .val = { .case_ServerHelloRetryRequest = { .hrr = hrr, .cs = cs } }
              }
            }
          }
        );
    }
    else if
    (
      scrut2.tag
      == FStar_Error_Correct
      &&
        scrut2.val.case_Correct.fst->tag
        == Prims_Cons
        && scrut2.val.case_Correct.fst->hd.tag == Negotiation_PSK_EDH
    )
    {
      CipherSuite_cipherSuite_ cs = scrut2.val.case_Correct.fst->hd.val.case_PSK_EDH.cs;
      FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_
      ogx = scrut2.val.case_Correct.fst->hd.val.case_PSK_EDH.oks;
      Prims_int j1 = scrut2.val.case_Correct.fst->hd.val.case_PSK_EDH.j;
      Negotiation_print("Negotiated PSK_EDH key exchange");
      KRML_CHECK_SIZE(sizeof (Prims_list__Extensions_extension_), (uint32_t)1U);
      Prims_list__Extensions_extension_
      *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Extensions_extension_));
      buf[0U] = ((Prims_list__Extensions_extension_){ .tag = Prims_Nil });
      return
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_serverMode){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = {
                .tag = Negotiation_ServerMode,
                .val = {
                  .case_ServerMode = {
                    ._0 = {
                      .n_offer = co, .n_hrr = { .tag = FStar_Pervasives_Native_None },
                      .n_protocol_version = { .tag = Parsers_ProtocolVersion_TLS_1p3 },
                      .n_server_random = serverRandom, .n_sessionID = co.ch_sessionID,
                      .n_cipher_suite = cs,
                      .n_pski = { .tag = FStar_Pervasives_Native_Some, .v = j1 },
                      .n_server_extensions = { .tag = FStar_Pervasives_Native_None },
                      .n_server_share = { .tag = FStar_Pervasives_Native_None },
                      .n_client_cert_request = { .tag = FStar_Pervasives_Native_None },
                      .n_server_cert = { .tag = FStar_Pervasives_Native_None },
                      .n_client_share = ogx
                    },
                    ._1 = { .tag = FStar_Pervasives_Native_None },
                    ._2 = buf
                  }
                }
              }
            }
          }
        );
    }
    else if
    (
      scrut2.tag
      == FStar_Error_Correct
      &&
        scrut2.val.case_Correct.fst->tag
        == Prims_Cons
        && scrut2.val.case_Correct.fst->hd.tag == Negotiation_JUST_EDH
    )
    {
      CipherSuite_cipherSuite_ cs = scrut2.val.case_Correct.fst->hd.val.case_JUST_EDH.cs;
      Prims_dtuple2__CommonDH_group__CommonDH_pre_share_
      gx = scrut2.val.case_Correct.fst->hd.val.case_JUST_EDH.oks;
      Negotiation_print("Negotiated Pure EDH key exchange");
      if (scert.tag == FStar_Pervasives_Native_Some)
      {
        Parsers_SignatureScheme_signatureScheme sa = scert.v.snd;
        uint64_t cert = scert.v.fst;
        Prims_list__FStar_Bytes_bytes *schain = TLSConstants_cert_format_cb(cfg, cert);
        Negotiation_print(Prims_strcat("Negotiated ",
            Parsers_SignatureScheme_string_of_signatureScheme(sa)));
        KRML_CHECK_SIZE(sizeof (Prims_list__Extensions_extension_), (uint32_t)1U);
        Prims_list__Extensions_extension_
        *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Extensions_extension_));
        buf[0U] = ((Prims_list__Extensions_extension_){ .tag = Prims_Nil });
        return
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_serverMode){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = {
                  .tag = Negotiation_ServerMode,
                  .val = {
                    .case_ServerMode = {
                      ._0 = {
                        .n_offer = co, .n_hrr = { .tag = FStar_Pervasives_Native_None },
                        .n_protocol_version = { .tag = Parsers_ProtocolVersion_TLS_1p3 },
                        .n_server_random = serverRandom, .n_sessionID = co.ch_sessionID,
                        .n_cipher_suite = cs, .n_pski = { .tag = FStar_Pervasives_Native_None },
                        .n_server_extensions = { .tag = FStar_Pervasives_Native_None },
                        .n_server_share = { .tag = FStar_Pervasives_Native_None },
                        .n_client_cert_request = { .tag = FStar_Pervasives_Native_None },
                        .n_server_cert = {
                          .tag = FStar_Pervasives_Native_Some,
                          .v = { .fst = Cert_chain_up(schain), .snd = sa }
                        }, .n_client_share = { .tag = FStar_Pervasives_Native_Some, .v = gx }
                      },
                      ._1 = scert,
                      ._2 = buf
                    }
                  }
                }
              }
            }
          );
      }
      else
      {
        KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
          __FILE__,
          __LINE__,
          "unreachable (pattern matches are exhaustive in F*)");
        KRML_HOST_EXIT(255U);
      }
    }
    else
    {
      KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
        __FILE__,
        __LINE__,
        "unreachable (pattern matches are exhaustive in F*)");
      KRML_HOST_EXIT(255U);
    }
  }
  else if (scrut0.tag == FStar_Error_Correct)
  {
    Parsers_ProtocolVersion_protocolVersion pv = scrut0.val.case_Correct;
    FStar_Pervasives_Native_option__FStar_Bytes_bytes scrut0 = Negotiation_find_sessionTicket(co);
    FStar_Pervasives_Native_option__K___Parsers_ProtocolVersion_protocolVersion_CipherSuite_cipherSuite__bool_TLSInfo_msId_FStar_Bytes_bytes
    valid_ticket;
    if (scrut0.tag == FStar_Pervasives_Native_None)
      valid_ticket =
        (
          (FStar_Pervasives_Native_option__K___Parsers_ProtocolVersion_protocolVersion_CipherSuite_cipherSuite__bool_TLSInfo_msId_FStar_Bytes_bytes){
            .tag = FStar_Pervasives_Native_None
          }
        );
    else if (scrut0.tag == FStar_Pervasives_Native_Some)
    {
      FStar_Bytes_bytes t = scrut0.v;
      if (FStar_UInt32_v(FStar_Bytes_len(co.ch_sessionID)) == (krml_checked_int_t)0)
        valid_ticket =
          (
            (FStar_Pervasives_Native_option__K___Parsers_ProtocolVersion_protocolVersion_CipherSuite_cipherSuite__bool_TLSInfo_msId_FStar_Bytes_bytes){
              .tag = FStar_Pervasives_Native_None
            }
          );
      else
        valid_ticket = Ticket_check_ticket12(t);
    }
    else
      valid_ticket =
        KRML_EABORT(FStar_Pervasives_Native_option__K___Parsers_ProtocolVersion_protocolVersion_CipherSuite_cipherSuite__bool_TLSInfo_msId_FStar_Bytes_bytes,
          "unreachable (pattern matches are exhaustive in F*)");
    if (valid_ticket.tag == FStar_Pervasives_Native_Some)
    {
      CipherSuite_cipherSuite_ cs = valid_ticket.v.snd;
      Parsers_ProtocolVersion_protocolVersion pv1 = valid_ticket.v.fst;
      KRML_CHECK_SIZE(sizeof (Prims_list__Extensions_extension_), (uint32_t)1U);
      Prims_list__Extensions_extension_
      *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Extensions_extension_));
      buf[0U] = ((Prims_list__Extensions_extension_){ .tag = Prims_Nil });
      return
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_serverMode){
            .tag = FStar_Error_Correct,
            .val = {
              .case_Correct = {
                .tag = Negotiation_ServerMode,
                .val = {
                  .case_ServerMode = {
                    ._0 = {
                      .n_offer = co, .n_hrr = { .tag = FStar_Pervasives_Native_None },
                      .n_protocol_version = pv1, .n_server_random = serverRandom,
                      .n_sessionID = co.ch_sessionID, .n_cipher_suite = cs,
                      .n_pski = { .tag = FStar_Pervasives_Native_None },
                      .n_server_extensions = { .tag = FStar_Pervasives_Native_None },
                      .n_server_share = { .tag = FStar_Pervasives_Native_None },
                      .n_client_cert_request = { .tag = FStar_Pervasives_Native_None },
                      .n_server_cert = { .tag = FStar_Pervasives_Native_None },
                      .n_client_share = { .tag = FStar_Pervasives_Native_None }
                    },
                    ._1 = { .tag = FStar_Pervasives_Native_None },
                    ._2 = buf
                  }
                }
              }
            }
          }
        );
    }
    else if
    (
      !FStar_List_Tot_Base_mem__Parsers_CompressionMethod_compressionMethod((
          (Parsers_CompressionMethod_compressionMethod){
            .tag = Parsers_CompressionMethod_NullCompression
          }
        ),
        co.ch_compressions)
    )
      return
        TLSError_fatal__Negotiation_serverMode(Parsers_AlertDescription_Illegal_parameter,
          "Compression is deprecated");
    else
    {
      FStar_Pervasives_Native_option__Prims_list__Parsers_SignatureScheme_signatureScheme
      scrut0 = Negotiation_find_signature_algorithms(co);
      Prims_list__Parsers_SignatureScheme_signatureScheme *salgs;
      if (scrut0.tag == FStar_Pervasives_Native_None)
      {
        KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme), (uint32_t)1U);
        Prims_list__Parsers_SignatureScheme_signatureScheme
        *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme));
        buf[0U] = ((Prims_list__Parsers_SignatureScheme_signatureScheme){ .tag = Prims_Nil });
        KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme), (uint32_t)1U);
        Prims_list__Parsers_SignatureScheme_signatureScheme
        *buf0 = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme));
        buf0[0U]
        =
          (
            (Prims_list__Parsers_SignatureScheme_signatureScheme){
              .tag = Prims_Cons,
              .hd = { .tag = Parsers_SignatureScheme_Ecdsa_sha1 },
              .tl = buf
            }
          );
        KRML_CHECK_SIZE(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme), (uint32_t)1U);
        Prims_list__Parsers_SignatureScheme_signatureScheme
        *buf1 = KRML_HOST_MALLOC(sizeof (Prims_list__Parsers_SignatureScheme_signatureScheme));
        buf1[0U]
        =
          (
            (Prims_list__Parsers_SignatureScheme_signatureScheme){
              .tag = Prims_Cons,
              .hd = {
                .tag = Parsers_SignatureScheme_Unknown_signatureScheme,
                ._0 = (uint16_t)0xFFFFU
              },
              .tl = buf0
            }
          );
        salgs = buf1;
      }
      else if (scrut0.tag == FStar_Pervasives_Native_Some)
      {
        Prims_list__Parsers_SignatureScheme_signatureScheme *sigalgs = scrut0.v;
        salgs =
          List_Helpers_filter_aux__Parsers_SignatureScheme_signatureScheme_Prims_list_Parsers_SignatureScheme_signatureScheme(cfg.signature_algorithms,
            List_Helpers_mem_rev__Parsers_SignatureScheme_signatureScheme,
            sigalgs);
      }
      else
        salgs =
          KRML_EABORT(Prims_list__Parsers_SignatureScheme_signatureScheme *,
            "unreachable (pattern matches are exhaustive in F*)");
      FStar_Pervasives_Native_option__K___uint64_t_Parsers_SignatureScheme_signatureScheme
      scrut1 =
        TLSConstants_cert_select_cb(cfg,
          pv,
          Negotiation_get_sni(co),
          Negotiation_nego_alpn(co, cfg),
          salgs);
      if (scrut1.tag == FStar_Pervasives_Native_None)
        return
          TLSError_fatal__Negotiation_serverMode(Parsers_AlertDescription_Certificate_unknown,
            FStar_Error_perror("Negotiation.fst",
              (krml_checked_int_t)1374,
              "No compatible certificate can be selected"));
      else if (scrut1.tag == FStar_Pervasives_Native_Some)
      {
        Parsers_SignatureScheme_signatureScheme sa = scrut1.v.snd;
        uint64_t cert = scrut1.v.fst;
        Prims_list__FStar_Bytes_bytes *schain = TLSConstants_cert_format_cb(cfg, cert);
        K___CipherSuite_sigAlg_Hashing_Spec_tls_alg
        scrut = TLSConstants_sigHashAlg_of_signatureScheme(sa);
        CipherSuite_sigAlg sig_10876 = scrut.fst;
        FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_K___CipherSuite_kexAlg_FStar_Pervasives_Native_option__CipherSuite_sigAlg_CipherSuite_aeAlg_CipherSuite_cipherSuite_
        scrut0 = Negotiation_negotiateCipherSuite(cfg, pv, co.ch_cipher_suites, sig_10876);
        if (scrut0.tag == FStar_Error_Error)
        {
          K___Parsers_Alert_alert_Prims_string z = scrut0.val.case_Error;
          return
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_serverMode){
                .tag = FStar_Error_Error,
                .val = { .case_Error = z }
              }
            );
        }
        else if (scrut0.tag == FStar_Error_Correct)
        {
          CipherSuite_cipherSuite_ cs = scrut0.val.case_Correct.f3;
          FStar_Bytes_bytes uu____0 = Random_sample32((uint32_t)32U);
          KRML_CHECK_SIZE(sizeof (Prims_list__Extensions_extension_), (uint32_t)1U);
          Prims_list__Extensions_extension_
          *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Extensions_extension_));
          buf[0U] = ((Prims_list__Extensions_extension_){ .tag = Prims_Nil });
          return
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_serverMode){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = {
                    .tag = Negotiation_ServerMode,
                    .val = {
                      .case_ServerMode = {
                        ._0 = {
                          .n_offer = co, .n_hrr = { .tag = FStar_Pervasives_Native_None },
                          .n_protocol_version = pv, .n_server_random = serverRandom,
                          .n_sessionID = uu____0, .n_cipher_suite = cs,
                          .n_pski = { .tag = FStar_Pervasives_Native_None },
                          .n_server_extensions = { .tag = FStar_Pervasives_Native_None },
                          .n_server_share = { .tag = FStar_Pervasives_Native_None },
                          .n_client_cert_request = { .tag = FStar_Pervasives_Native_None },
                          .n_server_cert = {
                            .tag = FStar_Pervasives_Native_Some,
                            .v = { .fst = Cert_chain_up(schain), .snd = sa }
                          }, .n_client_share = { .tag = FStar_Pervasives_Native_None }
                        },
                        ._1 = {
                          .tag = FStar_Pervasives_Native_Some,
                          .v = { .fst = cert, .snd = sa }
                        },
                        ._2 = buf
                      }
                    }
                  }
                }
              }
            );
        }
        else
        {
          KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
            __FILE__,
            __LINE__,
            "unreachable (pattern matches are exhaustive in F*)");
          KRML_HOST_EXIT(255U);
        }
      }
      else
      {
        KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
          __FILE__,
          __LINE__,
          "unreachable (pattern matches are exhaustive in F*)");
        KRML_HOST_EXIT(255U);
      }
    }
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

static Prims_string
Negotiation_accum_string_of_pv(Prims_string s, Parsers_ProtocolVersion_protocolVersion pv)
{
  return
    Prims_strcat(s,
      Prims_strcat(" ", Parsers_ProtocolVersion_string_of_protocolVersion(pv)));
}

static bool
FStar_Pervasives_Native_uu___is_Some__Prims_list_CommonDH_keyShareEntry(
  FStar_Pervasives_Native_option__Prims_list__CommonDH_keyShareEntry projectee
)
{
  if (projectee.tag == FStar_Pervasives_Native_Some)
    return true;
  else
    return false;
}

FStar_Pervasives_Native_option__Extensions_extension_
Negotiation_find_client_extension_aux__Extensions_extension_(
  Extensions_extension_ env,
  bool (*filter1)(Extensions_extension_ x0, Extensions_extension_ x1),
  HandshakeMessages_ch o
)
{
  if (o.ch_extensions.tag == FStar_Pervasives_Native_None)
    return
      (
        (FStar_Pervasives_Native_option__Extensions_extension_){
          .tag = FStar_Pervasives_Native_None
        }
      );
  else if (o.ch_extensions.tag == FStar_Pervasives_Native_Some)
  {
    Prims_list__Extensions_extension_ *es = o.ch_extensions.v;
    return List_Helpers_find_aux__Extensions_extension__Extensions_extension_(env, filter1, es);
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

typedef struct K___HandshakeMessages_ch_HandshakeMessages_hrr_s
{
  HandshakeMessages_ch fst;
  HandshakeMessages_hrr snd;
}
K___HandshakeMessages_ch_HandshakeMessages_hrr;

typedef struct
K___Prims_list__CommonDH_keyShareEntry_FStar_Pervasives_Native_option__CommonDH_group__s
{
  Prims_list__CommonDH_keyShareEntry *fst;
  FStar_Pervasives_Native_option__CommonDH_group_ snd;
}
K___Prims_list__CommonDH_keyShareEntry_FStar_Pervasives_Native_option__CommonDH_group_;

static bool
Negotiation_aux_extension_ok(
  K___HandshakeMessages_ch_HandshakeMessages_hrr uu____10973,
  Extensions_extension_ e
)
{
  HandshakeMessages_ch o1 = uu____10973.fst;
  HandshakeMessages_hrr hrr = uu____10973.snd;
  if (e.tag == Extensions_E_key_share && e.val.case_E_key_share.tag == CommonDH_ClientKeyShare)
  {
    Prims_list__CommonDH_keyShareEntry *ecl = e.val.case_E_key_share.val.case_ClientKeyShare;
    K___Prims_list__CommonDH_keyShareEntry_FStar_Pervasives_Native_option__CommonDH_group_
    scrut = { .fst = ecl, .snd = Negotiation_group_of_hrr(hrr) };
    if
    (
      scrut.fst->tag
      == Prims_Cons
      &&
        scrut.fst->hd.tag
        == CommonDH_Share
        && scrut.fst->tl->tag == Prims_Nil && scrut.snd.tag == FStar_Pervasives_Native_Some
    )
    {
      CommonDH_group_ g_ = scrut.snd.v;
      CommonDH_group_ g1 = scrut.fst->hd.val.case_Share.g;
      return __eq__CommonDH_group_(g1, g_);
    }
    else if (scrut.snd.tag == FStar_Pervasives_Native_None)
    {
      FStar_Pervasives_Native_option__Prims_list__CommonDH_keyShareEntry
      shares1 = Negotiation_find_key_shares(o1);
      if (FStar_Pervasives_Native_uu___is_Some__Prims_list_CommonDH_keyShareEntry(shares1))
      {
        Prims_list__CommonDH_keyShareEntry *ite;
        if (shares1.tag == FStar_Pervasives_Native_Some)
          ite = shares1.v;
        else
          ite =
            KRML_EABORT(Prims_list__CommonDH_keyShareEntry *,
              "unreachable (pattern matches are exhaustive in F*)");
        return
          __eq__FStar_Bytes_bytes(CommonDH_clientKeyShareBytes(ite),
            CommonDH_clientKeyShareBytes(ecl));
      }
      else
        return false;
    }
    else
      return false;
  }
  else if (e.tag == Extensions_E_early_data)
    return false;
  else if (e.tag == Extensions_E_cookie)
    return true;
  else
  {
    Extensions_extension_ e1 = e;
    FStar_Pervasives_Native_option__Extensions_extension_
    scrut =
      Negotiation_find_client_extension_aux__Extensions_extension_(e1,
        Extensions_sameExt____,
        o1);
    if (scrut.tag == FStar_Pervasives_Native_None)
      return FStar_IO_debug_print_string("Extra extension\n") && false;
    else if (scrut.tag == FStar_Pervasives_Native_Some)
      return true;
    else
    {
      KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
        __FILE__,
        __LINE__,
        "unreachable (pattern matches are exhaustive in F*)");
      KRML_HOST_EXIT(255U);
    }
  }
}

static Prims_string
FStar_List_Tot_Base_fold_left__Prims_string_Parsers_ProtocolVersion_protocolVersion(
  Prims_string (*f)(Prims_string x0, Parsers_ProtocolVersion_protocolVersion x1),
  Prims_string x,
  Prims_list__Parsers_ProtocolVersion_protocolVersion *l
)
{
  if (l->tag == Prims_Nil)
    return x;
  else if (l->tag == Prims_Cons)
  {
    Prims_list__Parsers_ProtocolVersion_protocolVersion *tl1 = l->tl;
    Parsers_ProtocolVersion_protocolVersion hd1 = l->hd;
    return
      FStar_List_Tot_Base_fold_left__Prims_string_Parsers_ProtocolVersion_protocolVersion(f,
        f(x, hd1),
        tl1);
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

static bool
List_Helpers_forall_aux__Extensions_extension__HandshakeMessages_ch___HandshakeMessages_hrr(
  K___HandshakeMessages_ch_HandshakeMessages_hrr env,
  bool (*f)(K___HandshakeMessages_ch_HandshakeMessages_hrr x0, Extensions_extension_ x1),
  Prims_list__Extensions_extension_ *l
)
{
  if (l->tag == Prims_Nil)
    return true;
  else if (l->tag == Prims_Cons)
  {
    Prims_list__Extensions_extension_ *tl1 = l->tl;
    Extensions_extension_ hd1 = l->hd;
    if (f(env, hd1))
      return
        List_Helpers_forall_aux__Extensions_extension__HandshakeMessages_ch___HandshakeMessages_hrr(env,
          f,
          tl1);
    else
      return false;
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

static bool
__eq__Prims_list__Parsers_CompressionMethod_compressionMethod(
  Prims_list__Parsers_CompressionMethod_compressionMethod *y,
  Prims_list__Parsers_CompressionMethod_compressionMethod *x
)
{
  if (x->tag == Prims_Nil)
    if (y->tag == Prims_Nil)
      return true;
    else
      return false;
  else if (x->tag == Prims_Cons)
  {
    Prims_list__Parsers_CompressionMethod_compressionMethod *x_tl = x->tl;
    Parsers_CompressionMethod_compressionMethod x_hd = x->hd;
    if (y->tag == Prims_Cons)
    {
      Prims_list__Parsers_CompressionMethod_compressionMethod *y_tl = y->tl;
      Parsers_CompressionMethod_compressionMethod y_hd = y->hd;
      return
        true
        && __eq__Parsers_CompressionMethod_compressionMethod(y_hd, x_hd)
        && __eq__Prims_list__Parsers_CompressionMethod_compressionMethod(y_tl, x_tl);
    }
    else
      return false;
  }
  else
    return false;
}

FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_serverMode
Negotiation_server_ClientHello(
  Negotiation_t ns,
  HandshakeMessages_ch offer,
  HandshakeLog_state *log
)
{
  Negotiation_print(Prims_strcat("offered client extensions ",
      Negotiation_string_of_option_extensions(offer.ch_extensions)));
  Negotiation_print(Prims_strcat("offered cipher suites ",
      Negotiation_string_of_ciphersuitenames(offer.ch_cipher_suites)));
  FStar_Pervasives_Native_option__Prims_list__Parsers_NamedGroup_namedGroup
  scrut0 = Negotiation_find_supported_groups(offer);
  Prims_string ite0;
  if (scrut0.tag == FStar_Pervasives_Native_Some)
  {
    Prims_list__Parsers_NamedGroup_namedGroup *ngl = scrut0.v;
    ite0 = Prims_strcat("offered groups ", Negotiation_string_of_namedGroups(ngl));
  }
  else if (scrut0.tag == FStar_Pervasives_Native_None)
    ite0 = "no groups offered, only PSK (1.3) and FFDH (1.2) can be used";
  else
    ite0 = KRML_EABORT(Prims_string, "unreachable (pattern matches are exhaustive in F*)");
  Negotiation_print(ite0);
  FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Prims_list__Parsers_ProtocolVersion_protocolVersion
  scrut1 =
    Negotiation_offered_versions((
        (Parsers_ProtocolVersion_protocolVersion){ .tag = Parsers_ProtocolVersion_TLS_1p0 }
      ),
      offer);
  Prims_string ite1;
  if (scrut1.tag == FStar_Error_Error)
  {
    K___Parsers_Alert_alert_Prims_string z = scrut1.val.case_Error;
    ite1 = Prims_strcat("Error: ", TLSError_string_of_error(z));
  }
  else if (scrut1.tag == FStar_Error_Correct)
  {
    Prims_list__Parsers_ProtocolVersion_protocolVersion *v1 = scrut1.val.case_Correct;
    ite1 =
      FStar_List_Tot_Base_fold_left__Prims_string_Parsers_ProtocolVersion_protocolVersion(Negotiation_accum_string_of_pv,
        "offered versions",
        v1);
  }
  else
    ite1 = KRML_EABORT(Prims_string, "unreachable (pattern matches are exhaustive in F*)");
  Negotiation_print(ite1);
  Negotiation_negotiationState scrut2 = ns.state[0U];
  if (scrut2.tag == Negotiation_S_HRR)
  {
    HandshakeMessages_hrr hrr = scrut2.val.case_S_HRR.n_hrr;
    HandshakeMessages_ch o1 = scrut2.val.case_S_HRR.n_offer;
    Negotiation_print("Processing second offer based on existing HRR state (staeful HRR).");
    HandshakeMessages_ch o2 = offer;
    bool extension_ok;
    if
    (
      FStar_Pervasives_Native_uu___is_Some__Prims_list_Extensions_extension_(o2.ch_extensions)
      && FStar_Pervasives_Native_uu___is_Some__Prims_list_Extensions_extension_(o1.ch_extensions)
    )
    {
      Prims_list__Extensions_extension_ *ite;
      if (o2.ch_extensions.tag == FStar_Pervasives_Native_Some)
        ite = o2.ch_extensions.v;
      else
        ite =
          KRML_EABORT(Prims_list__Extensions_extension_ *,
            "unreachable (pattern matches are exhaustive in F*)");
      extension_ok =
        List_Helpers_forall_aux__Extensions_extension__HandshakeMessages_ch___HandshakeMessages_hrr((
            (K___HandshakeMessages_ch_HandshakeMessages_hrr){ .fst = o1, .snd = hrr }
          ),
          Negotiation_aux_extension_ok,
          ite);
    }
    else
      extension_ok = false;
    if
    (
      __eq__Parsers_ProtocolVersion_protocolVersion(o1.ch_protocol_version,
        o2.ch_protocol_version)
      && __eq__FStar_Bytes_bytes(o1.ch_client_random, o2.ch_client_random)
      && __eq__FStar_Bytes_bytes(o1.ch_sessionID, o2.ch_sessionID)
      && __eq__FStar_Bytes_bytes(o1.ch_sessionID, hrr.hrr_sessionID)
      &&
        FStar_List_Tot_Base_mem__Parsers_CipherSuite_cipherSuite(hrr.hrr_cipher_suite,
          o2.ch_cipher_suites)
      &&
        __eq__Prims_list__Parsers_CompressionMethod_compressionMethod(o1.ch_compressions,
          o2.ch_compressions)
      && extension_ok
    )
    {
      FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_serverMode
      sm = Negotiation_computeServerMode(ns.cfg, offer, ns.nonce);
      if (sm.tag == FStar_Error_Error)
      {
        K___Parsers_Alert_alert_Prims_string z = sm.val.case_Error;
        Negotiation_print(Prims_strcat("negotiation failed: ", TLSError_string_of_error(z)));
        return
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_serverMode){
              .tag = FStar_Error_Error,
              .val = { .case_Error = z }
            }
          );
      }
      else if
      (
        sm.tag
        == FStar_Error_Correct
        && sm.val.case_Correct.tag == Negotiation_ServerHelloRetryRequest
      )
        return
          TLSError_fatal__Negotiation_serverMode(Parsers_AlertDescription_Illegal_parameter,
            "client sent the same hello in response to hello retry");
      else if (sm.tag == FStar_Error_Correct && sm.val.case_Correct.tag == Negotiation_ServerMode)
      {
        FStar_Pervasives_Native_option__K___uint64_t_Parsers_SignatureScheme_signatureScheme
        cert = sm.val.case_Correct.val.case_ServerMode._1;
        Negotiation_mode m = sm.val.case_Correct.val.case_ServerMode._0;
        Negotiation_print(Prims_strcat("negotiated after HRR ",
            Prims_strcat(Parsers_ProtocolVersion_string_of_protocolVersion(m.n_protocol_version),
              Prims_strcat(" ", Negotiation_string_of_ciphersuite(m.n_cipher_suite)))));
        TLSConstants_nego_cb nego_cb = ns.cfg.nego_callback;
        FStar_Pervasives_Native_option__Prims_list__Extensions_extension_
        exts = Extensions_app_ext_filter(offer.ch_extensions);
        FStar_Bytes_bytes exts_bytes = HandshakeMessages_optionExtensionsBytes(exts);
        Negotiation_print("Negotiation callback to handle extra extensions.");
        TLSConstants_nego_action
        scrut =
          nego_cb.negotiate(nego_cb.nego_context,
            m.n_protocol_version,
            exts_bytes,
            (
              (FStar_Pervasives_Native_option__FStar_Bytes_bytes){
                .tag = FStar_Pervasives_Native_Some,
                .v = FStar_Bytes_empty_bytes
              }
            ));
        if (scrut.tag == TLSConstants_Nego_accept)
        {
          Prims_list__K___uint16_t_FStar_Bytes_bytes *sexts = scrut.val.case_Nego_accept;
          Prims_list__Extensions_extension_ *el = Extensions_ext_of_custom(sexts);
          ns.state[0U] =
            (
              (Negotiation_negotiationState){
                .tag = Negotiation_S_ClientHello,
                .val = { .case_S_ClientHello = { .n_mode = m, .n_selected_cert = cert } }
              }
            );
          return
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_serverMode){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = {
                    .tag = Negotiation_ServerMode,
                    .val = { .case_ServerMode = { ._0 = m, ._1 = cert, ._2 = el } }
                  }
                }
              }
            );
        }
        else
        {
          Negotiation_print("Application requested to abort the handshake after internal HRR.");
          return
            TLSError_fatal__Negotiation_serverMode(Parsers_AlertDescription_Handshake_failure,
              "application aborted the handshake by callback");
        }
      }
      else
      {
        KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
          __FILE__,
          __LINE__,
          "unreachable (pattern matches are exhaustive in F*)");
        KRML_HOST_EXIT(255U);
      }
    }
    else
      return
        TLSError_fatal__Negotiation_serverMode(Parsers_AlertDescription_Illegal_parameter,
          "Inconsistant parameters between first and second client hello");
  }
  else if (scrut2.tag == Negotiation_S_Init)
  {
    FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_serverMode
    sm = Negotiation_computeServerMode(ns.cfg, offer, ns.nonce);
    FStar_Pervasives_Native_option__FStar_Bytes_bytes scrut0 = Negotiation_find_cookie(offer);
    FStar_Pervasives_Native_option__FStar_Bytes_bytes previous_cookie;
    if (scrut0.tag == FStar_Pervasives_Native_None)
      previous_cookie =
        ((FStar_Pervasives_Native_option__FStar_Bytes_bytes){ .tag = FStar_Pervasives_Native_None });
    else if (scrut0.tag == FStar_Pervasives_Native_Some)
    {
      FStar_Bytes_bytes c = scrut0.v;
      FStar_Pervasives_Native_option__K___HandshakeMessages_hrr_FStar_Bytes_bytes_FStar_Bytes_bytes
      scrut = Ticket_check_cookie(c);
      if (scrut.tag == FStar_Pervasives_Native_None)
      {
        Negotiation_print(Prims_strcat("WARNING: ignorning invalid cookie ",
            FStar_Bytes_hex_of_bytes(c)));
        previous_cookie =
          (
            (FStar_Pervasives_Native_option__FStar_Bytes_bytes){
              .tag = FStar_Pervasives_Native_None
            }
          );
      }
      else if (scrut.tag == FStar_Pervasives_Native_Some)
      {
        FStar_Bytes_bytes extra = scrut.v.thd;
        FStar_Bytes_bytes digest = scrut.v.snd;
        HandshakeMessages_hrr hrr = scrut.v.fst;
        Negotiation_print(Prims_strcat("Loaded stateless retry cookie ",
            FStar_Bytes_hex_of_bytes(c)));
        HandshakeMessages_hrr uu____0 = hrr;
        KRML_CHECK_SIZE(sizeof (Prims_list__Extensions_extension_), (uint32_t)1U);
        Prims_list__Extensions_extension_
        *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Extensions_extension_));
        buf[0U]
        =
          (
            (Prims_list__Extensions_extension_){
              .tag = Prims_Cons,
              .hd = { .tag = Extensions_E_cookie, .val = { .case_E_cookie = c } },
              .tl = hrr.hrr_extensions
            }
          );
        HandshakeMessages_hrr
        hrr1 =
          {
            .hrr_sessionID = uu____0.hrr_sessionID,
            .hrr_cipher_suite = uu____0.hrr_cipher_suite,
            .hrr_extensions = buf
          };
        Negotiation_print(Prims_strcat("Overwriting the transcript digest with CH1 hash ",
            FStar_Bytes_hex_of_bytes(digest)));
        HandshakeLog_load_stateless_cookie(log, hrr1, digest);
        previous_cookie =
          (
            (FStar_Pervasives_Native_option__FStar_Bytes_bytes){
              .tag = FStar_Pervasives_Native_Some,
              .v = extra
            }
          );
      }
      else
        previous_cookie =
          KRML_EABORT(FStar_Pervasives_Native_option__FStar_Bytes_bytes,
            "unreachable (pattern matches are exhaustive in F*)");
    }
    else
      previous_cookie =
        KRML_EABORT(FStar_Pervasives_Native_option__FStar_Bytes_bytes,
          "unreachable (pattern matches are exhaustive in F*)");
    if (sm.tag == FStar_Error_Error)
    {
      K___Parsers_Alert_alert_Prims_string z = sm.val.case_Error;
      Negotiation_print(Prims_strcat("negotiation failed: ", TLSError_string_of_error(z)));
      return
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_serverMode){
            .tag = FStar_Error_Error,
            .val = { .case_Error = z }
          }
        );
    }
    else if
    (
      sm.tag
      == FStar_Error_Correct
      && sm.val.case_Correct.tag == Negotiation_ServerHelloRetryRequest
    )
    {
      CipherSuite_cipherSuite_ cs = sm.val.case_Correct.val.case_ServerHelloRetryRequest.cs;
      HandshakeMessages_hrr hrr = sm.val.case_Correct.val.case_ServerHelloRetryRequest.hrr;
      Spec_Hash_Definitions_hash_alg ha = TLSConstants_verifyDataHashAlg_of_ciphersuite(cs);
      FStar_Bytes_bytes digest = HandshakeLog_hash_tag(ha, log);
      FStar_Bytes_bytes cookie = Ticket_create_cookie(hrr, digest, FStar_Bytes_empty_bytes);
      HandshakeMessages_hrr uu____1 = hrr;
      KRML_CHECK_SIZE(sizeof (Prims_list__Extensions_extension_), (uint32_t)1U);
      Prims_list__Extensions_extension_
      *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Extensions_extension_));
      buf[0U]
      =
        (
          (Prims_list__Extensions_extension_){
            .tag = Prims_Cons,
            .hd = { .tag = Extensions_E_cookie, .val = { .case_E_cookie = cookie } },
            .tl = hrr.hrr_extensions
          }
        );
      HandshakeMessages_hrr
      hrr1 =
        {
          .hrr_sessionID = uu____1.hrr_sessionID,
          .hrr_cipher_suite = uu____1.hrr_cipher_suite,
          .hrr_extensions = buf
        };
      ns.state[0U] =
        (
          (Negotiation_negotiationState){
            .tag = Negotiation_S_HRR,
            .val = { .case_S_HRR = { .n_offer = offer, .n_hrr = hrr1 } }
          }
        );
      return sm;
    }
    else if (sm.tag == FStar_Error_Correct && sm.val.case_Correct.tag == Negotiation_ServerMode)
    {
      FStar_Pervasives_Native_option__K___uint64_t_Parsers_SignatureScheme_signatureScheme
      cert = sm.val.case_Correct.val.case_ServerMode._1;
      Negotiation_mode m = sm.val.case_Correct.val.case_ServerMode._0;
      TLSConstants_nego_cb nego_cb = ns.cfg.nego_callback;
      FStar_Pervasives_Native_option__Prims_list__Extensions_extension_
      exts = Extensions_app_ext_filter(offer.ch_extensions);
      FStar_Bytes_bytes exts_bytes = HandshakeMessages_optionExtensionsBytes(exts);
      Negotiation_print("Negotiation callback to handle extra extensions and query for stateless retry.");
      Prims_string ite0;
      if (previous_cookie.tag == FStar_Pervasives_Native_Some)
      {
        FStar_Bytes_bytes c = previous_cookie.v;
        ite0 = FStar_Bytes_hex_of_bytes(c);
      }
      else
        ite0 = "none";
      Negotiation_print(Prims_strcat("Application data in cookie: ", ite0));
      TLSConstants_nego_action
      scrut0 =
        nego_cb.negotiate(nego_cb.nego_context,
          m.n_protocol_version,
          exts_bytes,
          previous_cookie);
      if (scrut0.tag == TLSConstants_Nego_abort)
      {
        Negotiation_print("Application requested to abort the handshake.");
        return
          TLSError_fatal__Negotiation_serverMode(Parsers_AlertDescription_Handshake_failure,
            "application aborted the handshake by callback");
      }
      else if (scrut0.tag == TLSConstants_Nego_retry)
      {
        FStar_Bytes_bytes cextra = scrut0.val.case_Nego_retry;
        FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite
        scrut;
        if (m.n_cipher_suite.tag == CipherSuite_NullCipherSuite)
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_NULL_WITH_NULL_NULL } }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite13
          &&
            m.n_cipher_suite.val.case_CipherSuite13._0
            == EverCrypt_AES128_GCM
            && m.n_cipher_suite.val.case_CipherSuite13._1 == Spec_Hash_Definitions_SHA2_256
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_AES_128_GCM_SHA256 } }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite13
          &&
            m.n_cipher_suite.val.case_CipherSuite13._0
            == EverCrypt_AES256_GCM
            && m.n_cipher_suite.val.case_CipherSuite13._1 == Spec_Hash_Definitions_SHA2_384
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_AES_256_GCM_SHA384 } }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite13
          &&
            m.n_cipher_suite.val.case_CipherSuite13._0
            == EverCrypt_CHACHA20_POLY1305
            && m.n_cipher_suite.val.case_CipherSuite13._1 == Spec_Hash_Definitions_SHA2_256
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_CHACHA20_POLY1305_SHA256 }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite13
          &&
            m.n_cipher_suite.val.case_CipherSuite13._0
            == EverCrypt_AES128_CCM
            && m.n_cipher_suite.val.case_CipherSuite13._1 == Spec_Hash_Definitions_SHA2_256
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_AES_128_CCM_SHA256 } }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite13
          &&
            m.n_cipher_suite.val.case_CipherSuite13._0
            == EverCrypt_AES128_CCM8
            && m.n_cipher_suite.val.case_CipherSuite13._1 == Spec_Hash_Definitions_SHA2_256
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_AES_128_CCM_8_SHA256 } }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_RSA
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_None
              &&
                m.n_cipher_suite.val.case_CipherSuite._2.tag
                == CipherSuite_MACOnly
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.val.case_MACOnly
                  == Spec_Hash_Definitions_MD5
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_NULL_MD5 } }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_RSA
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_None
              &&
                m.n_cipher_suite.val.case_CipherSuite._2.tag
                == CipherSuite_MACOnly
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.val.case_MACOnly
                  == Spec_Hash_Definitions_SHA1
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_NULL_SHA } }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_RSA
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_None
              &&
                m.n_cipher_suite.val.case_CipherSuite._2.tag
                == CipherSuite_MACOnly
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.val.case_MACOnly
                  == Spec_Hash_Definitions_SHA2_256
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_NULL_SHA256 } }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_RSA
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_None
              &&
                m.n_cipher_suite.val.case_CipherSuite._2.tag
                == CipherSuite_MtE
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.tag
                  == CipherSuite_Stream
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.val.case_Stream
                    == EverCrypt_RC4_128
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._1
                      == Spec_Hash_Definitions_MD5
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_RC4_128_MD5 } }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_RSA
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_None
              &&
                m.n_cipher_suite.val.case_CipherSuite._2.tag
                == CipherSuite_MtE
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.tag
                  == CipherSuite_Stream
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.val.case_Stream
                    == EverCrypt_RC4_128
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._1
                      == Spec_Hash_Definitions_SHA1
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = { .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_RC4_128_SHA } }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_RSA
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_None
              &&
                m.n_cipher_suite.val.case_CipherSuite._2.tag
                == CipherSuite_MtE
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.tag
                  == CipherSuite_Block
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                    == EverCrypt_TDES_EDE_CBC
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._1
                      == Spec_Hash_Definitions_SHA1
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_3DES_EDE_CBC_SHA }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_RSA
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_None
              &&
                m.n_cipher_suite.val.case_CipherSuite._2.tag
                == CipherSuite_MtE
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.tag
                  == CipherSuite_Block
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                    == EverCrypt_AES128_CBC
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._1
                      == Spec_Hash_Definitions_SHA1
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_AES_128_CBC_SHA }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_RSA
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_None
              &&
                m.n_cipher_suite.val.case_CipherSuite._2.tag
                == CipherSuite_MtE
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.tag
                  == CipherSuite_Block
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                    == EverCrypt_AES256_CBC
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._1
                      == Spec_Hash_Definitions_SHA1
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_AES_256_CBC_SHA }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_RSA
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_None
              &&
                m.n_cipher_suite.val.case_CipherSuite._2.tag
                == CipherSuite_MtE
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.tag
                  == CipherSuite_Block
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                    == EverCrypt_AES128_CBC
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._1
                      == Spec_Hash_Definitions_SHA2_256
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_AES_128_CBC_SHA256 }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_RSA
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_None
              &&
                m.n_cipher_suite.val.case_CipherSuite._2.tag
                == CipherSuite_MtE
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.tag
                  == CipherSuite_Block
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                    == EverCrypt_AES256_CBC
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._1
                      == Spec_Hash_Definitions_SHA2_256
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_AES_256_CBC_SHA256 }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_DHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_Some
              &&
                m.n_cipher_suite.val.case_CipherSuite._1.v
                == CipherSuite_DSA
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.tag
                  == CipherSuite_MtE
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.tag
                    == CipherSuite_Block
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                      == EverCrypt_TDES_EDE_CBC
                      &&
                        m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._1
                        == Spec_Hash_Definitions_SHA1
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_DSS_WITH_3DES_EDE_CBC_SHA }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_DHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_Some
              &&
                m.n_cipher_suite.val.case_CipherSuite._1.v
                == CipherSuite_RSASIG
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.tag
                  == CipherSuite_MtE
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.tag
                    == CipherSuite_Block
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                      == EverCrypt_TDES_EDE_CBC
                      &&
                        m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._1
                        == Spec_Hash_Definitions_SHA1
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_RSA_WITH_3DES_EDE_CBC_SHA }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_DHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_Some
              &&
                m.n_cipher_suite.val.case_CipherSuite._1.v
                == CipherSuite_DSA
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.tag
                  == CipherSuite_MtE
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.tag
                    == CipherSuite_Block
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                      == EverCrypt_AES128_CBC
                      &&
                        m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._1
                        == Spec_Hash_Definitions_SHA1
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_128_CBC_SHA }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_DHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_Some
              &&
                m.n_cipher_suite.val.case_CipherSuite._1.v
                == CipherSuite_RSASIG
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.tag
                  == CipherSuite_MtE
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.tag
                    == CipherSuite_Block
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                      == EverCrypt_AES128_CBC
                      &&
                        m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._1
                        == Spec_Hash_Definitions_SHA1
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_128_CBC_SHA }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_DHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_Some
              &&
                m.n_cipher_suite.val.case_CipherSuite._1.v
                == CipherSuite_DSA
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.tag
                  == CipherSuite_MtE
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.tag
                    == CipherSuite_Block
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                      == EverCrypt_AES256_CBC
                      &&
                        m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._1
                        == Spec_Hash_Definitions_SHA1
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_256_CBC_SHA }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_DHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_Some
              &&
                m.n_cipher_suite.val.case_CipherSuite._1.v
                == CipherSuite_RSASIG
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.tag
                  == CipherSuite_MtE
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.tag
                    == CipherSuite_Block
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                      == EverCrypt_AES256_CBC
                      &&
                        m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._1
                        == Spec_Hash_Definitions_SHA1
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_256_CBC_SHA }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_DHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_Some
              &&
                m.n_cipher_suite.val.case_CipherSuite._1.v
                == CipherSuite_DSA
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.tag
                  == CipherSuite_MtE
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.tag
                    == CipherSuite_Block
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                      == EverCrypt_AES128_CBC
                      &&
                        m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._1
                        == Spec_Hash_Definitions_SHA2_256
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_128_CBC_SHA256 }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_DHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_Some
              &&
                m.n_cipher_suite.val.case_CipherSuite._1.v
                == CipherSuite_RSASIG
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.tag
                  == CipherSuite_MtE
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.tag
                    == CipherSuite_Block
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                      == EverCrypt_AES128_CBC
                      &&
                        m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._1
                        == Spec_Hash_Definitions_SHA2_256
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_128_CBC_SHA256 }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_DHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_Some
              &&
                m.n_cipher_suite.val.case_CipherSuite._1.v
                == CipherSuite_DSA
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.tag
                  == CipherSuite_MtE
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.tag
                    == CipherSuite_Block
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                      == EverCrypt_AES256_CBC
                      &&
                        m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._1
                        == Spec_Hash_Definitions_SHA2_256
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_256_CBC_SHA256 }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_DHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_Some
              &&
                m.n_cipher_suite.val.case_CipherSuite._1.v
                == CipherSuite_RSASIG
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.tag
                  == CipherSuite_MtE
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.tag
                    == CipherSuite_Block
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                      == EverCrypt_AES256_CBC
                      &&
                        m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._1
                        == Spec_Hash_Definitions_SHA2_256
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_256_CBC_SHA256 }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_ECDHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_Some
              &&
                m.n_cipher_suite.val.case_CipherSuite._1.v
                == CipherSuite_RSASIG
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.tag
                  == CipherSuite_MtE
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.tag
                    == CipherSuite_Stream
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.val.case_Stream
                      == EverCrypt_RC4_128
                      &&
                        m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._1
                        == Spec_Hash_Definitions_SHA1
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_RC4_128_SHA }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_ECDHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_Some
              &&
                m.n_cipher_suite.val.case_CipherSuite._1.v
                == CipherSuite_RSASIG
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.tag
                  == CipherSuite_MtE
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.tag
                    == CipherSuite_Block
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                      == EverCrypt_TDES_EDE_CBC
                      &&
                        m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._1
                        == Spec_Hash_Definitions_SHA1
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_ECDHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_Some
              &&
                m.n_cipher_suite.val.case_CipherSuite._1.v
                == CipherSuite_RSASIG
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.tag
                  == CipherSuite_MtE
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.tag
                    == CipherSuite_Block
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                      == EverCrypt_AES128_CBC
                      &&
                        m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._1
                        == Spec_Hash_Definitions_SHA1
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_ECDHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_Some
              &&
                m.n_cipher_suite.val.case_CipherSuite._1.v
                == CipherSuite_RSASIG
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.tag
                  == CipherSuite_MtE
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.tag
                    == CipherSuite_Block
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                      == EverCrypt_AES128_CBC
                      &&
                        m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._1
                        == Spec_Hash_Definitions_SHA2_256
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = {
                    .tag = Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256
                  }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_ECDHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_Some
              &&
                m.n_cipher_suite.val.case_CipherSuite._1.v
                == CipherSuite_RSASIG
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.tag
                  == CipherSuite_MtE
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.tag
                    == CipherSuite_Block
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                      == EverCrypt_AES256_CBC
                      &&
                        m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._1
                        == Spec_Hash_Definitions_SHA1
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_ECDHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_Some
              &&
                m.n_cipher_suite.val.case_CipherSuite._1.v
                == CipherSuite_RSASIG
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.tag
                  == CipherSuite_MtE
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.tag
                    == CipherSuite_Block
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                      == EverCrypt_AES256_CBC
                      &&
                        m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._1
                        == Spec_Hash_Definitions_SHA2_384
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = {
                    .tag = Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384
                  }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_ECDHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_Some
              &&
                m.n_cipher_suite.val.case_CipherSuite._1.v
                == CipherSuite_RSASIG
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.tag
                  == CipherSuite_AEAD
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._0
                    == EverCrypt_AES128_GCM
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._1
                      == Spec_Hash_Definitions_SHA2_256
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = {
                    .tag = Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
                  }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_ECDHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_Some
              &&
                m.n_cipher_suite.val.case_CipherSuite._1.v
                == CipherSuite_ECDSA
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.tag
                  == CipherSuite_AEAD
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._0
                    == EverCrypt_AES128_GCM
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._1
                      == Spec_Hash_Definitions_SHA2_256
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = {
                    .tag = Parsers_CipherSuite_TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
                  }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_ECDHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_Some
              &&
                m.n_cipher_suite.val.case_CipherSuite._1.v
                == CipherSuite_RSASIG
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.tag
                  == CipherSuite_AEAD
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._0
                    == EverCrypt_AES256_GCM
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._1
                      == Spec_Hash_Definitions_SHA2_384
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = {
                    .tag = Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
                  }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_ECDHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_Some
              &&
                m.n_cipher_suite.val.case_CipherSuite._1.v
                == CipherSuite_ECDSA
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.tag
                  == CipherSuite_AEAD
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._0
                    == EverCrypt_AES256_GCM
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._1
                      == Spec_Hash_Definitions_SHA2_384
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = {
                    .tag = Parsers_CipherSuite_TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
                  }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_DHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_None
              &&
                m.n_cipher_suite.val.case_CipherSuite._2.tag
                == CipherSuite_MtE
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.tag
                  == CipherSuite_Stream
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.val.case_Stream
                    == EverCrypt_RC4_128
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._1
                      == Spec_Hash_Definitions_MD5
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_anon_WITH_RC4_128_MD5 }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_DHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_None
              &&
                m.n_cipher_suite.val.case_CipherSuite._2.tag
                == CipherSuite_MtE
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.tag
                  == CipherSuite_Block
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                    == EverCrypt_TDES_EDE_CBC
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._1
                      == Spec_Hash_Definitions_SHA1
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_anon_WITH_3DES_EDE_CBC_SHA }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_DHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_None
              &&
                m.n_cipher_suite.val.case_CipherSuite._2.tag
                == CipherSuite_MtE
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.tag
                  == CipherSuite_Block
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                    == EverCrypt_AES128_CBC
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._1
                      == Spec_Hash_Definitions_SHA1
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_anon_WITH_AES_128_CBC_SHA }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_DHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_None
              &&
                m.n_cipher_suite.val.case_CipherSuite._2.tag
                == CipherSuite_MtE
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.tag
                  == CipherSuite_Block
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                    == EverCrypt_AES256_CBC
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._1
                      == Spec_Hash_Definitions_SHA1
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_anon_WITH_AES_256_CBC_SHA }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_DHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_None
              &&
                m.n_cipher_suite.val.case_CipherSuite._2.tag
                == CipherSuite_MtE
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.tag
                  == CipherSuite_Block
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                    == EverCrypt_AES128_CBC
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._1
                      == Spec_Hash_Definitions_SHA2_256
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_anon_WITH_AES_128_CBC_SHA256 }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_DHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_None
              &&
                m.n_cipher_suite.val.case_CipherSuite._2.tag
                == CipherSuite_MtE
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.tag
                  == CipherSuite_Block
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._0.val.case_Block
                    == EverCrypt_AES256_CBC
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_MtE._1
                      == Spec_Hash_Definitions_SHA2_256
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_anon_WITH_AES_256_CBC_SHA256 }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_RSA
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_None
              &&
                m.n_cipher_suite.val.case_CipherSuite._2.tag
                == CipherSuite_AEAD
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._0
                  == EverCrypt_AES128_GCM
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._1
                    == Spec_Hash_Definitions_SHA2_256
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_AES_128_GCM_SHA256 }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_RSA
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_None
              &&
                m.n_cipher_suite.val.case_CipherSuite._2.tag
                == CipherSuite_AEAD
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._0
                  == EverCrypt_AES256_GCM
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._1
                    == Spec_Hash_Definitions_SHA2_384
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_RSA_WITH_AES_256_GCM_SHA384 }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_DHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_Some
              &&
                m.n_cipher_suite.val.case_CipherSuite._1.v
                == CipherSuite_RSASIG
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.tag
                  == CipherSuite_AEAD
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._0
                    == EverCrypt_AES128_GCM
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._1
                      == Spec_Hash_Definitions_SHA2_256
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_128_GCM_SHA256 }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_DHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_Some
              &&
                m.n_cipher_suite.val.case_CipherSuite._1.v
                == CipherSuite_RSASIG
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.tag
                  == CipherSuite_AEAD
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._0
                    == EverCrypt_AES256_GCM
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._1
                      == Spec_Hash_Definitions_SHA2_384
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_RSA_WITH_AES_256_GCM_SHA384 }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_DH
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_Some
              &&
                m.n_cipher_suite.val.case_CipherSuite._1.v
                == CipherSuite_RSASIG
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.tag
                  == CipherSuite_AEAD
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._0
                    == EverCrypt_AES128_GCM
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._1
                      == Spec_Hash_Definitions_SHA2_256
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_RSA_WITH_AES_128_GCM_SHA256 }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_DH
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_Some
              &&
                m.n_cipher_suite.val.case_CipherSuite._1.v
                == CipherSuite_RSASIG
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.tag
                  == CipherSuite_AEAD
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._0
                    == EverCrypt_AES256_GCM
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._1
                      == Spec_Hash_Definitions_SHA2_384
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_RSA_WITH_AES_256_GCM_SHA384 }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_DHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_Some
              &&
                m.n_cipher_suite.val.case_CipherSuite._1.v
                == CipherSuite_DSA
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.tag
                  == CipherSuite_AEAD
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._0
                    == EverCrypt_AES128_GCM
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._1
                      == Spec_Hash_Definitions_SHA2_256
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_128_GCM_SHA256 }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_DHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_Some
              &&
                m.n_cipher_suite.val.case_CipherSuite._1.v
                == CipherSuite_DSA
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.tag
                  == CipherSuite_AEAD
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._0
                    == EverCrypt_AES256_GCM
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._1
                      == Spec_Hash_Definitions_SHA2_384
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_DHE_DSS_WITH_AES_256_GCM_SHA384 }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_DH
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_Some
              &&
                m.n_cipher_suite.val.case_CipherSuite._1.v
                == CipherSuite_DSA
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.tag
                  == CipherSuite_AEAD
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._0
                    == EverCrypt_AES128_GCM
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._1
                      == Spec_Hash_Definitions_SHA2_256
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_DSS_WITH_AES_128_GCM_SHA256 }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_DH
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_Some
              &&
                m.n_cipher_suite.val.case_CipherSuite._1.v
                == CipherSuite_DSA
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.tag
                  == CipherSuite_AEAD
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._0
                    == EverCrypt_AES256_GCM
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._1
                      == Spec_Hash_Definitions_SHA2_384
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_DSS_WITH_AES_256_GCM_SHA384 }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_DHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_None
              &&
                m.n_cipher_suite.val.case_CipherSuite._2.tag
                == CipherSuite_AEAD
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._0
                  == EverCrypt_AES128_GCM
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._1
                    == Spec_Hash_Definitions_SHA2_256
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_anon_WITH_AES_128_GCM_SHA256 }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_DHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_None
              &&
                m.n_cipher_suite.val.case_CipherSuite._2.tag
                == CipherSuite_AEAD
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._0
                  == EverCrypt_AES256_GCM
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._1
                    == Spec_Hash_Definitions_SHA2_384
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = { .tag = Parsers_CipherSuite_TLS_DH_anon_WITH_AES_256_GCM_SHA384 }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_ECDHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_Some
              &&
                m.n_cipher_suite.val.case_CipherSuite._1.v
                == CipherSuite_RSASIG
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.tag
                  == CipherSuite_AEAD
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._0
                    == EverCrypt_CHACHA20_POLY1305
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._1
                      == Spec_Hash_Definitions_SHA2_256
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = {
                    .tag = Parsers_CipherSuite_TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256
                  }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_ECDHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_Some
              &&
                m.n_cipher_suite.val.case_CipherSuite._1.v
                == CipherSuite_ECDSA
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.tag
                  == CipherSuite_AEAD
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._0
                    == EverCrypt_CHACHA20_POLY1305
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._1
                      == Spec_Hash_Definitions_SHA2_256
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = {
                    .tag = Parsers_CipherSuite_TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256
                  }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_DHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_Some
              &&
                m.n_cipher_suite.val.case_CipherSuite._1.v
                == CipherSuite_RSASIG
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.tag
                  == CipherSuite_AEAD
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._0
                    == EverCrypt_CHACHA20_POLY1305
                    &&
                      m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._1
                      == Spec_Hash_Definitions_SHA2_256
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = {
                    .tag = Parsers_CipherSuite_TLS_DHE_RSA_WITH_CHACHA20_POLY1305_SHA256
                  }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_PSK
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_None
              &&
                m.n_cipher_suite.val.case_CipherSuite._2.tag
                == CipherSuite_AEAD
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._0
                  == EverCrypt_CHACHA20_POLY1305
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._1
                    == Spec_Hash_Definitions_SHA2_256
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = {
                    .tag = Parsers_CipherSuite_TLS_PSK_WITH_CHACHA20_POLY1305_SHA256
                  }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_PSK_ECDHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_None
              &&
                m.n_cipher_suite.val.case_CipherSuite._2.tag
                == CipherSuite_AEAD
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._0
                  == EverCrypt_CHACHA20_POLY1305
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._1
                    == Spec_Hash_Definitions_SHA2_256
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = {
                    .tag = Parsers_CipherSuite_TLS_ECDHE_PSK_WITH_CHACHA20_POLY1305_SHA256
                  }
                }
              }
            );
        else if
        (
          m.n_cipher_suite.tag
          == CipherSuite_CipherSuite
          &&
            m.n_cipher_suite.val.case_CipherSuite._0
            == CipherSuite_Kex_PSK_DHE
            &&
              m.n_cipher_suite.val.case_CipherSuite._1.tag
              == FStar_Pervasives_Native_None
              &&
                m.n_cipher_suite.val.case_CipherSuite._2.tag
                == CipherSuite_AEAD
                &&
                  m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._0
                  == EverCrypt_CHACHA20_POLY1305
                  &&
                    m.n_cipher_suite.val.case_CipherSuite._2.val.case_AEAD._1
                    == Spec_Hash_Definitions_SHA2_256
        )
          scrut =
            (
              (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Parsers_CipherSuite_cipherSuite){
                .tag = FStar_Error_Correct,
                .val = {
                  .case_Correct = {
                    .tag = Parsers_CipherSuite_TLS_DHE_PSK_WITH_CHACHA20_POLY1305_SHA256
                  }
                }
              }
            );
        else
          scrut =
            TLSError_fatal__Parsers_CipherSuite_cipherSuite(Parsers_AlertDescription_Illegal_parameter,
              FStar_Error_perror("CipherSuite.fsti",
                (krml_checked_int_t)290,
                "Invoked on a unknown ciphersuite"));
        Parsers_CipherSuite_cipherSuite ite;
        if (scrut.tag == FStar_Error_Correct)
          ite = scrut.val.case_Correct;
        else
          ite =
            KRML_EABORT(Parsers_CipherSuite_cipherSuite,
              "unreachable (pattern matches are exhaustive in F*)");
        KRML_CHECK_SIZE(sizeof (Prims_list__Extensions_extension_), (uint32_t)1U);
        Prims_list__Extensions_extension_
        *buf0 = KRML_HOST_MALLOC(sizeof (Prims_list__Extensions_extension_));
        buf0[0U] = ((Prims_list__Extensions_extension_){ .tag = Prims_Nil });
        KRML_CHECK_SIZE(sizeof (Prims_list__Extensions_extension_), (uint32_t)1U);
        Prims_list__Extensions_extension_
        *buf1 = KRML_HOST_MALLOC(sizeof (Prims_list__Extensions_extension_));
        buf1[0U]
        =
          (
            (Prims_list__Extensions_extension_){
              .tag = Prims_Cons,
              .hd = {
                .tag = Extensions_E_supported_versions,
                .val = {
                  .case_E_supported_versions = {
                    .tag = Extensions_ServerPV,
                    .val = { .case_ServerPV = { .tag = Parsers_ProtocolVersion_TLS_1p3 } }
                  }
                }
              },
              .tl = buf0
            }
          );
        HandshakeMessages_hrr
        hrr =
          { .hrr_sessionID = offer.ch_sessionID, .hrr_cipher_suite = ite, .hrr_extensions = buf1 };
        Spec_Hash_Definitions_hash_alg
        ha = TLSConstants_verifyDataHashAlg_of_ciphersuite(m.n_cipher_suite);
        FStar_Bytes_bytes digest = HandshakeLog_hash_tag(ha, log);
        FStar_Bytes_bytes cookie = Ticket_create_cookie(hrr, digest, cextra);
        HandshakeMessages_hrr uu____2 = hrr;
        KRML_CHECK_SIZE(sizeof (Prims_list__Extensions_extension_), (uint32_t)1U);
        Prims_list__Extensions_extension_
        *buf = KRML_HOST_MALLOC(sizeof (Prims_list__Extensions_extension_));
        buf[0U]
        =
          (
            (Prims_list__Extensions_extension_){
              .tag = Prims_Cons,
              .hd = { .tag = Extensions_E_cookie, .val = { .case_E_cookie = cookie } },
              .tl = hrr.hrr_extensions
            }
          );
        HandshakeMessages_hrr
        hrr1 =
          {
            .hrr_sessionID = uu____2.hrr_sessionID,
            .hrr_cipher_suite = uu____2.hrr_cipher_suite,
            .hrr_extensions = buf
          };
        ns.state[0U] =
          (
            (Negotiation_negotiationState){
              .tag = Negotiation_S_HRR,
              .val = { .case_S_HRR = { .n_offer = offer, .n_hrr = hrr1 } }
            }
          );
        return
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_serverMode){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = {
                  .tag = Negotiation_ServerHelloRetryRequest,
                  .val = { .case_ServerHelloRetryRequest = { .hrr = hrr1, .cs = m.n_cipher_suite } }
                }
              }
            }
          );
      }
      else if (scrut0.tag == TLSConstants_Nego_accept)
      {
        Prims_list__K___uint16_t_FStar_Bytes_bytes *sexts = scrut0.val.case_Nego_accept;
        Negotiation_print(Prims_strcat("negotiated ",
            Prims_strcat(Parsers_ProtocolVersion_string_of_protocolVersion(m.n_protocol_version),
              Prims_strcat(" ", Negotiation_string_of_ciphersuite(m.n_cipher_suite)))));
        ns.state[0U] =
          (
            (Negotiation_negotiationState){
              .tag = Negotiation_S_ClientHello,
              .val = { .case_S_ClientHello = { .n_mode = m, .n_selected_cert = cert } }
            }
          );
        return
          (
            (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_serverMode){
              .tag = FStar_Error_Correct,
              .val = {
                .case_Correct = {
                  .tag = Negotiation_ServerMode,
                  .val = {
                    .case_ServerMode = {
                      ._0 = m,
                      ._1 = cert,
                      ._2 = Extensions_ext_of_custom(sexts)
                    }
                  }
                }
              }
            }
          );
      }
      else
      {
        KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
          __FILE__,
          __LINE__,
          "unreachable (pattern matches are exhaustive in F*)");
        KRML_HOST_EXIT(255U);
      }
    }
    else
    {
      KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
        __FILE__,
        __LINE__,
        "unreachable (pattern matches are exhaustive in F*)");
      KRML_HOST_EXIT(255U);
    }
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

Prims_dtuple2__CommonDH_group__CommonDH_pre_share_
Negotiation_share_of_serverKeyShare(CommonDH_keyShareEntry ks)
{
  if (ks.tag == CommonDH_Share)
  {
    CommonDH_pre_share_ gy = ks.val.case_Share._1;
    CommonDH_group_ g1 = ks.val.case_Share.g;
    return ((Prims_dtuple2__CommonDH_group__CommonDH_pre_share_){ .fst = g1, .snd = gy });
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_mode
Negotiation_server_ServerShare(
  Negotiation_t ns,
  FStar_Pervasives_Native_option__CommonDH_keyShareEntry ks,
  Prims_list__Extensions_extension_ *app_exts
)
{
  Negotiation_negotiationState scrut = ns.state[0U];
  if (scrut.tag == Negotiation_S_ClientHello)
  {
    FStar_Pervasives_Native_option__K___uint64_t_Parsers_SignatureScheme_signatureScheme
    cert = scrut.val.case_S_ClientHello.n_selected_cert;
    Negotiation_mode mode = scrut.val.case_S_ClientHello.n_mode;
    FStar_Pervasives_Native_option__Prims_list__Extensions_extension_
    cexts = mode.n_offer.ch_extensions;
    Negotiation_print(Prims_strcat("processing client extensions ",
        Negotiation_string_of_option_extensions(cexts)));
    FStar_Pervasives_Native_option__CommonDH_keyShare ite0;
    if (ks.tag == FStar_Pervasives_Native_Some)
    {
      CommonDH_keyShareEntry x = ks.v;
      ite0 =
        (
          (FStar_Pervasives_Native_option__CommonDH_keyShare){
            .tag = FStar_Pervasives_Native_Some,
            .v = { .tag = CommonDH_ServerKeyShare, .val = { .case_ServerKeyShare = x } }
          }
        );
    }
    else if (ks.tag == FStar_Pervasives_Native_None)
      ite0 =
        ((FStar_Pervasives_Native_option__CommonDH_keyShare){ .tag = FStar_Pervasives_Native_None });
    else
      ite0 =
        KRML_EABORT(FStar_Pervasives_Native_option__CommonDH_keyShare,
          "unreachable (pattern matches are exhaustive in F*)");
    FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_FStar_Pervasives_Native_option__Prims_list__Extensions_extension_
    scrut =
      Extensions_negotiateServerExtensions(mode.n_protocol_version,
        cexts,
        mode.n_offer.ch_cipher_suites,
        ns.cfg,
        mode.n_cipher_suite,
        (
          (FStar_Pervasives_Native_option__K___FStar_Bytes_bytes_FStar_Bytes_bytes){
            .tag = FStar_Pervasives_Native_None
          }
        ),
        mode.n_pski,
        ite0,
        __eq__FStar_Bytes_bytes(mode.n_sessionID, mode.n_offer.ch_sessionID));
    if (scrut.tag == FStar_Error_Error)
    {
      K___Parsers_Alert_alert_Prims_string z = scrut.val.case_Error;
      return
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_mode){
            .tag = FStar_Error_Error,
            .val = { .case_Error = z }
          }
        );
    }
    else if (scrut.tag == FStar_Error_Correct)
    {
      FStar_Pervasives_Native_option__Prims_list__Extensions_extension_
      sexts = scrut.val.case_Correct;
      Negotiation_print(Prims_strcat("including server extensions (SH + EE) ",
          Negotiation_string_of_option_extensions(sexts)));
      FStar_Pervasives_Native_option__Prims_list__Extensions_extension_ sexts1;
      if (sexts.tag == FStar_Pervasives_Native_Some)
      {
        Prims_list__Extensions_extension_ *el = sexts.v;
        Negotiation_print(Prims_strcat("extra extensions from application callback: ",
            Extensions_string_of_extensions____(app_exts)));
        sexts1 =
          (
            (FStar_Pervasives_Native_option__Prims_list__Extensions_extension_){
              .tag = FStar_Pervasives_Native_Some,
              .v = FStar_List_Tot_Base_append__Extensions_extension_(el, app_exts)
            }
          );
      }
      else
        sexts1 = sexts;
      FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_ ite;
      if (ks.tag == FStar_Pervasives_Native_Some)
      {
        CommonDH_keyShareEntry x = ks.v;
        ite =
          (
            (FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_){
              .tag = FStar_Pervasives_Native_Some,
              .v = Negotiation_share_of_serverKeyShare(x)
            }
          );
      }
      else if (ks.tag == FStar_Pervasives_Native_None)
        ite =
          (
            (FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_){
              .tag = FStar_Pervasives_Native_None
            }
          );
      else
        ite =
          KRML_EABORT(FStar_Pervasives_Native_option__Prims_dtuple2__CommonDH_group__CommonDH_pre_share_,
            "unreachable (pattern matches are exhaustive in F*)");
      Negotiation_mode
      mode1 =
        {
          .n_offer = mode.n_offer, .n_hrr = mode.n_hrr,
          .n_protocol_version = mode.n_protocol_version, .n_server_random = mode.n_server_random,
          .n_sessionID = mode.n_sessionID, .n_cipher_suite = mode.n_cipher_suite,
          .n_pski = mode.n_pski, .n_server_extensions = sexts1, .n_server_share = ite,
          .n_client_cert_request = mode.n_client_cert_request, .n_server_cert = mode.n_server_cert,
          .n_client_share = mode.n_client_share
        };
      ns.state[0U] =
        (
          (Negotiation_negotiationState){
            .tag = Negotiation_S_Mode,
            .val = { .case_S_Mode = { .n_mode = mode1, .n_selected_cert = cert } }
          }
        );
      return
        (
          (FStar_Error_optResult__K___Parsers_Alert_alert_Prims_string_Negotiation_mode){
            .tag = FStar_Error_Correct,
            .val = { .case_Correct = mode1 }
          }
        );
    }
    else
    {
      KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
        __FILE__,
        __LINE__,
        "unreachable (pattern matches are exhaustive in F*)");
      KRML_HOST_EXIT(255U);
    }
  }
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

Prims_list__FStar_Bytes_bytes
*Negotiation___proj__Mkhs_id__item__id_cert(Negotiation_hs_id projectee)
{
  return projectee.id_cert;
}

FStar_Pervasives_Native_option__Parsers_SignatureScheme_signatureScheme
Negotiation___proj__Mkhs_id__item__id_sigalg(Negotiation_hs_id projectee)
{
  return projectee.id_sigalg;
}

FStar_Pervasives_Native_option__Negotiation_mode
Negotiation___proj__Mksession__item__session_nego(
  FStar_Pervasives_Native_option__Negotiation_mode projectee
)
{
  return projectee;
}

bool Negotiation_uu___is_Fresh(Negotiation_handshake projectee)
{
  if (projectee.tag == Negotiation_Fresh)
    return true;
  else
    return false;
}

FStar_Pervasives_Native_option__Negotiation_mode
Negotiation___proj__Fresh__item___0(Negotiation_handshake projectee)
{
  if (projectee.tag == Negotiation_Fresh)
    return projectee.val.case_Fresh;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

bool Negotiation_uu___is_Resumed(Negotiation_handshake projectee)
{
  if (projectee.tag == Negotiation_Resumed)
    return true;
  else
    return false;
}

FStar_Pervasives_Native_option__Negotiation_mode
Negotiation___proj__Resumed__item___0(Negotiation_handshake projectee)
{
  if (projectee.tag == Negotiation_Resumed)
    return projectee.val.case_Resumed;
  else
  {
    KRML_HOST_EPRINTF("KreMLin abort at %s:%d\n%s\n",
      __FILE__,
      __LINE__,
      "unreachable (pattern matches are exhaustive in F*)");
    KRML_HOST_EXIT(255U);
  }
}

